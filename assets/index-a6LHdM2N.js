(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const U of document.querySelectorAll('link[rel="modulepreload"]'))O(U);new MutationObserver(U=>{for(const $ of U)if($.type==="childList")for(const ee of $.addedNodes)ee.tagName==="LINK"&&ee.rel==="modulepreload"&&O(ee)}).observe(document,{childList:!0,subtree:!0});function I(U){const $={};return U.integrity&&($.integrity=U.integrity),U.referrerPolicy&&($.referrerPolicy=U.referrerPolicy),U.crossOrigin==="use-credentials"?$.credentials="include":U.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function O(U){if(U.ep)return;U.ep=!0;const $=I(U);fetch(U.href,$)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function i1(d){const v=Object.create(null);for(const I of d.split(","))v[I]=1;return I=>I in v}const br={},Xp=[],Hc=()=>{},kE=()=>!1,Ky=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&(d.charCodeAt(2)>122||d.charCodeAt(2)<97),n1=d=>d.startsWith("onUpdate:"),No=Object.assign,r1=(d,v)=>{const I=d.indexOf(v);I>-1&&d.splice(I,1)},FE=Object.prototype.hasOwnProperty,lr=(d,v)=>FE.call(d,v),dn=Array.isArray,Yp=d=>Jy(d)==="[object Map]",R2=d=>Jy(d)==="[object Set]",xn=d=>typeof d=="function",xo=d=>typeof d=="string",Ju=d=>typeof d=="symbol",Zr=d=>d!==null&&typeof d=="object",D2=d=>(Zr(d)||xn(d))&&xn(d.then)&&xn(d.catch),L2=Object.prototype.toString,Jy=d=>L2.call(d),BE=d=>Jy(d).slice(8,-1),z2=d=>Jy(d)==="[object Object]",o1=d=>xo(d)&&d!=="NaN"&&d[0]!=="-"&&""+parseInt(d,10)===d,v_=i1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Qy=d=>{const v=Object.create(null);return I=>v[I]||(v[I]=d(I))},NE=/-(\w)/g,cl=Qy(d=>d.replace(NE,(v,I)=>I?I.toUpperCase():"")),UE=/\B([A-Z])/g,Hd=Qy(d=>d.replace(UE,"-$1").toLowerCase()),e0=Qy(d=>d.charAt(0).toUpperCase()+d.slice(1)),ev=Qy(d=>d?`on${e0(d)}`:""),af=(d,v)=>!Object.is(d,v),zy=(d,...v)=>{for(let I=0;I<d.length;I++)d[I](...v)},O2=(d,v,I,O=!1)=>{Object.defineProperty(d,v,{configurable:!0,enumerable:!1,writable:O,value:I})},wv=d=>{const v=parseFloat(d);return isNaN(v)?d:v};let iw;const t0=()=>iw||(iw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function s1(d){if(dn(d)){const v={};for(let I=0;I<d.length;I++){const O=d[I],U=xo(O)?qE(O):s1(O);if(U)for(const $ in U)v[$]=U[$]}return v}else if(xo(d)||Zr(d))return d}const VE=/;(?![^(]*\))/g,jE=/:([^]+)/,GE=/\/\*[^]*?\*\//g;function qE(d){const v={};return d.replace(GE,"").split(VE).forEach(I=>{if(I){const O=I.split(jE);O.length>1&&(v[O[0].trim()]=O[1].trim())}}),v}function a1(d){let v="";if(xo(d))v=d;else if(dn(d))for(let I=0;I<d.length;I++){const O=a1(d[I]);O&&(v+=O+" ")}else if(Zr(d))for(const I in d)d[I]&&(v+=I+" ");return v.trim()}const $E="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",HE=i1($E);function k2(d){return!!d||d===""}const F2=d=>!!(d&&d.__v_isRef===!0),Tv=d=>xo(d)?d:d==null?"":dn(d)||Zr(d)&&(d.toString===L2||!xn(d.toString))?F2(d)?Tv(d.value):JSON.stringify(d,B2,2):String(d),B2=(d,v)=>F2(v)?B2(d,v.value):Yp(v)?{[`Map(${v.size})`]:[...v.entries()].reduce((I,[O,U],$)=>(I[tv(O,$)+" =>"]=U,I),{})}:R2(v)?{[`Set(${v.size})`]:[...v.values()].map(I=>tv(I))}:Ju(v)?tv(v):Zr(v)&&!dn(v)&&!z2(v)?String(v):v,tv=(d,v="")=>{var I;return Ju(d)?`Symbol(${(I=d.description)!=null?I:v})`:d};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ka;class WE{constructor(v=!1){this.detached=v,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ka,!v&&ka&&(this.index=(ka.scopes||(ka.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let v,I;if(this.scopes)for(v=0,I=this.scopes.length;v<I;v++)this.scopes[v].pause();for(v=0,I=this.effects.length;v<I;v++)this.effects[v].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let v,I;if(this.scopes)for(v=0,I=this.scopes.length;v<I;v++)this.scopes[v].resume();for(v=0,I=this.effects.length;v<I;v++)this.effects[v].resume()}}run(v){if(this._active){const I=ka;try{return ka=this,v()}finally{ka=I}}}on(){ka=this}off(){ka=this.parent}stop(v){if(this._active){this._active=!1;let I,O;for(I=0,O=this.effects.length;I<O;I++)this.effects[I].stop();for(this.effects.length=0,I=0,O=this.cleanups.length;I<O;I++)this.cleanups[I]();if(this.cleanups.length=0,this.scopes){for(I=0,O=this.scopes.length;I<O;I++)this.scopes[I].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!v){const U=this.parent.scopes.pop();U&&U!==this&&(this.parent.scopes[this.index]=U,U.index=this.index)}this.parent=void 0}}}function ZE(){return ka}let Cr;const iv=new WeakSet;class N2{constructor(v){this.fn=v,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ka&&ka.active&&ka.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,iv.has(this)&&(iv.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||V2(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,nw(this),j2(this);const v=Cr,I=Yl;Cr=this,Yl=!0;try{return this.fn()}finally{G2(this),Cr=v,Yl=I,this.flags&=-3}}stop(){if(this.flags&1){for(let v=this.deps;v;v=v.nextDep)u1(v);this.deps=this.depsTail=void 0,nw(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?iv.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Sv(this)&&this.run()}get dirty(){return Sv(this)}}let U2=0,b_,w_;function V2(d,v=!1){if(d.flags|=8,v){d.next=w_,w_=d;return}d.next=b_,b_=d}function l1(){U2++}function c1(){if(--U2>0)return;if(w_){let v=w_;for(w_=void 0;v;){const I=v.next;v.next=void 0,v.flags&=-9,v=I}}let d;for(;b_;){let v=b_;for(b_=void 0;v;){const I=v.next;if(v.next=void 0,v.flags&=-9,v.flags&1)try{v.trigger()}catch(O){d||(d=O)}v=I}}if(d)throw d}function j2(d){for(let v=d.deps;v;v=v.nextDep)v.version=-1,v.prevActiveLink=v.dep.activeLink,v.dep.activeLink=v}function G2(d){let v,I=d.depsTail,O=I;for(;O;){const U=O.prevDep;O.version===-1?(O===I&&(I=U),u1(O),XE(O)):v=O,O.dep.activeLink=O.prevActiveLink,O.prevActiveLink=void 0,O=U}d.deps=v,d.depsTail=I}function Sv(d){for(let v=d.deps;v;v=v.nextDep)if(v.dep.version!==v.version||v.dep.computed&&(q2(v.dep.computed)||v.dep.version!==v.version))return!0;return!!d._dirty}function q2(d){if(d.flags&4&&!(d.flags&16)||(d.flags&=-17,d.globalVersion===P_))return;d.globalVersion=P_;const v=d.dep;if(d.flags|=2,v.version>0&&!d.isSSR&&d.deps&&!Sv(d)){d.flags&=-3;return}const I=Cr,O=Yl;Cr=d,Yl=!0;try{j2(d);const U=d.fn(d._value);(v.version===0||af(U,d._value))&&(d._value=U,v.version++)}catch(U){throw v.version++,U}finally{Cr=I,Yl=O,G2(d),d.flags&=-3}}function u1(d,v=!1){const{dep:I,prevSub:O,nextSub:U}=d;if(O&&(O.nextSub=U,d.prevSub=void 0),U&&(U.prevSub=O,d.nextSub=void 0),I.subs===d&&(I.subs=O,!O&&I.computed)){I.computed.flags&=-5;for(let $=I.computed.deps;$;$=$.nextDep)u1($,!0)}!v&&!--I.sc&&I.map&&I.map.delete(I.key)}function XE(d){const{prevDep:v,nextDep:I}=d;v&&(v.nextDep=I,d.prevDep=void 0),I&&(I.prevDep=v,d.nextDep=void 0)}let Yl=!0;const $2=[];function ff(){$2.push(Yl),Yl=!1}function df(){const d=$2.pop();Yl=d===void 0?!0:d}function nw(d){const{cleanup:v}=d;if(d.cleanup=void 0,v){const I=Cr;Cr=void 0;try{v()}finally{Cr=I}}}let P_=0;class YE{constructor(v,I){this.sub=v,this.dep=I,this.version=I.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class h1{constructor(v){this.computed=v,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(v){if(!Cr||!Yl||Cr===this.computed)return;let I=this.activeLink;if(I===void 0||I.sub!==Cr)I=this.activeLink=new YE(Cr,this),Cr.deps?(I.prevDep=Cr.depsTail,Cr.depsTail.nextDep=I,Cr.depsTail=I):Cr.deps=Cr.depsTail=I,H2(I);else if(I.version===-1&&(I.version=this.version,I.nextDep)){const O=I.nextDep;O.prevDep=I.prevDep,I.prevDep&&(I.prevDep.nextDep=O),I.prevDep=Cr.depsTail,I.nextDep=void 0,Cr.depsTail.nextDep=I,Cr.depsTail=I,Cr.deps===I&&(Cr.deps=O)}return I}trigger(v){this.version++,P_++,this.notify(v)}notify(v){l1();try{for(let I=this.subs;I;I=I.prevSub)I.sub.notify()&&I.sub.dep.notify()}finally{c1()}}}function H2(d){if(d.dep.sc++,d.sub.flags&4){const v=d.dep.computed;if(v&&!d.dep.subs){v.flags|=20;for(let O=v.deps;O;O=O.nextDep)H2(O)}const I=d.dep.subs;I!==d&&(d.prevSub=I,I&&(I.nextSub=d)),d.dep.subs=d}}const Ev=new WeakMap,jd=Symbol(""),Av=Symbol(""),R_=Symbol("");function _s(d,v,I){if(Yl&&Cr){let O=Ev.get(d);O||Ev.set(d,O=new Map);let U=O.get(I);U||(O.set(I,U=new h1),U.map=O,U.key=I),U.track()}}function Hu(d,v,I,O,U,$){const ee=Ev.get(d);if(!ee){P_++;return}const o=ue=>{ue&&ue.trigger()};if(l1(),v==="clear")ee.forEach(o);else{const ue=dn(d),Re=ue&&o1(I);if(ue&&I==="length"){const xe=Number(O);ee.forEach((Oe,Ke)=>{(Ke==="length"||Ke===R_||!Ju(Ke)&&Ke>=xe)&&o(Oe)})}else switch((I!==void 0||ee.has(void 0))&&o(ee.get(I)),Re&&o(ee.get(R_)),v){case"add":ue?Re&&o(ee.get("length")):(o(ee.get(jd)),Yp(d)&&o(ee.get(Av)));break;case"delete":ue||(o(ee.get(jd)),Yp(d)&&o(ee.get(Av)));break;case"set":Yp(d)&&o(ee.get(jd));break}}c1()}function qp(d){const v=ar(d);return v===d?v:(_s(v,"iterate",R_),ll(d)?v:v.map(gs))}function i0(d){return _s(d=ar(d),"iterate",R_),d}const KE={__proto__:null,[Symbol.iterator](){return nv(this,Symbol.iterator,gs)},concat(...d){return qp(this).concat(...d.map(v=>dn(v)?qp(v):v))},entries(){return nv(this,"entries",d=>(d[1]=gs(d[1]),d))},every(d,v){return Gu(this,"every",d,v,void 0,arguments)},filter(d,v){return Gu(this,"filter",d,v,I=>I.map(gs),arguments)},find(d,v){return Gu(this,"find",d,v,gs,arguments)},findIndex(d,v){return Gu(this,"findIndex",d,v,void 0,arguments)},findLast(d,v){return Gu(this,"findLast",d,v,gs,arguments)},findLastIndex(d,v){return Gu(this,"findLastIndex",d,v,void 0,arguments)},forEach(d,v){return Gu(this,"forEach",d,v,void 0,arguments)},includes(...d){return rv(this,"includes",d)},indexOf(...d){return rv(this,"indexOf",d)},join(d){return qp(this).join(d)},lastIndexOf(...d){return rv(this,"lastIndexOf",d)},map(d,v){return Gu(this,"map",d,v,void 0,arguments)},pop(){return p_(this,"pop")},push(...d){return p_(this,"push",d)},reduce(d,...v){return rw(this,"reduce",d,v)},reduceRight(d,...v){return rw(this,"reduceRight",d,v)},shift(){return p_(this,"shift")},some(d,v){return Gu(this,"some",d,v,void 0,arguments)},splice(...d){return p_(this,"splice",d)},toReversed(){return qp(this).toReversed()},toSorted(d){return qp(this).toSorted(d)},toSpliced(...d){return qp(this).toSpliced(...d)},unshift(...d){return p_(this,"unshift",d)},values(){return nv(this,"values",gs)}};function nv(d,v,I){const O=i0(d),U=O[v]();return O!==d&&!ll(d)&&(U._next=U.next,U.next=()=>{const $=U._next();return $.value&&($.value=I($.value)),$}),U}const JE=Array.prototype;function Gu(d,v,I,O,U,$){const ee=i0(d),o=ee!==d&&!ll(d),ue=ee[v];if(ue!==JE[v]){const Oe=ue.apply(d,$);return o?gs(Oe):Oe}let Re=I;ee!==d&&(o?Re=function(Oe,Ke){return I.call(this,gs(Oe),Ke,d)}:I.length>2&&(Re=function(Oe,Ke){return I.call(this,Oe,Ke,d)}));const xe=ue.call(ee,Re,O);return o&&U?U(xe):xe}function rw(d,v,I,O){const U=i0(d);let $=I;return U!==d&&(ll(d)?I.length>3&&($=function(ee,o,ue){return I.call(this,ee,o,ue,d)}):$=function(ee,o,ue){return I.call(this,ee,gs(o),ue,d)}),U[v]($,...O)}function rv(d,v,I){const O=ar(d);_s(O,"iterate",R_);const U=O[v](...I);return(U===-1||U===!1)&&p1(I[0])?(I[0]=ar(I[0]),O[v](...I)):U}function p_(d,v,I=[]){ff(),l1();const O=ar(d)[v].apply(d,I);return c1(),df(),O}const QE=i1("__proto__,__v_isRef,__isVue"),W2=new Set(Object.getOwnPropertyNames(Symbol).filter(d=>d!=="arguments"&&d!=="caller").map(d=>Symbol[d]).filter(Ju));function eA(d){Ju(d)||(d=String(d));const v=ar(this);return _s(v,"has",d),v.hasOwnProperty(d)}class Z2{constructor(v=!1,I=!1){this._isReadonly=v,this._isShallow=I}get(v,I,O){if(I==="__v_skip")return v.__v_skip;const U=this._isReadonly,$=this._isShallow;if(I==="__v_isReactive")return!U;if(I==="__v_isReadonly")return U;if(I==="__v_isShallow")return $;if(I==="__v_raw")return O===(U?$?uA:J2:$?K2:Y2).get(v)||Object.getPrototypeOf(v)===Object.getPrototypeOf(O)?v:void 0;const ee=dn(v);if(!U){let ue;if(ee&&(ue=KE[I]))return ue;if(I==="hasOwnProperty")return eA}const o=Reflect.get(v,I,xs(v)?v:O);return(Ju(I)?W2.has(I):QE(I))||(U||_s(v,"get",I),$)?o:xs(o)?ee&&o1(I)?o:o.value:Zr(o)?U?eT(o):n0(o):o}}class X2 extends Z2{constructor(v=!1){super(!1,v)}set(v,I,O,U){let $=v[I];if(!this._isShallow){const ue=Gd($);if(!ll(O)&&!Gd(O)&&($=ar($),O=ar(O)),!dn(v)&&xs($)&&!xs(O))return ue?!1:($.value=O,!0)}const ee=dn(v)&&o1(I)?Number(I)<v.length:lr(v,I),o=Reflect.set(v,I,O,xs(v)?v:U);return v===ar(U)&&(ee?af(O,$)&&Hu(v,"set",I,O):Hu(v,"add",I,O)),o}deleteProperty(v,I){const O=lr(v,I);v[I];const U=Reflect.deleteProperty(v,I);return U&&O&&Hu(v,"delete",I,void 0),U}has(v,I){const O=Reflect.has(v,I);return(!Ju(I)||!W2.has(I))&&_s(v,"has",I),O}ownKeys(v){return _s(v,"iterate",dn(v)?"length":jd),Reflect.ownKeys(v)}}class tA extends Z2{constructor(v=!1){super(!0,v)}set(v,I){return!0}deleteProperty(v,I){return!0}}const iA=new X2,nA=new tA,rA=new X2(!0);const Mv=d=>d,Iy=d=>Reflect.getPrototypeOf(d);function oA(d,v,I){return function(...O){const U=this.__v_raw,$=ar(U),ee=Yp($),o=d==="entries"||d===Symbol.iterator&&ee,ue=d==="keys"&&ee,Re=U[d](...O),xe=I?Mv:v?Iv:gs;return!v&&_s($,"iterate",ue?Av:jd),{next(){const{value:Oe,done:Ke}=Re.next();return Ke?{value:Oe,done:Ke}:{value:o?[xe(Oe[0]),xe(Oe[1])]:xe(Oe),done:Ke}},[Symbol.iterator](){return this}}}}function Cy(d){return function(...v){return d==="delete"?!1:d==="clear"?void 0:this}}function sA(d,v){const I={get(U){const $=this.__v_raw,ee=ar($),o=ar(U);d||(af(U,o)&&_s(ee,"get",U),_s(ee,"get",o));const{has:ue}=Iy(ee),Re=v?Mv:d?Iv:gs;if(ue.call(ee,U))return Re($.get(U));if(ue.call(ee,o))return Re($.get(o));$!==ee&&$.get(U)},get size(){const U=this.__v_raw;return!d&&_s(ar(U),"iterate",jd),Reflect.get(U,"size",U)},has(U){const $=this.__v_raw,ee=ar($),o=ar(U);return d||(af(U,o)&&_s(ee,"has",U),_s(ee,"has",o)),U===o?$.has(U):$.has(U)||$.has(o)},forEach(U,$){const ee=this,o=ee.__v_raw,ue=ar(o),Re=v?Mv:d?Iv:gs;return!d&&_s(ue,"iterate",jd),o.forEach((xe,Oe)=>U.call($,Re(xe),Re(Oe),ee))}};return No(I,d?{add:Cy("add"),set:Cy("set"),delete:Cy("delete"),clear:Cy("clear")}:{add(U){!v&&!ll(U)&&!Gd(U)&&(U=ar(U));const $=ar(this);return Iy($).has.call($,U)||($.add(U),Hu($,"add",U,U)),this},set(U,$){!v&&!ll($)&&!Gd($)&&($=ar($));const ee=ar(this),{has:o,get:ue}=Iy(ee);let Re=o.call(ee,U);Re||(U=ar(U),Re=o.call(ee,U));const xe=ue.call(ee,U);return ee.set(U,$),Re?af($,xe)&&Hu(ee,"set",U,$):Hu(ee,"add",U,$),this},delete(U){const $=ar(this),{has:ee,get:o}=Iy($);let ue=ee.call($,U);ue||(U=ar(U),ue=ee.call($,U)),o&&o.call($,U);const Re=$.delete(U);return ue&&Hu($,"delete",U,void 0),Re},clear(){const U=ar(this),$=U.size!==0,ee=U.clear();return $&&Hu(U,"clear",void 0,void 0),ee}}),["keys","values","entries",Symbol.iterator].forEach(U=>{I[U]=oA(U,d,v)}),I}function f1(d,v){const I=sA(d,v);return(O,U,$)=>U==="__v_isReactive"?!d:U==="__v_isReadonly"?d:U==="__v_raw"?O:Reflect.get(lr(I,U)&&U in O?I:O,U,$)}const aA={get:f1(!1,!1)},lA={get:f1(!1,!0)},cA={get:f1(!0,!1)};const Y2=new WeakMap,K2=new WeakMap,J2=new WeakMap,uA=new WeakMap;function hA(d){switch(d){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function fA(d){return d.__v_skip||!Object.isExtensible(d)?0:hA(BE(d))}function n0(d){return Gd(d)?d:d1(d,!1,iA,aA,Y2)}function Q2(d){return d1(d,!1,rA,lA,K2)}function eT(d){return d1(d,!0,nA,cA,J2)}function d1(d,v,I,O,U){if(!Zr(d)||d.__v_raw&&!(v&&d.__v_isReactive))return d;const $=U.get(d);if($)return $;const ee=fA(d);if(ee===0)return d;const o=new Proxy(d,ee===2?O:I);return U.set(d,o),o}function Kp(d){return Gd(d)?Kp(d.__v_raw):!!(d&&d.__v_isReactive)}function Gd(d){return!!(d&&d.__v_isReadonly)}function ll(d){return!!(d&&d.__v_isShallow)}function p1(d){return d?!!d.__v_raw:!1}function ar(d){const v=d&&d.__v_raw;return v?ar(v):d}function dA(d){return!lr(d,"__v_skip")&&Object.isExtensible(d)&&O2(d,"__v_skip",!0),d}const gs=d=>Zr(d)?n0(d):d,Iv=d=>Zr(d)?eT(d):d;function xs(d){return d?d.__v_isRef===!0:!1}function pA(d){return tT(d,!1)}function mA(d){return tT(d,!0)}function tT(d,v){return xs(d)?d:new _A(d,v)}class _A{constructor(v,I){this.dep=new h1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=I?v:ar(v),this._value=I?v:gs(v),this.__v_isShallow=I}get value(){return this.dep.track(),this._value}set value(v){const I=this._rawValue,O=this.__v_isShallow||ll(v)||Gd(v);v=O?v:ar(v),af(v,I)&&(this._rawValue=v,this._value=O?v:gs(v),this.dep.trigger())}}function Jp(d){return xs(d)?d.value:d}const gA={get:(d,v,I)=>v==="__v_raw"?d:Jp(Reflect.get(d,v,I)),set:(d,v,I,O)=>{const U=d[v];return xs(U)&&!xs(I)?(U.value=I,!0):Reflect.set(d,v,I,O)}};function iT(d){return Kp(d)?d:new Proxy(d,gA)}class yA{constructor(v,I,O){this.fn=v,this.setter=I,this._value=void 0,this.dep=new h1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=P_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!I,this.isSSR=O}notify(){if(this.flags|=16,!(this.flags&8)&&Cr!==this)return V2(this,!0),!0}get value(){const v=this.dep.track();return q2(this),v&&(v.version=this.dep.version),this._value}set value(v){this.setter&&this.setter(v)}}function xA(d,v,I=!1){let O,U;return xn(d)?O=d:(O=d.get,U=d.set),new yA(O,U,I)}const Py={},Vy=new WeakMap;let Ud;function vA(d,v=!1,I=Ud){if(I){let O=Vy.get(I);O||Vy.set(I,O=[]),O.push(d)}}function bA(d,v,I=br){const{immediate:O,deep:U,once:$,scheduler:ee,augmentJob:o,call:ue}=I,Re=At=>U?At:ll(At)||U===!1||U===0?Wu(At,1):Wu(At);let xe,Oe,Ke,st,Rt=!1,It=!1;if(xs(d)?(Oe=()=>d.value,Rt=ll(d)):Kp(d)?(Oe=()=>Re(d),Rt=!0):dn(d)?(It=!0,Rt=d.some(At=>Kp(At)||ll(At)),Oe=()=>d.map(At=>{if(xs(At))return At.value;if(Kp(At))return Re(At);if(xn(At))return ue?ue(At,2):At()})):xn(d)?v?Oe=ue?()=>ue(d,2):d:Oe=()=>{if(Ke){ff();try{Ke()}finally{df()}}const At=Ud;Ud=xe;try{return ue?ue(d,3,[st]):d(st)}finally{Ud=At}}:Oe=Hc,v&&U){const At=Oe,Ri=U===!0?1/0:U;Oe=()=>Wu(At(),Ri)}const ri=ZE(),ft=()=>{xe.stop(),ri&&ri.active&&r1(ri.effects,xe)};if($&&v){const At=v;v=(...Ri)=>{At(...Ri),ft()}}let Dt=It?new Array(d.length).fill(Py):Py;const Yt=At=>{if(!(!(xe.flags&1)||!xe.dirty&&!At))if(v){const Ri=xe.run();if(U||Rt||(It?Ri.some((Sn,Ut)=>af(Sn,Dt[Ut])):af(Ri,Dt))){Ke&&Ke();const Sn=Ud;Ud=xe;try{const Ut=[Ri,Dt===Py?void 0:It&&Dt[0]===Py?[]:Dt,st];ue?ue(v,3,Ut):v(...Ut),Dt=Ri}finally{Ud=Sn}}}else xe.run()};return o&&o(Yt),xe=new N2(Oe),xe.scheduler=ee?()=>ee(Yt,!1):Yt,st=At=>vA(At,!1,xe),Ke=xe.onStop=()=>{const At=Vy.get(xe);if(At){if(ue)ue(At,4);else for(const Ri of At)Ri();Vy.delete(xe)}},v?O?Yt(!0):Dt=xe.run():ee?ee(Yt.bind(null,!0),!0):xe.run(),ft.pause=xe.pause.bind(xe),ft.resume=xe.resume.bind(xe),ft.stop=ft,ft}function Wu(d,v=1/0,I){if(v<=0||!Zr(d)||d.__v_skip||(I=I||new Set,I.has(d)))return d;if(I.add(d),v--,xs(d))Wu(d.value,v,I);else if(dn(d))for(let O=0;O<d.length;O++)Wu(d[O],v,I);else if(R2(d)||Yp(d))d.forEach(O=>{Wu(O,v,I)});else if(z2(d)){for(const O in d)Wu(d[O],v,I);for(const O of Object.getOwnPropertySymbols(d))Object.prototype.propertyIsEnumerable.call(d,O)&&Wu(d[O],v,I)}return d}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function U_(d,v,I,O){try{return O?d(...O):d()}catch(U){r0(U,v,I)}}function Wc(d,v,I,O){if(xn(d)){const U=U_(d,v,I,O);return U&&D2(U)&&U.catch($=>{r0($,v,I)}),U}if(dn(d)){const U=[];for(let $=0;$<d.length;$++)U.push(Wc(d[$],v,I,O));return U}}function r0(d,v,I,O=!0){const U=v?v.vnode:null,{errorHandler:$,throwUnhandledErrorInProduction:ee}=v&&v.appContext.config||br;if(v){let o=v.parent;const ue=v.proxy,Re=`https://vuejs.org/error-reference/#runtime-${I}`;for(;o;){const xe=o.ec;if(xe){for(let Oe=0;Oe<xe.length;Oe++)if(xe[Oe](d,ue,Re)===!1)return}o=o.parent}if($){ff(),U_($,null,10,[d,ue,Re]),df();return}}wA(d,I,U,O,ee)}function wA(d,v,I,O=!0,U=!1){if(U)throw d;console.error(d)}const Ws=[];let Uc=-1;const Qp=[];let rf=null,$p=0;const nT=Promise.resolve();let jy=null;function rT(d){const v=jy||nT;return d?v.then(this?d.bind(this):d):v}function TA(d){let v=Uc+1,I=Ws.length;for(;v<I;){const O=v+I>>>1,U=Ws[O],$=D_(U);$<d||$===d&&U.flags&2?v=O+1:I=O}return v}function m1(d){if(!(d.flags&1)){const v=D_(d),I=Ws[Ws.length-1];!I||!(d.flags&2)&&v>=D_(I)?Ws.push(d):Ws.splice(TA(v),0,d),d.flags|=1,oT()}}function oT(){jy||(jy=nT.then(aT))}function SA(d){dn(d)?Qp.push(...d):rf&&d.id===-1?rf.splice($p+1,0,d):d.flags&1||(Qp.push(d),d.flags|=1),oT()}function ow(d,v,I=Uc+1){for(;I<Ws.length;I++){const O=Ws[I];if(O&&O.flags&2){if(d&&O.id!==d.uid)continue;Ws.splice(I,1),I--,O.flags&4&&(O.flags&=-2),O(),O.flags&4||(O.flags&=-2)}}}function sT(d){if(Qp.length){const v=[...new Set(Qp)].sort((I,O)=>D_(I)-D_(O));if(Qp.length=0,rf){rf.push(...v);return}for(rf=v,$p=0;$p<rf.length;$p++){const I=rf[$p];I.flags&4&&(I.flags&=-2),I.flags&8||I(),I.flags&=-2}rf=null,$p=0}}const D_=d=>d.id==null?d.flags&2?-1:1/0:d.id;function aT(d){try{for(Uc=0;Uc<Ws.length;Uc++){const v=Ws[Uc];v&&!(v.flags&8)&&(v.flags&4&&(v.flags&=-2),U_(v,v.i,v.i?15:14),v.flags&4||(v.flags&=-2))}}finally{for(;Uc<Ws.length;Uc++){const v=Ws[Uc];v&&(v.flags&=-2)}Uc=-1,Ws.length=0,sT(),jy=null,(Ws.length||Qp.length)&&aT()}}let es=null,lT=null;function Gy(d){const v=es;return es=d,lT=d&&d.type.__scopeId||null,v}function cT(d,v=es,I){if(!v||d._n)return d;const O=(...U)=>{O._d&&_w(-1);const $=Gy(v);let ee;try{ee=d(...U)}finally{Gy($),O._d&&_w(1)}return ee};return O._n=!0,O._c=!0,O._d=!0,O}function sw(d,v){if(es===null)return d;const I=l0(es),O=d.dirs||(d.dirs=[]);for(let U=0;U<v.length;U++){let[$,ee,o,ue=br]=v[U];$&&(xn($)&&($={mounted:$,updated:$}),$.deep&&Wu(ee),O.push({dir:$,instance:I,value:ee,oldValue:void 0,arg:o,modifiers:ue}))}return d}function Bd(d,v,I,O){const U=d.dirs,$=v&&v.dirs;for(let ee=0;ee<U.length;ee++){const o=U[ee];$&&(o.oldValue=$[ee].value);let ue=o.dir[O];ue&&(ff(),Wc(ue,I,8,[d.el,o,d,v]),df())}}const EA=Symbol("_vte"),AA=d=>d.__isTeleport;function _1(d,v){d.shapeFlag&6&&d.component?(d.transition=v,_1(d.component.subTree,v)):d.shapeFlag&128?(d.ssContent.transition=v.clone(d.ssContent),d.ssFallback.transition=v.clone(d.ssFallback)):d.transition=v}/*! #__NO_SIDE_EFFECTS__ */function g1(d,v){return xn(d)?No({name:d.name},v,{setup:d}):d}function uT(d){d.ids=[d.ids[0]+d.ids[2]+++"-",0,0]}function qy(d,v,I,O,U=!1){if(dn(d)){d.forEach((Rt,It)=>qy(Rt,v&&(dn(v)?v[It]:v),I,O,U));return}if(em(O)&&!U){O.shapeFlag&512&&O.type.__asyncResolved&&O.component.subTree.component&&qy(d,v,I,O.component.subTree);return}const $=O.shapeFlag&4?l0(O.component):O.el,ee=U?null:$,{i:o,r:ue}=d,Re=v&&v.r,xe=o.refs===br?o.refs={}:o.refs,Oe=o.setupState,Ke=ar(Oe),st=Oe===br?()=>!1:Rt=>lr(Ke,Rt);if(Re!=null&&Re!==ue&&(xo(Re)?(xe[Re]=null,st(Re)&&(Oe[Re]=null)):xs(Re)&&(Re.value=null)),xn(ue))U_(ue,o,12,[ee,xe]);else{const Rt=xo(ue),It=xs(ue);if(Rt||It){const ri=()=>{if(d.f){const ft=Rt?st(ue)?Oe[ue]:xe[ue]:ue.value;U?dn(ft)&&r1(ft,$):dn(ft)?ft.includes($)||ft.push($):Rt?(xe[ue]=[$],st(ue)&&(Oe[ue]=xe[ue])):(ue.value=[$],d.k&&(xe[d.k]=ue.value))}else Rt?(xe[ue]=ee,st(ue)&&(Oe[ue]=ee)):It&&(ue.value=ee,d.k&&(xe[d.k]=ee))};ee?(ri.id=-1,Oa(ri,I)):ri()}}}t0().requestIdleCallback;t0().cancelIdleCallback;const em=d=>!!d.type.__asyncLoader,hT=d=>d.type.__isKeepAlive;function MA(d,v){fT(d,"a",v)}function IA(d,v){fT(d,"da",v)}function fT(d,v,I=ys){const O=d.__wdc||(d.__wdc=()=>{let U=I;for(;U;){if(U.isDeactivated)return;U=U.parent}return d()});if(o0(v,O,I),I){let U=I.parent;for(;U&&U.parent;)hT(U.parent.vnode)&&CA(O,v,I,U),U=U.parent}}function CA(d,v,I,O){const U=o0(v,d,O,!0);dT(()=>{r1(O[v],U)},I)}function o0(d,v,I=ys,O=!1){if(I){const U=I[d]||(I[d]=[]),$=v.__weh||(v.__weh=(...ee)=>{ff();const o=V_(I),ue=Wc(v,I,d,ee);return o(),df(),ue});return O?U.unshift($):U.push($),$}}const Qu=d=>(v,I=ys)=>{(!O_||d==="sp")&&o0(d,(...O)=>v(...O),I)},PA=Qu("bm"),RA=Qu("m"),DA=Qu("bu"),LA=Qu("u"),zA=Qu("bum"),dT=Qu("um"),OA=Qu("sp"),kA=Qu("rtg"),FA=Qu("rtc");function BA(d,v=ys){o0("ec",d,v)}const NA="components";function $y(d,v){return VA(NA,d,!0,v)||d}const UA=Symbol.for("v-ndc");function VA(d,v,I=!0,O=!1){const U=es||ys;if(U){const $=U.type;{const o=CM($,!1);if(o&&(o===v||o===cl(v)||o===e0(cl(v))))return $}const ee=aw(U[d]||$[d],v)||aw(U.appContext[d],v);return!ee&&O?$:ee}}function aw(d,v){return d&&(d[v]||d[cl(v)]||d[e0(cl(v))])}function lw(d,v,I,O){let U;const $=I,ee=dn(d);if(ee||xo(d)){const o=ee&&Kp(d);let ue=!1;o&&(ue=!ll(d),d=i0(d)),U=new Array(d.length);for(let Re=0,xe=d.length;Re<xe;Re++)U[Re]=v(ue?gs(d[Re]):d[Re],Re,void 0,$)}else if(typeof d=="number"){U=new Array(d);for(let o=0;o<d;o++)U[o]=v(o+1,o,void 0,$)}else if(Zr(d))if(d[Symbol.iterator])U=Array.from(d,(o,ue)=>v(o,ue,void 0,$));else{const o=Object.keys(d);U=new Array(o.length);for(let ue=0,Re=o.length;ue<Re;ue++){const xe=o[ue];U[ue]=v(d[xe],xe,ue,$)}}else U=[];return U}function jA(d,v,I={},O,U){if(es.ce||es.parent&&em(es.parent)&&es.parent.ce)return Fa(),Lv(da,null,[yo("slot",I,O)],64);let $=d[v];$&&$._c&&($._d=!1),Fa();const ee=$&&pT($(I)),o=I.key||ee&&ee.key,ue=Lv(da,{key:(o&&!Ju(o)?o:`_${v}`)+(!ee&&O?"_fb":"")},ee||[],ee&&d._===1?64:-2);return ue.scopeId&&(ue.slotScopeIds=[ue.scopeId+"-s"]),$&&$._c&&($._d=!0),ue}function pT(d){return d.some(v=>z_(v)?!(v.type===lf||v.type===da&&!pT(v.children)):!0)?d:null}const Cv=d=>d?zT(d)?l0(d):Cv(d.parent):null,T_=No(Object.create(null),{$:d=>d,$el:d=>d.vnode.el,$data:d=>d.data,$props:d=>d.props,$attrs:d=>d.attrs,$slots:d=>d.slots,$refs:d=>d.refs,$parent:d=>Cv(d.parent),$root:d=>Cv(d.root),$host:d=>d.ce,$emit:d=>d.emit,$options:d=>y1(d),$forceUpdate:d=>d.f||(d.f=()=>{m1(d.update)}),$nextTick:d=>d.n||(d.n=rT.bind(d.proxy)),$watch:d=>cM.bind(d)}),ov=(d,v)=>d!==br&&!d.__isScriptSetup&&lr(d,v),GA={get({_:d},v){if(v==="__v_skip")return!0;const{ctx:I,setupState:O,data:U,props:$,accessCache:ee,type:o,appContext:ue}=d;let Re;if(v[0]!=="$"){const st=ee[v];if(st!==void 0)switch(st){case 1:return O[v];case 2:return U[v];case 4:return I[v];case 3:return $[v]}else{if(ov(O,v))return ee[v]=1,O[v];if(U!==br&&lr(U,v))return ee[v]=2,U[v];if((Re=d.propsOptions[0])&&lr(Re,v))return ee[v]=3,$[v];if(I!==br&&lr(I,v))return ee[v]=4,I[v];Pv&&(ee[v]=0)}}const xe=T_[v];let Oe,Ke;if(xe)return v==="$attrs"&&_s(d.attrs,"get",""),xe(d);if((Oe=o.__cssModules)&&(Oe=Oe[v]))return Oe;if(I!==br&&lr(I,v))return ee[v]=4,I[v];if(Ke=ue.config.globalProperties,lr(Ke,v))return Ke[v]},set({_:d},v,I){const{data:O,setupState:U,ctx:$}=d;return ov(U,v)?(U[v]=I,!0):O!==br&&lr(O,v)?(O[v]=I,!0):lr(d.props,v)||v[0]==="$"&&v.slice(1)in d?!1:($[v]=I,!0)},has({_:{data:d,setupState:v,accessCache:I,ctx:O,appContext:U,propsOptions:$}},ee){let o;return!!I[ee]||d!==br&&lr(d,ee)||ov(v,ee)||(o=$[0])&&lr(o,ee)||lr(O,ee)||lr(T_,ee)||lr(U.config.globalProperties,ee)},defineProperty(d,v,I){return I.get!=null?d._.accessCache[v]=0:lr(I,"value")&&this.set(d,v,I.value,null),Reflect.defineProperty(d,v,I)}};function cw(d){return dn(d)?d.reduce((v,I)=>(v[I]=null,v),{}):d}let Pv=!0;function qA(d){const v=y1(d),I=d.proxy,O=d.ctx;Pv=!1,v.beforeCreate&&uw(v.beforeCreate,d,"bc");const{data:U,computed:$,methods:ee,watch:o,provide:ue,inject:Re,created:xe,beforeMount:Oe,mounted:Ke,beforeUpdate:st,updated:Rt,activated:It,deactivated:ri,beforeDestroy:ft,beforeUnmount:Dt,destroyed:Yt,unmounted:At,render:Ri,renderTracked:Sn,renderTriggered:Ut,errorCaptured:cr,serverPrefetch:Xr,expose:li,inheritAttrs:ui,components:vo,directives:Yr,filters:bs}=v;if(Re&&$A(Re,O,null),ee)for(const tn in ee){const nn=ee[tn];xn(nn)&&(O[tn]=nn.bind(I))}if(U){const tn=U.call(I,I);Zr(tn)&&(d.data=n0(tn))}if(Pv=!0,$)for(const tn in $){const nn=$[tn],_i=xn(nn)?nn.bind(I,I):xn(nn.get)?nn.get.bind(I,I):Hc,Kr=!xn(nn)&&xn(nn.set)?nn.set.bind(I):Hc,ur=Qo({get:_i,set:Kr});Object.defineProperty(O,tn,{enumerable:!0,configurable:!0,get:()=>ur.value,set:Pr=>ur.value=Pr})}if(o)for(const tn in o)mT(o[tn],O,I,tn);if(ue){const tn=xn(ue)?ue.call(I):ue;Reflect.ownKeys(tn).forEach(nn=>{Oy(nn,tn[nn])})}xe&&uw(xe,d,"c");function zn(tn,nn){dn(nn)?nn.forEach(_i=>tn(_i.bind(I))):nn&&tn(nn.bind(I))}if(zn(PA,Oe),zn(RA,Ke),zn(DA,st),zn(LA,Rt),zn(MA,It),zn(IA,ri),zn(BA,cr),zn(FA,Sn),zn(kA,Ut),zn(zA,Dt),zn(dT,At),zn(OA,Xr),dn(li))if(li.length){const tn=d.exposed||(d.exposed={});li.forEach(nn=>{Object.defineProperty(tn,nn,{get:()=>I[nn],set:_i=>I[nn]=_i})})}else d.exposed||(d.exposed={});Ri&&d.render===Hc&&(d.render=Ri),ui!=null&&(d.inheritAttrs=ui),vo&&(d.components=vo),Yr&&(d.directives=Yr),Xr&&uT(d)}function $A(d,v,I=Hc){dn(d)&&(d=Rv(d));for(const O in d){const U=d[O];let $;Zr(U)?"default"in U?$=Xu(U.from||O,U.default,!0):$=Xu(U.from||O):$=Xu(U),xs($)?Object.defineProperty(v,O,{enumerable:!0,configurable:!0,get:()=>$.value,set:ee=>$.value=ee}):v[O]=$}}function uw(d,v,I){Wc(dn(d)?d.map(O=>O.bind(v.proxy)):d.bind(v.proxy),v,I)}function mT(d,v,I,O){let U=O.includes(".")?CT(I,O):()=>I[O];if(xo(d)){const $=v[d];xn($)&&S_(U,$)}else if(xn(d))S_(U,d.bind(I));else if(Zr(d))if(dn(d))d.forEach($=>mT($,v,I,O));else{const $=xn(d.handler)?d.handler.bind(I):v[d.handler];xn($)&&S_(U,$,d)}}function y1(d){const v=d.type,{mixins:I,extends:O}=v,{mixins:U,optionsCache:$,config:{optionMergeStrategies:ee}}=d.appContext,o=$.get(v);let ue;return o?ue=o:!U.length&&!I&&!O?ue=v:(ue={},U.length&&U.forEach(Re=>Hy(ue,Re,ee,!0)),Hy(ue,v,ee)),Zr(v)&&$.set(v,ue),ue}function Hy(d,v,I,O=!1){const{mixins:U,extends:$}=v;$&&Hy(d,$,I,!0),U&&U.forEach(ee=>Hy(d,ee,I,!0));for(const ee in v)if(!(O&&ee==="expose")){const o=HA[ee]||I&&I[ee];d[ee]=o?o(d[ee],v[ee]):v[ee]}return d}const HA={data:hw,props:fw,emits:fw,methods:g_,computed:g_,beforeCreate:Hs,created:Hs,beforeMount:Hs,mounted:Hs,beforeUpdate:Hs,updated:Hs,beforeDestroy:Hs,beforeUnmount:Hs,destroyed:Hs,unmounted:Hs,activated:Hs,deactivated:Hs,errorCaptured:Hs,serverPrefetch:Hs,components:g_,directives:g_,watch:ZA,provide:hw,inject:WA};function hw(d,v){return v?d?function(){return No(xn(d)?d.call(this,this):d,xn(v)?v.call(this,this):v)}:v:d}function WA(d,v){return g_(Rv(d),Rv(v))}function Rv(d){if(dn(d)){const v={};for(let I=0;I<d.length;I++)v[d[I]]=d[I];return v}return d}function Hs(d,v){return d?[...new Set([].concat(d,v))]:v}function g_(d,v){return d?No(Object.create(null),d,v):v}function fw(d,v){return d?dn(d)&&dn(v)?[...new Set([...d,...v])]:No(Object.create(null),cw(d),cw(v??{})):v}function ZA(d,v){if(!d)return v;if(!v)return d;const I=No(Object.create(null),d);for(const O in v)I[O]=Hs(d[O],v[O]);return I}function _T(){return{app:null,config:{isNativeTag:kE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let XA=0;function YA(d,v){return function(O,U=null){xn(O)||(O=No({},O)),U!=null&&!Zr(U)&&(U=null);const $=_T(),ee=new WeakSet,o=[];let ue=!1;const Re=$.app={_uid:XA++,_component:O,_props:U,_container:null,_context:$,_instance:null,version:RM,get config(){return $.config},set config(xe){},use(xe,...Oe){return ee.has(xe)||(xe&&xn(xe.install)?(ee.add(xe),xe.install(Re,...Oe)):xn(xe)&&(ee.add(xe),xe(Re,...Oe))),Re},mixin(xe){return $.mixins.includes(xe)||$.mixins.push(xe),Re},component(xe,Oe){return Oe?($.components[xe]=Oe,Re):$.components[xe]},directive(xe,Oe){return Oe?($.directives[xe]=Oe,Re):$.directives[xe]},mount(xe,Oe,Ke){if(!ue){const st=Re._ceVNode||yo(O,U);return st.appContext=$,Ke===!0?Ke="svg":Ke===!1&&(Ke=void 0),Oe&&v?v(st,xe):d(st,xe,Ke),ue=!0,Re._container=xe,xe.__vue_app__=Re,l0(st.component)}},onUnmount(xe){o.push(xe)},unmount(){ue&&(Wc(o,Re._instance,16),d(null,Re._container),delete Re._container.__vue_app__)},provide(xe,Oe){return $.provides[xe]=Oe,Re},runWithContext(xe){const Oe=tm;tm=Re;try{return xe()}finally{tm=Oe}}};return Re}}let tm=null;function Oy(d,v){if(ys){let I=ys.provides;const O=ys.parent&&ys.parent.provides;O===I&&(I=ys.provides=Object.create(O)),I[d]=v}}function Xu(d,v,I=!1){const O=ys||es;if(O||tm){const U=tm?tm._context.provides:O?O.parent==null?O.vnode.appContext&&O.vnode.appContext.provides:O.parent.provides:void 0;if(U&&d in U)return U[d];if(arguments.length>1)return I&&xn(v)?v.call(O&&O.proxy):v}}const gT={},yT=()=>Object.create(gT),xT=d=>Object.getPrototypeOf(d)===gT;function KA(d,v,I,O=!1){const U={},$=yT();d.propsDefaults=Object.create(null),vT(d,v,U,$);for(const ee in d.propsOptions[0])ee in U||(U[ee]=void 0);I?d.props=O?U:Q2(U):d.type.props?d.props=U:d.props=$,d.attrs=$}function JA(d,v,I,O){const{props:U,attrs:$,vnode:{patchFlag:ee}}=d,o=ar(U),[ue]=d.propsOptions;let Re=!1;if((O||ee>0)&&!(ee&16)){if(ee&8){const xe=d.vnode.dynamicProps;for(let Oe=0;Oe<xe.length;Oe++){let Ke=xe[Oe];if(s0(d.emitsOptions,Ke))continue;const st=v[Ke];if(ue)if(lr($,Ke))st!==$[Ke]&&($[Ke]=st,Re=!0);else{const Rt=cl(Ke);U[Rt]=Dv(ue,o,Rt,st,d,!1)}else st!==$[Ke]&&($[Ke]=st,Re=!0)}}}else{vT(d,v,U,$)&&(Re=!0);let xe;for(const Oe in o)(!v||!lr(v,Oe)&&((xe=Hd(Oe))===Oe||!lr(v,xe)))&&(ue?I&&(I[Oe]!==void 0||I[xe]!==void 0)&&(U[Oe]=Dv(ue,o,Oe,void 0,d,!0)):delete U[Oe]);if($!==o)for(const Oe in $)(!v||!lr(v,Oe))&&(delete $[Oe],Re=!0)}Re&&Hu(d.attrs,"set","")}function vT(d,v,I,O){const[U,$]=d.propsOptions;let ee=!1,o;if(v)for(let ue in v){if(v_(ue))continue;const Re=v[ue];let xe;U&&lr(U,xe=cl(ue))?!$||!$.includes(xe)?I[xe]=Re:(o||(o={}))[xe]=Re:s0(d.emitsOptions,ue)||(!(ue in O)||Re!==O[ue])&&(O[ue]=Re,ee=!0)}if($){const ue=ar(I),Re=o||br;for(let xe=0;xe<$.length;xe++){const Oe=$[xe];I[Oe]=Dv(U,ue,Oe,Re[Oe],d,!lr(Re,Oe))}}return ee}function Dv(d,v,I,O,U,$){const ee=d[I];if(ee!=null){const o=lr(ee,"default");if(o&&O===void 0){const ue=ee.default;if(ee.type!==Function&&!ee.skipFactory&&xn(ue)){const{propsDefaults:Re}=U;if(I in Re)O=Re[I];else{const xe=V_(U);O=Re[I]=ue.call(null,v),xe()}}else O=ue;U.ce&&U.ce._setProp(I,O)}ee[0]&&($&&!o?O=!1:ee[1]&&(O===""||O===Hd(I))&&(O=!0))}return O}const QA=new WeakMap;function bT(d,v,I=!1){const O=I?QA:v.propsCache,U=O.get(d);if(U)return U;const $=d.props,ee={},o=[];let ue=!1;if(!xn(d)){const xe=Oe=>{ue=!0;const[Ke,st]=bT(Oe,v,!0);No(ee,Ke),st&&o.push(...st)};!I&&v.mixins.length&&v.mixins.forEach(xe),d.extends&&xe(d.extends),d.mixins&&d.mixins.forEach(xe)}if(!$&&!ue)return Zr(d)&&O.set(d,Xp),Xp;if(dn($))for(let xe=0;xe<$.length;xe++){const Oe=cl($[xe]);dw(Oe)&&(ee[Oe]=br)}else if($)for(const xe in $){const Oe=cl(xe);if(dw(Oe)){const Ke=$[xe],st=ee[Oe]=dn(Ke)||xn(Ke)?{type:Ke}:No({},Ke),Rt=st.type;let It=!1,ri=!0;if(dn(Rt))for(let ft=0;ft<Rt.length;++ft){const Dt=Rt[ft],Yt=xn(Dt)&&Dt.name;if(Yt==="Boolean"){It=!0;break}else Yt==="String"&&(ri=!1)}else It=xn(Rt)&&Rt.name==="Boolean";st[0]=It,st[1]=ri,(It||lr(st,"default"))&&o.push(Oe)}}const Re=[ee,o];return Zr(d)&&O.set(d,Re),Re}function dw(d){return d[0]!=="$"&&!v_(d)}const wT=d=>d[0]==="_"||d==="$stable",x1=d=>dn(d)?d.map(Gc):[Gc(d)],eM=(d,v,I)=>{if(v._n)return v;const O=cT((...U)=>x1(v(...U)),I);return O._c=!1,O},TT=(d,v,I)=>{const O=d._ctx;for(const U in d){if(wT(U))continue;const $=d[U];if(xn($))v[U]=eM(U,$,O);else if($!=null){const ee=x1($);v[U]=()=>ee}}},ST=(d,v)=>{const I=x1(v);d.slots.default=()=>I},ET=(d,v,I)=>{for(const O in v)(I||O!=="_")&&(d[O]=v[O])},tM=(d,v,I)=>{const O=d.slots=yT();if(d.vnode.shapeFlag&32){const U=v._;U?(ET(O,v,I),I&&O2(O,"_",U,!0)):TT(v,O)}else v&&ST(d,v)},iM=(d,v,I)=>{const{vnode:O,slots:U}=d;let $=!0,ee=br;if(O.shapeFlag&32){const o=v._;o?I&&o===1?$=!1:ET(U,v,I):($=!v.$stable,TT(v,U)),ee=v}else v&&(ST(d,v),ee={default:1});if($)for(const o in U)!wT(o)&&ee[o]==null&&delete U[o]},Oa=_M;function nM(d){return rM(d)}function rM(d,v){const I=t0();I.__VUE__=!0;const{insert:O,remove:U,patchProp:$,createElement:ee,createText:o,createComment:ue,setText:Re,setElementText:xe,parentNode:Oe,nextSibling:Ke,setScopeId:st=Hc,insertStaticContent:Rt}=d,It=(De,he,ct,Ct=null,xt=null,pt=null,Xt=void 0,Zt=null,$t=!!he.dynamicChildren)=>{if(De===he)return;De&&!m_(De,he)&&(Ct=Mt(De),Pr(De,xt,pt,!0),De=null),he.patchFlag===-2&&($t=!1,he.dynamicChildren=null);const{type:Nt,ref:Mi,shapeFlag:vt}=he;switch(Nt){case a0:ri(De,he,ct,Ct);break;case lf:ft(De,he,ct,Ct);break;case lv:De==null&&Dt(he,ct,Ct,Xt);break;case da:vo(De,he,ct,Ct,xt,pt,Xt,Zt,$t);break;default:vt&1?Ri(De,he,ct,Ct,xt,pt,Xt,Zt,$t):vt&6?Yr(De,he,ct,Ct,xt,pt,Xt,Zt,$t):(vt&64||vt&128)&&Nt.process(De,he,ct,Ct,xt,pt,Xt,Zt,$t,ye)}Mi!=null&&xt&&qy(Mi,De&&De.ref,pt,he||De,!he)},ri=(De,he,ct,Ct)=>{if(De==null)O(he.el=o(he.children),ct,Ct);else{const xt=he.el=De.el;he.children!==De.children&&Re(xt,he.children)}},ft=(De,he,ct,Ct)=>{De==null?O(he.el=ue(he.children||""),ct,Ct):he.el=De.el},Dt=(De,he,ct,Ct)=>{[De.el,De.anchor]=Rt(De.children,he,ct,Ct,De.el,De.anchor)},Yt=({el:De,anchor:he},ct,Ct)=>{let xt;for(;De&&De!==he;)xt=Ke(De),O(De,ct,Ct),De=xt;O(he,ct,Ct)},At=({el:De,anchor:he})=>{let ct;for(;De&&De!==he;)ct=Ke(De),U(De),De=ct;U(he)},Ri=(De,he,ct,Ct,xt,pt,Xt,Zt,$t)=>{he.type==="svg"?Xt="svg":he.type==="math"&&(Xt="mathml"),De==null?Sn(he,ct,Ct,xt,pt,Xt,Zt,$t):Xr(De,he,xt,pt,Xt,Zt,$t)},Sn=(De,he,ct,Ct,xt,pt,Xt,Zt)=>{let $t,Nt;const{props:Mi,shapeFlag:vt,transition:xi,dirs:Di}=De;if($t=De.el=ee(De.type,pt,Mi&&Mi.is,Mi),vt&8?xe($t,De.children):vt&16&&cr(De.children,$t,null,Ct,xt,sv(De,pt),Xt,Zt),Di&&Bd(De,null,Ct,"created"),Ut($t,De,De.scopeId,Xt,Ct),Mi){for(const $i in Mi)$i!=="value"&&!v_($i)&&$($t,$i,null,Mi[$i],pt,Ct);"value"in Mi&&$($t,"value",null,Mi.value,pt),(Nt=Mi.onVnodeBeforeMount)&&Nc(Nt,Ct,De)}Di&&Bd(De,null,Ct,"beforeMount");const Hi=oM(xt,xi);Hi&&xi.beforeEnter($t),O($t,he,ct),((Nt=Mi&&Mi.onVnodeMounted)||Hi||Di)&&Oa(()=>{Nt&&Nc(Nt,Ct,De),Hi&&xi.enter($t),Di&&Bd(De,null,Ct,"mounted")},xt)},Ut=(De,he,ct,Ct,xt)=>{if(ct&&st(De,ct),Ct)for(let pt=0;pt<Ct.length;pt++)st(De,Ct[pt]);if(xt){let pt=xt.subTree;if(he===pt||RT(pt.type)&&(pt.ssContent===he||pt.ssFallback===he)){const Xt=xt.vnode;Ut(De,Xt,Xt.scopeId,Xt.slotScopeIds,xt.parent)}}},cr=(De,he,ct,Ct,xt,pt,Xt,Zt,$t=0)=>{for(let Nt=$t;Nt<De.length;Nt++){const Mi=De[Nt]=Zt?of(De[Nt]):Gc(De[Nt]);It(null,Mi,he,ct,Ct,xt,pt,Xt,Zt)}},Xr=(De,he,ct,Ct,xt,pt,Xt)=>{const Zt=he.el=De.el;let{patchFlag:$t,dynamicChildren:Nt,dirs:Mi}=he;$t|=De.patchFlag&16;const vt=De.props||br,xi=he.props||br;let Di;if(ct&&Nd(ct,!1),(Di=xi.onVnodeBeforeUpdate)&&Nc(Di,ct,he,De),Mi&&Bd(he,De,ct,"beforeUpdate"),ct&&Nd(ct,!0),(vt.innerHTML&&xi.innerHTML==null||vt.textContent&&xi.textContent==null)&&xe(Zt,""),Nt?li(De.dynamicChildren,Nt,Zt,ct,Ct,sv(he,xt),pt):Xt||nn(De,he,Zt,null,ct,Ct,sv(he,xt),pt,!1),$t>0){if($t&16)ui(Zt,vt,xi,ct,xt);else if($t&2&&vt.class!==xi.class&&$(Zt,"class",null,xi.class,xt),$t&4&&$(Zt,"style",vt.style,xi.style,xt),$t&8){const Hi=he.dynamicProps;for(let $i=0;$i<Hi.length;$i++){const Yi=Hi[$i],Dr=vt[Yi],mr=xi[Yi];(mr!==Dr||Yi==="value")&&$(Zt,Yi,Dr,mr,xt,ct)}}$t&1&&De.children!==he.children&&xe(Zt,he.children)}else!Xt&&Nt==null&&ui(Zt,vt,xi,ct,xt);((Di=xi.onVnodeUpdated)||Mi)&&Oa(()=>{Di&&Nc(Di,ct,he,De),Mi&&Bd(he,De,ct,"updated")},Ct)},li=(De,he,ct,Ct,xt,pt,Xt)=>{for(let Zt=0;Zt<he.length;Zt++){const $t=De[Zt],Nt=he[Zt],Mi=$t.el&&($t.type===da||!m_($t,Nt)||$t.shapeFlag&70)?Oe($t.el):ct;It($t,Nt,Mi,null,Ct,xt,pt,Xt,!0)}},ui=(De,he,ct,Ct,xt)=>{if(he!==ct){if(he!==br)for(const pt in he)!v_(pt)&&!(pt in ct)&&$(De,pt,he[pt],null,xt,Ct);for(const pt in ct){if(v_(pt))continue;const Xt=ct[pt],Zt=he[pt];Xt!==Zt&&pt!=="value"&&$(De,pt,Zt,Xt,xt,Ct)}"value"in ct&&$(De,"value",he.value,ct.value,xt)}},vo=(De,he,ct,Ct,xt,pt,Xt,Zt,$t)=>{const Nt=he.el=De?De.el:o(""),Mi=he.anchor=De?De.anchor:o("");let{patchFlag:vt,dynamicChildren:xi,slotScopeIds:Di}=he;Di&&(Zt=Zt?Zt.concat(Di):Di),De==null?(O(Nt,ct,Ct),O(Mi,ct,Ct),cr(he.children||[],ct,Mi,xt,pt,Xt,Zt,$t)):vt>0&&vt&64&&xi&&De.dynamicChildren?(li(De.dynamicChildren,xi,ct,xt,pt,Xt,Zt),(he.key!=null||xt&&he===xt.subTree)&&AT(De,he,!0)):nn(De,he,ct,Mi,xt,pt,Xt,Zt,$t)},Yr=(De,he,ct,Ct,xt,pt,Xt,Zt,$t)=>{he.slotScopeIds=Zt,De==null?he.shapeFlag&512?xt.ctx.activate(he,ct,Ct,Xt,$t):bs(he,ct,Ct,xt,pt,Xt,$t):Ei(De,he,$t)},bs=(De,he,ct,Ct,xt,pt,Xt)=>{const Zt=De.component=SM(De,Ct,xt);if(hT(De)&&(Zt.ctx.renderer=ye),EM(Zt,!1,Xt),Zt.asyncDep){if(xt&&xt.registerDep(Zt,zn,Xt),!De.el){const $t=Zt.subTree=yo(lf);ft(null,$t,he,ct)}}else zn(Zt,De,he,ct,xt,pt,Xt)},Ei=(De,he,ct)=>{const Ct=he.component=De.component;if(pM(De,he,ct))if(Ct.asyncDep&&!Ct.asyncResolved){tn(Ct,he,ct);return}else Ct.next=he,Ct.update();else he.el=De.el,Ct.vnode=he},zn=(De,he,ct,Ct,xt,pt,Xt)=>{const Zt=()=>{if(De.isMounted){let{next:vt,bu:xi,u:Di,parent:Hi,vnode:$i}=De;{const hr=MT(De);if(hr){vt&&(vt.el=$i.el,tn(De,vt,Xt)),hr.asyncDep.then(()=>{De.isUnmounted||Zt()});return}}let Yi=vt,Dr;Nd(De,!1),vt?(vt.el=$i.el,tn(De,vt,Xt)):vt=$i,xi&&zy(xi),(Dr=vt.props&&vt.props.onVnodeBeforeUpdate)&&Nc(Dr,Hi,vt,$i),Nd(De,!0);const mr=av(De),jr=De.subTree;De.subTree=mr,It(jr,mr,Oe(jr.el),Mt(jr),De,xt,pt),vt.el=mr.el,Yi===null&&mM(De,mr.el),Di&&Oa(Di,xt),(Dr=vt.props&&vt.props.onVnodeUpdated)&&Oa(()=>Nc(Dr,Hi,vt,$i),xt)}else{let vt;const{el:xi,props:Di}=he,{bm:Hi,m:$i,parent:Yi,root:Dr,type:mr}=De,jr=em(he);if(Nd(De,!1),Hi&&zy(Hi),!jr&&(vt=Di&&Di.onVnodeBeforeMount)&&Nc(vt,Yi,he),Nd(De,!0),xi&&Cn){const hr=()=>{De.subTree=av(De),Cn(xi,De.subTree,De,xt,null)};jr&&mr.__asyncHydrate?mr.__asyncHydrate(xi,De,hr):hr()}else{Dr.ce&&Dr.ce._injectChildStyle(mr);const hr=De.subTree=av(De);It(null,hr,ct,Ct,De,xt,pt),he.el=hr.el}if($i&&Oa($i,xt),!jr&&(vt=Di&&Di.onVnodeMounted)){const hr=he;Oa(()=>Nc(vt,Yi,hr),xt)}(he.shapeFlag&256||Yi&&em(Yi.vnode)&&Yi.vnode.shapeFlag&256)&&De.a&&Oa(De.a,xt),De.isMounted=!0,he=ct=Ct=null}};De.scope.on();const $t=De.effect=new N2(Zt);De.scope.off();const Nt=De.update=$t.run.bind($t),Mi=De.job=$t.runIfDirty.bind($t);Mi.i=De,Mi.id=De.uid,$t.scheduler=()=>m1(Mi),Nd(De,!0),Nt()},tn=(De,he,ct)=>{he.component=De;const Ct=De.vnode.props;De.vnode=he,De.next=null,JA(De,he.props,Ct,ct),iM(De,he.children,ct),ff(),ow(De),df()},nn=(De,he,ct,Ct,xt,pt,Xt,Zt,$t=!1)=>{const Nt=De&&De.children,Mi=De?De.shapeFlag:0,vt=he.children,{patchFlag:xi,shapeFlag:Di}=he;if(xi>0){if(xi&128){Kr(Nt,vt,ct,Ct,xt,pt,Xt,Zt,$t);return}else if(xi&256){_i(Nt,vt,ct,Ct,xt,pt,Xt,Zt,$t);return}}Di&8?(Mi&16&&Qn(Nt,xt,pt),vt!==Nt&&xe(ct,vt)):Mi&16?Di&16?Kr(Nt,vt,ct,Ct,xt,pt,Xt,Zt,$t):Qn(Nt,xt,pt,!0):(Mi&8&&xe(ct,""),Di&16&&cr(vt,ct,Ct,xt,pt,Xt,Zt,$t))},_i=(De,he,ct,Ct,xt,pt,Xt,Zt,$t)=>{De=De||Xp,he=he||Xp;const Nt=De.length,Mi=he.length,vt=Math.min(Nt,Mi);let xi;for(xi=0;xi<vt;xi++){const Di=he[xi]=$t?of(he[xi]):Gc(he[xi]);It(De[xi],Di,ct,null,xt,pt,Xt,Zt,$t)}Nt>Mi?Qn(De,xt,pt,!0,!1,vt):cr(he,ct,Ct,xt,pt,Xt,Zt,$t,vt)},Kr=(De,he,ct,Ct,xt,pt,Xt,Zt,$t)=>{let Nt=0;const Mi=he.length;let vt=De.length-1,xi=Mi-1;for(;Nt<=vt&&Nt<=xi;){const Di=De[Nt],Hi=he[Nt]=$t?of(he[Nt]):Gc(he[Nt]);if(m_(Di,Hi))It(Di,Hi,ct,null,xt,pt,Xt,Zt,$t);else break;Nt++}for(;Nt<=vt&&Nt<=xi;){const Di=De[vt],Hi=he[xi]=$t?of(he[xi]):Gc(he[xi]);if(m_(Di,Hi))It(Di,Hi,ct,null,xt,pt,Xt,Zt,$t);else break;vt--,xi--}if(Nt>vt){if(Nt<=xi){const Di=xi+1,Hi=Di<Mi?he[Di].el:Ct;for(;Nt<=xi;)It(null,he[Nt]=$t?of(he[Nt]):Gc(he[Nt]),ct,Hi,xt,pt,Xt,Zt,$t),Nt++}}else if(Nt>xi)for(;Nt<=vt;)Pr(De[Nt],xt,pt,!0),Nt++;else{const Di=Nt,Hi=Nt,$i=new Map;for(Nt=Hi;Nt<=xi;Nt++){const er=he[Nt]=$t?of(he[Nt]):Gc(he[Nt]);er.key!=null&&$i.set(er.key,Nt)}let Yi,Dr=0;const mr=xi-Hi+1;let jr=!1,hr=0;const bo=new Array(mr);for(Nt=0;Nt<mr;Nt++)bo[Nt]=0;for(Nt=Di;Nt<=vt;Nt++){const er=De[Nt];if(Dr>=mr){Pr(er,xt,pt,!0);continue}let io;if(er.key!=null)io=$i.get(er.key);else for(Yi=Hi;Yi<=xi;Yi++)if(bo[Yi-Hi]===0&&m_(er,he[Yi])){io=Yi;break}io===void 0?Pr(er,xt,pt,!0):(bo[io-Hi]=Nt+1,io>=hr?hr=io:jr=!0,It(er,he[io],ct,null,xt,pt,Xt,Zt,$t),Dr++)}const ws=jr?sM(bo):Xp;for(Yi=ws.length-1,Nt=mr-1;Nt>=0;Nt--){const er=Hi+Nt,io=he[er],ji=er+1<Mi?he[er+1].el:Ct;bo[Nt]===0?It(null,io,ct,ji,xt,pt,Xt,Zt,$t):jr&&(Yi<0||Nt!==ws[Yi]?ur(io,ct,ji,2):Yi--)}}},ur=(De,he,ct,Ct,xt=null)=>{const{el:pt,type:Xt,transition:Zt,children:$t,shapeFlag:Nt}=De;if(Nt&6){ur(De.component.subTree,he,ct,Ct);return}if(Nt&128){De.suspense.move(he,ct,Ct);return}if(Nt&64){Xt.move(De,he,ct,ye);return}if(Xt===da){O(pt,he,ct);for(let vt=0;vt<$t.length;vt++)ur($t[vt],he,ct,Ct);O(De.anchor,he,ct);return}if(Xt===lv){Yt(De,he,ct);return}if(Ct!==2&&Nt&1&&Zt)if(Ct===0)Zt.beforeEnter(pt),O(pt,he,ct),Oa(()=>Zt.enter(pt),xt);else{const{leave:vt,delayLeave:xi,afterLeave:Di}=Zt,Hi=()=>O(pt,he,ct),$i=()=>{vt(pt,()=>{Hi(),Di&&Di()})};xi?xi(pt,Hi,$i):$i()}else O(pt,he,ct)},Pr=(De,he,ct,Ct=!1,xt=!1)=>{const{type:pt,props:Xt,ref:Zt,children:$t,dynamicChildren:Nt,shapeFlag:Mi,patchFlag:vt,dirs:xi,cacheIndex:Di}=De;if(vt===-2&&(xt=!1),Zt!=null&&qy(Zt,null,ct,De,!0),Di!=null&&(he.renderCache[Di]=void 0),Mi&256){he.ctx.deactivate(De);return}const Hi=Mi&1&&xi,$i=!em(De);let Yi;if($i&&(Yi=Xt&&Xt.onVnodeBeforeUnmount)&&Nc(Yi,he,De),Mi&6)Rr(De.component,ct,Ct);else{if(Mi&128){De.suspense.unmount(ct,Ct);return}Hi&&Bd(De,null,he,"beforeUnmount"),Mi&64?De.type.remove(De,he,ct,ye,Ct):Nt&&!Nt.hasOnce&&(pt!==da||vt>0&&vt&64)?Qn(Nt,he,ct,!1,!0):(pt===da&&vt&384||!xt&&Mi&16)&&Qn($t,he,ct),Ct&&gi(De)}($i&&(Yi=Xt&&Xt.onVnodeUnmounted)||Hi)&&Oa(()=>{Yi&&Nc(Yi,he,De),Hi&&Bd(De,null,he,"unmounted")},ct)},gi=De=>{const{type:he,el:ct,anchor:Ct,transition:xt}=De;if(he===da){ts(ct,Ct);return}if(he===lv){At(De);return}const pt=()=>{U(ct),xt&&!xt.persisted&&xt.afterLeave&&xt.afterLeave()};if(De.shapeFlag&1&&xt&&!xt.persisted){const{leave:Xt,delayLeave:Zt}=xt,$t=()=>Xt(ct,pt);Zt?Zt(De.el,pt,$t):$t()}else pt()},ts=(De,he)=>{let ct;for(;De!==he;)ct=Ke(De),U(De),De=ct;U(he)},Rr=(De,he,ct)=>{const{bum:Ct,scope:xt,job:pt,subTree:Xt,um:Zt,m:$t,a:Nt}=De;pw($t),pw(Nt),Ct&&zy(Ct),xt.stop(),pt&&(pt.flags|=8,Pr(Xt,De,he,ct)),Zt&&Oa(Zt,he),Oa(()=>{De.isUnmounted=!0},he),he&&he.pendingBranch&&!he.isUnmounted&&De.asyncDep&&!De.asyncResolved&&De.suspenseId===he.pendingId&&(he.deps--,he.deps===0&&he.resolve())},Qn=(De,he,ct,Ct=!1,xt=!1,pt=0)=>{for(let Xt=pt;Xt<De.length;Xt++)Pr(De[Xt],he,ct,Ct,xt)},Mt=De=>{if(De.shapeFlag&6)return Mt(De.component.subTree);if(De.shapeFlag&128)return De.suspense.next();const he=Ke(De.anchor||De.el),ct=he&&he[EA];return ct?Ke(ct):he};let si=!1;const ii=(De,he,ct)=>{De==null?he._vnode&&Pr(he._vnode,null,null,!0):It(he._vnode||null,De,he,null,null,null,ct),he._vnode=De,si||(si=!0,ow(),sT(),si=!1)},ye={p:It,um:Pr,m:ur,r:gi,mt:bs,mc:cr,pc:nn,pbc:li,n:Mt,o:d};let sn,Cn;return{render:ii,hydrate:sn,createApp:YA(ii,sn)}}function sv({type:d,props:v},I){return I==="svg"&&d==="foreignObject"||I==="mathml"&&d==="annotation-xml"&&v&&v.encoding&&v.encoding.includes("html")?void 0:I}function Nd({effect:d,job:v},I){I?(d.flags|=32,v.flags|=4):(d.flags&=-33,v.flags&=-5)}function oM(d,v){return(!d||d&&!d.pendingBranch)&&v&&!v.persisted}function AT(d,v,I=!1){const O=d.children,U=v.children;if(dn(O)&&dn(U))for(let $=0;$<O.length;$++){const ee=O[$];let o=U[$];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=U[$]=of(U[$]),o.el=ee.el),!I&&o.patchFlag!==-2&&AT(ee,o)),o.type===a0&&(o.el=ee.el)}}function sM(d){const v=d.slice(),I=[0];let O,U,$,ee,o;const ue=d.length;for(O=0;O<ue;O++){const Re=d[O];if(Re!==0){if(U=I[I.length-1],d[U]<Re){v[O]=U,I.push(O);continue}for($=0,ee=I.length-1;$<ee;)o=$+ee>>1,d[I[o]]<Re?$=o+1:ee=o;Re<d[I[$]]&&($>0&&(v[O]=I[$-1]),I[$]=O)}}for($=I.length,ee=I[$-1];$-- >0;)I[$]=ee,ee=v[ee];return I}function MT(d){const v=d.subTree.component;if(v)return v.asyncDep&&!v.asyncResolved?v:MT(v)}function pw(d){if(d)for(let v=0;v<d.length;v++)d[v].flags|=8}const aM=Symbol.for("v-scx"),lM=()=>Xu(aM);function S_(d,v,I){return IT(d,v,I)}function IT(d,v,I=br){const{immediate:O,deep:U,flush:$,once:ee}=I,o=No({},I),ue=v&&O||!v&&$!=="post";let Re;if(O_){if($==="sync"){const st=lM();Re=st.__watcherHandles||(st.__watcherHandles=[])}else if(!ue){const st=()=>{};return st.stop=Hc,st.resume=Hc,st.pause=Hc,st}}const xe=ys;o.call=(st,Rt,It)=>Wc(st,xe,Rt,It);let Oe=!1;$==="post"?o.scheduler=st=>{Oa(st,xe&&xe.suspense)}:$!=="sync"&&(Oe=!0,o.scheduler=(st,Rt)=>{Rt?st():m1(st)}),o.augmentJob=st=>{v&&(st.flags|=4),Oe&&(st.flags|=2,xe&&(st.id=xe.uid,st.i=xe))};const Ke=bA(d,v,o);return O_&&(Re?Re.push(Ke):ue&&Ke()),Ke}function cM(d,v,I){const O=this.proxy,U=xo(d)?d.includes(".")?CT(O,d):()=>O[d]:d.bind(O,O);let $;xn(v)?$=v:($=v.handler,I=v);const ee=V_(this),o=IT(U,$.bind(O),I);return ee(),o}function CT(d,v){const I=v.split(".");return()=>{let O=d;for(let U=0;U<I.length&&O;U++)O=O[I[U]];return O}}const uM=(d,v)=>v==="modelValue"||v==="model-value"?d.modelModifiers:d[`${v}Modifiers`]||d[`${cl(v)}Modifiers`]||d[`${Hd(v)}Modifiers`];function hM(d,v,...I){if(d.isUnmounted)return;const O=d.vnode.props||br;let U=I;const $=v.startsWith("update:"),ee=$&&uM(O,v.slice(7));ee&&(ee.trim&&(U=I.map(xe=>xo(xe)?xe.trim():xe)),ee.number&&(U=I.map(wv)));let o,ue=O[o=ev(v)]||O[o=ev(cl(v))];!ue&&$&&(ue=O[o=ev(Hd(v))]),ue&&Wc(ue,d,6,U);const Re=O[o+"Once"];if(Re){if(!d.emitted)d.emitted={};else if(d.emitted[o])return;d.emitted[o]=!0,Wc(Re,d,6,U)}}function PT(d,v,I=!1){const O=v.emitsCache,U=O.get(d);if(U!==void 0)return U;const $=d.emits;let ee={},o=!1;if(!xn(d)){const ue=Re=>{const xe=PT(Re,v,!0);xe&&(o=!0,No(ee,xe))};!I&&v.mixins.length&&v.mixins.forEach(ue),d.extends&&ue(d.extends),d.mixins&&d.mixins.forEach(ue)}return!$&&!o?(Zr(d)&&O.set(d,null),null):(dn($)?$.forEach(ue=>ee[ue]=null):No(ee,$),Zr(d)&&O.set(d,ee),ee)}function s0(d,v){return!d||!Ky(v)?!1:(v=v.slice(2).replace(/Once$/,""),lr(d,v[0].toLowerCase()+v.slice(1))||lr(d,Hd(v))||lr(d,v))}function av(d){const{type:v,vnode:I,proxy:O,withProxy:U,propsOptions:[$],slots:ee,attrs:o,emit:ue,render:Re,renderCache:xe,props:Oe,data:Ke,setupState:st,ctx:Rt,inheritAttrs:It}=d,ri=Gy(d);let ft,Dt;try{if(I.shapeFlag&4){const At=U||O,Ri=At;ft=Gc(Re.call(Ri,At,xe,Oe,st,Ke,Rt)),Dt=o}else{const At=v;ft=Gc(At.length>1?At(Oe,{attrs:o,slots:ee,emit:ue}):At(Oe,null)),Dt=v.props?o:fM(o)}}catch(At){E_.length=0,r0(At,d,1),ft=yo(lf)}let Yt=ft;if(Dt&&It!==!1){const At=Object.keys(Dt),{shapeFlag:Ri}=Yt;At.length&&Ri&7&&($&&At.some(n1)&&(Dt=dM(Dt,$)),Yt=nm(Yt,Dt,!1,!0))}return I.dirs&&(Yt=nm(Yt,null,!1,!0),Yt.dirs=Yt.dirs?Yt.dirs.concat(I.dirs):I.dirs),I.transition&&_1(Yt,I.transition),ft=Yt,Gy(ri),ft}const fM=d=>{let v;for(const I in d)(I==="class"||I==="style"||Ky(I))&&((v||(v={}))[I]=d[I]);return v},dM=(d,v)=>{const I={};for(const O in d)(!n1(O)||!(O.slice(9)in v))&&(I[O]=d[O]);return I};function pM(d,v,I){const{props:O,children:U,component:$}=d,{props:ee,children:o,patchFlag:ue}=v,Re=$.emitsOptions;if(v.dirs||v.transition)return!0;if(I&&ue>=0){if(ue&1024)return!0;if(ue&16)return O?mw(O,ee,Re):!!ee;if(ue&8){const xe=v.dynamicProps;for(let Oe=0;Oe<xe.length;Oe++){const Ke=xe[Oe];if(ee[Ke]!==O[Ke]&&!s0(Re,Ke))return!0}}}else return(U||o)&&(!o||!o.$stable)?!0:O===ee?!1:O?ee?mw(O,ee,Re):!0:!!ee;return!1}function mw(d,v,I){const O=Object.keys(v);if(O.length!==Object.keys(d).length)return!0;for(let U=0;U<O.length;U++){const $=O[U];if(v[$]!==d[$]&&!s0(I,$))return!0}return!1}function mM({vnode:d,parent:v},I){for(;v;){const O=v.subTree;if(O.suspense&&O.suspense.activeBranch===d&&(O.el=d.el),O===d)(d=v.vnode).el=I,v=v.parent;else break}}const RT=d=>d.__isSuspense;function _M(d,v){v&&v.pendingBranch?dn(d)?v.effects.push(...d):v.effects.push(d):SA(d)}const da=Symbol.for("v-fgt"),a0=Symbol.for("v-txt"),lf=Symbol.for("v-cmt"),lv=Symbol.for("v-stc"),E_=[];let Ba=null;function Fa(d=!1){E_.push(Ba=d?null:[])}function gM(){E_.pop(),Ba=E_[E_.length-1]||null}let L_=1;function _w(d,v=!1){L_+=d,d<0&&Ba&&v&&(Ba.hasOnce=!0)}function DT(d){return d.dynamicChildren=L_>0?Ba||Xp:null,gM(),L_>0&&Ba&&Ba.push(d),d}function Vc(d,v,I,O,U,$){return DT(jc(d,v,I,O,U,$,!0))}function Lv(d,v,I,O,U){return DT(yo(d,v,I,O,U,!0))}function z_(d){return d?d.__v_isVNode===!0:!1}function m_(d,v){return d.type===v.type&&d.key===v.key}const LT=({key:d})=>d??null,ky=({ref:d,ref_key:v,ref_for:I})=>(typeof d=="number"&&(d=""+d),d!=null?xo(d)||xs(d)||xn(d)?{i:es,r:d,k:v,f:!!I}:d:null);function jc(d,v=null,I=null,O=0,U=null,$=d===da?0:1,ee=!1,o=!1){const ue={__v_isVNode:!0,__v_skip:!0,type:d,props:v,key:v&&LT(v),ref:v&&ky(v),scopeId:lT,slotScopeIds:null,children:I,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:$,patchFlag:O,dynamicProps:U,dynamicChildren:null,appContext:null,ctx:es};return o?(v1(ue,I),$&128&&d.normalize(ue)):I&&(ue.shapeFlag|=xo(I)?8:16),L_>0&&!ee&&Ba&&(ue.patchFlag>0||$&6)&&ue.patchFlag!==32&&Ba.push(ue),ue}const yo=yM;function yM(d,v=null,I=null,O=0,U=null,$=!1){if((!d||d===UA)&&(d=lf),z_(d)){const o=nm(d,v,!0);return I&&v1(o,I),L_>0&&!$&&Ba&&(o.shapeFlag&6?Ba[Ba.indexOf(d)]=o:Ba.push(o)),o.patchFlag=-2,o}if(PM(d)&&(d=d.__vccOpts),v){v=xM(v);let{class:o,style:ue}=v;o&&!xo(o)&&(v.class=a1(o)),Zr(ue)&&(p1(ue)&&!dn(ue)&&(ue=No({},ue)),v.style=s1(ue))}const ee=xo(d)?1:RT(d)?128:AA(d)?64:Zr(d)?4:xn(d)?2:0;return jc(d,v,I,O,U,ee,$,!0)}function xM(d){return d?p1(d)||xT(d)?No({},d):d:null}function nm(d,v,I=!1,O=!1){const{props:U,ref:$,patchFlag:ee,children:o,transition:ue}=d,Re=v?bM(U||{},v):U,xe={__v_isVNode:!0,__v_skip:!0,type:d.type,props:Re,key:Re&&LT(Re),ref:v&&v.ref?I&&$?dn($)?$.concat(ky(v)):[$,ky(v)]:ky(v):$,scopeId:d.scopeId,slotScopeIds:d.slotScopeIds,children:o,target:d.target,targetStart:d.targetStart,targetAnchor:d.targetAnchor,staticCount:d.staticCount,shapeFlag:d.shapeFlag,patchFlag:v&&d.type!==da?ee===-1?16:ee|16:ee,dynamicProps:d.dynamicProps,dynamicChildren:d.dynamicChildren,appContext:d.appContext,dirs:d.dirs,transition:ue,component:d.component,suspense:d.suspense,ssContent:d.ssContent&&nm(d.ssContent),ssFallback:d.ssFallback&&nm(d.ssFallback),el:d.el,anchor:d.anchor,ctx:d.ctx,ce:d.ce};return ue&&O&&_1(xe,ue.clone(xe)),xe}function vM(d=" ",v=0){return yo(a0,null,d,v)}function gw(d="",v=!1){return v?(Fa(),Lv(lf,null,d)):yo(lf,null,d)}function Gc(d){return d==null||typeof d=="boolean"?yo(lf):dn(d)?yo(da,null,d.slice()):z_(d)?of(d):yo(a0,null,String(d))}function of(d){return d.el===null&&d.patchFlag!==-1||d.memo?d:nm(d)}function v1(d,v){let I=0;const{shapeFlag:O}=d;if(v==null)v=null;else if(dn(v))I=16;else if(typeof v=="object")if(O&65){const U=v.default;U&&(U._c&&(U._d=!1),v1(d,U()),U._c&&(U._d=!0));return}else{I=32;const U=v._;!U&&!xT(v)?v._ctx=es:U===3&&es&&(es.slots._===1?v._=1:(v._=2,d.patchFlag|=1024))}else xn(v)?(v={default:v,_ctx:es},I=32):(v=String(v),O&64?(I=16,v=[vM(v)]):I=8);d.children=v,d.shapeFlag|=I}function bM(...d){const v={};for(let I=0;I<d.length;I++){const O=d[I];for(const U in O)if(U==="class")v.class!==O.class&&(v.class=a1([v.class,O.class]));else if(U==="style")v.style=s1([v.style,O.style]);else if(Ky(U)){const $=v[U],ee=O[U];ee&&$!==ee&&!(dn($)&&$.includes(ee))&&(v[U]=$?[].concat($,ee):ee)}else U!==""&&(v[U]=O[U])}return v}function Nc(d,v,I,O=null){Wc(d,v,7,[I,O])}const wM=_T();let TM=0;function SM(d,v,I){const O=d.type,U=(v?v.appContext:d.appContext)||wM,$={uid:TM++,vnode:d,type:O,parent:v,appContext:U,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new WE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:v?v.provides:Object.create(U.provides),ids:v?v.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:bT(O,U),emitsOptions:PT(O,U),emit:null,emitted:null,propsDefaults:br,inheritAttrs:O.inheritAttrs,ctx:br,data:br,props:br,attrs:br,slots:br,refs:br,setupState:br,setupContext:null,suspense:I,suspenseId:I?I.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return $.ctx={_:$},$.root=v?v.root:$,$.emit=hM.bind(null,$),d.ce&&d.ce($),$}let ys=null,Wy,zv;{const d=t0(),v=(I,O)=>{let U;return(U=d[I])||(U=d[I]=[]),U.push(O),$=>{U.length>1?U.forEach(ee=>ee($)):U[0]($)}};Wy=v("__VUE_INSTANCE_SETTERS__",I=>ys=I),zv=v("__VUE_SSR_SETTERS__",I=>O_=I)}const V_=d=>{const v=ys;return Wy(d),d.scope.on(),()=>{d.scope.off(),Wy(v)}},yw=()=>{ys&&ys.scope.off(),Wy(null)};function zT(d){return d.vnode.shapeFlag&4}let O_=!1;function EM(d,v=!1,I=!1){v&&zv(v);const{props:O,children:U}=d.vnode,$=zT(d);KA(d,O,$,v),tM(d,U,I);const ee=$?AM(d,v):void 0;return v&&zv(!1),ee}function AM(d,v){const I=d.type;d.accessCache=Object.create(null),d.proxy=new Proxy(d.ctx,GA);const{setup:O}=I;if(O){ff();const U=d.setupContext=O.length>1?IM(d):null,$=V_(d),ee=U_(O,d,0,[d.props,U]),o=D2(ee);if(df(),$(),(o||d.sp)&&!em(d)&&uT(d),o){if(ee.then(yw,yw),v)return ee.then(ue=>{xw(d,ue,v)}).catch(ue=>{r0(ue,d,0)});d.asyncDep=ee}else xw(d,ee,v)}else OT(d,v)}function xw(d,v,I){xn(v)?d.type.__ssrInlineRender?d.ssrRender=v:d.render=v:Zr(v)&&(d.setupState=iT(v)),OT(d,I)}let vw;function OT(d,v,I){const O=d.type;if(!d.render){if(!v&&vw&&!O.render){const U=O.template||y1(d).template;if(U){const{isCustomElement:$,compilerOptions:ee}=d.appContext.config,{delimiters:o,compilerOptions:ue}=O,Re=No(No({isCustomElement:$,delimiters:o},ee),ue);O.render=vw(U,Re)}}d.render=O.render||Hc}{const U=V_(d);ff();try{qA(d)}finally{df(),U()}}}const MM={get(d,v){return _s(d,"get",""),d[v]}};function IM(d){const v=I=>{d.exposed=I||{}};return{attrs:new Proxy(d.attrs,MM),slots:d.slots,emit:d.emit,expose:v}}function l0(d){return d.exposed?d.exposeProxy||(d.exposeProxy=new Proxy(iT(dA(d.exposed)),{get(v,I){if(I in v)return v[I];if(I in T_)return T_[I](d)},has(v,I){return I in v||I in T_}})):d.proxy}function CM(d,v=!0){return xn(d)?d.displayName||d.name:d.name||v&&d.__name}function PM(d){return xn(d)&&"__vccOpts"in d}const Qo=(d,v)=>xA(d,v,O_);function b1(d,v,I){const O=arguments.length;return O===2?Zr(v)&&!dn(v)?z_(v)?yo(d,null,[v]):yo(d,v):yo(d,null,v):(O>3?I=Array.prototype.slice.call(arguments,2):O===3&&z_(I)&&(I=[I]),yo(d,v,I))}const RM="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ov;const bw=typeof window<"u"&&window.trustedTypes;if(bw)try{Ov=bw.createPolicy("vue",{createHTML:d=>d})}catch{}const kT=Ov?d=>Ov.createHTML(d):d=>d,DM="http://www.w3.org/2000/svg",LM="http://www.w3.org/1998/Math/MathML",$u=typeof document<"u"?document:null,ww=$u&&$u.createElement("template"),zM={insert:(d,v,I)=>{v.insertBefore(d,I||null)},remove:d=>{const v=d.parentNode;v&&v.removeChild(d)},createElement:(d,v,I,O)=>{const U=v==="svg"?$u.createElementNS(DM,d):v==="mathml"?$u.createElementNS(LM,d):I?$u.createElement(d,{is:I}):$u.createElement(d);return d==="select"&&O&&O.multiple!=null&&U.setAttribute("multiple",O.multiple),U},createText:d=>$u.createTextNode(d),createComment:d=>$u.createComment(d),setText:(d,v)=>{d.nodeValue=v},setElementText:(d,v)=>{d.textContent=v},parentNode:d=>d.parentNode,nextSibling:d=>d.nextSibling,querySelector:d=>$u.querySelector(d),setScopeId(d,v){d.setAttribute(v,"")},insertStaticContent(d,v,I,O,U,$){const ee=I?I.previousSibling:v.lastChild;if(U&&(U===$||U.nextSibling))for(;v.insertBefore(U.cloneNode(!0),I),!(U===$||!(U=U.nextSibling)););else{ww.innerHTML=kT(O==="svg"?`<svg>${d}</svg>`:O==="mathml"?`<math>${d}</math>`:d);const o=ww.content;if(O==="svg"||O==="mathml"){const ue=o.firstChild;for(;ue.firstChild;)o.appendChild(ue.firstChild);o.removeChild(ue)}v.insertBefore(o,I)}return[ee?ee.nextSibling:v.firstChild,I?I.previousSibling:v.lastChild]}},OM=Symbol("_vtc");function kM(d,v,I){const O=d[OM];O&&(v=(v?[v,...O]:[...O]).join(" ")),v==null?d.removeAttribute("class"):I?d.setAttribute("class",v):d.className=v}const Tw=Symbol("_vod"),FM=Symbol("_vsh"),BM=Symbol(""),NM=/(^|;)\s*display\s*:/;function UM(d,v,I){const O=d.style,U=xo(I);let $=!1;if(I&&!U){if(v)if(xo(v))for(const ee of v.split(";")){const o=ee.slice(0,ee.indexOf(":")).trim();I[o]==null&&Fy(O,o,"")}else for(const ee in v)I[ee]==null&&Fy(O,ee,"");for(const ee in I)ee==="display"&&($=!0),Fy(O,ee,I[ee])}else if(U){if(v!==I){const ee=O[BM];ee&&(I+=";"+ee),O.cssText=I,$=NM.test(I)}}else v&&d.removeAttribute("style");Tw in d&&(d[Tw]=$?O.display:"",d[FM]&&(O.display="none"))}const Sw=/\s*!important$/;function Fy(d,v,I){if(dn(I))I.forEach(O=>Fy(d,v,O));else if(I==null&&(I=""),v.startsWith("--"))d.setProperty(v,I);else{const O=VM(d,v);Sw.test(I)?d.setProperty(Hd(O),I.replace(Sw,""),"important"):d[O]=I}}const Ew=["Webkit","Moz","ms"],cv={};function VM(d,v){const I=cv[v];if(I)return I;let O=cl(v);if(O!=="filter"&&O in d)return cv[v]=O;O=e0(O);for(let U=0;U<Ew.length;U++){const $=Ew[U]+O;if($ in d)return cv[v]=$}return v}const Aw="http://www.w3.org/1999/xlink";function Mw(d,v,I,O,U,$=HE(v)){O&&v.startsWith("xlink:")?I==null?d.removeAttributeNS(Aw,v.slice(6,v.length)):d.setAttributeNS(Aw,v,I):I==null||$&&!k2(I)?d.removeAttribute(v):d.setAttribute(v,$?"":Ju(I)?String(I):I)}function Iw(d,v,I,O,U){if(v==="innerHTML"||v==="textContent"){I!=null&&(d[v]=v==="innerHTML"?kT(I):I);return}const $=d.tagName;if(v==="value"&&$!=="PROGRESS"&&!$.includes("-")){const o=$==="OPTION"?d.getAttribute("value")||"":d.value,ue=I==null?d.type==="checkbox"?"on":"":String(I);(o!==ue||!("_value"in d))&&(d.value=ue),I==null&&d.removeAttribute(v),d._value=I;return}let ee=!1;if(I===""||I==null){const o=typeof d[v];o==="boolean"?I=k2(I):I==null&&o==="string"?(I="",ee=!0):o==="number"&&(I=0,ee=!0)}try{d[v]=I}catch{}ee&&d.removeAttribute(U||v)}function Hp(d,v,I,O){d.addEventListener(v,I,O)}function jM(d,v,I,O){d.removeEventListener(v,I,O)}const Cw=Symbol("_vei");function GM(d,v,I,O,U=null){const $=d[Cw]||(d[Cw]={}),ee=$[v];if(O&&ee)ee.value=O;else{const[o,ue]=qM(v);if(O){const Re=$[v]=WM(O,U);Hp(d,o,Re,ue)}else ee&&(jM(d,o,ee,ue),$[v]=void 0)}}const Pw=/(?:Once|Passive|Capture)$/;function qM(d){let v;if(Pw.test(d)){v={};let O;for(;O=d.match(Pw);)d=d.slice(0,d.length-O[0].length),v[O[0].toLowerCase()]=!0}return[d[2]===":"?d.slice(3):Hd(d.slice(2)),v]}let uv=0;const $M=Promise.resolve(),HM=()=>uv||($M.then(()=>uv=0),uv=Date.now());function WM(d,v){const I=O=>{if(!O._vts)O._vts=Date.now();else if(O._vts<=I.attached)return;Wc(ZM(O,I.value),v,5,[O])};return I.value=d,I.attached=HM(),I}function ZM(d,v){if(dn(v)){const I=d.stopImmediatePropagation;return d.stopImmediatePropagation=()=>{I.call(d),d._stopped=!0},v.map(O=>U=>!U._stopped&&O&&O(U))}else return v}const Rw=d=>d.charCodeAt(0)===111&&d.charCodeAt(1)===110&&d.charCodeAt(2)>96&&d.charCodeAt(2)<123,XM=(d,v,I,O,U,$)=>{const ee=U==="svg";v==="class"?kM(d,O,ee):v==="style"?UM(d,I,O):Ky(v)?n1(v)||GM(d,v,I,O,$):(v[0]==="."?(v=v.slice(1),!0):v[0]==="^"?(v=v.slice(1),!1):YM(d,v,O,ee))?(Iw(d,v,O),!d.tagName.includes("-")&&(v==="value"||v==="checked"||v==="selected")&&Mw(d,v,O,ee,$,v!=="value")):d._isVueCE&&(/[A-Z]/.test(v)||!xo(O))?Iw(d,cl(v),O,$,v):(v==="true-value"?d._trueValue=O:v==="false-value"&&(d._falseValue=O),Mw(d,v,O,ee))};function YM(d,v,I,O){if(O)return!!(v==="innerHTML"||v==="textContent"||v in d&&Rw(v)&&xn(I));if(v==="spellcheck"||v==="draggable"||v==="translate"||v==="form"||v==="list"&&d.tagName==="INPUT"||v==="type"&&d.tagName==="TEXTAREA")return!1;if(v==="width"||v==="height"){const U=d.tagName;if(U==="IMG"||U==="VIDEO"||U==="CANVAS"||U==="SOURCE")return!1}return Rw(v)&&xo(I)?!1:v in d}const Dw=d=>{const v=d.props["onUpdate:modelValue"]||!1;return dn(v)?I=>zy(v,I):v};function KM(d){d.target.composing=!0}function Lw(d){const v=d.target;v.composing&&(v.composing=!1,v.dispatchEvent(new Event("input")))}const hv=Symbol("_assign"),zw={created(d,{modifiers:{lazy:v,trim:I,number:O}},U){d[hv]=Dw(U);const $=O||U.props&&U.props.type==="number";Hp(d,v?"change":"input",ee=>{if(ee.target.composing)return;let o=d.value;I&&(o=o.trim()),$&&(o=wv(o)),d[hv](o)}),I&&Hp(d,"change",()=>{d.value=d.value.trim()}),v||(Hp(d,"compositionstart",KM),Hp(d,"compositionend",Lw),Hp(d,"change",Lw))},mounted(d,{value:v}){d.value=v??""},beforeUpdate(d,{value:v,oldValue:I,modifiers:{lazy:O,trim:U,number:$}},ee){if(d[hv]=Dw(ee),d.composing)return;const o=($||d.type==="number")&&!/^0\d/.test(d.value)?wv(d.value):d.value,ue=v??"";o!==ue&&(document.activeElement===d&&d.type!=="range"&&(O&&v===I||U&&d.value.trim()===ue)||(d.value=ue))}},JM=No({patchProp:XM},zM);let Ow;function QM(){return Ow||(Ow=nM(JM))}const eI=(...d)=>{const v=QM().createApp(...d),{mount:I}=v;return v.mount=O=>{const U=iI(O);if(!U)return;const $=v._component;!xn($)&&!$.render&&!$.template&&($.template=U.innerHTML),U.nodeType===1&&(U.textContent="");const ee=I(U,!1,tI(U));return U instanceof Element&&(U.removeAttribute("v-cloak"),U.setAttribute("data-v-app","")),ee},v};function tI(d){if(d instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&d instanceof MathMLElement)return"mathml"}function iI(d){return xo(d)?document.querySelector(d):d}const c0=(d,v)=>{const I=d.__vccOpts||d;for(const[O,U]of v)I[O]=U;return I},nI={},rI={class:"iphone-container"},oI={class:"screen"};function sI(d,v){return Fa(),Vc("div",rI,[jc("div",oI,[jA(d.$slots,"default")])])}const aI=c0(nI,[["render",sI]]),lI={components:{IPhoneContainer:aI}},cI={class:"app"};function uI(d,v,I,O,U,$){const ee=$y("router-view"),o=$y("IPhoneContainer");return Fa(),Vc("div",cI,[yo(o,null,{default:cT(()=>[yo(ee)]),_:1})])}const hI=c0(lI,[["render",uI]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Wp=typeof document<"u";function FT(d){return typeof d=="object"||"displayName"in d||"props"in d||"__vccOpts"in d}function fI(d){return d.__esModule||d[Symbol.toStringTag]==="Module"||d.default&&FT(d.default)}const sr=Object.assign;function fv(d,v){const I={};for(const O in v){const U=v[O];I[O]=Kl(U)?U.map(d):d(U)}return I}const A_=()=>{},Kl=Array.isArray,BT=/#/g,dI=/&/g,pI=/\//g,mI=/=/g,_I=/\?/g,NT=/\+/g,gI=/%5B/g,yI=/%5D/g,UT=/%5E/g,xI=/%60/g,VT=/%7B/g,vI=/%7C/g,jT=/%7D/g,bI=/%20/g;function w1(d){return encodeURI(""+d).replace(vI,"|").replace(gI,"[").replace(yI,"]")}function wI(d){return w1(d).replace(VT,"{").replace(jT,"}").replace(UT,"^")}function kv(d){return w1(d).replace(NT,"%2B").replace(bI,"+").replace(BT,"%23").replace(dI,"%26").replace(xI,"`").replace(VT,"{").replace(jT,"}").replace(UT,"^")}function TI(d){return kv(d).replace(mI,"%3D")}function SI(d){return w1(d).replace(BT,"%23").replace(_I,"%3F")}function EI(d){return d==null?"":SI(d).replace(pI,"%2F")}function k_(d){try{return decodeURIComponent(""+d)}catch{}return""+d}const AI=/\/$/,MI=d=>d.replace(AI,"");function dv(d,v,I="/"){let O,U={},$="",ee="";const o=v.indexOf("#");let ue=v.indexOf("?");return o<ue&&o>=0&&(ue=-1),ue>-1&&(O=v.slice(0,ue),$=v.slice(ue+1,o>-1?o:v.length),U=d($)),o>-1&&(O=O||v.slice(0,o),ee=v.slice(o,v.length)),O=RI(O??v,I),{fullPath:O+($&&"?")+$+ee,path:O,query:U,hash:k_(ee)}}function II(d,v){const I=v.query?d(v.query):"";return v.path+(I&&"?")+I+(v.hash||"")}function kw(d,v){return!v||!d.toLowerCase().startsWith(v.toLowerCase())?d:d.slice(v.length)||"/"}function CI(d,v,I){const O=v.matched.length-1,U=I.matched.length-1;return O>-1&&O===U&&rm(v.matched[O],I.matched[U])&&GT(v.params,I.params)&&d(v.query)===d(I.query)&&v.hash===I.hash}function rm(d,v){return(d.aliasOf||d)===(v.aliasOf||v)}function GT(d,v){if(Object.keys(d).length!==Object.keys(v).length)return!1;for(const I in d)if(!PI(d[I],v[I]))return!1;return!0}function PI(d,v){return Kl(d)?Fw(d,v):Kl(v)?Fw(v,d):d===v}function Fw(d,v){return Kl(v)?d.length===v.length&&d.every((I,O)=>I===v[O]):d.length===1&&d[0]===v}function RI(d,v){if(d.startsWith("/"))return d;if(!d)return v;const I=v.split("/"),O=d.split("/"),U=O[O.length-1];(U===".."||U===".")&&O.push("");let $=I.length-1,ee,o;for(ee=0;ee<O.length;ee++)if(o=O[ee],o!==".")if(o==="..")$>1&&$--;else break;return I.slice(0,$).join("/")+"/"+O.slice(ee).join("/")}const tf={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var F_;(function(d){d.pop="pop",d.push="push"})(F_||(F_={}));var M_;(function(d){d.back="back",d.forward="forward",d.unknown=""})(M_||(M_={}));function DI(d){if(!d)if(Wp){const v=document.querySelector("base");d=v&&v.getAttribute("href")||"/",d=d.replace(/^\w+:\/\/[^\/]+/,"")}else d="/";return d[0]!=="/"&&d[0]!=="#"&&(d="/"+d),MI(d)}const LI=/^[^#]+#/;function zI(d,v){return d.replace(LI,"#")+v}function OI(d,v){const I=document.documentElement.getBoundingClientRect(),O=d.getBoundingClientRect();return{behavior:v.behavior,left:O.left-I.left-(v.left||0),top:O.top-I.top-(v.top||0)}}const u0=()=>({left:window.scrollX,top:window.scrollY});function kI(d){let v;if("el"in d){const I=d.el,O=typeof I=="string"&&I.startsWith("#"),U=typeof I=="string"?O?document.getElementById(I.slice(1)):document.querySelector(I):I;if(!U)return;v=OI(U,d)}else v=d;"scrollBehavior"in document.documentElement.style?window.scrollTo(v):window.scrollTo(v.left!=null?v.left:window.scrollX,v.top!=null?v.top:window.scrollY)}function Bw(d,v){return(history.state?history.state.position-v:-1)+d}const Fv=new Map;function FI(d,v){Fv.set(d,v)}function BI(d){const v=Fv.get(d);return Fv.delete(d),v}let NI=()=>location.protocol+"//"+location.host;function qT(d,v){const{pathname:I,search:O,hash:U}=v,$=d.indexOf("#");if($>-1){let o=U.includes(d.slice($))?d.slice($).length:1,ue=U.slice(o);return ue[0]!=="/"&&(ue="/"+ue),kw(ue,"")}return kw(I,d)+O+U}function UI(d,v,I,O){let U=[],$=[],ee=null;const o=({state:Ke})=>{const st=qT(d,location),Rt=I.value,It=v.value;let ri=0;if(Ke){if(I.value=st,v.value=Ke,ee&&ee===Rt){ee=null;return}ri=It?Ke.position-It.position:0}else O(st);U.forEach(ft=>{ft(I.value,Rt,{delta:ri,type:F_.pop,direction:ri?ri>0?M_.forward:M_.back:M_.unknown})})};function ue(){ee=I.value}function Re(Ke){U.push(Ke);const st=()=>{const Rt=U.indexOf(Ke);Rt>-1&&U.splice(Rt,1)};return $.push(st),st}function xe(){const{history:Ke}=window;Ke.state&&Ke.replaceState(sr({},Ke.state,{scroll:u0()}),"")}function Oe(){for(const Ke of $)Ke();$=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",xe)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",xe,{passive:!0}),{pauseListeners:ue,listen:Re,destroy:Oe}}function Nw(d,v,I,O=!1,U=!1){return{back:d,current:v,forward:I,replaced:O,position:window.history.length,scroll:U?u0():null}}function VI(d){const{history:v,location:I}=window,O={value:qT(d,I)},U={value:v.state};U.value||$(O.value,{back:null,current:O.value,forward:null,position:v.length-1,replaced:!0,scroll:null},!0);function $(ue,Re,xe){const Oe=d.indexOf("#"),Ke=Oe>-1?(I.host&&document.querySelector("base")?d:d.slice(Oe))+ue:NI()+d+ue;try{v[xe?"replaceState":"pushState"](Re,"",Ke),U.value=Re}catch(st){console.error(st),I[xe?"replace":"assign"](Ke)}}function ee(ue,Re){const xe=sr({},v.state,Nw(U.value.back,ue,U.value.forward,!0),Re,{position:U.value.position});$(ue,xe,!0),O.value=ue}function o(ue,Re){const xe=sr({},U.value,v.state,{forward:ue,scroll:u0()});$(xe.current,xe,!0);const Oe=sr({},Nw(O.value,ue,null),{position:xe.position+1},Re);$(ue,Oe,!1),O.value=ue}return{location:O,state:U,push:o,replace:ee}}function jI(d){d=DI(d);const v=VI(d),I=UI(d,v.state,v.location,v.replace);function O($,ee=!0){ee||I.pauseListeners(),history.go($)}const U=sr({location:"",base:d,go:O,createHref:zI.bind(null,d)},v,I);return Object.defineProperty(U,"location",{enumerable:!0,get:()=>v.location.value}),Object.defineProperty(U,"state",{enumerable:!0,get:()=>v.state.value}),U}function GI(d){return typeof d=="string"||d&&typeof d=="object"}function $T(d){return typeof d=="string"||typeof d=="symbol"}const HT=Symbol("");var Uw;(function(d){d[d.aborted=4]="aborted",d[d.cancelled=8]="cancelled",d[d.duplicated=16]="duplicated"})(Uw||(Uw={}));function om(d,v){return sr(new Error,{type:d,[HT]:!0},v)}function qu(d,v){return d instanceof Error&&HT in d&&(v==null||!!(d.type&v))}const Vw="[^/]+?",qI={sensitive:!1,strict:!1,start:!0,end:!0},$I=/[.+*?^${}()[\]/\\]/g;function HI(d,v){const I=sr({},qI,v),O=[];let U=I.start?"^":"";const $=[];for(const Re of d){const xe=Re.length?[]:[90];I.strict&&!Re.length&&(U+="/");for(let Oe=0;Oe<Re.length;Oe++){const Ke=Re[Oe];let st=40+(I.sensitive?.25:0);if(Ke.type===0)Oe||(U+="/"),U+=Ke.value.replace($I,"\\$&"),st+=40;else if(Ke.type===1){const{value:Rt,repeatable:It,optional:ri,regexp:ft}=Ke;$.push({name:Rt,repeatable:It,optional:ri});const Dt=ft||Vw;if(Dt!==Vw){st+=10;try{new RegExp(`(${Dt})`)}catch(At){throw new Error(`Invalid custom RegExp for param "${Rt}" (${Dt}): `+At.message)}}let Yt=It?`((?:${Dt})(?:/(?:${Dt}))*)`:`(${Dt})`;Oe||(Yt=ri&&Re.length<2?`(?:/${Yt})`:"/"+Yt),ri&&(Yt+="?"),U+=Yt,st+=20,ri&&(st+=-8),It&&(st+=-20),Dt===".*"&&(st+=-50)}xe.push(st)}O.push(xe)}if(I.strict&&I.end){const Re=O.length-1;O[Re][O[Re].length-1]+=.7000000000000001}I.strict||(U+="/?"),I.end?U+="$":I.strict&&!U.endsWith("/")&&(U+="(?:/|$)");const ee=new RegExp(U,I.sensitive?"":"i");function o(Re){const xe=Re.match(ee),Oe={};if(!xe)return null;for(let Ke=1;Ke<xe.length;Ke++){const st=xe[Ke]||"",Rt=$[Ke-1];Oe[Rt.name]=st&&Rt.repeatable?st.split("/"):st}return Oe}function ue(Re){let xe="",Oe=!1;for(const Ke of d){(!Oe||!xe.endsWith("/"))&&(xe+="/"),Oe=!1;for(const st of Ke)if(st.type===0)xe+=st.value;else if(st.type===1){const{value:Rt,repeatable:It,optional:ri}=st,ft=Rt in Re?Re[Rt]:"";if(Kl(ft)&&!It)throw new Error(`Provided param "${Rt}" is an array but it is not repeatable (* or + modifiers)`);const Dt=Kl(ft)?ft.join("/"):ft;if(!Dt)if(ri)Ke.length<2&&(xe.endsWith("/")?xe=xe.slice(0,-1):Oe=!0);else throw new Error(`Missing required param "${Rt}"`);xe+=Dt}}return xe||"/"}return{re:ee,score:O,keys:$,parse:o,stringify:ue}}function WI(d,v){let I=0;for(;I<d.length&&I<v.length;){const O=v[I]-d[I];if(O)return O;I++}return d.length<v.length?d.length===1&&d[0]===80?-1:1:d.length>v.length?v.length===1&&v[0]===80?1:-1:0}function WT(d,v){let I=0;const O=d.score,U=v.score;for(;I<O.length&&I<U.length;){const $=WI(O[I],U[I]);if($)return $;I++}if(Math.abs(U.length-O.length)===1){if(jw(O))return 1;if(jw(U))return-1}return U.length-O.length}function jw(d){const v=d[d.length-1];return d.length>0&&v[v.length-1]<0}const ZI={type:0,value:""},XI=/[a-zA-Z0-9_]/;function YI(d){if(!d)return[[]];if(d==="/")return[[ZI]];if(!d.startsWith("/"))throw new Error(`Invalid path "${d}"`);function v(st){throw new Error(`ERR (${I})/"${Re}": ${st}`)}let I=0,O=I;const U=[];let $;function ee(){$&&U.push($),$=[]}let o=0,ue,Re="",xe="";function Oe(){Re&&(I===0?$.push({type:0,value:Re}):I===1||I===2||I===3?($.length>1&&(ue==="*"||ue==="+")&&v(`A repeatable param (${Re}) must be alone in its segment. eg: '/:ids+.`),$.push({type:1,value:Re,regexp:xe,repeatable:ue==="*"||ue==="+",optional:ue==="*"||ue==="?"})):v("Invalid state to consume buffer"),Re="")}function Ke(){Re+=ue}for(;o<d.length;){if(ue=d[o++],ue==="\\"&&I!==2){O=I,I=4;continue}switch(I){case 0:ue==="/"?(Re&&Oe(),ee()):ue===":"?(Oe(),I=1):Ke();break;case 4:Ke(),I=O;break;case 1:ue==="("?I=2:XI.test(ue)?Ke():(Oe(),I=0,ue!=="*"&&ue!=="?"&&ue!=="+"&&o--);break;case 2:ue===")"?xe[xe.length-1]=="\\"?xe=xe.slice(0,-1)+ue:I=3:xe+=ue;break;case 3:Oe(),I=0,ue!=="*"&&ue!=="?"&&ue!=="+"&&o--,xe="";break;default:v("Unknown state");break}}return I===2&&v(`Unfinished custom RegExp for param "${Re}"`),Oe(),ee(),U}function KI(d,v,I){const O=HI(YI(d.path),I),U=sr(O,{record:d,parent:v,children:[],alias:[]});return v&&!U.record.aliasOf==!v.record.aliasOf&&v.children.push(U),U}function JI(d,v){const I=[],O=new Map;v=Hw({strict:!1,end:!0,sensitive:!1},v);function U(Oe){return O.get(Oe)}function $(Oe,Ke,st){const Rt=!st,It=qw(Oe);It.aliasOf=st&&st.record;const ri=Hw(v,Oe),ft=[It];if("alias"in Oe){const At=typeof Oe.alias=="string"?[Oe.alias]:Oe.alias;for(const Ri of At)ft.push(qw(sr({},It,{components:st?st.record.components:It.components,path:Ri,aliasOf:st?st.record:It})))}let Dt,Yt;for(const At of ft){const{path:Ri}=At;if(Ke&&Ri[0]!=="/"){const Sn=Ke.record.path,Ut=Sn[Sn.length-1]==="/"?"":"/";At.path=Ke.record.path+(Ri&&Ut+Ri)}if(Dt=KI(At,Ke,ri),st?st.alias.push(Dt):(Yt=Yt||Dt,Yt!==Dt&&Yt.alias.push(Dt),Rt&&Oe.name&&!$w(Dt)&&ee(Oe.name)),ZT(Dt)&&ue(Dt),It.children){const Sn=It.children;for(let Ut=0;Ut<Sn.length;Ut++)$(Sn[Ut],Dt,st&&st.children[Ut])}st=st||Dt}return Yt?()=>{ee(Yt)}:A_}function ee(Oe){if($T(Oe)){const Ke=O.get(Oe);Ke&&(O.delete(Oe),I.splice(I.indexOf(Ke),1),Ke.children.forEach(ee),Ke.alias.forEach(ee))}else{const Ke=I.indexOf(Oe);Ke>-1&&(I.splice(Ke,1),Oe.record.name&&O.delete(Oe.record.name),Oe.children.forEach(ee),Oe.alias.forEach(ee))}}function o(){return I}function ue(Oe){const Ke=tC(Oe,I);I.splice(Ke,0,Oe),Oe.record.name&&!$w(Oe)&&O.set(Oe.record.name,Oe)}function Re(Oe,Ke){let st,Rt={},It,ri;if("name"in Oe&&Oe.name){if(st=O.get(Oe.name),!st)throw om(1,{location:Oe});ri=st.record.name,Rt=sr(Gw(Ke.params,st.keys.filter(Yt=>!Yt.optional).concat(st.parent?st.parent.keys.filter(Yt=>Yt.optional):[]).map(Yt=>Yt.name)),Oe.params&&Gw(Oe.params,st.keys.map(Yt=>Yt.name))),It=st.stringify(Rt)}else if(Oe.path!=null)It=Oe.path,st=I.find(Yt=>Yt.re.test(It)),st&&(Rt=st.parse(It),ri=st.record.name);else{if(st=Ke.name?O.get(Ke.name):I.find(Yt=>Yt.re.test(Ke.path)),!st)throw om(1,{location:Oe,currentLocation:Ke});ri=st.record.name,Rt=sr({},Ke.params,Oe.params),It=st.stringify(Rt)}const ft=[];let Dt=st;for(;Dt;)ft.unshift(Dt.record),Dt=Dt.parent;return{name:ri,path:It,params:Rt,matched:ft,meta:eC(ft)}}d.forEach(Oe=>$(Oe));function xe(){I.length=0,O.clear()}return{addRoute:$,resolve:Re,removeRoute:ee,clearRoutes:xe,getRoutes:o,getRecordMatcher:U}}function Gw(d,v){const I={};for(const O of v)O in d&&(I[O]=d[O]);return I}function qw(d){const v={path:d.path,redirect:d.redirect,name:d.name,meta:d.meta||{},aliasOf:d.aliasOf,beforeEnter:d.beforeEnter,props:QI(d),children:d.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in d?d.components||null:d.component&&{default:d.component}};return Object.defineProperty(v,"mods",{value:{}}),v}function QI(d){const v={},I=d.props||!1;if("component"in d)v.default=I;else for(const O in d.components)v[O]=typeof I=="object"?I[O]:I;return v}function $w(d){for(;d;){if(d.record.aliasOf)return!0;d=d.parent}return!1}function eC(d){return d.reduce((v,I)=>sr(v,I.meta),{})}function Hw(d,v){const I={};for(const O in d)I[O]=O in v?v[O]:d[O];return I}function tC(d,v){let I=0,O=v.length;for(;I!==O;){const $=I+O>>1;WT(d,v[$])<0?O=$:I=$+1}const U=iC(d);return U&&(O=v.lastIndexOf(U,O-1)),O}function iC(d){let v=d;for(;v=v.parent;)if(ZT(v)&&WT(d,v)===0)return v}function ZT({record:d}){return!!(d.name||d.components&&Object.keys(d.components).length||d.redirect)}function nC(d){const v={};if(d===""||d==="?")return v;const O=(d[0]==="?"?d.slice(1):d).split("&");for(let U=0;U<O.length;++U){const $=O[U].replace(NT," "),ee=$.indexOf("="),o=k_(ee<0?$:$.slice(0,ee)),ue=ee<0?null:k_($.slice(ee+1));if(o in v){let Re=v[o];Kl(Re)||(Re=v[o]=[Re]),Re.push(ue)}else v[o]=ue}return v}function Ww(d){let v="";for(let I in d){const O=d[I];if(I=TI(I),O==null){O!==void 0&&(v+=(v.length?"&":"")+I);continue}(Kl(O)?O.map($=>$&&kv($)):[O&&kv(O)]).forEach($=>{$!==void 0&&(v+=(v.length?"&":"")+I,$!=null&&(v+="="+$))})}return v}function rC(d){const v={};for(const I in d){const O=d[I];O!==void 0&&(v[I]=Kl(O)?O.map(U=>U==null?null:""+U):O==null?O:""+O)}return v}const oC=Symbol(""),Zw=Symbol(""),T1=Symbol(""),XT=Symbol(""),Bv=Symbol("");function __(){let d=[];function v(O){return d.push(O),()=>{const U=d.indexOf(O);U>-1&&d.splice(U,1)}}function I(){d=[]}return{add:v,list:()=>d.slice(),reset:I}}function sf(d,v,I,O,U,$=ee=>ee()){const ee=O&&(O.enterCallbacks[U]=O.enterCallbacks[U]||[]);return()=>new Promise((o,ue)=>{const Re=Ke=>{Ke===!1?ue(om(4,{from:I,to:v})):Ke instanceof Error?ue(Ke):GI(Ke)?ue(om(2,{from:v,to:Ke})):(ee&&O.enterCallbacks[U]===ee&&typeof Ke=="function"&&ee.push(Ke),o())},xe=$(()=>d.call(O&&O.instances[U],v,I,Re));let Oe=Promise.resolve(xe);d.length<3&&(Oe=Oe.then(Re)),Oe.catch(Ke=>ue(Ke))})}function pv(d,v,I,O,U=$=>$()){const $=[];for(const ee of d)for(const o in ee.components){let ue=ee.components[o];if(!(v!=="beforeRouteEnter"&&!ee.instances[o]))if(FT(ue)){const xe=(ue.__vccOpts||ue)[v];xe&&$.push(sf(xe,I,O,ee,o,U))}else{let Re=ue();$.push(()=>Re.then(xe=>{if(!xe)throw new Error(`Couldn't resolve component "${o}" at "${ee.path}"`);const Oe=fI(xe)?xe.default:xe;ee.mods[o]=xe,ee.components[o]=Oe;const st=(Oe.__vccOpts||Oe)[v];return st&&sf(st,I,O,ee,o,U)()}))}}return $}function Xw(d){const v=Xu(T1),I=Xu(XT),O=Qo(()=>{const ue=Jp(d.to);return v.resolve(ue)}),U=Qo(()=>{const{matched:ue}=O.value,{length:Re}=ue,xe=ue[Re-1],Oe=I.matched;if(!xe||!Oe.length)return-1;const Ke=Oe.findIndex(rm.bind(null,xe));if(Ke>-1)return Ke;const st=Yw(ue[Re-2]);return Re>1&&Yw(xe)===st&&Oe[Oe.length-1].path!==st?Oe.findIndex(rm.bind(null,ue[Re-2])):Ke}),$=Qo(()=>U.value>-1&&uC(I.params,O.value.params)),ee=Qo(()=>U.value>-1&&U.value===I.matched.length-1&&GT(I.params,O.value.params));function o(ue={}){if(cC(ue)){const Re=v[Jp(d.replace)?"replace":"push"](Jp(d.to)).catch(A_);return d.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>Re),Re}return Promise.resolve()}return{route:O,href:Qo(()=>O.value.href),isActive:$,isExactActive:ee,navigate:o}}function sC(d){return d.length===1?d[0]:d}const aC=g1({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Xw,setup(d,{slots:v}){const I=n0(Xw(d)),{options:O}=Xu(T1),U=Qo(()=>({[Kw(d.activeClass,O.linkActiveClass,"router-link-active")]:I.isActive,[Kw(d.exactActiveClass,O.linkExactActiveClass,"router-link-exact-active")]:I.isExactActive}));return()=>{const $=v.default&&sC(v.default(I));return d.custom?$:b1("a",{"aria-current":I.isExactActive?d.ariaCurrentValue:null,href:I.href,onClick:I.navigate,class:U.value},$)}}}),lC=aC;function cC(d){if(!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)&&!d.defaultPrevented&&!(d.button!==void 0&&d.button!==0)){if(d.currentTarget&&d.currentTarget.getAttribute){const v=d.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(v))return}return d.preventDefault&&d.preventDefault(),!0}}function uC(d,v){for(const I in v){const O=v[I],U=d[I];if(typeof O=="string"){if(O!==U)return!1}else if(!Kl(U)||U.length!==O.length||O.some(($,ee)=>$!==U[ee]))return!1}return!0}function Yw(d){return d?d.aliasOf?d.aliasOf.path:d.path:""}const Kw=(d,v,I)=>d??v??I,hC=g1({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(d,{attrs:v,slots:I}){const O=Xu(Bv),U=Qo(()=>d.route||O.value),$=Xu(Zw,0),ee=Qo(()=>{let Re=Jp($);const{matched:xe}=U.value;let Oe;for(;(Oe=xe[Re])&&!Oe.components;)Re++;return Re}),o=Qo(()=>U.value.matched[ee.value]);Oy(Zw,Qo(()=>ee.value+1)),Oy(oC,o),Oy(Bv,U);const ue=pA();return S_(()=>[ue.value,o.value,d.name],([Re,xe,Oe],[Ke,st,Rt])=>{xe&&(xe.instances[Oe]=Re,st&&st!==xe&&Re&&Re===Ke&&(xe.leaveGuards.size||(xe.leaveGuards=st.leaveGuards),xe.updateGuards.size||(xe.updateGuards=st.updateGuards))),Re&&xe&&(!st||!rm(xe,st)||!Ke)&&(xe.enterCallbacks[Oe]||[]).forEach(It=>It(Re))},{flush:"post"}),()=>{const Re=U.value,xe=d.name,Oe=o.value,Ke=Oe&&Oe.components[xe];if(!Ke)return Jw(I.default,{Component:Ke,route:Re});const st=Oe.props[xe],Rt=st?st===!0?Re.params:typeof st=="function"?st(Re):st:null,ri=b1(Ke,sr({},Rt,v,{onVnodeUnmounted:ft=>{ft.component.isUnmounted&&(Oe.instances[xe]=null)},ref:ue}));return Jw(I.default,{Component:ri,route:Re})||ri}}});function Jw(d,v){if(!d)return null;const I=d(v);return I.length===1?I[0]:I}const fC=hC;function dC(d){const v=JI(d.routes,d),I=d.parseQuery||nC,O=d.stringifyQuery||Ww,U=d.history,$=__(),ee=__(),o=__(),ue=mA(tf);let Re=tf;Wp&&d.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const xe=fv.bind(null,Mt=>""+Mt),Oe=fv.bind(null,EI),Ke=fv.bind(null,k_);function st(Mt,si){let ii,ye;return $T(Mt)?(ii=v.getRecordMatcher(Mt),ye=si):ye=Mt,v.addRoute(ye,ii)}function Rt(Mt){const si=v.getRecordMatcher(Mt);si&&v.removeRoute(si)}function It(){return v.getRoutes().map(Mt=>Mt.record)}function ri(Mt){return!!v.getRecordMatcher(Mt)}function ft(Mt,si){if(si=sr({},si||ue.value),typeof Mt=="string"){const he=dv(I,Mt,si.path),ct=v.resolve({path:he.path},si),Ct=U.createHref(he.fullPath);return sr(he,ct,{params:Ke(ct.params),hash:k_(he.hash),redirectedFrom:void 0,href:Ct})}let ii;if(Mt.path!=null)ii=sr({},Mt,{path:dv(I,Mt.path,si.path).path});else{const he=sr({},Mt.params);for(const ct in he)he[ct]==null&&delete he[ct];ii=sr({},Mt,{params:Oe(he)}),si.params=Oe(si.params)}const ye=v.resolve(ii,si),sn=Mt.hash||"";ye.params=xe(Ke(ye.params));const Cn=II(O,sr({},Mt,{hash:wI(sn),path:ye.path})),De=U.createHref(Cn);return sr({fullPath:Cn,hash:sn,query:O===Ww?rC(Mt.query):Mt.query||{}},ye,{redirectedFrom:void 0,href:De})}function Dt(Mt){return typeof Mt=="string"?dv(I,Mt,ue.value.path):sr({},Mt)}function Yt(Mt,si){if(Re!==Mt)return om(8,{from:si,to:Mt})}function At(Mt){return Ut(Mt)}function Ri(Mt){return At(sr(Dt(Mt),{replace:!0}))}function Sn(Mt){const si=Mt.matched[Mt.matched.length-1];if(si&&si.redirect){const{redirect:ii}=si;let ye=typeof ii=="function"?ii(Mt):ii;return typeof ye=="string"&&(ye=ye.includes("?")||ye.includes("#")?ye=Dt(ye):{path:ye},ye.params={}),sr({query:Mt.query,hash:Mt.hash,params:ye.path!=null?{}:Mt.params},ye)}}function Ut(Mt,si){const ii=Re=ft(Mt),ye=ue.value,sn=Mt.state,Cn=Mt.force,De=Mt.replace===!0,he=Sn(ii);if(he)return Ut(sr(Dt(he),{state:typeof he=="object"?sr({},sn,he.state):sn,force:Cn,replace:De}),si||ii);const ct=ii;ct.redirectedFrom=si;let Ct;return!Cn&&CI(O,ye,ii)&&(Ct=om(16,{to:ct,from:ye}),ur(ye,ye,!0,!1)),(Ct?Promise.resolve(Ct):li(ct,ye)).catch(xt=>qu(xt)?qu(xt,2)?xt:Kr(xt):nn(xt,ct,ye)).then(xt=>{if(xt){if(qu(xt,2))return Ut(sr({replace:De},Dt(xt.to),{state:typeof xt.to=="object"?sr({},sn,xt.to.state):sn,force:Cn}),si||ct)}else xt=vo(ct,ye,!0,De,sn);return ui(ct,ye,xt),xt})}function cr(Mt,si){const ii=Yt(Mt,si);return ii?Promise.reject(ii):Promise.resolve()}function Xr(Mt){const si=ts.values().next().value;return si&&typeof si.runWithContext=="function"?si.runWithContext(Mt):Mt()}function li(Mt,si){let ii;const[ye,sn,Cn]=pC(Mt,si);ii=pv(ye.reverse(),"beforeRouteLeave",Mt,si);for(const he of ye)he.leaveGuards.forEach(ct=>{ii.push(sf(ct,Mt,si))});const De=cr.bind(null,Mt,si);return ii.push(De),Qn(ii).then(()=>{ii=[];for(const he of $.list())ii.push(sf(he,Mt,si));return ii.push(De),Qn(ii)}).then(()=>{ii=pv(sn,"beforeRouteUpdate",Mt,si);for(const he of sn)he.updateGuards.forEach(ct=>{ii.push(sf(ct,Mt,si))});return ii.push(De),Qn(ii)}).then(()=>{ii=[];for(const he of Cn)if(he.beforeEnter)if(Kl(he.beforeEnter))for(const ct of he.beforeEnter)ii.push(sf(ct,Mt,si));else ii.push(sf(he.beforeEnter,Mt,si));return ii.push(De),Qn(ii)}).then(()=>(Mt.matched.forEach(he=>he.enterCallbacks={}),ii=pv(Cn,"beforeRouteEnter",Mt,si,Xr),ii.push(De),Qn(ii))).then(()=>{ii=[];for(const he of ee.list())ii.push(sf(he,Mt,si));return ii.push(De),Qn(ii)}).catch(he=>qu(he,8)?he:Promise.reject(he))}function ui(Mt,si,ii){o.list().forEach(ye=>Xr(()=>ye(Mt,si,ii)))}function vo(Mt,si,ii,ye,sn){const Cn=Yt(Mt,si);if(Cn)return Cn;const De=si===tf,he=Wp?history.state:{};ii&&(ye||De?U.replace(Mt.fullPath,sr({scroll:De&&he&&he.scroll},sn)):U.push(Mt.fullPath,sn)),ue.value=Mt,ur(Mt,si,ii,De),Kr()}let Yr;function bs(){Yr||(Yr=U.listen((Mt,si,ii)=>{if(!Rr.listening)return;const ye=ft(Mt),sn=Sn(ye);if(sn){Ut(sr(sn,{replace:!0,force:!0}),ye).catch(A_);return}Re=ye;const Cn=ue.value;Wp&&FI(Bw(Cn.fullPath,ii.delta),u0()),li(ye,Cn).catch(De=>qu(De,12)?De:qu(De,2)?(Ut(sr(Dt(De.to),{force:!0}),ye).then(he=>{qu(he,20)&&!ii.delta&&ii.type===F_.pop&&U.go(-1,!1)}).catch(A_),Promise.reject()):(ii.delta&&U.go(-ii.delta,!1),nn(De,ye,Cn))).then(De=>{De=De||vo(ye,Cn,!1),De&&(ii.delta&&!qu(De,8)?U.go(-ii.delta,!1):ii.type===F_.pop&&qu(De,20)&&U.go(-1,!1)),ui(ye,Cn,De)}).catch(A_)}))}let Ei=__(),zn=__(),tn;function nn(Mt,si,ii){Kr(Mt);const ye=zn.list();return ye.length?ye.forEach(sn=>sn(Mt,si,ii)):console.error(Mt),Promise.reject(Mt)}function _i(){return tn&&ue.value!==tf?Promise.resolve():new Promise((Mt,si)=>{Ei.add([Mt,si])})}function Kr(Mt){return tn||(tn=!Mt,bs(),Ei.list().forEach(([si,ii])=>Mt?ii(Mt):si()),Ei.reset()),Mt}function ur(Mt,si,ii,ye){const{scrollBehavior:sn}=d;if(!Wp||!sn)return Promise.resolve();const Cn=!ii&&BI(Bw(Mt.fullPath,0))||(ye||!ii)&&history.state&&history.state.scroll||null;return rT().then(()=>sn(Mt,si,Cn)).then(De=>De&&kI(De)).catch(De=>nn(De,Mt,si))}const Pr=Mt=>U.go(Mt);let gi;const ts=new Set,Rr={currentRoute:ue,listening:!0,addRoute:st,removeRoute:Rt,clearRoutes:v.clearRoutes,hasRoute:ri,getRoutes:It,resolve:ft,options:d,push:At,replace:Ri,go:Pr,back:()=>Pr(-1),forward:()=>Pr(1),beforeEach:$.add,beforeResolve:ee.add,afterEach:o.add,onError:zn.add,isReady:_i,install(Mt){const si=this;Mt.component("RouterLink",lC),Mt.component("RouterView",fC),Mt.config.globalProperties.$router=si,Object.defineProperty(Mt.config.globalProperties,"$route",{enumerable:!0,get:()=>Jp(ue)}),Wp&&!gi&&ue.value===tf&&(gi=!0,At(U.location).catch(sn=>{}));const ii={};for(const sn in tf)Object.defineProperty(ii,sn,{get:()=>ue.value[sn],enumerable:!0});Mt.provide(T1,si),Mt.provide(XT,Q2(ii)),Mt.provide(Bv,ue);const ye=Mt.unmount;ts.add(Mt),Mt.unmount=function(){ts.delete(Mt),ts.size<1&&(Re=tf,Yr&&Yr(),Yr=null,ue.value=tf,gi=!1,tn=!1),ye()}}};function Qn(Mt){return Mt.reduce((si,ii)=>si.then(()=>Xr(ii)),Promise.resolve())}return Rr}function pC(d,v){const I=[],O=[],U=[],$=Math.max(v.matched.length,d.matched.length);for(let ee=0;ee<$;ee++){const o=v.matched[ee];o&&(d.matched.find(Re=>rm(Re,o))?O.push(o):I.push(o));const ue=d.matched[ee];ue&&(v.matched.find(Re=>rm(Re,ue))||U.push(ue))}return[I,O,U]}var Ry=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mC(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var y_={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var _C=y_.exports,Qw;function gC(){return Qw||(Qw=1,function(d,v){(function(){var I,O="4.17.21",U=200,$="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",ee="Expected a function",o="Invalid `variable` option passed into `_.template`",ue="__lodash_hash_undefined__",Re=500,xe="__lodash_placeholder__",Oe=1,Ke=2,st=4,Rt=1,It=2,ri=1,ft=2,Dt=4,Yt=8,At=16,Ri=32,Sn=64,Ut=128,cr=256,Xr=512,li=30,ui="...",vo=800,Yr=16,bs=1,Ei=2,zn=3,tn=1/0,nn=9007199254740991,_i=17976931348623157e292,Kr=NaN,ur=4294967295,Pr=ur-1,gi=ur>>>1,ts=[["ary",Ut],["bind",ri],["bindKey",ft],["curry",Yt],["curryRight",At],["flip",Xr],["partial",Ri],["partialRight",Sn],["rearg",cr]],Rr="[object Arguments]",Qn="[object Array]",Mt="[object AsyncFunction]",si="[object Boolean]",ii="[object Date]",ye="[object DOMException]",sn="[object Error]",Cn="[object Function]",De="[object GeneratorFunction]",he="[object Map]",ct="[object Number]",Ct="[object Null]",xt="[object Object]",pt="[object Promise]",Xt="[object Proxy]",Zt="[object RegExp]",$t="[object Set]",Nt="[object String]",Mi="[object Symbol]",vt="[object Undefined]",xi="[object WeakMap]",Di="[object WeakSet]",Hi="[object ArrayBuffer]",$i="[object DataView]",Yi="[object Float32Array]",Dr="[object Float64Array]",mr="[object Int8Array]",jr="[object Int16Array]",hr="[object Int32Array]",bo="[object Uint8Array]",ws="[object Uint8ClampedArray]",er="[object Uint16Array]",io="[object Uint32Array]",ji=/\b__p \+= '';/g,Zs=/\b(__p \+=) '' \+/g,th=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Do=/&(?:amp|lt|gt|quot|#39);/g,Ua=/[&<>"']/g,Zc=RegExp(Do.source),Xc=RegExp(Ua.source),Jl=/<%-([\s\S]+?)%>/g,Yc=/<%([\s\S]+?)%>/g,Ze=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ie=/^\w*$/,pe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pe=/[\\^$.*+?()[\]{}|]/g,we=RegExp(Pe.source),ze=/^\s+/,He=/\s/,Be=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Je=/,? & /,Qe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,gt=/[()=,{}\[\]\/\s]/,Lt=/\\(\\)?/g,Ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fi=/\w*$/,wi=/^[-+]0x[0-9a-f]+$/i,Ti=/^0b[01]+$/i,yi=/^\[object .+?Constructor\]$/,pn=/^0o[0-7]+$/i,rn=/^(?:0|[1-9]\d*)$/,Li=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mn=/($^)/,jn=/['\n\r\u2028\u2029\\]/g,_r="\\ud800-\\udfff",no="\\u0300-\\u036f",wr="\\ufe20-\\ufe2f",ro="\\u20d0-\\u20ff",pa=no+wr+ro,Ts="\\u2700-\\u27bf",Kc="a-z\\xdf-\\xf6\\xf8-\\xff",ih="\\xac\\xb1\\xd7\\xf7",nh="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",pf="\\u2000-\\u206f",mf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ul="A-Z\\xc0-\\xd6\\xd8-\\xde",hl="\\ufe0e\\ufe0f",Uo=ih+nh+pf+mf,Vo="['’]",Ss="["+_r+"]",wo="["+Uo+"]",jo="["+pa+"]",Ql="\\d+",_f="["+Ts+"]",rh="["+Kc+"]",Es="[^"+_r+Uo+Ql+Ts+Kc+ul+"]",ec="\\ud83c[\\udffb-\\udfff]",Wd="(?:"+jo+"|"+ec+")",Zd="[^"+_r+"]",ho="(?:\\ud83c[\\udde6-\\uddff]){2}",Xs="[\\ud800-\\udbff][\\udc00-\\udfff]",Ys="["+ul+"]",fl="\\u200d",oh="(?:"+rh+"|"+Es+")",tc="(?:"+Ys+"|"+Es+")",sh="(?:"+Vo+"(?:d|ll|m|re|s|t|ve))?",Ki="(?:"+Vo+"(?:D|LL|M|RE|S|T|VE))?",ah=Wd+"?",_n="["+hl+"]?",lm="(?:"+fl+"(?:"+[Zd,ho,Xs].join("|")+")"+_n+ah+")*",hi="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Jc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Va=_n+ah+lm,ic="(?:"+[_f,ho,Xs].join("|")+")"+Va,As="(?:"+[Zd+jo+"?",jo,ho,Xs,Ss].join("|")+")",lh=RegExp(Vo,"g"),Ms=RegExp(jo,"g"),Gt=RegExp(ec+"(?="+ec+")|"+As+Va,"g"),Wi=RegExp([Ys+"?"+rh+"+"+sh+"(?="+[wo,Ys,"$"].join("|")+")",tc+"+"+Ki+"(?="+[wo,Ys+oh,"$"].join("|")+")",Ys+"?"+oh+"+"+sh,Ys+"+"+Ki,Jc,hi,Ql,ic].join("|"),"g"),Zi=RegExp("["+fl+_r+pa+hl+"]"),Lo=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,fo=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ji=-1,tr={};tr[Yi]=tr[Dr]=tr[mr]=tr[jr]=tr[hr]=tr[bo]=tr[ws]=tr[er]=tr[io]=!0,tr[Rr]=tr[Qn]=tr[Hi]=tr[si]=tr[$i]=tr[ii]=tr[sn]=tr[Cn]=tr[he]=tr[ct]=tr[xt]=tr[Zt]=tr[$t]=tr[Nt]=tr[xi]=!1;var Hn={};Hn[Rr]=Hn[Qn]=Hn[Hi]=Hn[$i]=Hn[si]=Hn[ii]=Hn[Yi]=Hn[Dr]=Hn[mr]=Hn[jr]=Hn[hr]=Hn[he]=Hn[ct]=Hn[xt]=Hn[Zt]=Hn[$t]=Hn[Nt]=Hn[Mi]=Hn[bo]=Hn[ws]=Hn[er]=Hn[io]=!0,Hn[sn]=Hn[Cn]=Hn[xi]=!1;var nc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},To={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fr={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Xd={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},rc=parseFloat,oc=parseInt,Is=typeof Ry=="object"&&Ry&&Ry.Object===Object&&Ry,ch=typeof self=="object"&&self&&self.Object===Object&&self,Yn=Is||ch||Function("return this")(),oo=v&&!v.nodeType&&v,Lr=oo&&!0&&d&&!d.nodeType&&d,gf=Lr&&Lr.exports===oo,Ks=gf&&Is.process,On=function(){try{var et=Lr&&Lr.require&&Lr.require("util").types;return et||Ks&&Ks.binding&&Ks.binding("util")}catch{}}(),po=On&&On.isArrayBuffer,is=On&&On.isDate,zr=On&&On.isMap,uh=On&&On.isRegExp,ns=On&&On.isSet,dl=On&&On.isTypedArray;function Jr(et,Tt,mt){switch(mt.length){case 0:return et.call(Tt);case 1:return et.call(Tt,mt[0]);case 2:return et.call(Tt,mt[0],mt[1]);case 3:return et.call(Tt,mt[0],mt[1],mt[2])}return et.apply(Tt,mt)}function pl(et,Tt,mt,pi){for(var Qi=-1,Pn=et==null?0:et.length;++Qi<Pn;){var Tr=et[Qi];Tt(pi,Tr,mt(Tr),et)}return pi}function So(et,Tt){for(var mt=-1,pi=et==null?0:et.length;++mt<pi&&Tt(et[mt],mt,et)!==!1;);return et}function ma(et,Tt){for(var mt=et==null?0:et.length;mt--&&Tt(et[mt],mt,et)!==!1;);return et}function Yd(et,Tt){for(var mt=-1,pi=et==null?0:et.length;++mt<pi;)if(!Tt(et[mt],mt,et))return!1;return!0}function _a(et,Tt){for(var mt=-1,pi=et==null?0:et.length,Qi=0,Pn=[];++mt<pi;){var Tr=et[mt];Tt(Tr,mt,et)&&(Pn[Qi++]=Tr)}return Pn}function co(et,Tt){var mt=et==null?0:et.length;return!!mt&&ya(et,Tt,0)>-1}function yf(et,Tt,mt){for(var pi=-1,Qi=et==null?0:et.length;++pi<Qi;)if(mt(Tt,et[pi]))return!0;return!1}function ir(et,Tt){for(var mt=-1,pi=et==null?0:et.length,Qi=Array(pi);++mt<pi;)Qi[mt]=Tt(et[mt],mt,et);return Qi}function ga(et,Tt){for(var mt=-1,pi=Tt.length,Qi=et.length;++mt<pi;)et[Qi+mt]=Tt[mt];return et}function ja(et,Tt,mt,pi){var Qi=-1,Pn=et==null?0:et.length;for(pi&&Pn&&(mt=et[++Qi]);++Qi<Pn;)mt=Tt(mt,et[Qi],Qi,et);return mt}function sc(et,Tt,mt,pi){var Qi=et==null?0:et.length;for(pi&&Qi&&(mt=et[--Qi]);Qi--;)mt=Tt(mt,et[Qi],Qi,et);return mt}function xf(et,Tt){for(var mt=-1,pi=et==null?0:et.length;++mt<pi;)if(Tt(et[mt],mt,et))return!0;return!1}var Qc=tu("length");function ml(et){return et.split("")}function cm(et){return et.match(Qe)||[]}function _l(et,Tt,mt){var pi;return mt(et,function(Qi,Pn,Tr){if(Tt(Qi,Pn,Tr))return pi=Pn,!1}),pi}function eu(et,Tt,mt,pi){for(var Qi=et.length,Pn=mt+(pi?1:-1);pi?Pn--:++Pn<Qi;)if(Tt(et[Pn],Pn,et))return Pn;return-1}function ya(et,Tt,mt){return Tt===Tt?qo(et,Tt,mt):eu(et,Oi,mt)}function Go(et,Tt,mt,pi){for(var Qi=mt-1,Pn=et.length;++Qi<Pn;)if(pi(et[Qi],Tt))return Qi;return-1}function Oi(et){return et!==et}function oi(et,Tt){var mt=et==null?0:et.length;return mt?di(et,Tt)/mt:Kr}function tu(et){return function(Tt){return Tt==null?I:Tt[et]}}function vi(et){return function(Tt){return et==null?I:et[Tt]}}function hh(et,Tt,mt,pi,Qi){return Qi(et,function(Pn,Tr,Wn){mt=pi?(pi=!1,Pn):Tt(mt,Pn,Tr,Wn)}),mt}function iu(et,Tt){var mt=et.length;for(et.sort(Tt);mt--;)et[mt]=et[mt].value;return et}function di(et,Tt){for(var mt,pi=-1,Qi=et.length;++pi<Qi;){var Pn=Tt(et[pi]);Pn!==I&&(mt=mt===I?Pn:mt+Pn)}return mt}function nu(et,Tt){for(var mt=-1,pi=Array(et);++mt<et;)pi[mt]=Tt(mt);return pi}function fh(et,Tt){return ir(Tt,function(mt){return[mt,et[mt]]})}function dh(et){return et&&et.slice(0,wf(et)+1).replace(ze,"")}function Gr(et){return function(Tt){return et(Tt)}}function xa(et,Tt){return ir(Tt,function(mt){return et[mt]})}function Or(et,Tt){return et.has(Tt)}function ru(et,Tt){for(var mt=-1,pi=et.length;++mt<pi&&ya(Tt,et[mt],0)>-1;);return mt}function gl(et,Tt){for(var mt=et.length;mt--&&ya(Tt,et[mt],0)>-1;);return mt}function ac(et,Tt){for(var mt=et.length,pi=0;mt--;)et[mt]===Tt&&++pi;return pi}var ph=vi(nc),va=vi(To);function nr(et){return"\\"+Xd[et]}function vf(et,Tt){return et==null?I:et[Tt]}function wt(et){return Zi.test(et)}function Kd(et){return Lo.test(et)}function lc(et){for(var Tt,mt=[];!(Tt=et.next()).done;)mt.push(Tt.value);return mt}function cc(et){var Tt=-1,mt=Array(et.size);return et.forEach(function(pi,Qi){mt[++Tt]=[Qi,pi]}),mt}function ou(et,Tt){return function(mt){return et(Tt(mt))}}function Cs(et,Tt){for(var mt=-1,pi=et.length,Qi=0,Pn=[];++mt<pi;){var Tr=et[mt];(Tr===Tt||Tr===xe)&&(et[mt]=xe,Pn[Qi++]=mt)}return Pn}function rs(et){var Tt=-1,mt=Array(et.size);return et.forEach(function(pi){mt[++Tt]=pi}),mt}function bf(et){var Tt=-1,mt=Array(et.size);return et.forEach(function(pi){mt[++Tt]=[pi,pi]}),mt}function qo(et,Tt,mt){for(var pi=mt-1,Qi=et.length;++pi<Qi;)if(et[pi]===Tt)return pi;return-1}function mh(et,Tt,mt){for(var pi=mt+1;pi--;)if(et[pi]===Tt)return pi;return pi}function Ps(et){return wt(et)?Jd(et):Qc(et)}function os(et){return wt(et)?Tf(et):ml(et)}function wf(et){for(var Tt=et.length;Tt--&&He.test(et.charAt(Tt)););return Tt}var $o=vi(fr);function Jd(et){for(var Tt=Gt.lastIndex=0;Gt.test(et);)++Tt;return Tt}function Tf(et){return et.match(Gt)||[]}function Sf(et){return et.match(Wi)||[]}var _h=function et(Tt){Tt=Tt==null?Yn:yl.defaults(Yn.Object(),Tt,yl.pick(Yn,fo));var mt=Tt.Array,pi=Tt.Date,Qi=Tt.Error,Pn=Tt.Function,Tr=Tt.Math,Wn=Tt.Object,Ga=Tt.RegExp,su=Tt.String,Eo=Tt.TypeError,Rs=mt.prototype,qa=Pn.prototype,ki=Wn.prototype,ba=Tt["__core-js_shared__"],$a=qa.toString,Gn=ki.hasOwnProperty,au=0,xl=function(){var m=/[^.]+$/.exec(ba&&ba.keys&&ba.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),vn=ki.toString,Ef=$a.call(Wn),Qd=Yn._,Af=Ga("^"+$a.call(Gn).replace(Pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vl=gf?Tt.Buffer:I,ss=Tt.Symbol,lu=Tt.Uint8Array,Mf=vl?vl.allocUnsafe:I,cu=ou(Wn.getPrototypeOf,Wn),bl=Wn.create,If=ki.propertyIsEnumerable,gh=Rs.splice,ep=ss?ss.isConcatSpreadable:I,uu=ss?ss.iterator:I,wa=ss?ss.toStringTag:I,uc=function(){try{var m=_(Wn,"defineProperty");return m({},"",{}),m}catch{}}(),Cf=Tt.clearTimeout!==Yn.clearTimeout&&Tt.clearTimeout,Pf=pi&&pi.now!==Yn.Date.now&&pi.now,tp=Tt.setTimeout!==Yn.setTimeout&&Tt.setTimeout,hu=Tr.ceil,yh=Tr.floor,wl=Wn.getOwnPropertySymbols,fu=vl?vl.isBuffer:I,Rf=Tt.isFinite,Ho=Rs.join,Df=ou(Wn.keys,Wn),Sr=Tr.max,Qr=Tr.min,Lf=pi.now,zf=Tt.parseInt,du=Tr.random,Of=Rs.reverse,Tl=_(Tt,"DataView"),Ha=_(Tt,"Map"),pu=_(Tt,"Promise"),Sl=_(Tt,"Set"),Js=_(Tt,"WeakMap"),mu=_(Wn,"create"),_u=Js&&new Js,El={},hc=Kt(Tl),ip=Kt(Ha),np=Kt(pu),kf=Kt(Sl),gu=Kt(Js),Al=ss?ss.prototype:I,Qs=Al?Al.valueOf:I,Ff=Al?Al.toString:I;function _e(m){if(Br(m)&&!un(m)&&!(m instanceof En)){if(m instanceof so)return m;if(Gn.call(m,"__wrapped__"))return ai(m)}return new so(m)}var Wa=function(){function m(){}return function(S){if(!yr(S))return{};if(bl)return bl(S);m.prototype=S;var z=new m;return m.prototype=I,z}}();function fc(){}function so(m,S){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!S,this.__index__=0,this.__values__=I}_e.templateSettings={escape:Jl,evaluate:Yc,interpolate:Ze,variable:"",imports:{_:_e}},_e.prototype=fc.prototype,_e.prototype.constructor=_e,so.prototype=Wa(fc.prototype),so.prototype.constructor=so;function En(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ur,this.__views__=[]}function Ta(){var m=new En(this.__wrapped__);return m.__actions__=go(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=go(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=go(this.__views__),m}function xh(){if(this.__filtered__){var m=new En(this);m.__dir__=-1,m.__filtered__=!0}else m=this.clone(),m.__dir__*=-1;return m}function Ml(){var m=this.__wrapped__.value(),S=this.__dir__,z=un(m),H=S<0,ne=z?m.length:0,ve=R(0,ne,this.__views__),Ne=ve.start,qe=ve.end,it=qe-Ne,Pt=H?qe:Ne-1,Ot=this.__iteratees__,jt=Ot.length,ci=0,Ii=Qr(it,this.__takeCount__);if(!z||!H&&ne==it&&Ii==it)return bc(m,this.__actions__);var Gi=[];e:for(;it--&&ci<Ii;){Pt+=S;for(var wn=-1,qi=m[Pt];++wn<jt;){var Dn=Ot[wn],Fn=Dn.iteratee,qs=Dn.type,Jo=Fn(qi);if(qs==Ei)qi=Jo;else if(!Jo){if(qs==bs)continue e;break e}}Gi[ci++]=qi}return Gi}En.prototype=Wa(fc.prototype),En.prototype.constructor=En;function Za(m){var S=-1,z=m==null?0:m.length;for(this.clear();++S<z;){var H=m[S];this.set(H[0],H[1])}}function Bf(){this.__data__=mu?mu(null):{},this.size=0}function Nf(m){var S=this.has(m)&&delete this.__data__[m];return this.size-=S?1:0,S}function Uf(m){var S=this.__data__;if(mu){var z=S[m];return z===ue?I:z}return Gn.call(S,m)?S[m]:I}function rp(m){var S=this.__data__;return mu?S[m]!==I:Gn.call(S,m)}function Vf(m,S){var z=this.__data__;return this.size+=this.has(m)?0:1,z[m]=mu&&S===I?ue:S,this}Za.prototype.clear=Bf,Za.prototype.delete=Nf,Za.prototype.get=Uf,Za.prototype.has=rp,Za.prototype.set=Vf;function Wo(m){var S=-1,z=m==null?0:m.length;for(this.clear();++S<z;){var H=m[S];this.set(H[0],H[1])}}function um(){this.__data__=[],this.size=0}function hm(m){var S=this.__data__,z=Sa(S,m);if(z<0)return!1;var H=S.length-1;return z==H?S.pop():gh.call(S,z,1),--this.size,!0}function jf(m){var S=this.__data__,z=Sa(S,m);return z<0?I:S[z][1]}function fm(m){return Sa(this.__data__,m)>-1}function Gf(m,S){var z=this.__data__,H=Sa(z,m);return H<0?(++this.size,z.push([m,S])):z[H][1]=S,this}Wo.prototype.clear=um,Wo.prototype.delete=hm,Wo.prototype.get=jf,Wo.prototype.has=fm,Wo.prototype.set=Gf;function as(m){var S=-1,z=m==null?0:m.length;for(this.clear();++S<z;){var H=m[S];this.set(H[0],H[1])}}function dc(){this.size=0,this.__data__={hash:new Za,map:new(Ha||Wo),string:new Za}}function vh(m){var S=c(this,m).delete(m);return this.size-=S?1:0,S}function yu(m){return c(this,m).get(m)}function Il(m){return c(this,m).has(m)}function bh(m,S){var z=c(this,m),H=z.size;return z.set(m,S),this.size+=z.size==H?0:1,this}as.prototype.clear=dc,as.prototype.delete=vh,as.prototype.get=yu,as.prototype.has=Il,as.prototype.set=bh;function ea(m){var S=-1,z=m==null?0:m.length;for(this.__data__=new as;++S<z;)this.add(m[S])}function qf(m){return this.__data__.set(m,ue),this}function $f(m){return this.__data__.has(m)}ea.prototype.add=ea.prototype.push=qf,ea.prototype.has=$f;function ls(m){var S=this.__data__=new Wo(m);this.size=S.size}function Cl(){this.__data__=new Wo,this.size=0}function xu(m){var S=this.__data__,z=S.delete(m);return this.size=S.size,z}function Vt(m){return this.__data__.get(m)}function wh(m){return this.__data__.has(m)}function Hf(m,S){var z=this.__data__;if(z instanceof Wo){var H=z.__data__;if(!Ha||H.length<U-1)return H.push([m,S]),this.size=++z.size,this;z=this.__data__=new as(H)}return z.set(m,S),this.size=z.size,this}ls.prototype.clear=Cl,ls.prototype.delete=xu,ls.prototype.get=Vt,ls.prototype.has=wh,ls.prototype.set=Hf;function Xa(m,S){var z=un(m),H=!z&&Vs(m),ne=!z&&!H&&jl(m),ve=!z&&!H&&!ne&&ju(m),Ne=z||H||ne||ve,qe=Ne?nu(m.length,su):[],it=qe.length;for(var Pt in m)(S||Gn.call(m,Pt))&&!(Ne&&(Pt=="length"||ne&&(Pt=="offset"||Pt=="parent")||ve&&(Pt=="buffer"||Pt=="byteLength"||Pt=="byteOffset")||te(Pt,it)))&&qe.push(Pt);return qe}function Ao(m){var S=m.length;return S?m[Os(0,S-1)]:I}function Qt(m,S){return Wt(go(m),Ds(S,0,m.length))}function Wf(m){return Wt(go(m))}function Th(m,S,z){(z!==I&&!la(m[S],z)||z===I&&!(S in m))&&Ea(m,S,z)}function vu(m,S,z){var H=m[S];(!(Gn.call(m,S)&&la(H,z))||z===I&&!(S in m))&&Ea(m,S,z)}function Sa(m,S){for(var z=m.length;z--;)if(la(m[z][0],S))return z;return-1}function Zf(m,S,z,H){return ta(m,function(ne,ve,Ne){S(H,ne,z(ne),Ne)}),H}function pc(m,S){return m&&ia(S,uo(S),m)}function op(m,S){return m&&ia(S,Ko(S),m)}function Ea(m,S,z){S=="__proto__"&&uc?uc(m,S,{configurable:!0,enumerable:!0,value:z,writable:!0}):m[S]=z}function bu(m,S){for(var z=-1,H=S.length,ne=mt(H),ve=m==null;++z<H;)ne[z]=ve?I:Vm(m,S[z]);return ne}function Ds(m,S,z){return m===m&&(z!==I&&(m=m<=z?m:z),S!==I&&(m=m>=S?m:S)),m}function mo(m,S,z,H,ne,ve){var Ne,qe=S&Oe,it=S&Ke,Pt=S&st;if(z&&(Ne=ne?z(m,H,ne,ve):z(m)),Ne!==I)return Ne;if(!yr(m))return m;var Ot=un(m);if(Ot){if(Ne=G(m),!qe)return go(m,Ne)}else{var jt=D(m),ci=jt==Cn||jt==De;if(jl(m))return Sc(m,qe);if(jt==xt||jt==Rr||ci&&!ne){if(Ne=it||ci?{}:X(m),!qe)return it?rr(m,op(Ne,m)):mm(m,pc(Ne,m))}else{if(!Hn[jt])return ne?m:{};Ne=W(m,jt,qe)}}ve||(ve=new ls);var Ii=ve.get(m);if(Ii)return Ii;ve.set(m,Ne),Fm(m)?m.forEach(function(qi){Ne.add(mo(qi,S,z,qi,m,ve))}):Ep(m)&&m.forEach(function(qi,Dn){Ne.set(Dn,mo(qi,S,z,Dn,m,ve))});var Gi=Pt?it?to:Fh:it?Ko:uo,wn=Ot?I:Gi(m);return So(wn||m,function(qi,Dn){wn&&(Dn=qi,qi=m[Dn]),vu(Ne,Dn,mo(qi,S,z,Dn,m,ve))}),Ne}function Sh(m){var S=uo(m);return function(z){return ao(z,m,S)}}function ao(m,S,z){var H=z.length;if(m==null)return!H;for(m=Wn(m);H--;){var ne=z[H],ve=S[ne],Ne=m[ne];if(Ne===I&&!(ne in m)||!ve(Ne))return!1}return!0}function zo(m,S,z){if(typeof m!="function")throw new Eo(ee);return nt(function(){m.apply(I,z)},S)}function mc(m,S,z,H){var ne=-1,ve=co,Ne=!0,qe=m.length,it=[],Pt=S.length;if(!qe)return it;z&&(S=ir(S,Gr(z))),H?(ve=yf,Ne=!1):S.length>=U&&(ve=Or,Ne=!1,S=new ea(S));e:for(;++ne<qe;){var Ot=m[ne],jt=z==null?Ot:z(Ot);if(Ot=H||Ot!==0?Ot:0,Ne&&jt===jt){for(var ci=Pt;ci--;)if(S[ci]===jt)continue e;it.push(Ot)}else ve(S,jt,H)||it.push(Ot)}return it}var ta=cp(Ls),Eh=cp(Ah,!0);function Xf(m,S){var z=!0;return ta(m,function(H,ne,ve){return z=!!S(H,ne,ve),z}),z}function wu(m,S,z){for(var H=-1,ne=m.length;++H<ne;){var ve=m[H],Ne=S(ve);if(Ne!=null&&(qe===I?Ne===Ne&&!ds(Ne):z(Ne,qe)))var qe=Ne,it=ve}return it}function Zo(m,S,z,H){var ne=m.length;for(z=fn(z),z<0&&(z=-z>ne?0:ne+z),H=H===I||H>ne?ne:fn(H),H<0&&(H+=ne),H=z>H?0:Bm(H);z<H;)m[z++]=S;return m}function Kn(m,S){var z=[];return ta(m,function(H,ne,ve){S(H,ne,ve)&&z.push(H)}),z}function qr(m,S,z,H,ne){var ve=-1,Ne=m.length;for(z||(z=Y),ne||(ne=[]);++ve<Ne;){var qe=m[ve];S>0&&z(qe)?S>1?qr(qe,S-1,z,H,ne):ga(ne,qe):H||(ne[ne.length]=qe)}return ne}var Tu=Ac(),Yf=Ac(!0);function Ls(m,S){return m&&Tu(m,S,uo)}function Ah(m,S){return m&&Yf(m,S,uo)}function Mh(m,S){return _a(S,function(z){return nl(m[z])})}function cs(m,S){S=Fs(S,m);for(var z=0,H=S.length;m!=null&&z<H;)m=m[kt(S[z++])];return z&&z==H?m:I}function Pl(m,S,z){var H=S(m);return un(m)?H:ga(H,z(m))}function ht(m){return m==null?m===I?vt:Ct:wa&&wa in Wn(m)?y(m):at(m)}function ei(m,S){return m>S}function _c(m,S){return m!=null&&Gn.call(m,S)}function Bn(m,S){return m!=null&&S in Wn(m)}function Ve(m,S,z){return m>=Qr(S,z)&&m<Sr(S,z)}function Su(m,S,z){for(var H=z?yf:co,ne=m[0].length,ve=m.length,Ne=ve,qe=mt(ve),it=1/0,Pt=[];Ne--;){var Ot=m[Ne];Ne&&S&&(Ot=ir(Ot,Gr(S))),it=Qr(Ot.length,it),qe[Ne]=!z&&(S||ne>=120&&Ot.length>=120)?new ea(Ne&&Ot):I}Ot=m[0];var jt=-1,ci=qe[0];e:for(;++jt<ne&&Pt.length<it;){var Ii=Ot[jt],Gi=S?S(Ii):Ii;if(Ii=z||Ii!==0?Ii:0,!(ci?Or(ci,Gi):H(Pt,Gi,z))){for(Ne=ve;--Ne;){var wn=qe[Ne];if(!(wn?Or(wn,Gi):H(m[Ne],Gi,z)))continue e}ci&&ci.push(Gi),Pt.push(Ii)}}return Pt}function Rl(m,S,z,H){return Ls(m,function(ne,ve,Ne){S(H,z(ne),ve,Ne)}),H}function Dl(m,S,z){S=Fs(S,m),m=bt(m,S);var H=m==null?m:m[kt(dr(S))];return H==null?I:Jr(H,m,z)}function Eu(m){return Br(m)&&ht(m)==Rr}function Aa(m){return Br(m)&&ht(m)==Hi}function Kf(m){return Br(m)&&ht(m)==ii}function Mo(m,S,z,H,ne){return m===S?!0:m==null||S==null||!Br(m)&&!Br(S)?m!==m&&S!==S:dm(m,S,z,H,Mo,ne)}function dm(m,S,z,H,ne,ve){var Ne=un(m),qe=un(S),it=Ne?Qn:D(m),Pt=qe?Qn:D(S);it=it==Rr?xt:it,Pt=Pt==Rr?xt:Pt;var Ot=it==xt,jt=Pt==xt,ci=it==Pt;if(ci&&jl(m)){if(!jl(S))return!1;Ne=!0,Ot=!1}if(ci&&!Ot)return ve||(ve=new ls),Ne||ju(m)?hp(m,S,z,H,ne,ve):gm(m,S,it,z,H,ne,ve);if(!(z&Rt)){var Ii=Ot&&Gn.call(m,"__wrapped__"),Gi=jt&&Gn.call(S,"__wrapped__");if(Ii||Gi){var wn=Ii?m.value():m,qi=Gi?S.value():S;return ve||(ve=new ls),ne(wn,qi,z,H,ve)}}return ci?(ve||(ve=new ls),ym(m,S,z,H,ne,ve)):!1}function pm(m){return Br(m)&&D(m)==he}function Ih(m,S,z,H){var ne=z.length,ve=ne,Ne=!H;if(m==null)return!ve;for(m=Wn(m);ne--;){var qe=z[ne];if(Ne&&qe[2]?qe[1]!==m[qe[0]]:!(qe[0]in m))return!1}for(;++ne<ve;){qe=z[ne];var it=qe[0],Pt=m[it],Ot=qe[1];if(Ne&&qe[2]){if(Pt===I&&!(it in m))return!1}else{var jt=new ls;if(H)var ci=H(Pt,Ot,it,m,S,jt);if(!(ci===I?Mo(Ot,Pt,Rt|It,H,jt):ci))return!1}}return!0}function Au(m){if(!yr(m)||de(m))return!1;var S=nl(m)?Af:yi;return S.test(Kt(m))}function Jf(m){return Br(m)&&ht(m)==Zt}function Qf(m){return Br(m)&&D(m)==$t}function Ch(m){return Br(m)&&yd(m.length)&&!!tr[ht(m)]}function Ya(m){return typeof m=="function"?m:m==null?ps:typeof m=="object"?un(m)?ed(m[0],m[1]):_o(m):$l(m)}function Ll(m){if(!Te(m))return Df(m);var S=[];for(var z in Wn(m))Gn.call(m,z)&&z!="constructor"&&S.push(z);return S}function Ph(m){if(!yr(m))return Ye(m);var S=Te(m),z=[];for(var H in m)H=="constructor"&&(S||!Gn.call(m,H))||z.push(H);return z}function Rh(m,S){return m<S}function zs(m,S){var z=-1,H=Yo(m)?mt(m.length):[];return ta(m,function(ne,ve,Ne){H[++z]=S(ne,ve,Ne)}),H}function _o(m){var S=f(m);return S.length==1&&S[0][2]?Ae(S[0][0],S[0][1]):function(z){return z===m||Ih(z,m,S)}}function ed(m,S){return le(m)&&Ce(S)?Ae(kt(m),S):function(z){var H=Vm(z,m);return H===I&&H===S?Td(z,m):Mo(S,H,Rt|It)}}function Ka(m,S,z,H,ne){m!==S&&Tu(S,function(ve,Ne){if(ne||(ne=new ls),yr(ve))Nn(m,S,Ne,z,Ka,H,ne);else{var qe=H?H(rt(m,Ne),ve,Ne+"",m,S,ne):I;qe===I&&(qe=ve),Th(m,Ne,qe)}},Ko)}function Nn(m,S,z,H,ne,ve,Ne){var qe=rt(m,z),it=rt(S,z),Pt=Ne.get(it);if(Pt){Th(m,z,Pt);return}var Ot=ve?ve(qe,it,z+"",m,S,Ne):I,jt=Ot===I;if(jt){var ci=un(it),Ii=!ci&&jl(it),Gi=!ci&&!Ii&&ju(it);Ot=it,ci||Ii||Gi?un(qe)?Ot=qe:Hr(qe)?Ot=go(qe):Ii?(jt=!1,Ot=Sc(it,!0)):Gi?(jt=!1,Ot=ku(it,!0)):Ot=[]:Gl(it)||Vs(it)?(Ot=qe,Vs(qe)?Ot=Nm(qe):(!yr(qe)||nl(qe))&&(Ot=X(it))):jt=!1}jt&&(Ne.set(it,Ot),ne(Ot,it,H,ve,Ne),Ne.delete(it)),Th(m,z,Ot)}function on(m,S){var z=m.length;if(z)return S+=S<0?z:0,te(S,z)?m[S]:I}function td(m,S,z){S.length?S=ir(S,function(ve){return un(ve)?function(Ne){return cs(Ne,ve.length===1?ve[0]:ve)}:ve}):S=[ps];var H=-1;S=ir(S,Gr(n()));var ne=zs(m,function(ve,Ne,qe){var it=ir(S,function(Pt){return Pt(ve)});return{criteria:it,index:++H,value:ve}});return iu(ne,function(ve,Ne){return lp(ve,Ne,z)})}function Ja(m,S){return Mu(m,S,function(z,H){return Td(m,H)})}function Mu(m,S,z){for(var H=-1,ne=S.length,ve={};++H<ne;){var Ne=S[H],qe=cs(m,Ne);z(qe,Ne)&&zl(ve,Fs(Ne,m),qe)}return ve}function gc(m){return function(S){return cs(S,m)}}function Iu(m,S,z,H){var ne=H?Go:ya,ve=-1,Ne=S.length,qe=m;for(m===S&&(S=go(S)),z&&(qe=ir(m,Gr(z)));++ve<Ne;)for(var it=0,Pt=S[ve],Ot=z?z(Pt):Pt;(it=ne(qe,Ot,it,H))>-1;)qe!==m&&gh.call(qe,it,1),gh.call(m,it,1);return m}function yc(m,S){for(var z=m?S.length:0,H=z-1;z--;){var ne=S[z];if(z==H||ne!==ve){var ve=ne;te(ne)?gh.call(m,ne,1):Pu(m,ne)}}return m}function Os(m,S){return m+yh(du()*(S-m+1))}function Qa(m,S,z,H){for(var ne=-1,ve=Sr(hu((S-m)/(z||1)),0),Ne=mt(ve);ve--;)Ne[H?ve:++ne]=m,m+=z;return Ne}function ks(m,S){var z="";if(!m||S<1||S>nn)return z;do S%2&&(z+=m),S=yh(S/2),S&&(m+=m);while(S);return z}function an(m,S){return lt(_t(m,S,ps),m+"")}function Cu(m){return Ao(Ar(m))}function xc(m,S){var z=Ar(m);return Wt(z,Ds(S,0,z.length))}function zl(m,S,z,H){if(!yr(m))return m;S=Fs(S,m);for(var ne=-1,ve=S.length,Ne=ve-1,qe=m;qe!=null&&++ne<ve;){var it=kt(S[ne]),Pt=z;if(it==="__proto__"||it==="constructor"||it==="prototype")return m;if(ne!=Ne){var Ot=qe[it];Pt=H?H(Ot,it,qe):I,Pt===I&&(Pt=yr(Ot)?Ot:te(S[ne+1])?[]:{})}vu(qe,it,Pt),qe=qe[it]}return m}var Dh=_u?function(m,S){return _u.set(m,S),m}:ps,el=uc?function(m,S){return uc(m,"toString",{configurable:!0,enumerable:!1,value:Rp(S),writable:!0})}:ps;function id(m){return Wt(Ar(m))}function Io(m,S,z){var H=-1,ne=m.length;S<0&&(S=-S>ne?0:ne+S),z=z>ne?ne:z,z<0&&(z+=ne),ne=S>z?0:z-S>>>0,S>>>=0;for(var ve=mt(ne);++H<ne;)ve[H]=m[H+S];return ve}function vc(m,S){var z;return ta(m,function(H,ne,ve){return z=S(H,ne,ve),!z}),!!z}function Ma(m,S,z){var H=0,ne=m==null?H:m.length;if(typeof S=="number"&&S===S&&ne<=gi){for(;H<ne;){var ve=H+ne>>>1,Ne=m[ve];Ne!==null&&!ds(Ne)&&(z?Ne<=S:Ne<S)?H=ve+1:ne=ve}return ne}return qn(m,S,ps,z)}function qn(m,S,z,H){var ne=0,ve=m==null?0:m.length;if(ve===0)return 0;S=z(S);for(var Ne=S!==S,qe=S===null,it=ds(S),Pt=S===I;ne<ve;){var Ot=yh((ne+ve)/2),jt=z(m[Ot]),ci=jt!==I,Ii=jt===null,Gi=jt===jt,wn=ds(jt);if(Ne)var qi=H||Gi;else Pt?qi=Gi&&(H||ci):qe?qi=Gi&&ci&&(H||!Ii):it?qi=Gi&&ci&&!Ii&&(H||!wn):Ii||wn?qi=!1:qi=H?jt<=S:jt<S;qi?ne=Ot+1:ve=Ot}return Qr(ve,Pr)}function Ol(m,S){for(var z=-1,H=m.length,ne=0,ve=[];++z<H;){var Ne=m[z],qe=S?S(Ne):Ne;if(!z||!la(qe,it)){var it=qe;ve[ne++]=Ne===0?0:Ne}}return ve}function Lh(m){return typeof m=="number"?m:ds(m)?Kr:+m}function lo(m){if(typeof m=="string")return m;if(un(m))return ir(m,lo)+"";if(ds(m))return Ff?Ff.call(m):"";var S=m+"";return S=="0"&&1/m==-tn?"-0":S}function Oo(m,S,z){var H=-1,ne=co,ve=m.length,Ne=!0,qe=[],it=qe;if(z)Ne=!1,ne=yf;else if(ve>=U){var Pt=S?null:Cc(m);if(Pt)return rs(Pt);Ne=!1,ne=Or,it=new ea}else it=S?[]:qe;e:for(;++H<ve;){var Ot=m[H],jt=S?S(Ot):Ot;if(Ot=z||Ot!==0?Ot:0,Ne&&jt===jt){for(var ci=it.length;ci--;)if(it[ci]===jt)continue e;S&&it.push(jt),qe.push(Ot)}else ne(it,jt,z)||(it!==qe&&it.push(jt),qe.push(Ot))}return qe}function Pu(m,S){return S=Fs(S,m),m=bt(m,S),m==null||delete m[kt(dr(S))]}function Ru(m,S,z,H){return zl(m,S,z(cs(m,S)),H)}function Du(m,S,z,H){for(var ne=m.length,ve=H?ne:-1;(H?ve--:++ve<ne)&&S(m[ve],ve,m););return z?Io(m,H?0:ve,H?ve+1:ne):Io(m,H?ve+1:0,H?ne:ve)}function bc(m,S){var z=m;return z instanceof En&&(z=z.value()),ja(S,function(H,ne){return ne.func.apply(ne.thisArg,ga([H],ne.args))},z)}function Lu(m,S,z){var H=m.length;if(H<2)return H?Oo(m[0]):[];for(var ne=-1,ve=mt(H);++ne<H;)for(var Ne=m[ne],qe=-1;++qe<H;)qe!=ne&&(ve[ne]=mc(ve[ne]||Ne,m[qe],S,z));return Oo(qr(ve,1),S,z)}function wc(m,S,z){for(var H=-1,ne=m.length,ve=S.length,Ne={};++H<ne;){var qe=H<ve?S[H]:I;z(Ne,m[H],qe)}return Ne}function kl(m){return Hr(m)?m:[]}function Tc(m){return typeof m=="function"?m:ps}function Fs(m,S){return un(m)?m:le(m,S)?[m]:ti(Jn(m))}var zh=an;function Ia(m,S,z){var H=m.length;return z=z===I?H:z,!S&&z>=H?m:Io(m,S,z)}var zu=Cf||function(m){return Yn.clearTimeout(m)};function Sc(m,S){if(S)return m.slice();var z=m.length,H=Mf?Mf(z):new m.constructor(z);return m.copy(H),H}function Ou(m){var S=new m.constructor(m.byteLength);return new lu(S).set(new lu(m)),S}function sp(m,S){var z=S?Ou(m.buffer):m.buffer;return new m.constructor(z,m.byteOffset,m.byteLength)}function nd(m){var S=new m.constructor(m.source,fi.exec(m));return S.lastIndex=m.lastIndex,S}function ap(m){return Qs?Wn(Qs.call(m)):{}}function ku(m,S){var z=S?Ou(m.buffer):m.buffer;return new m.constructor(z,m.byteOffset,m.length)}function rd(m,S){if(m!==S){var z=m!==I,H=m===null,ne=m===m,ve=ds(m),Ne=S!==I,qe=S===null,it=S===S,Pt=ds(S);if(!qe&&!Pt&&!ve&&m>S||ve&&Ne&&it&&!qe&&!Pt||H&&Ne&&it||!z&&it||!ne)return 1;if(!H&&!ve&&!Pt&&m<S||Pt&&z&&ne&&!H&&!ve||qe&&z&&ne||!Ne&&ne||!it)return-1}return 0}function lp(m,S,z){for(var H=-1,ne=m.criteria,ve=S.criteria,Ne=ne.length,qe=z.length;++H<Ne;){var it=rd(ne[H],ve[H]);if(it){if(H>=qe)return it;var Pt=z[H];return it*(Pt=="desc"?-1:1)}}return m.index-S.index}function od(m,S,z,H){for(var ne=-1,ve=m.length,Ne=z.length,qe=-1,it=S.length,Pt=Sr(ve-Ne,0),Ot=mt(it+Pt),jt=!H;++qe<it;)Ot[qe]=S[qe];for(;++ne<Ne;)(jt||ne<ve)&&(Ot[z[ne]]=m[ne]);for(;Pt--;)Ot[qe++]=m[ne++];return Ot}function sd(m,S,z,H){for(var ne=-1,ve=m.length,Ne=-1,qe=z.length,it=-1,Pt=S.length,Ot=Sr(ve-qe,0),jt=mt(Ot+Pt),ci=!H;++ne<Ot;)jt[ne]=m[ne];for(var Ii=ne;++it<Pt;)jt[Ii+it]=S[it];for(;++Ne<qe;)(ci||ne<ve)&&(jt[Ii+z[Ne]]=m[ne++]);return jt}function go(m,S){var z=-1,H=m.length;for(S||(S=mt(H));++z<H;)S[z]=m[z];return S}function ia(m,S,z,H){var ne=!z;z||(z={});for(var ve=-1,Ne=S.length;++ve<Ne;){var qe=S[ve],it=H?H(z[qe],m[qe],qe,z,m):I;it===I&&(it=m[qe]),ne?Ea(z,qe,it):vu(z,qe,it)}return z}function mm(m,S){return ia(m,M(m),S)}function rr(m,S){return ia(m,P(m),S)}function Fu(m,S){return function(z,H){var ne=un(z)?pl:Zf,ve=S?S():{};return ne(z,m,n(H,2),ve)}}function Ec(m){return an(function(S,z){var H=-1,ne=z.length,ve=ne>1?z[ne-1]:I,Ne=ne>2?z[2]:I;for(ve=m.length>3&&typeof ve=="function"?(ne--,ve):I,Ne&&re(z[0],z[1],Ne)&&(ve=ne<3?I:ve,ne=1),S=Wn(S);++H<ne;){var qe=z[H];qe&&m(S,qe,H,ve)}return S})}function cp(m,S){return function(z,H){if(z==null)return z;if(!Yo(z))return m(z,H);for(var ne=z.length,ve=S?ne:-1,Ne=Wn(z);(S?ve--:++ve<ne)&&H(Ne[ve],ve,Ne)!==!1;);return z}}function Ac(m){return function(S,z,H){for(var ne=-1,ve=Wn(S),Ne=H(S),qe=Ne.length;qe--;){var it=Ne[m?qe:++ne];if(z(ve[it],it,ve)===!1)break}return S}}function up(m,S,z){var H=S&ri,ne=Xo(m);function ve(){var Ne=this&&this!==Yn&&this instanceof ve?ne:m;return Ne.apply(H?z:this,arguments)}return ve}function Fl(m){return function(S){S=Jn(S);var z=wt(S)?os(S):I,H=z?z[0]:S.charAt(0),ne=z?Ia(z,1).join(""):S.slice(1);return H[m]()+ne}}function Ca(m){return function(S){return ja(Xm($h(S).replace(lh,"")),m,"")}}function Xo(m){return function(){var S=arguments;switch(S.length){case 0:return new m;case 1:return new m(S[0]);case 2:return new m(S[0],S[1]);case 3:return new m(S[0],S[1],S[2]);case 4:return new m(S[0],S[1],S[2],S[3]);case 5:return new m(S[0],S[1],S[2],S[3],S[4]);case 6:return new m(S[0],S[1],S[2],S[3],S[4],S[5]);case 7:return new m(S[0],S[1],S[2],S[3],S[4],S[5],S[6])}var z=Wa(m.prototype),H=m.apply(z,S);return yr(H)?H:z}}function Bl(m,S,z){var H=Xo(m);function ne(){for(var ve=arguments.length,Ne=mt(ve),qe=ve,it=t(ne);qe--;)Ne[qe]=arguments[qe];var Pt=ve<3&&Ne[0]!==it&&Ne[ve-1]!==it?[]:Cs(Ne,it);if(ve-=Pt.length,ve<z)return kh(m,S,Mc,ne.placeholder,I,Ne,Pt,I,I,z-ve);var Ot=this&&this!==Yn&&this instanceof ne?H:m;return Jr(Ot,this,Ne)}return ne}function Er(m){return function(S,z,H){var ne=Wn(S);if(!Yo(S)){var ve=n(z,3);S=uo(S),z=function(qe){return ve(ne[qe],qe,ne)}}var Ne=m(S,z,H);return Ne>-1?ne[ve?S[Ne]:Ne]:I}}function Bs(m){return Pa(function(S){var z=S.length,H=z,ne=so.prototype.thru;for(m&&S.reverse();H--;){var ve=S[H];if(typeof ve!="function")throw new Eo(ee);if(ne&&!Ne&&l(ve)=="wrapper")var Ne=new so([],!0)}for(H=Ne?H:z;++H<z;){ve=S[H];var qe=l(ve),it=qe=="wrapper"?Bh(ve):I;it&&me(it[0])&&it[1]==(Ut|Yt|Ri|cr)&&!it[4].length&&it[9]==1?Ne=Ne[l(it[0])].apply(Ne,it[3]):Ne=ve.length==1&&me(ve)?Ne[qe]():Ne.thru(ve)}return function(){var Pt=arguments,Ot=Pt[0];if(Ne&&Pt.length==1&&un(Ot))return Ne.plant(Ot).value();for(var jt=0,ci=z?S[jt].apply(this,Pt):Ot;++jt<z;)ci=S[jt].call(this,ci);return ci}})}function Mc(m,S,z,H,ne,ve,Ne,qe,it,Pt){var Ot=S&Ut,jt=S&ri,ci=S&ft,Ii=S&(Yt|At),Gi=S&Xr,wn=ci?I:Xo(m);function qi(){for(var Dn=arguments.length,Fn=mt(Dn),qs=Dn;qs--;)Fn[qs]=arguments[qs];if(Ii)var Jo=t(qi),Bo=ac(Fn,Jo);if(H&&(Fn=od(Fn,H,ne,Ii)),ve&&(Fn=sd(Fn,ve,Ne,Ii)),Dn-=Bo,Ii&&Dn<Pt){var Mr=Cs(Fn,Jo);return kh(m,S,Mc,qi.placeholder,z,Fn,Mr,qe,it,Pt-Dn)}var ms=jt?z:this,ca=ci?ms[m]:m;return Dn=Fn.length,qe?Fn=ke(Fn,qe):Gi&&Dn>1&&Fn.reverse(),Ot&&it<Dn&&(Fn.length=it),this&&this!==Yn&&this instanceof qi&&(ca=wn||Xo(ca)),ca.apply(ms,Fn)}return qi}function Bu(m,S){return function(z,H){return Rl(z,m,S(H),{})}}function Ic(m,S){return function(z,H){var ne;if(z===I&&H===I)return S;if(z!==I&&(ne=z),H!==I){if(ne===I)return H;typeof z=="string"||typeof H=="string"?(z=lo(z),H=lo(H)):(z=Lh(z),H=Lh(H)),ne=m(z,H)}return ne}}function Oh(m){return Pa(function(S){return S=ir(S,Gr(n())),an(function(z){var H=this;return m(S,function(ne){return Jr(ne,H,z)})})})}function tl(m,S){S=S===I?" ":lo(S);var z=S.length;if(z<2)return z?ks(S,m):S;var H=ks(S,hu(m/Ps(S)));return wt(S)?Ia(os(H),0,m).join(""):H.slice(0,m)}function _m(m,S,z,H){var ne=S&ri,ve=Xo(m);function Ne(){for(var qe=-1,it=arguments.length,Pt=-1,Ot=H.length,jt=mt(Ot+it),ci=this&&this!==Yn&&this instanceof Ne?ve:m;++Pt<Ot;)jt[Pt]=H[Pt];for(;it--;)jt[Pt++]=arguments[++qe];return Jr(ci,ne?z:this,jt)}return Ne}function ad(m){return function(S,z,H){return H&&typeof H!="number"&&re(S,z,H)&&(z=H=I),S=rl(S),z===I?(z=S,S=0):z=rl(z),H=H===I?S<z?1:-1:rl(H),Qa(S,z,H,m)}}function Nl(m){return function(S,z){return typeof S=="string"&&typeof z=="string"||(S=js(S),z=js(z)),m(S,z)}}function kh(m,S,z,H,ne,ve,Ne,qe,it,Pt){var Ot=S&Yt,jt=Ot?Ne:I,ci=Ot?I:Ne,Ii=Ot?ve:I,Gi=Ot?I:ve;S|=Ot?Ri:Sn,S&=~(Ot?Sn:Ri),S&Dt||(S&=~(ri|ft));var wn=[m,S,ne,Ii,jt,Gi,ci,qe,it,Pt],qi=z.apply(I,wn);return me(m)&&$e(qi,wn),qi.placeholder=H,ot(qi,m,S)}function Ul(m){var S=Tr[m];return function(z,H){if(z=js(z),H=H==null?0:Qr(fn(H),292),H&&Rf(z)){var ne=(Jn(z)+"e").split("e"),ve=S(ne[0]+"e"+(+ne[1]+H));return ne=(Jn(ve)+"e").split("e"),+(ne[0]+"e"+(+ne[1]-H))}return S(z)}}var Cc=Sl&&1/rs(new Sl([,-0]))[1]==tn?function(m){return new Sl(m)}:zp;function na(m){return function(S){var z=D(S);return z==he?cc(S):z==$t?bf(S):fh(S,m(S))}}function eo(m,S,z,H,ne,ve,Ne,qe){var it=S&ft;if(!it&&typeof m!="function")throw new Eo(ee);var Pt=H?H.length:0;if(Pt||(S&=~(Ri|Sn),H=ne=I),Ne=Ne===I?Ne:Sr(fn(Ne),0),qe=qe===I?qe:fn(qe),Pt-=ne?ne.length:0,S&Sn){var Ot=H,jt=ne;H=ne=I}var ci=it?I:Bh(m),Ii=[m,S,z,H,ne,Ot,jt,ve,Ne,qe];if(ci&&Ge(Ii,ci),m=Ii[0],S=Ii[1],z=Ii[2],H=Ii[3],ne=Ii[4],qe=Ii[9]=Ii[9]===I?it?0:m.length:Sr(Ii[9]-Pt,0),!qe&&S&(Yt|At)&&(S&=~(Yt|At)),!S||S==ri)var Gi=up(m,S,z);else S==Yt||S==At?Gi=Bl(m,S,qe):(S==Ri||S==(ri|Ri))&&!ne.length?Gi=_m(m,S,z,H):Gi=Mc.apply(I,Ii);var wn=ci?Dh:$e;return ot(wn(Gi,Ii),m,S)}function ra(m,S,z,H){return m===I||la(m,ki[z])&&!Gn.call(H,z)?S:m}function oa(m,S,z,H,ne,ve){return yr(m)&&yr(S)&&(ve.set(S,m),Ka(m,S,I,oa,ve),ve.delete(S)),m}function sa(m){return Gl(m)?I:m}function hp(m,S,z,H,ne,ve){var Ne=z&Rt,qe=m.length,it=S.length;if(qe!=it&&!(Ne&&it>qe))return!1;var Pt=ve.get(m),Ot=ve.get(S);if(Pt&&Ot)return Pt==S&&Ot==m;var jt=-1,ci=!0,Ii=z&It?new ea:I;for(ve.set(m,S),ve.set(S,m);++jt<qe;){var Gi=m[jt],wn=S[jt];if(H)var qi=Ne?H(wn,Gi,jt,S,m,ve):H(Gi,wn,jt,m,S,ve);if(qi!==I){if(qi)continue;ci=!1;break}if(Ii){if(!xf(S,function(Dn,Fn){if(!Or(Ii,Fn)&&(Gi===Dn||ne(Gi,Dn,z,H,ve)))return Ii.push(Fn)})){ci=!1;break}}else if(!(Gi===wn||ne(Gi,wn,z,H,ve))){ci=!1;break}}return ve.delete(m),ve.delete(S),ci}function gm(m,S,z,H,ne,ve,Ne){switch(z){case $i:if(m.byteLength!=S.byteLength||m.byteOffset!=S.byteOffset)return!1;m=m.buffer,S=S.buffer;case Hi:return!(m.byteLength!=S.byteLength||!ve(new lu(m),new lu(S)));case si:case ii:case ct:return la(+m,+S);case sn:return m.name==S.name&&m.message==S.message;case Zt:case Nt:return m==S+"";case he:var qe=cc;case $t:var it=H&Rt;if(qe||(qe=rs),m.size!=S.size&&!it)return!1;var Pt=Ne.get(m);if(Pt)return Pt==S;H|=It,Ne.set(m,S);var Ot=hp(qe(m),qe(S),H,ne,ve,Ne);return Ne.delete(m),Ot;case Mi:if(Qs)return Qs.call(m)==Qs.call(S)}return!1}function ym(m,S,z,H,ne,ve){var Ne=z&Rt,qe=Fh(m),it=qe.length,Pt=Fh(S),Ot=Pt.length;if(it!=Ot&&!Ne)return!1;for(var jt=it;jt--;){var ci=qe[jt];if(!(Ne?ci in S:Gn.call(S,ci)))return!1}var Ii=ve.get(m),Gi=ve.get(S);if(Ii&&Gi)return Ii==S&&Gi==m;var wn=!0;ve.set(m,S),ve.set(S,m);for(var qi=Ne;++jt<it;){ci=qe[jt];var Dn=m[ci],Fn=S[ci];if(H)var qs=Ne?H(Fn,Dn,ci,S,m,ve):H(Dn,Fn,ci,m,S,ve);if(!(qs===I?Dn===Fn||ne(Dn,Fn,z,H,ve):qs)){wn=!1;break}qi||(qi=ci=="constructor")}if(wn&&!qi){var Jo=m.constructor,Bo=S.constructor;Jo!=Bo&&"constructor"in m&&"constructor"in S&&!(typeof Jo=="function"&&Jo instanceof Jo&&typeof Bo=="function"&&Bo instanceof Bo)&&(wn=!1)}return ve.delete(m),ve.delete(S),wn}function Pa(m){return lt(_t(m,I,ko),m+"")}function Fh(m){return Pl(m,uo,M)}function to(m){return Pl(m,Ko,P)}var Bh=_u?function(m){return _u.get(m)}:zp;function l(m){for(var S=m.name+"",z=El[S],H=Gn.call(El,S)?z.length:0;H--;){var ne=z[H],ve=ne.func;if(ve==null||ve==m)return ne.name}return S}function t(m){var S=Gn.call(_e,"placeholder")?_e:m;return S.placeholder}function n(){var m=_e.iteratee||Dp;return m=m===Dp?Ya:m,arguments.length?m(arguments[0],arguments[1]):m}function c(m,S){var z=m.__data__;return fe(S)?z[typeof S=="string"?"string":"hash"]:z.map}function f(m){for(var S=uo(m),z=S.length;z--;){var H=S[z],ne=m[H];S[z]=[H,ne,Ce(ne)]}return S}function _(m,S){var z=vf(m,S);return Au(z)?z:I}function y(m){var S=Gn.call(m,wa),z=m[wa];try{m[wa]=I;var H=!0}catch{}var ne=vn.call(m);return H&&(S?m[wa]=z:delete m[wa]),ne}var M=wl?function(m){return m==null?[]:(m=Wn(m),_a(wl(m),function(S){return If.call(m,S)}))}:Zh,P=wl?function(m){for(var S=[];m;)ga(S,M(m)),m=cu(m);return S}:Zh,D=ht;(Tl&&D(new Tl(new ArrayBuffer(1)))!=$i||Ha&&D(new Ha)!=he||pu&&D(pu.resolve())!=pt||Sl&&D(new Sl)!=$t||Js&&D(new Js)!=xi)&&(D=function(m){var S=ht(m),z=S==xt?m.constructor:I,H=z?Kt(z):"";if(H)switch(H){case hc:return $i;case ip:return he;case np:return pt;case kf:return $t;case gu:return xi}return S});function R(m,S,z){for(var H=-1,ne=z.length;++H<ne;){var ve=z[H],Ne=ve.size;switch(ve.type){case"drop":m+=Ne;break;case"dropRight":S-=Ne;break;case"take":S=Qr(S,m+Ne);break;case"takeRight":m=Sr(m,S-Ne);break}}return{start:m,end:S}}function F(m){var S=m.match(We);return S?S[1].split(Je):[]}function N(m,S,z){S=Fs(S,m);for(var H=-1,ne=S.length,ve=!1;++H<ne;){var Ne=kt(S[H]);if(!(ve=m!=null&&z(m,Ne)))break;m=m[Ne]}return ve||++H!=ne?ve:(ne=m==null?0:m.length,!!ne&&yd(ne)&&te(Ne,ne)&&(un(m)||Vs(m)))}function G(m){var S=m.length,z=new m.constructor(S);return S&&typeof m[0]=="string"&&Gn.call(m,"index")&&(z.index=m.index,z.input=m.input),z}function X(m){return typeof m.constructor=="function"&&!Te(m)?Wa(cu(m)):{}}function W(m,S,z){var H=m.constructor;switch(S){case Hi:return Ou(m);case si:case ii:return new H(+m);case $i:return sp(m,z);case Yi:case Dr:case mr:case jr:case hr:case bo:case ws:case er:case io:return ku(m,z);case he:return new H;case ct:case Nt:return new H(m);case Zt:return nd(m);case $t:return new H;case Mi:return ap(m)}}function K(m,S){var z=S.length;if(!z)return m;var H=z-1;return S[H]=(z>1?"& ":"")+S[H],S=S.join(z>2?", ":" "),m.replace(Be,`{
/* [wrapped with `+S+`] */
`)}function Y(m){return un(m)||Vs(m)||!!(ep&&m&&m[ep])}function te(m,S){var z=typeof m;return S=S??nn,!!S&&(z=="number"||z!="symbol"&&rn.test(m))&&m>-1&&m%1==0&&m<S}function re(m,S,z){if(!yr(z))return!1;var H=typeof S;return(H=="number"?Yo(z)&&te(S,z.length):H=="string"&&S in z)?la(z[S],m):!1}function le(m,S){if(un(m))return!1;var z=typeof m;return z=="number"||z=="symbol"||z=="boolean"||m==null||ds(m)?!0:ie.test(m)||!J.test(m)||S!=null&&m in Wn(S)}function fe(m){var S=typeof m;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?m!=="__proto__":m===null}function me(m){var S=l(m),z=_e[S];if(typeof z!="function"||!(S in En.prototype))return!1;if(m===z)return!0;var H=Bh(z);return!!H&&m===H[0]}function de(m){return!!xl&&xl in m}var ge=ba?nl:Xh;function Te(m){var S=m&&m.constructor,z=typeof S=="function"&&S.prototype||ki;return m===z}function Ce(m){return m===m&&!yr(m)}function Ae(m,S){return function(z){return z==null?!1:z[m]===S&&(S!==I||m in Wn(z))}}function Ee(m){var S=Us(m,function(H){return z.size===Re&&z.clear(),H}),z=S.cache;return S}function Ge(m,S){var z=m[1],H=S[1],ne=z|H,ve=ne<(ri|ft|Ut),Ne=H==Ut&&z==Yt||H==Ut&&z==cr&&m[7].length<=S[8]||H==(Ut|cr)&&S[7].length<=S[8]&&z==Yt;if(!(ve||Ne))return m;H&ri&&(m[2]=S[2],ne|=z&ri?0:Dt);var qe=S[3];if(qe){var it=m[3];m[3]=it?od(it,qe,S[4]):qe,m[4]=it?Cs(m[3],xe):S[4]}return qe=S[5],qe&&(it=m[5],m[5]=it?sd(it,qe,S[6]):qe,m[6]=it?Cs(m[5],xe):S[6]),qe=S[7],qe&&(m[7]=qe),H&Ut&&(m[8]=m[8]==null?S[8]:Qr(m[8],S[8])),m[9]==null&&(m[9]=S[9]),m[0]=S[0],m[1]=ne,m}function Ye(m){var S=[];if(m!=null)for(var z in Wn(m))S.push(z);return S}function at(m){return vn.call(m)}function _t(m,S,z){return S=Sr(S===I?m.length-1:S,0),function(){for(var H=arguments,ne=-1,ve=Sr(H.length-S,0),Ne=mt(ve);++ne<ve;)Ne[ne]=H[S+ne];ne=-1;for(var qe=mt(S+1);++ne<S;)qe[ne]=H[ne];return qe[S]=z(Ne),Jr(m,this,qe)}}function bt(m,S){return S.length<2?m:cs(m,Io(S,0,-1))}function ke(m,S){for(var z=m.length,H=Qr(S.length,z),ne=go(m);H--;){var ve=S[H];m[H]=te(ve,z)?ne[ve]:I}return m}function rt(m,S){if(!(S==="constructor"&&typeof m[S]=="function")&&S!="__proto__")return m[S]}var $e=St(Dh),nt=tp||function(m,S){return Yn.setTimeout(m,S)},lt=St(el);function ot(m,S,z){var H=S+"";return lt(m,K(H,zt(F(H),z)))}function St(m){var S=0,z=0;return function(){var H=Lf(),ne=Yr-(H-z);if(z=H,ne>0){if(++S>=vo)return arguments[0]}else S=0;return m.apply(I,arguments)}}function Wt(m,S){var z=-1,H=m.length,ne=H-1;for(S=S===I?H:S;++z<S;){var ve=Os(z,ne),Ne=m[ve];m[ve]=m[z],m[z]=Ne}return m.length=S,m}var ti=Ee(function(m){var S=[];return m.charCodeAt(0)===46&&S.push(""),m.replace(pe,function(z,H,ne,ve){S.push(ne?ve.replace(Lt,"$1"):H||z)}),S});function kt(m){if(typeof m=="string"||ds(m))return m;var S=m+"";return S=="0"&&1/m==-tn?"-0":S}function Kt(m){if(m!=null){try{return $a.call(m)}catch{}try{return m+""}catch{}}return""}function zt(m,S){return So(ts,function(z){var H="_."+z[0];S&z[1]&&!co(m,H)&&m.push(H)}),m.sort()}function ai(m){if(m instanceof En)return m.clone();var S=new so(m.__wrapped__,m.__chain__);return S.__actions__=go(m.__actions__),S.__index__=m.__index__,S.__values__=m.__values__,S}function Si(m,S,z){(z?re(m,S,z):S===I)?S=1:S=Sr(fn(S),0);var H=m==null?0:m.length;if(!H||S<1)return[];for(var ne=0,ve=0,Ne=mt(hu(H/S));ne<H;)Ne[ve++]=Io(m,ne,ne+=S);return Ne}function Ui(m){for(var S=-1,z=m==null?0:m.length,H=0,ne=[];++S<z;){var ve=m[S];ve&&(ne[H++]=ve)}return ne}function Mn(){var m=arguments.length;if(!m)return[];for(var S=mt(m-1),z=arguments[0],H=m;H--;)S[H-1]=arguments[H];return ga(un(z)?go(z):[z],qr(S,1))}var en=an(function(m,S){return Hr(m)?mc(m,qr(S,1,Hr,!0)):[]}),kn=an(function(m,S){var z=dr(S);return Hr(z)&&(z=I),Hr(m)?mc(m,qr(S,1,Hr,!0),n(z,2)):[]}),ln=an(function(m,S){var z=dr(S);return Hr(z)&&(z=I),Hr(m)?mc(m,qr(S,1,Hr,!0),I,z):[]});function In(m,S,z){var H=m==null?0:m.length;return H?(S=z||S===I?1:fn(S),Io(m,S<0?0:S,H)):[]}function Fi(m,S,z){var H=m==null?0:m.length;return H?(S=z||S===I?1:fn(S),S=H-S,Io(m,0,S<0?0:S)):[]}function An(m,S){return m&&m.length?Du(m,n(S,3),!0,!0):[]}function bn(m,S){return m&&m.length?Du(m,n(S,3),!0):[]}function hn(m,S,z,H){var ne=m==null?0:m.length;return ne?(z&&typeof z!="number"&&re(m,S,z)&&(z=0,H=ne),Zo(m,S,z,H)):[]}function Un(m,S,z){var H=m==null?0:m.length;if(!H)return-1;var ne=z==null?0:fn(z);return ne<0&&(ne=Sr(H+ne,0)),eu(m,n(S,3),ne)}function gr(m,S,z){var H=m==null?0:m.length;if(!H)return-1;var ne=H-1;return z!==I&&(ne=fn(z),ne=z<0?Sr(H+ne,0):Qr(ne,H-1)),eu(m,n(S,3),ne,!0)}function ko(m){var S=m==null?0:m.length;return S?qr(m,1):[]}function us(m){var S=m==null?0:m.length;return S?qr(m,tn):[]}function kr(m,S){var z=m==null?0:m.length;return z?(S=S===I?1:fn(S),qr(m,S)):[]}function Xi(m){for(var S=-1,z=m==null?0:m.length,H={};++S<z;){var ne=m[S];H[ne[0]]=ne[1]}return H}function Vi(m){return m&&m.length?m[0]:I}function cn(m,S,z){var H=m==null?0:m.length;if(!H)return-1;var ne=z==null?0:fn(z);return ne<0&&(ne=Sr(H+ne,0)),ya(m,S,ne)}function Rn(m){var S=m==null?0:m.length;return S?Io(m,0,-1):[]}var or=an(function(m){var S=ir(m,kl);return S.length&&S[0]===m[0]?Su(S):[]}),$n=an(function(m){var S=dr(m),z=ir(m,kl);return S===dr(z)?S=I:z.pop(),z.length&&z[0]===m[0]?Su(z,n(S,2)):[]}),$r=an(function(m){var S=dr(m),z=ir(m,kl);return S=typeof S=="function"?S:I,S&&z.pop(),z.length&&z[0]===m[0]?Su(z,I,S):[]});function aa(m,S){return m==null?"":Ho.call(m,S)}function dr(m){var S=m==null?0:m.length;return S?m[S-1]:I}function Fo(m,S,z){var H=m==null?0:m.length;if(!H)return-1;var ne=H;return z!==I&&(ne=fn(z),ne=ne<0?Sr(H+ne,0):Qr(ne,H-1)),S===S?mh(m,S,ne):eu(m,Oi,ne,!0)}function hs(m,S){return m&&m.length?on(m,fn(S)):I}var Ns=an(Co);function Co(m,S){return m&&m.length&&S&&S.length?Iu(m,S):m}function Ra(m,S,z){return m&&m.length&&S&&S.length?Iu(m,S,n(z,2)):m}function fs(m,S,z){return m&&m.length&&S&&S.length?Iu(m,S,I,z):m}var gn=Pa(function(m,S){var z=m==null?0:m.length,H=bu(m,S);return yc(m,ir(S,function(ne){return te(ne,z)?+ne:ne}).sort(rd)),H});function Pc(m,S){var z=[];if(!(m&&m.length))return z;var H=-1,ne=[],ve=m.length;for(S=n(S,3);++H<ve;){var Ne=m[H];S(Ne,H,m)&&(z.push(Ne),ne.push(H))}return yc(m,ne),z}function Nu(m){return m==null?m:Of.call(m)}function Rc(m,S,z){var H=m==null?0:m.length;return H?(z&&typeof z!="number"&&re(m,S,z)?(S=0,z=H):(S=S==null?0:fn(S),z=z===I?H:fn(z)),Io(m,S,z)):[]}function ld(m,S){return Ma(m,S)}function Uu(m,S,z){return qn(m,S,n(z,2))}function il(m,S){var z=m==null?0:m.length;if(z){var H=Ma(m,S);if(H<z&&la(m[H],S))return H}return-1}function Vl(m,S){return Ma(m,S,!0)}function q_(m,S,z){return qn(m,S,n(z,2),!0)}function $_(m,S){var z=m==null?0:m.length;if(z){var H=Ma(m,S,!0)-1;if(la(m[H],S))return H}return-1}function fp(m){return m&&m.length?Ol(m):[]}function xm(m,S){return m&&m.length?Ol(m,n(S,2)):[]}function cd(m){var S=m==null?0:m.length;return S?Io(m,1,S):[]}function dp(m,S,z){return m&&m.length?(S=z||S===I?1:fn(S),Io(m,0,S<0?0:S)):[]}function H_(m,S,z){var H=m==null?0:m.length;return H?(S=z||S===I?1:fn(S),S=H-S,Io(m,S<0?0:S,H)):[]}function pp(m,S){return m&&m.length?Du(m,n(S,3),!1,!0):[]}function vm(m,S){return m&&m.length?Du(m,n(S,3)):[]}var bm=an(function(m){return Oo(qr(m,1,Hr,!0))}),W_=an(function(m){var S=dr(m);return Hr(S)&&(S=I),Oo(qr(m,1,Hr,!0),n(S,2))}),Z_=an(function(m){var S=dr(m);return S=typeof S=="function"?S:I,Oo(qr(m,1,Hr,!0),I,S)});function Dc(m){return m&&m.length?Oo(m):[]}function X_(m,S){return m&&m.length?Oo(m,n(S,2)):[]}function wm(m,S){return S=typeof S=="function"?S:I,m&&m.length?Oo(m,I,S):[]}function mp(m){if(!(m&&m.length))return[];var S=0;return m=_a(m,function(z){if(Hr(z))return S=Sr(z.length,S),!0}),nu(S,function(z){return ir(m,tu(z))})}function Y_(m,S){if(!(m&&m.length))return[];var z=mp(m);return S==null?z:ir(z,function(H){return Jr(S,I,H)})}var _0=an(function(m,S){return Hr(m)?mc(m,S):[]}),g0=an(function(m){return Lu(_a(m,Hr))}),K_=an(function(m){var S=dr(m);return Hr(S)&&(S=I),Lu(_a(m,Hr),n(S,2))}),J_=an(function(m){var S=dr(m);return S=typeof S=="function"?S:I,Lu(_a(m,Hr),I,S)}),y0=an(mp);function Q_(m,S){return wc(m||[],S||[],vu)}function x0(m,S){return wc(m||[],S||[],zl)}var v0=an(function(m){var S=m.length,z=S>1?m[S-1]:I;return z=typeof z=="function"?(m.pop(),z):I,Y_(m,z)});function Tm(m){var S=_e(m);return S.__chain__=!0,S}function eg(m,S){return S(m),m}function ud(m,S){return S(m)}var tg=Pa(function(m){var S=m.length,z=S?m[0]:0,H=this.__wrapped__,ne=function(ve){return bu(ve,m)};return S>1||this.__actions__.length||!(H instanceof En)||!te(z)?this.thru(ne):(H=H.slice(z,+z+(S?1:0)),H.__actions__.push({func:ud,args:[ne],thisArg:I}),new so(H,this.__chain__).thru(function(ve){return S&&!ve.length&&ve.push(I),ve}))});function ig(){return Tm(this)}function ng(){return new so(this.value(),this.__chain__)}function rg(){this.__values__===I&&(this.__values__=Ig(this.value()));var m=this.__index__>=this.__values__.length,S=m?I:this.__values__[this.__index__++];return{done:m,value:S}}function Sm(){return this}function Lc(m){for(var S,z=this;z instanceof fc;){var H=ai(z);H.__index__=0,H.__values__=I,S?ne.__wrapped__=H:S=H;var ne=H;z=z.__wrapped__}return ne.__wrapped__=m,S}function Po(){var m=this.__wrapped__;if(m instanceof En){var S=m;return this.__actions__.length&&(S=new En(this)),S=S.reverse(),S.__actions__.push({func:ud,args:[Nu],thisArg:I}),new so(S,this.__chain__)}return this.thru(Nu)}function og(){return bc(this.__wrapped__,this.__actions__)}var hd=Fu(function(m,S,z){Gn.call(m,z)?++m[z]:Ea(m,z,1)});function b0(m,S,z){var H=un(m)?Yd:Xf;return z&&re(m,S,z)&&(S=I),H(m,n(S,3))}function w0(m,S){var z=un(m)?_a:Kn;return z(m,n(S,3))}var fd=Er(Un),sg=Er(gr);function Vu(m,S){return qr(Nh(m,S),1)}function dd(m,S){return qr(Nh(m,S),tn)}function T0(m,S,z){return z=z===I?1:fn(z),qr(Nh(m,S),z)}function ag(m,S){var z=un(m)?So:ta;return z(m,n(S,3))}function lg(m,S){var z=un(m)?ma:Eh;return z(m,n(S,3))}var S0=Fu(function(m,S,z){Gn.call(m,z)?m[z].push(S):Ea(m,z,[S])});function E0(m,S,z,H){m=Yo(m)?m:Ar(m),z=z&&!H?fn(z):0;var ne=m.length;return z<0&&(z=Sr(ne+z,0)),vd(m)?z<=ne&&m.indexOf(S,z)>-1:!!ne&&ya(m,S,z)>-1}var A0=an(function(m,S,z){var H=-1,ne=typeof S=="function",ve=Yo(m)?mt(m.length):[];return ta(m,function(Ne){ve[++H]=ne?Jr(S,Ne,z):Dl(Ne,S,z)}),ve}),M0=Fu(function(m,S,z){Ea(m,z,S)});function Nh(m,S){var z=un(m)?ir:zs;return z(m,n(S,3))}function I0(m,S,z,H){return m==null?[]:(un(S)||(S=S==null?[]:[S]),z=H?I:z,un(z)||(z=z==null?[]:[z]),td(m,S,z))}var Uh=Fu(function(m,S,z){m[z?0:1].push(S)},function(){return[[],[]]});function C0(m,S,z){var H=un(m)?ja:hh,ne=arguments.length<3;return H(m,n(S,4),z,ne,ta)}function Fr(m,S,z){var H=un(m)?sc:hh,ne=arguments.length<3;return H(m,n(S,4),z,ne,Eh)}function _p(m,S){var z=un(m)?_a:Kn;return z(m,gd(n(S,3)))}function cg(m){var S=un(m)?Ao:Cu;return S(m)}function gp(m,S,z){(z?re(m,S,z):S===I)?S=1:S=fn(S);var H=un(m)?Qt:xc;return H(m,S)}function yp(m){var S=un(m)?Wf:id;return S(m)}function pd(m){if(m==null)return 0;if(Yo(m))return vd(m)?Ps(m):m.length;var S=D(m);return S==he||S==$t?m.size:Ll(m).length}function ug(m,S,z){var H=un(m)?xf:vc;return z&&re(m,S,z)&&(S=I),H(m,n(S,3))}var hg=an(function(m,S){if(m==null)return[];var z=S.length;return z>1&&re(m,S[0],S[1])?S=[]:z>2&&re(S[0],S[1],S[2])&&(S=[S[0]]),td(m,qr(S,1),[])}),zc=Pf||function(){return Yn.Date.now()};function Em(m,S){if(typeof S!="function")throw new Eo(ee);return m=fn(m),function(){if(--m<1)return S.apply(this,arguments)}}function md(m,S,z){return S=z?I:S,S=m&&S==null?m.length:S,eo(m,Ut,I,I,I,I,S)}function fg(m,S){var z;if(typeof S!="function")throw new Eo(ee);return m=fn(m),function(){return--m>0&&(z=S.apply(this,arguments)),m<=1&&(S=I),z}}var _d=an(function(m,S,z){var H=ri;if(z.length){var ne=Cs(z,t(_d));H|=Ri}return eo(m,H,S,z,ne)}),xp=an(function(m,S,z){var H=ri|ft;if(z.length){var ne=Cs(z,t(xp));H|=Ri}return eo(S,H,m,z,ne)});function vp(m,S,z){S=z?I:S;var H=eo(m,Yt,I,I,I,I,I,S);return H.placeholder=vp.placeholder,H}function Am(m,S,z){S=z?I:S;var H=eo(m,At,I,I,I,I,I,S);return H.placeholder=Am.placeholder,H}function Mm(m,S,z){var H,ne,ve,Ne,qe,it,Pt=0,Ot=!1,jt=!1,ci=!0;if(typeof m!="function")throw new Eo(ee);S=js(S)||0,yr(z)&&(Ot=!!z.leading,jt="maxWait"in z,ve=jt?Sr(js(z.maxWait)||0,S):ve,ci="trailing"in z?!!z.trailing:ci);function Ii(Mr){var ms=H,ca=ne;return H=ne=I,Pt=Mr,Ne=m.apply(ca,ms),Ne}function Gi(Mr){return Pt=Mr,qe=nt(Dn,S),Ot?Ii(Mr):Ne}function wn(Mr){var ms=Mr-it,ca=Mr-Pt,dy=S-ms;return jt?Qr(dy,ve-ca):dy}function qi(Mr){var ms=Mr-it,ca=Mr-Pt;return it===I||ms>=S||ms<0||jt&&ca>=ve}function Dn(){var Mr=zc();if(qi(Mr))return Fn(Mr);qe=nt(Dn,wn(Mr))}function Fn(Mr){return qe=I,ci&&H?Ii(Mr):(H=ne=I,Ne)}function qs(){qe!==I&&zu(qe),Pt=0,H=it=ne=qe=I}function Jo(){return qe===I?Ne:Fn(zc())}function Bo(){var Mr=zc(),ms=qi(Mr);if(H=arguments,ne=this,it=Mr,ms){if(qe===I)return Gi(it);if(jt)return zu(qe),qe=nt(Dn,S),Ii(it)}return qe===I&&(qe=nt(Dn,S)),Ne}return Bo.cancel=qs,Bo.flush=Jo,Bo}var dg=an(function(m,S){return zo(m,1,S)}),pg=an(function(m,S,z){return zo(m,js(S)||0,z)});function Im(m){return eo(m,Xr)}function Us(m,S){if(typeof m!="function"||S!=null&&typeof S!="function")throw new Eo(ee);var z=function(){var H=arguments,ne=S?S.apply(this,H):H[0],ve=z.cache;if(ve.has(ne))return ve.get(ne);var Ne=m.apply(this,H);return z.cache=ve.set(ne,Ne)||ve,Ne};return z.cache=new(Us.Cache||as),z}Us.Cache=as;function gd(m){if(typeof m!="function")throw new Eo(ee);return function(){var S=arguments;switch(S.length){case 0:return!m.call(this);case 1:return!m.call(this,S[0]);case 2:return!m.call(this,S[0],S[1]);case 3:return!m.call(this,S[0],S[1],S[2])}return!m.apply(this,S)}}function P0(m){return fg(2,m)}var R0=zh(function(m,S){S=S.length==1&&un(S[0])?ir(S[0],Gr(n())):ir(qr(S,1),Gr(n()));var z=S.length;return an(function(H){for(var ne=-1,ve=Qr(H.length,z);++ne<ve;)H[ne]=S[ne].call(this,H[ne]);return Jr(m,this,H)})}),Cm=an(function(m,S){var z=Cs(S,t(Cm));return eo(m,Ri,I,S,z)}),mg=an(function(m,S){var z=Cs(S,t(mg));return eo(m,Sn,I,S,z)}),D0=Pa(function(m,S){return eo(m,cr,I,I,I,S)});function L0(m,S){if(typeof m!="function")throw new Eo(ee);return S=S===I?S:fn(S),an(m,S)}function z0(m,S){if(typeof m!="function")throw new Eo(ee);return S=S==null?0:Sr(fn(S),0),an(function(z){var H=z[S],ne=Ia(z,0,S);return H&&ga(ne,H),Jr(m,this,ne)})}function Pm(m,S,z){var H=!0,ne=!0;if(typeof m!="function")throw new Eo(ee);return yr(z)&&(H="leading"in z?!!z.leading:H,ne="trailing"in z?!!z.trailing:ne),Mm(m,S,{leading:H,maxWait:S,trailing:ne})}function _g(m){return md(m,1)}function Rm(m,S){return Cm(Tc(S),m)}function gg(){if(!arguments.length)return[];var m=arguments[0];return un(m)?m:[m]}function Dm(m){return mo(m,st)}function yg(m,S){return S=typeof S=="function"?S:I,mo(m,st,S)}function xg(m){return mo(m,Oe|st)}function bp(m,S){return S=typeof S=="function"?S:I,mo(m,Oe|st,S)}function vg(m,S){return S==null||ao(m,S,uo(S))}function la(m,S){return m===S||m!==m&&S!==S}var bg=Nl(ei),Vh=Nl(function(m,S){return m>=S}),Vs=Eu(function(){return arguments}())?Eu:function(m){return Br(m)&&Gn.call(m,"callee")&&!If.call(m,"callee")},un=mt.isArray,wp=po?Gr(po):Aa;function Yo(m){return m!=null&&yd(m.length)&&!nl(m)}function Hr(m){return Br(m)&&Yo(m)}function Tp(m){return m===!0||m===!1||Br(m)&&ht(m)==si}var jl=fu||Xh,Sp=is?Gr(is):Kf;function wg(m){return Br(m)&&m.nodeType===1&&!Gl(m)}function Lm(m){if(m==null)return!0;if(Yo(m)&&(un(m)||typeof m=="string"||typeof m.splice=="function"||jl(m)||ju(m)||Vs(m)))return!m.length;var S=D(m);if(S==he||S==$t)return!m.size;if(Te(m))return!Ll(m).length;for(var z in m)if(Gn.call(m,z))return!1;return!0}function zm(m,S){return Mo(m,S)}function Tg(m,S,z){z=typeof z=="function"?z:I;var H=z?z(m,S):I;return H===I?Mo(m,S,I,z):!!H}function Om(m){if(!Br(m))return!1;var S=ht(m);return S==sn||S==ye||typeof m.message=="string"&&typeof m.name=="string"&&!Gl(m)}function Sg(m){return typeof m=="number"&&Rf(m)}function nl(m){if(!yr(m))return!1;var S=ht(m);return S==Cn||S==De||S==Mt||S==Xt}function km(m){return typeof m=="number"&&m==fn(m)}function yd(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=nn}function yr(m){var S=typeof m;return m!=null&&(S=="object"||S=="function")}function Br(m){return m!=null&&typeof m=="object"}var Ep=zr?Gr(zr):pm;function O0(m,S){return m===S||Ih(m,S,f(S))}function k0(m,S,z){return z=typeof z=="function"?z:I,Ih(m,S,f(S),z)}function F0(m){return jh(m)&&m!=+m}function B0(m){if(ge(m))throw new Qi($);return Au(m)}function Eg(m){return m===null}function Oc(m){return m==null}function jh(m){return typeof m=="number"||Br(m)&&ht(m)==ct}function Gl(m){if(!Br(m)||ht(m)!=xt)return!1;var S=cu(m);if(S===null)return!0;var z=Gn.call(S,"constructor")&&S.constructor;return typeof z=="function"&&z instanceof z&&$a.call(z)==Ef}var Gh=uh?Gr(uh):Jf;function xd(m){return km(m)&&m>=-nn&&m<=nn}var Fm=ns?Gr(ns):Qf;function vd(m){return typeof m=="string"||!un(m)&&Br(m)&&ht(m)==Nt}function ds(m){return typeof m=="symbol"||Br(m)&&ht(m)==Mi}var ju=dl?Gr(dl):Ch;function N0(m){return m===I}function U0(m){return Br(m)&&D(m)==xi}function Ag(m){return Br(m)&&ht(m)==Di}var Ap=Nl(Rh),Mg=Nl(function(m,S){return m<=S});function Ig(m){if(!m)return[];if(Yo(m))return vd(m)?os(m):go(m);if(uu&&m[uu])return lc(m[uu]());var S=D(m),z=S==he?cc:S==$t?rs:Ar;return z(m)}function rl(m){if(!m)return m===0?m:0;if(m=js(m),m===tn||m===-tn){var S=m<0?-1:1;return S*_i}return m===m?m:0}function fn(m){var S=rl(m),z=S%1;return S===S?z?S-z:S:0}function Bm(m){return m?Ds(fn(m),0,ur):0}function js(m){if(typeof m=="number")return m;if(ds(m))return Kr;if(yr(m)){var S=typeof m.valueOf=="function"?m.valueOf():m;m=yr(S)?S+"":S}if(typeof m!="string")return m===0?m:+m;m=dh(m);var z=Ti.test(m);return z||pn.test(m)?oc(m.slice(2),z?2:8):wi.test(m)?Kr:+m}function Nm(m){return ia(m,Ko(m))}function Cg(m){return m?Ds(fn(m),-nn,nn):m===0?m:0}function Jn(m){return m==null?"":lo(m)}var V0=Ec(function(m,S){if(Te(S)||Yo(S)){ia(S,uo(S),m);return}for(var z in S)Gn.call(S,z)&&vu(m,z,S[z])}),Um=Ec(function(m,S){ia(S,Ko(S),m)}),bd=Ec(function(m,S,z,H){ia(S,Ko(S),m,H)}),wd=Ec(function(m,S,z,H){ia(S,uo(S),m,H)}),Pg=Pa(bu);function Rg(m,S){var z=Wa(m);return S==null?z:pc(z,S)}var j0=an(function(m,S){m=Wn(m);var z=-1,H=S.length,ne=H>2?S[2]:I;for(ne&&re(S[0],S[1],ne)&&(H=1);++z<H;)for(var ve=S[z],Ne=Ko(ve),qe=-1,it=Ne.length;++qe<it;){var Pt=Ne[qe],Ot=m[Pt];(Ot===I||la(Ot,ki[Pt])&&!Gn.call(m,Pt))&&(m[Pt]=ve[Pt])}return m}),G0=an(function(m){return m.push(I,oa),Jr(Mp,I,m)});function q0(m,S){return _l(m,n(S,3),Ls)}function $0(m,S){return _l(m,n(S,3),Ah)}function H0(m,S){return m==null?m:Tu(m,n(S,3),Ko)}function W0(m,S){return m==null?m:Yf(m,n(S,3),Ko)}function Z0(m,S){return m&&Ls(m,n(S,3))}function Dg(m,S){return m&&Ah(m,n(S,3))}function X0(m){return m==null?[]:Mh(m,uo(m))}function Y0(m){return m==null?[]:Mh(m,Ko(m))}function Vm(m,S,z){var H=m==null?I:cs(m,S);return H===I?z:H}function jm(m,S){return m!=null&&N(m,S,_c)}function Td(m,S){return m!=null&&N(m,S,Bn)}var Lg=Bu(function(m,S,z){S!=null&&typeof S.toString!="function"&&(S=vn.call(S)),m[S]=z},Rp(ps)),zg=Bu(function(m,S,z){S!=null&&typeof S.toString!="function"&&(S=vn.call(S)),Gn.call(m,S)?m[S].push(z):m[S]=[z]},n),Og=an(Dl);function uo(m){return Yo(m)?Xa(m):Ll(m)}function Ko(m){return Yo(m)?Xa(m,!0):Ph(m)}function kg(m,S){var z={};return S=n(S,3),Ls(m,function(H,ne,ve){Ea(z,S(H,ne,ve),H)}),z}function Fg(m,S){var z={};return S=n(S,3),Ls(m,function(H,ne,ve){Ea(z,ne,S(H,ne,ve))}),z}var Bg=Ec(function(m,S,z){Ka(m,S,z)}),Mp=Ec(function(m,S,z,H){Ka(m,S,z,H)}),Ng=Pa(function(m,S){var z={};if(m==null)return z;var H=!1;S=ir(S,function(ve){return ve=Fs(ve,m),H||(H=ve.length>1),ve}),ia(m,to(m),z),H&&(z=mo(z,Oe|Ke|st,sa));for(var ne=S.length;ne--;)Pu(z,S[ne]);return z});function K0(m,S){return Gm(m,gd(n(S)))}var Sd=Pa(function(m,S){return m==null?{}:Ja(m,S)});function Gm(m,S){if(m==null)return{};var z=ir(to(m),function(H){return[H]});return S=n(S),Mu(m,z,function(H,ne){return S(H,ne[0])})}function J0(m,S,z){S=Fs(S,m);var H=-1,ne=S.length;for(ne||(ne=1,m=I);++H<ne;){var ve=m==null?I:m[kt(S[H])];ve===I&&(H=ne,ve=z),m=nl(ve)?ve.call(m):ve}return m}function Q0(m,S,z){return m==null?m:zl(m,S,z)}function ex(m,S,z,H){return H=typeof H=="function"?H:I,m==null?m:zl(m,S,z,H)}var Ug=na(uo),Vg=na(Ko);function tx(m,S,z){var H=un(m),ne=H||jl(m)||ju(m);if(S=n(S,4),z==null){var ve=m&&m.constructor;ne?z=H?new ve:[]:yr(m)?z=nl(ve)?Wa(cu(m)):{}:z={}}return(ne?So:Ls)(m,function(Ne,qe,it){return S(z,Ne,qe,it)}),z}function ix(m,S){return m==null?!0:Pu(m,S)}function jg(m,S,z){return m==null?m:Ru(m,S,Tc(z))}function nx(m,S,z,H){return H=typeof H=="function"?H:I,m==null?m:Ru(m,S,Tc(z),H)}function Ar(m){return m==null?[]:xa(m,uo(m))}function Da(m){return m==null?[]:xa(m,Ko(m))}function qm(m,S,z){return z===I&&(z=S,S=I),z!==I&&(z=js(z),z=z===z?z:0),S!==I&&(S=js(S),S=S===S?S:0),Ds(js(m),S,z)}function Ip(m,S,z){return S=rl(S),z===I?(z=S,S=0):z=rl(z),m=js(m),Ve(m,S,z)}function qh(m,S,z){if(z&&typeof z!="boolean"&&re(m,S,z)&&(S=z=I),z===I&&(typeof S=="boolean"?(z=S,S=I):typeof m=="boolean"&&(z=m,m=I)),m===I&&S===I?(m=0,S=1):(m=rl(m),S===I?(S=m,m=0):S=rl(S)),m>S){var H=m;m=S,S=H}if(z||m%1||S%1){var ne=du();return Qr(m+ne*(S-m+rc("1e-"+((ne+"").length-1))),S)}return Os(m,S)}var rx=Ca(function(m,S,z){return S=S.toLowerCase(),m+(z?Gg(S):S)});function Gg(m){return Ad(Jn(m).toLowerCase())}function $h(m){return m=Jn(m),m&&m.replace(Li,ph).replace(Ms,"")}function ox(m,S,z){m=Jn(m),S=lo(S);var H=m.length;z=z===I?H:Ds(fn(z),0,H);var ne=z;return z-=S.length,z>=0&&m.slice(z,ne)==S}function sx(m){return m=Jn(m),m&&Xc.test(m)?m.replace(Ua,va):m}function qg(m){return m=Jn(m),m&&we.test(m)?m.replace(Pe,"\\$&"):m}var $m=Ca(function(m,S,z){return m+(z?"-":"")+S.toLowerCase()}),$g=Ca(function(m,S,z){return m+(z?" ":"")+S.toLowerCase()}),Hm=Fl("toLowerCase");function ax(m,S,z){m=Jn(m),S=fn(S);var H=S?Ps(m):0;if(!S||H>=S)return m;var ne=(S-H)/2;return tl(yh(ne),z)+m+tl(hu(ne),z)}function Hg(m,S,z){m=Jn(m),S=fn(S);var H=S?Ps(m):0;return S&&H<S?m+tl(S-H,z):m}function Cp(m,S,z){m=Jn(m),S=fn(S);var H=S?Ps(m):0;return S&&H<S?tl(S-H,z)+m:m}function Wm(m,S,z){return z||S==null?S=0:S&&(S=+S),zf(Jn(m).replace(ze,""),S||0)}function lx(m,S,z){return(z?re(m,S,z):S===I)?S=1:S=fn(S),ks(Jn(m),S)}function cx(){var m=arguments,S=Jn(m[0]);return m.length<3?S:S.replace(m[1],m[2])}var ux=Ca(function(m,S,z){return m+(z?"_":"")+S.toLowerCase()});function Wg(m,S,z){return z&&typeof z!="number"&&re(m,S,z)&&(S=z=I),z=z===I?ur:z>>>0,z?(m=Jn(m),m&&(typeof S=="string"||S!=null&&!Gh(S))&&(S=lo(S),!S&&wt(m))?Ia(os(m),0,z):m.split(S,z)):[]}var Gs=Ca(function(m,S,z){return m+(z?" ":"")+Ad(S)});function Ed(m,S,z){return m=Jn(m),z=z==null?0:Ds(fn(z),0,m.length),S=lo(S),m.slice(z,z+S.length)==S}function Hh(m,S,z){var H=_e.templateSettings;z&&re(m,S,z)&&(S=I),m=Jn(m),S=bd({},S,H,ra);var ne=bd({},S.imports,H.imports,ra),ve=uo(ne),Ne=xa(ne,ve),qe,it,Pt=0,Ot=S.interpolate||mn,jt="__p += '",ci=Ga((S.escape||mn).source+"|"+Ot.source+"|"+(Ot===Ze?Ht:mn).source+"|"+(S.evaluate||mn).source+"|$","g"),Ii="//# sourceURL="+(Gn.call(S,"sourceURL")?(S.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ji+"]")+`
`;m.replace(ci,function(qi,Dn,Fn,qs,Jo,Bo){return Fn||(Fn=qs),jt+=m.slice(Pt,Bo).replace(jn,nr),Dn&&(qe=!0,jt+=`' +
__e(`+Dn+`) +
'`),Jo&&(it=!0,jt+=`';
`+Jo+`;
__p += '`),Fn&&(jt+=`' +
((__t = (`+Fn+`)) == null ? '' : __t) +
'`),Pt=Bo+qi.length,qi}),jt+=`';
`;var Gi=Gn.call(S,"variable")&&S.variable;if(!Gi)jt=`with (obj) {
`+jt+`
}
`;else if(gt.test(Gi))throw new Qi(o);jt=(it?jt.replace(ji,""):jt).replace(Zs,"$1").replace(th,"$1;"),jt="function("+(Gi||"obj")+`) {
`+(Gi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(qe?", __e = _.escape":"")+(it?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+jt+`return __p
}`;var wn=Jg(function(){return Pn(ve,Ii+"return "+jt).apply(I,Ne)});if(wn.source=jt,Om(wn))throw wn;return wn}function Zm(m){return Jn(m).toLowerCase()}function Pp(m){return Jn(m).toUpperCase()}function hx(m,S,z){if(m=Jn(m),m&&(z||S===I))return dh(m);if(!m||!(S=lo(S)))return m;var H=os(m),ne=os(S),ve=ru(H,ne),Ne=gl(H,ne)+1;return Ia(H,ve,Ne).join("")}function Zg(m,S,z){if(m=Jn(m),m&&(z||S===I))return m.slice(0,wf(m)+1);if(!m||!(S=lo(S)))return m;var H=os(m),ne=gl(H,os(S))+1;return Ia(H,0,ne).join("")}function Xg(m,S,z){if(m=Jn(m),m&&(z||S===I))return m.replace(ze,"");if(!m||!(S=lo(S)))return m;var H=os(m),ne=ru(H,os(S));return Ia(H,ne).join("")}function fx(m,S){var z=li,H=ui;if(yr(S)){var ne="separator"in S?S.separator:ne;z="length"in S?fn(S.length):z,H="omission"in S?lo(S.omission):H}m=Jn(m);var ve=m.length;if(wt(m)){var Ne=os(m);ve=Ne.length}if(z>=ve)return m;var qe=z-Ps(H);if(qe<1)return H;var it=Ne?Ia(Ne,0,qe).join(""):m.slice(0,qe);if(ne===I)return it+H;if(Ne&&(qe+=it.length-qe),Gh(ne)){if(m.slice(qe).search(ne)){var Pt,Ot=it;for(ne.global||(ne=Ga(ne.source,Jn(fi.exec(ne))+"g")),ne.lastIndex=0;Pt=ne.exec(Ot);)var jt=Pt.index;it=it.slice(0,jt===I?qe:jt)}}else if(m.indexOf(lo(ne),qe)!=qe){var ci=it.lastIndexOf(ne);ci>-1&&(it=it.slice(0,ci))}return it+H}function Yg(m){return m=Jn(m),m&&Zc.test(m)?m.replace(Do,$o):m}var Kg=Ca(function(m,S,z){return m+(z?" ":"")+S.toUpperCase()}),Ad=Fl("toUpperCase");function Xm(m,S,z){return m=Jn(m),S=z?I:S,S===I?Kd(m)?Sf(m):cm(m):m.match(S)||[]}var Jg=an(function(m,S){try{return Jr(m,I,S)}catch(z){return Om(z)?z:new Qi(z)}}),Qg=Pa(function(m,S){return So(S,function(z){z=kt(z),Ea(m,z,_d(m[z],m))}),m});function ql(m){var S=m==null?0:m.length,z=n();return m=S?ir(m,function(H){if(typeof H[1]!="function")throw new Eo(ee);return[z(H[0]),H[1]]}):[],an(function(H){for(var ne=-1;++ne<S;){var ve=m[ne];if(Jr(ve[0],this,H))return Jr(ve[1],this,H)}})}function ey(m){return Sh(mo(m,Oe))}function Rp(m){return function(){return m}}function ty(m,S){return m==null||m!==m?S:m}var iy=Bs(),dx=Bs(!0);function ps(m){return m}function Dp(m){return Ya(typeof m=="function"?m:mo(m,Oe))}function ny(m){return _o(mo(m,Oe))}function ry(m,S){return ed(m,mo(S,Oe))}var Md=an(function(m,S){return function(z){return Dl(z,m,S)}}),Ym=an(function(m,S){return function(z){return Dl(m,z,S)}});function Lp(m,S,z){var H=uo(S),ne=Mh(S,H);z==null&&!(yr(S)&&(ne.length||!H.length))&&(z=S,S=m,m=this,ne=Mh(S,uo(S)));var ve=!(yr(z)&&"chain"in z)||!!z.chain,Ne=nl(m);return So(ne,function(qe){var it=S[qe];m[qe]=it,Ne&&(m.prototype[qe]=function(){var Pt=this.__chain__;if(ve||Pt){var Ot=m(this.__wrapped__),jt=Ot.__actions__=go(this.__actions__);return jt.push({func:it,args:arguments,thisArg:m}),Ot.__chain__=Pt,Ot}return it.apply(m,ga([this.value()],arguments))})}),m}function Id(){return Yn._===this&&(Yn._=Qd),this}function zp(){}function oy(m){return m=fn(m),an(function(S){return on(S,m)})}var La=Oh(ir),Km=Oh(Yd),Wh=Oh(xf);function $l(m){return le(m)?tu(kt(m)):gc(m)}function sy(m){return function(S){return m==null?I:cs(m,S)}}var Op=ad(),ay=ad(!0);function Zh(){return[]}function Xh(){return!1}function px(){return{}}function mx(){return""}function _x(){return!0}function Yh(m,S){if(m=fn(m),m<1||m>nn)return[];var z=ur,H=Qr(m,ur);S=n(S),m-=ur;for(var ne=nu(H,S);++z<m;)S(z);return ne}function Jm(m){return un(m)?ir(m,kt):ds(m)?[m]:go(ti(Jn(m)))}function gx(m){var S=++au;return Jn(m)+S}var ly=Ic(function(m,S){return m+S},0),Qm=Ul("ceil"),yx=Ic(function(m,S){return m/S},1),Cd=Ul("floor");function kc(m){return m&&m.length?wu(m,ps,ei):I}function cy(m,S){return m&&m.length?wu(m,n(S,2),ei):I}function uy(m){return oi(m,ps)}function kp(m,S){return oi(m,n(S,2))}function e_(m){return m&&m.length?wu(m,ps,Rh):I}function xx(m,S){return m&&m.length?wu(m,n(S,2),Rh):I}var hy=Ic(function(m,S){return m*S},1),Pd=Ul("round"),fy=Ic(function(m,S){return m-S},0);function vx(m){return m&&m.length?di(m,ps):0}function Fc(m,S){return m&&m.length?di(m,n(S,2)):0}return _e.after=Em,_e.ary=md,_e.assign=V0,_e.assignIn=Um,_e.assignInWith=bd,_e.assignWith=wd,_e.at=Pg,_e.before=fg,_e.bind=_d,_e.bindAll=Qg,_e.bindKey=xp,_e.castArray=gg,_e.chain=Tm,_e.chunk=Si,_e.compact=Ui,_e.concat=Mn,_e.cond=ql,_e.conforms=ey,_e.constant=Rp,_e.countBy=hd,_e.create=Rg,_e.curry=vp,_e.curryRight=Am,_e.debounce=Mm,_e.defaults=j0,_e.defaultsDeep=G0,_e.defer=dg,_e.delay=pg,_e.difference=en,_e.differenceBy=kn,_e.differenceWith=ln,_e.drop=In,_e.dropRight=Fi,_e.dropRightWhile=An,_e.dropWhile=bn,_e.fill=hn,_e.filter=w0,_e.flatMap=Vu,_e.flatMapDeep=dd,_e.flatMapDepth=T0,_e.flatten=ko,_e.flattenDeep=us,_e.flattenDepth=kr,_e.flip=Im,_e.flow=iy,_e.flowRight=dx,_e.fromPairs=Xi,_e.functions=X0,_e.functionsIn=Y0,_e.groupBy=S0,_e.initial=Rn,_e.intersection=or,_e.intersectionBy=$n,_e.intersectionWith=$r,_e.invert=Lg,_e.invertBy=zg,_e.invokeMap=A0,_e.iteratee=Dp,_e.keyBy=M0,_e.keys=uo,_e.keysIn=Ko,_e.map=Nh,_e.mapKeys=kg,_e.mapValues=Fg,_e.matches=ny,_e.matchesProperty=ry,_e.memoize=Us,_e.merge=Bg,_e.mergeWith=Mp,_e.method=Md,_e.methodOf=Ym,_e.mixin=Lp,_e.negate=gd,_e.nthArg=oy,_e.omit=Ng,_e.omitBy=K0,_e.once=P0,_e.orderBy=I0,_e.over=La,_e.overArgs=R0,_e.overEvery=Km,_e.overSome=Wh,_e.partial=Cm,_e.partialRight=mg,_e.partition=Uh,_e.pick=Sd,_e.pickBy=Gm,_e.property=$l,_e.propertyOf=sy,_e.pull=Ns,_e.pullAll=Co,_e.pullAllBy=Ra,_e.pullAllWith=fs,_e.pullAt=gn,_e.range=Op,_e.rangeRight=ay,_e.rearg=D0,_e.reject=_p,_e.remove=Pc,_e.rest=L0,_e.reverse=Nu,_e.sampleSize=gp,_e.set=Q0,_e.setWith=ex,_e.shuffle=yp,_e.slice=Rc,_e.sortBy=hg,_e.sortedUniq=fp,_e.sortedUniqBy=xm,_e.split=Wg,_e.spread=z0,_e.tail=cd,_e.take=dp,_e.takeRight=H_,_e.takeRightWhile=pp,_e.takeWhile=vm,_e.tap=eg,_e.throttle=Pm,_e.thru=ud,_e.toArray=Ig,_e.toPairs=Ug,_e.toPairsIn=Vg,_e.toPath=Jm,_e.toPlainObject=Nm,_e.transform=tx,_e.unary=_g,_e.union=bm,_e.unionBy=W_,_e.unionWith=Z_,_e.uniq=Dc,_e.uniqBy=X_,_e.uniqWith=wm,_e.unset=ix,_e.unzip=mp,_e.unzipWith=Y_,_e.update=jg,_e.updateWith=nx,_e.values=Ar,_e.valuesIn=Da,_e.without=_0,_e.words=Xm,_e.wrap=Rm,_e.xor=g0,_e.xorBy=K_,_e.xorWith=J_,_e.zip=y0,_e.zipObject=Q_,_e.zipObjectDeep=x0,_e.zipWith=v0,_e.entries=Ug,_e.entriesIn=Vg,_e.extend=Um,_e.extendWith=bd,Lp(_e,_e),_e.add=ly,_e.attempt=Jg,_e.camelCase=rx,_e.capitalize=Gg,_e.ceil=Qm,_e.clamp=qm,_e.clone=Dm,_e.cloneDeep=xg,_e.cloneDeepWith=bp,_e.cloneWith=yg,_e.conformsTo=vg,_e.deburr=$h,_e.defaultTo=ty,_e.divide=yx,_e.endsWith=ox,_e.eq=la,_e.escape=sx,_e.escapeRegExp=qg,_e.every=b0,_e.find=fd,_e.findIndex=Un,_e.findKey=q0,_e.findLast=sg,_e.findLastIndex=gr,_e.findLastKey=$0,_e.floor=Cd,_e.forEach=ag,_e.forEachRight=lg,_e.forIn=H0,_e.forInRight=W0,_e.forOwn=Z0,_e.forOwnRight=Dg,_e.get=Vm,_e.gt=bg,_e.gte=Vh,_e.has=jm,_e.hasIn=Td,_e.head=Vi,_e.identity=ps,_e.includes=E0,_e.indexOf=cn,_e.inRange=Ip,_e.invoke=Og,_e.isArguments=Vs,_e.isArray=un,_e.isArrayBuffer=wp,_e.isArrayLike=Yo,_e.isArrayLikeObject=Hr,_e.isBoolean=Tp,_e.isBuffer=jl,_e.isDate=Sp,_e.isElement=wg,_e.isEmpty=Lm,_e.isEqual=zm,_e.isEqualWith=Tg,_e.isError=Om,_e.isFinite=Sg,_e.isFunction=nl,_e.isInteger=km,_e.isLength=yd,_e.isMap=Ep,_e.isMatch=O0,_e.isMatchWith=k0,_e.isNaN=F0,_e.isNative=B0,_e.isNil=Oc,_e.isNull=Eg,_e.isNumber=jh,_e.isObject=yr,_e.isObjectLike=Br,_e.isPlainObject=Gl,_e.isRegExp=Gh,_e.isSafeInteger=xd,_e.isSet=Fm,_e.isString=vd,_e.isSymbol=ds,_e.isTypedArray=ju,_e.isUndefined=N0,_e.isWeakMap=U0,_e.isWeakSet=Ag,_e.join=aa,_e.kebabCase=$m,_e.last=dr,_e.lastIndexOf=Fo,_e.lowerCase=$g,_e.lowerFirst=Hm,_e.lt=Ap,_e.lte=Mg,_e.max=kc,_e.maxBy=cy,_e.mean=uy,_e.meanBy=kp,_e.min=e_,_e.minBy=xx,_e.stubArray=Zh,_e.stubFalse=Xh,_e.stubObject=px,_e.stubString=mx,_e.stubTrue=_x,_e.multiply=hy,_e.nth=hs,_e.noConflict=Id,_e.noop=zp,_e.now=zc,_e.pad=ax,_e.padEnd=Hg,_e.padStart=Cp,_e.parseInt=Wm,_e.random=qh,_e.reduce=C0,_e.reduceRight=Fr,_e.repeat=lx,_e.replace=cx,_e.result=J0,_e.round=Pd,_e.runInContext=et,_e.sample=cg,_e.size=pd,_e.snakeCase=ux,_e.some=ug,_e.sortedIndex=ld,_e.sortedIndexBy=Uu,_e.sortedIndexOf=il,_e.sortedLastIndex=Vl,_e.sortedLastIndexBy=q_,_e.sortedLastIndexOf=$_,_e.startCase=Gs,_e.startsWith=Ed,_e.subtract=fy,_e.sum=vx,_e.sumBy=Fc,_e.template=Hh,_e.times=Yh,_e.toFinite=rl,_e.toInteger=fn,_e.toLength=Bm,_e.toLower=Zm,_e.toNumber=js,_e.toSafeInteger=Cg,_e.toString=Jn,_e.toUpper=Pp,_e.trim=hx,_e.trimEnd=Zg,_e.trimStart=Xg,_e.truncate=fx,_e.unescape=Yg,_e.uniqueId=gx,_e.upperCase=Kg,_e.upperFirst=Ad,_e.each=ag,_e.eachRight=lg,_e.first=Vi,Lp(_e,function(){var m={};return Ls(_e,function(S,z){Gn.call(_e.prototype,z)||(m[z]=S)}),m}(),{chain:!1}),_e.VERSION=O,So(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){_e[m].placeholder=_e}),So(["drop","take"],function(m,S){En.prototype[m]=function(z){z=z===I?1:Sr(fn(z),0);var H=this.__filtered__&&!S?new En(this):this.clone();return H.__filtered__?H.__takeCount__=Qr(z,H.__takeCount__):H.__views__.push({size:Qr(z,ur),type:m+(H.__dir__<0?"Right":"")}),H},En.prototype[m+"Right"]=function(z){return this.reverse()[m](z).reverse()}}),So(["filter","map","takeWhile"],function(m,S){var z=S+1,H=z==bs||z==zn;En.prototype[m]=function(ne){var ve=this.clone();return ve.__iteratees__.push({iteratee:n(ne,3),type:z}),ve.__filtered__=ve.__filtered__||H,ve}}),So(["head","last"],function(m,S){var z="take"+(S?"Right":"");En.prototype[m]=function(){return this[z](1).value()[0]}}),So(["initial","tail"],function(m,S){var z="drop"+(S?"":"Right");En.prototype[m]=function(){return this.__filtered__?new En(this):this[z](1)}}),En.prototype.compact=function(){return this.filter(ps)},En.prototype.find=function(m){return this.filter(m).head()},En.prototype.findLast=function(m){return this.reverse().find(m)},En.prototype.invokeMap=an(function(m,S){return typeof m=="function"?new En(this):this.map(function(z){return Dl(z,m,S)})}),En.prototype.reject=function(m){return this.filter(gd(n(m)))},En.prototype.slice=function(m,S){m=fn(m);var z=this;return z.__filtered__&&(m>0||S<0)?new En(z):(m<0?z=z.takeRight(-m):m&&(z=z.drop(m)),S!==I&&(S=fn(S),z=S<0?z.dropRight(-S):z.take(S-m)),z)},En.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},En.prototype.toArray=function(){return this.take(ur)},Ls(En.prototype,function(m,S){var z=/^(?:filter|find|map|reject)|While$/.test(S),H=/^(?:head|last)$/.test(S),ne=_e[H?"take"+(S=="last"?"Right":""):S],ve=H||/^find/.test(S);ne&&(_e.prototype[S]=function(){var Ne=this.__wrapped__,qe=H?[1]:arguments,it=Ne instanceof En,Pt=qe[0],Ot=it||un(Ne),jt=function(Dn){var Fn=ne.apply(_e,ga([Dn],qe));return H&&ci?Fn[0]:Fn};Ot&&z&&typeof Pt=="function"&&Pt.length!=1&&(it=Ot=!1);var ci=this.__chain__,Ii=!!this.__actions__.length,Gi=ve&&!ci,wn=it&&!Ii;if(!ve&&Ot){Ne=wn?Ne:new En(this);var qi=m.apply(Ne,qe);return qi.__actions__.push({func:ud,args:[jt],thisArg:I}),new so(qi,ci)}return Gi&&wn?m.apply(this,qe):(qi=this.thru(jt),Gi?H?qi.value()[0]:qi.value():qi)})}),So(["pop","push","shift","sort","splice","unshift"],function(m){var S=Rs[m],z=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",H=/^(?:pop|shift)$/.test(m);_e.prototype[m]=function(){var ne=arguments;if(H&&!this.__chain__){var ve=this.value();return S.apply(un(ve)?ve:[],ne)}return this[z](function(Ne){return S.apply(un(Ne)?Ne:[],ne)})}}),Ls(En.prototype,function(m,S){var z=_e[S];if(z){var H=z.name+"";Gn.call(El,H)||(El[H]=[]),El[H].push({name:S,func:z})}}),El[Mc(I,ft).name]=[{name:"wrapper",func:I}],En.prototype.clone=Ta,En.prototype.reverse=xh,En.prototype.value=Ml,_e.prototype.at=tg,_e.prototype.chain=ig,_e.prototype.commit=ng,_e.prototype.next=rg,_e.prototype.plant=Lc,_e.prototype.reverse=Po,_e.prototype.toJSON=_e.prototype.valueOf=_e.prototype.value=og,_e.prototype.first=_e.prototype.head,uu&&(_e.prototype[uu]=Sm),_e},yl=_h();Lr?((Lr.exports=yl)._=yl,oo._=yl):Yn._=yl}).call(_C)}(y_,y_.exports)),y_.exports}var yC=gC(),By={exports:{}},xC=By.exports,e2;function vC(){return e2||(e2=1,function(d,v){(function(I,O){d.exports=O()})(xC,function(){var I,O,U;function $(o,ue){if(!I)I=ue;else if(!O)O=ue;else{var Re="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+I+")(sharedChunk); ("+O+")(sharedChunk); self.onerror = null;",xe={};I(xe),U=ue(xe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(U.workerUrl=window.URL.createObjectURL(new Blob([Re],{type:"text/javascript"})))}}$(["exports"],function(o){function ue(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Re,xe={},Oe={};function Ke(){if(Re)return Oe;Re=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.setMatrixArrayType=function(u){Oe.ARRAY_TYPE=e=u},Oe.toRadian=function(u){return u*s},Oe.equals=function(u,a){return Math.abs(u-a)<=r*Math.max(1,Math.abs(u),Math.abs(a))},Oe.RANDOM=Oe.ARRAY_TYPE=Oe.EPSILON=void 0;var r=1e-6;Oe.EPSILON=r;var e=typeof Float32Array<"u"?Float32Array:Array;Oe.ARRAY_TYPE=e;var i=Math.random;Oe.RANDOM=i;var s=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,a=arguments.length;a--;)u+=arguments[a]*arguments[a];return Math.sqrt(u)}),Oe}var st,Rt={};function It(){if(st)return Rt;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},r(a)}st=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=function(){var a=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},Rt.clone=function(a){var h=new e.ARRAY_TYPE(4);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h},Rt.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a},Rt.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},Rt.fromValues=function(a,h,g,w){var A=new e.ARRAY_TYPE(4);return A[0]=a,A[1]=h,A[2]=g,A[3]=w,A},Rt.set=function(a,h,g,w,A){return a[0]=h,a[1]=g,a[2]=w,a[3]=A,a},Rt.transpose=function(a,h){if(a===h){var g=h[1];a[1]=h[2],a[2]=g}else a[0]=h[0],a[1]=h[2],a[2]=h[1],a[3]=h[3];return a},Rt.invert=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=g*p-A*w;return b?(a[0]=p*(b=1/b),a[1]=-w*b,a[2]=-A*b,a[3]=g*b,a):null},Rt.adjoint=function(a,h){var g=h[0];return a[0]=h[3],a[1]=-h[1],a[2]=-h[2],a[3]=g,a},Rt.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},Rt.multiply=s,Rt.rotate=function(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=Math.sin(g),x=Math.cos(g);return a[0]=w*x+p*E,a[1]=A*x+b*E,a[2]=w*-E+p*x,a[3]=A*-E+b*x,a},Rt.scale=function(a,h,g){var w=h[1],A=h[2],p=h[3],b=g[0],E=g[1];return a[0]=h[0]*b,a[1]=w*b,a[2]=A*E,a[3]=p*E,a},Rt.fromRotation=function(a,h){var g=Math.sin(h),w=Math.cos(h);return a[0]=w,a[1]=g,a[2]=-g,a[3]=w,a},Rt.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=h[1],a},Rt.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},Rt.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},Rt.LDU=function(a,h,g,w){return a[2]=w[2]/w[0],g[0]=w[0],g[1]=w[1],g[3]=w[3]-a[2]*g[1],[a,h,g]},Rt.add=function(a,h,g){return a[0]=h[0]+g[0],a[1]=h[1]+g[1],a[2]=h[2]+g[2],a[3]=h[3]+g[3],a},Rt.subtract=u,Rt.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]},Rt.equals=function(a,h){var g=a[0],w=a[1],A=a[2],p=a[3],b=h[0],E=h[1],x=h[2],T=h[3];return Math.abs(g-b)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(b))&&Math.abs(w-E)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(E))&&Math.abs(A-x)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(x))&&Math.abs(p-T)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))},Rt.multiplyScalar=function(a,h,g){return a[0]=h[0]*g,a[1]=h[1]*g,a[2]=h[2]*g,a[3]=h[3]*g,a},Rt.multiplyScalarAndAdd=function(a,h,g,w){return a[0]=h[0]+g[0]*w,a[1]=h[1]+g[1]*w,a[2]=h[2]+g[2]*w,a[3]=h[3]+g[3]*w,a},Rt.sub=Rt.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var g=i(void 0);if(g&&g.has(a))return g.get(a);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var b=A?Object.getOwnPropertyDescriptor(a,p):null;b&&(b.get||b.set)?Object.defineProperty(w,p,b):w[p]=a[p]}return w.default=a,g&&g.set(a,w),w}(Ke());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,g=new WeakMap;return(i=function(w){return w?g:h})(a)}function s(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=g[0],x=g[1],T=g[2],C=g[3];return a[0]=w*E+p*x,a[1]=A*E+b*x,a[2]=w*T+p*C,a[3]=A*T+b*C,a}function u(a,h,g){return a[0]=h[0]-g[0],a[1]=h[1]-g[1],a[2]=h[2]-g[2],a[3]=h[3]-g[3],a}return Rt.mul=s,Rt.sub=u,Rt}var ri,ft={};function Dt(){if(ri)return ft;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},r(a)}ri=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.create=function(){var a=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0),a[0]=1,a[3]=1,a},ft.clone=function(a){var h=new e.ARRAY_TYPE(6);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h},ft.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a},ft.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},ft.fromValues=function(a,h,g,w,A,p){var b=new e.ARRAY_TYPE(6);return b[0]=a,b[1]=h,b[2]=g,b[3]=w,b[4]=A,b[5]=p,b},ft.set=function(a,h,g,w,A,p,b){return a[0]=h,a[1]=g,a[2]=w,a[3]=A,a[4]=p,a[5]=b,a},ft.invert=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=h[4],E=h[5],x=g*p-w*A;return x?(a[0]=p*(x=1/x),a[1]=-w*x,a[2]=-A*x,a[3]=g*x,a[4]=(A*E-p*b)*x,a[5]=(w*b-g*E)*x,a):null},ft.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},ft.multiply=s,ft.rotate=function(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=Math.sin(g),C=Math.cos(g);return a[0]=w*C+p*T,a[1]=A*C+b*T,a[2]=w*-T+p*C,a[3]=A*-T+b*C,a[4]=E,a[5]=x,a},ft.scale=function(a,h,g){var w=h[1],A=h[2],p=h[3],b=h[4],E=h[5],x=g[0],T=g[1];return a[0]=h[0]*x,a[1]=w*x,a[2]=A*T,a[3]=p*T,a[4]=b,a[5]=E,a},ft.translate=function(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=g[0],C=g[1];return a[0]=w,a[1]=A,a[2]=p,a[3]=b,a[4]=w*T+p*C+E,a[5]=A*T+b*C+x,a},ft.fromRotation=function(a,h){var g=Math.sin(h),w=Math.cos(h);return a[0]=w,a[1]=g,a[2]=-g,a[3]=w,a[4]=0,a[5]=0,a},ft.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=h[1],a[4]=0,a[5]=0,a},ft.fromTranslation=function(a,h){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=h[0],a[5]=h[1],a},ft.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},ft.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)},ft.add=function(a,h,g){return a[0]=h[0]+g[0],a[1]=h[1]+g[1],a[2]=h[2]+g[2],a[3]=h[3]+g[3],a[4]=h[4]+g[4],a[5]=h[5]+g[5],a},ft.subtract=u,ft.multiplyScalar=function(a,h,g){return a[0]=h[0]*g,a[1]=h[1]*g,a[2]=h[2]*g,a[3]=h[3]*g,a[4]=h[4]*g,a[5]=h[5]*g,a},ft.multiplyScalarAndAdd=function(a,h,g,w){return a[0]=h[0]+g[0]*w,a[1]=h[1]+g[1]*w,a[2]=h[2]+g[2]*w,a[3]=h[3]+g[3]*w,a[4]=h[4]+g[4]*w,a[5]=h[5]+g[5]*w,a},ft.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]&&a[4]===h[4]&&a[5]===h[5]},ft.equals=function(a,h){var g=a[0],w=a[1],A=a[2],p=a[3],b=a[4],E=a[5],x=h[0],T=h[1],C=h[2],L=h[3],k=h[4],V=h[5];return Math.abs(g-x)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(w-T)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(T))&&Math.abs(A-C)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(C))&&Math.abs(p-L)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(b-k)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(E-V)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(V))},ft.sub=ft.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var g=i(void 0);if(g&&g.has(a))return g.get(a);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var b=A?Object.getOwnPropertyDescriptor(a,p):null;b&&(b.get||b.set)?Object.defineProperty(w,p,b):w[p]=a[p]}return w.default=a,g&&g.set(a,w),w}(Ke());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,g=new WeakMap;return(i=function(w){return w?g:h})(a)}function s(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=g[0],C=g[1],L=g[2],k=g[3],V=g[4],j=g[5];return a[0]=w*T+p*C,a[1]=A*T+b*C,a[2]=w*L+p*k,a[3]=A*L+b*k,a[4]=w*V+p*j+E,a[5]=A*V+b*j+x,a}function u(a,h,g){return a[0]=h[0]-g[0],a[1]=h[1]-g[1],a[2]=h[2]-g[2],a[3]=h[3]-g[3],a[4]=h[4]-g[4],a[5]=h[5]-g[5],a}return ft.mul=s,ft.sub=u,ft}var Yt,At={};function Ri(){if(Yt)return At;function r(a){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},r(a)}Yt=1,Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var a=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},At.fromMat4=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[4],a[4]=h[5],a[5]=h[6],a[6]=h[8],a[7]=h[9],a[8]=h[10],a},At.clone=function(a){var h=new e.ARRAY_TYPE(9);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h},At.copy=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a},At.fromValues=function(a,h,g,w,A,p,b,E,x){var T=new e.ARRAY_TYPE(9);return T[0]=a,T[1]=h,T[2]=g,T[3]=w,T[4]=A,T[5]=p,T[6]=b,T[7]=E,T[8]=x,T},At.set=function(a,h,g,w,A,p,b,E,x,T){return a[0]=h,a[1]=g,a[2]=w,a[3]=A,a[4]=p,a[5]=b,a[6]=E,a[7]=x,a[8]=T,a},At.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},At.transpose=function(a,h){if(a===h){var g=h[1],w=h[2],A=h[5];a[1]=h[3],a[2]=h[6],a[3]=g,a[5]=h[7],a[6]=w,a[7]=A}else a[0]=h[0],a[1]=h[3],a[2]=h[6],a[3]=h[1],a[4]=h[4],a[5]=h[7],a[6]=h[2],a[7]=h[5],a[8]=h[8];return a},At.invert=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=h[4],E=h[5],x=h[6],T=h[7],C=h[8],L=C*b-E*T,k=-C*p+E*x,V=T*p-b*x,j=g*L+w*k+A*V;return j?(a[0]=L*(j=1/j),a[1]=(-C*w+A*T)*j,a[2]=(E*w-A*b)*j,a[3]=k*j,a[4]=(C*g-A*x)*j,a[5]=(-E*g+A*p)*j,a[6]=V*j,a[7]=(-T*g+w*x)*j,a[8]=(b*g-w*p)*j,a):null},At.adjoint=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=h[4],E=h[5],x=h[6],T=h[7],C=h[8];return a[0]=b*C-E*T,a[1]=A*T-w*C,a[2]=w*E-A*b,a[3]=E*x-p*C,a[4]=g*C-A*x,a[5]=A*p-g*E,a[6]=p*T-b*x,a[7]=w*x-g*T,a[8]=g*b-w*p,a},At.determinant=function(a){var h=a[3],g=a[4],w=a[5],A=a[6],p=a[7],b=a[8];return a[0]*(b*g-w*p)+a[1]*(-b*h+w*A)+a[2]*(p*h-g*A)},At.multiply=s,At.translate=function(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=h[6],C=h[7],L=h[8],k=g[0],V=g[1];return a[0]=w,a[1]=A,a[2]=p,a[3]=b,a[4]=E,a[5]=x,a[6]=k*w+V*b+T,a[7]=k*A+V*E+C,a[8]=k*p+V*x+L,a},At.rotate=function(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=h[6],C=h[7],L=h[8],k=Math.sin(g),V=Math.cos(g);return a[0]=V*w+k*b,a[1]=V*A+k*E,a[2]=V*p+k*x,a[3]=V*b-k*w,a[4]=V*E-k*A,a[5]=V*x-k*p,a[6]=T,a[7]=C,a[8]=L,a},At.scale=function(a,h,g){var w=g[0],A=g[1];return a[0]=w*h[0],a[1]=w*h[1],a[2]=w*h[2],a[3]=A*h[3],a[4]=A*h[4],a[5]=A*h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a},At.fromTranslation=function(a,h){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=h[0],a[7]=h[1],a[8]=1,a},At.fromRotation=function(a,h){var g=Math.sin(h),w=Math.cos(h);return a[0]=w,a[1]=g,a[2]=0,a[3]=-g,a[4]=w,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},At.fromScaling=function(a,h){return a[0]=h[0],a[1]=0,a[2]=0,a[3]=0,a[4]=h[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},At.fromMat2d=function(a,h){return a[0]=h[0],a[1]=h[1],a[2]=0,a[3]=h[2],a[4]=h[3],a[5]=0,a[6]=h[4],a[7]=h[5],a[8]=1,a},At.fromQuat=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=g+g,E=w+w,x=A+A,T=g*b,C=w*b,L=w*E,k=A*b,V=A*E,j=A*x,B=p*b,q=p*E,Z=p*x;return a[0]=1-L-j,a[3]=C-Z,a[6]=k+q,a[1]=C+Z,a[4]=1-T-j,a[7]=V-B,a[2]=k-q,a[5]=V+B,a[8]=1-T-L,a},At.normalFromMat4=function(a,h){var g=h[0],w=h[1],A=h[2],p=h[3],b=h[4],E=h[5],x=h[6],T=h[7],C=h[8],L=h[9],k=h[10],V=h[11],j=h[12],B=h[13],q=h[14],Z=h[15],Q=g*E-w*b,ce=g*x-A*b,oe=g*T-p*b,ae=w*x-A*E,Se=w*T-p*E,se=A*T-p*x,be=C*B-L*j,Me=C*q-k*j,Ie=C*Z-V*j,Le=L*q-k*B,Ue=L*Z-V*B,je=k*Z-V*q,Fe=Q*je-ce*Ue+oe*Le+ae*Ie-Se*Me+se*be;return Fe?(a[0]=(E*je-x*Ue+T*Le)*(Fe=1/Fe),a[1]=(x*Ie-b*je-T*Me)*Fe,a[2]=(b*Ue-E*Ie+T*be)*Fe,a[3]=(A*Ue-w*je-p*Le)*Fe,a[4]=(g*je-A*Ie+p*Me)*Fe,a[5]=(w*Ie-g*Ue-p*be)*Fe,a[6]=(B*se-q*Se+Z*ae)*Fe,a[7]=(q*oe-j*se-Z*ce)*Fe,a[8]=(j*Se-B*oe+Z*Q)*Fe,a):null},At.projection=function(a,h,g){return a[0]=2/h,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/g,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a},At.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},At.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},At.add=function(a,h,g){return a[0]=h[0]+g[0],a[1]=h[1]+g[1],a[2]=h[2]+g[2],a[3]=h[3]+g[3],a[4]=h[4]+g[4],a[5]=h[5]+g[5],a[6]=h[6]+g[6],a[7]=h[7]+g[7],a[8]=h[8]+g[8],a},At.subtract=u,At.multiplyScalar=function(a,h,g){return a[0]=h[0]*g,a[1]=h[1]*g,a[2]=h[2]*g,a[3]=h[3]*g,a[4]=h[4]*g,a[5]=h[5]*g,a[6]=h[6]*g,a[7]=h[7]*g,a[8]=h[8]*g,a},At.multiplyScalarAndAdd=function(a,h,g,w){return a[0]=h[0]+g[0]*w,a[1]=h[1]+g[1]*w,a[2]=h[2]+g[2]*w,a[3]=h[3]+g[3]*w,a[4]=h[4]+g[4]*w,a[5]=h[5]+g[5]*w,a[6]=h[6]+g[6]*w,a[7]=h[7]+g[7]*w,a[8]=h[8]+g[8]*w,a},At.exactEquals=function(a,h){return a[0]===h[0]&&a[1]===h[1]&&a[2]===h[2]&&a[3]===h[3]&&a[4]===h[4]&&a[5]===h[5]&&a[6]===h[6]&&a[7]===h[7]&&a[8]===h[8]},At.equals=function(a,h){var g=a[0],w=a[1],A=a[2],p=a[3],b=a[4],E=a[5],x=a[6],T=a[7],C=a[8],L=h[0],k=h[1],V=h[2],j=h[3],B=h[4],q=h[5],Z=h[6],Q=h[7],ce=h[8];return Math.abs(g-L)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(w-k)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(k))&&Math.abs(A-V)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(p-j)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(b-B)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(E-q)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(q))&&Math.abs(x-Z)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(T-Q)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Q))&&Math.abs(C-ce)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(ce))},At.sub=At.mul=void 0;var e=function(a,h){if(a&&a.__esModule)return a;if(a===null||r(a)!=="object"&&typeof a!="function")return{default:a};var g=i(void 0);if(g&&g.has(a))return g.get(a);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in a)if(p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)){var b=A?Object.getOwnPropertyDescriptor(a,p):null;b&&(b.get||b.set)?Object.defineProperty(w,p,b):w[p]=a[p]}return w.default=a,g&&g.set(a,w),w}(Ke());function i(a){if(typeof WeakMap!="function")return null;var h=new WeakMap,g=new WeakMap;return(i=function(w){return w?g:h})(a)}function s(a,h,g){var w=h[0],A=h[1],p=h[2],b=h[3],E=h[4],x=h[5],T=h[6],C=h[7],L=h[8],k=g[0],V=g[1],j=g[2],B=g[3],q=g[4],Z=g[5],Q=g[6],ce=g[7],oe=g[8];return a[0]=k*w+V*b+j*T,a[1]=k*A+V*E+j*C,a[2]=k*p+V*x+j*L,a[3]=B*w+q*b+Z*T,a[4]=B*A+q*E+Z*C,a[5]=B*p+q*x+Z*L,a[6]=Q*w+ce*b+oe*T,a[7]=Q*A+ce*E+oe*C,a[8]=Q*p+ce*x+oe*L,a}function u(a,h,g){return a[0]=h[0]-g[0],a[1]=h[1]-g[1],a[2]=h[2]-g[2],a[3]=h[3]-g[3],a[4]=h[4]-g[4],a[5]=h[5]-g[5],a[6]=h[6]-g[6],a[7]=h[7]-g[7],a[8]=h[8]-g[8],a}return At.mul=s,At.sub=u,At}var Sn,Ut={};function cr(){if(Sn)return Ut;function r(p){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},r(p)}Sn=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=function(){var p=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},Ut.clone=function(p){var b=new e.ARRAY_TYPE(16);return b[0]=p[0],b[1]=p[1],b[2]=p[2],b[3]=p[3],b[4]=p[4],b[5]=p[5],b[6]=p[6],b[7]=p[7],b[8]=p[8],b[9]=p[9],b[10]=p[10],b[11]=p[11],b[12]=p[12],b[13]=p[13],b[14]=p[14],b[15]=p[15],b},Ut.copy=function(p,b){return p[0]=b[0],p[1]=b[1],p[2]=b[2],p[3]=b[3],p[4]=b[4],p[5]=b[5],p[6]=b[6],p[7]=b[7],p[8]=b[8],p[9]=b[9],p[10]=b[10],p[11]=b[11],p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15],p},Ut.fromValues=function(p,b,E,x,T,C,L,k,V,j,B,q,Z,Q,ce,oe){var ae=new e.ARRAY_TYPE(16);return ae[0]=p,ae[1]=b,ae[2]=E,ae[3]=x,ae[4]=T,ae[5]=C,ae[6]=L,ae[7]=k,ae[8]=V,ae[9]=j,ae[10]=B,ae[11]=q,ae[12]=Z,ae[13]=Q,ae[14]=ce,ae[15]=oe,ae},Ut.set=function(p,b,E,x,T,C,L,k,V,j,B,q,Z,Q,ce,oe,ae){return p[0]=b,p[1]=E,p[2]=x,p[3]=T,p[4]=C,p[5]=L,p[6]=k,p[7]=V,p[8]=j,p[9]=B,p[10]=q,p[11]=Z,p[12]=Q,p[13]=ce,p[14]=oe,p[15]=ae,p},Ut.identity=s,Ut.transpose=function(p,b){if(p===b){var E=b[1],x=b[2],T=b[3],C=b[6],L=b[7],k=b[11];p[1]=b[4],p[2]=b[8],p[3]=b[12],p[4]=E,p[6]=b[9],p[7]=b[13],p[8]=x,p[9]=C,p[11]=b[14],p[12]=T,p[13]=L,p[14]=k}else p[0]=b[0],p[1]=b[4],p[2]=b[8],p[3]=b[12],p[4]=b[1],p[5]=b[5],p[6]=b[9],p[7]=b[13],p[8]=b[2],p[9]=b[6],p[10]=b[10],p[11]=b[14],p[12]=b[3],p[13]=b[7],p[14]=b[11],p[15]=b[15];return p},Ut.invert=function(p,b){var E=b[0],x=b[1],T=b[2],C=b[3],L=b[4],k=b[5],V=b[6],j=b[7],B=b[8],q=b[9],Z=b[10],Q=b[11],ce=b[12],oe=b[13],ae=b[14],Se=b[15],se=E*k-x*L,be=E*V-T*L,Me=E*j-C*L,Ie=x*V-T*k,Le=x*j-C*k,Ue=T*j-C*V,je=B*oe-q*ce,Fe=B*ae-Z*ce,tt=B*Se-Q*ce,dt=q*ae-Z*oe,Xe=q*Se-Q*oe,Bt=Z*Se-Q*ae,Et=se*Bt-be*Xe+Me*dt+Ie*tt-Le*Fe+Ue*je;return Et?(p[0]=(k*Bt-V*Xe+j*dt)*(Et=1/Et),p[1]=(T*Xe-x*Bt-C*dt)*Et,p[2]=(oe*Ue-ae*Le+Se*Ie)*Et,p[3]=(Z*Le-q*Ue-Q*Ie)*Et,p[4]=(V*tt-L*Bt-j*Fe)*Et,p[5]=(E*Bt-T*tt+C*Fe)*Et,p[6]=(ae*Me-ce*Ue-Se*be)*Et,p[7]=(B*Ue-Z*Me+Q*be)*Et,p[8]=(L*Xe-k*tt+j*je)*Et,p[9]=(x*tt-E*Xe-C*je)*Et,p[10]=(ce*Le-oe*Me+Se*se)*Et,p[11]=(q*Me-B*Le-Q*se)*Et,p[12]=(k*Fe-L*dt-V*je)*Et,p[13]=(E*dt-x*Fe+T*je)*Et,p[14]=(oe*be-ce*Ie-ae*se)*Et,p[15]=(B*Ie-q*be+Z*se)*Et,p):null},Ut.adjoint=function(p,b){var E=b[0],x=b[1],T=b[2],C=b[3],L=b[4],k=b[5],V=b[6],j=b[7],B=b[8],q=b[9],Z=b[10],Q=b[11],ce=b[12],oe=b[13],ae=b[14],Se=b[15];return p[0]=k*(Z*Se-Q*ae)-q*(V*Se-j*ae)+oe*(V*Q-j*Z),p[1]=-(x*(Z*Se-Q*ae)-q*(T*Se-C*ae)+oe*(T*Q-C*Z)),p[2]=x*(V*Se-j*ae)-k*(T*Se-C*ae)+oe*(T*j-C*V),p[3]=-(x*(V*Q-j*Z)-k*(T*Q-C*Z)+q*(T*j-C*V)),p[4]=-(L*(Z*Se-Q*ae)-B*(V*Se-j*ae)+ce*(V*Q-j*Z)),p[5]=E*(Z*Se-Q*ae)-B*(T*Se-C*ae)+ce*(T*Q-C*Z),p[6]=-(E*(V*Se-j*ae)-L*(T*Se-C*ae)+ce*(T*j-C*V)),p[7]=E*(V*Q-j*Z)-L*(T*Q-C*Z)+B*(T*j-C*V),p[8]=L*(q*Se-Q*oe)-B*(k*Se-j*oe)+ce*(k*Q-j*q),p[9]=-(E*(q*Se-Q*oe)-B*(x*Se-C*oe)+ce*(x*Q-C*q)),p[10]=E*(k*Se-j*oe)-L*(x*Se-C*oe)+ce*(x*j-C*k),p[11]=-(E*(k*Q-j*q)-L*(x*Q-C*q)+B*(x*j-C*k)),p[12]=-(L*(q*ae-Z*oe)-B*(k*ae-V*oe)+ce*(k*Z-V*q)),p[13]=E*(q*ae-Z*oe)-B*(x*ae-T*oe)+ce*(x*Z-T*q),p[14]=-(E*(k*ae-V*oe)-L*(x*ae-T*oe)+ce*(x*V-T*k)),p[15]=E*(k*Z-V*q)-L*(x*Z-T*q)+B*(x*V-T*k),p},Ut.determinant=function(p){var b=p[0],E=p[1],x=p[2],T=p[3],C=p[4],L=p[5],k=p[6],V=p[7],j=p[8],B=p[9],q=p[10],Z=p[11],Q=p[12],ce=p[13],oe=p[14],ae=p[15];return(b*L-E*C)*(q*ae-Z*oe)-(b*k-x*C)*(B*ae-Z*ce)+(b*V-T*C)*(B*oe-q*ce)+(E*k-x*L)*(j*ae-Z*Q)-(E*V-T*L)*(j*oe-q*Q)+(x*V-T*k)*(j*ce-B*Q)},Ut.multiply=u,Ut.translate=function(p,b,E){var x,T,C,L,k,V,j,B,q,Z,Q,ce,oe=E[0],ae=E[1],Se=E[2];return b===p?(p[12]=b[0]*oe+b[4]*ae+b[8]*Se+b[12],p[13]=b[1]*oe+b[5]*ae+b[9]*Se+b[13],p[14]=b[2]*oe+b[6]*ae+b[10]*Se+b[14],p[15]=b[3]*oe+b[7]*ae+b[11]*Se+b[15]):(T=b[1],C=b[2],L=b[3],k=b[4],V=b[5],j=b[6],B=b[7],q=b[8],Z=b[9],Q=b[10],ce=b[11],p[0]=x=b[0],p[1]=T,p[2]=C,p[3]=L,p[4]=k,p[5]=V,p[6]=j,p[7]=B,p[8]=q,p[9]=Z,p[10]=Q,p[11]=ce,p[12]=x*oe+k*ae+q*Se+b[12],p[13]=T*oe+V*ae+Z*Se+b[13],p[14]=C*oe+j*ae+Q*Se+b[14],p[15]=L*oe+B*ae+ce*Se+b[15]),p},Ut.scale=function(p,b,E){var x=E[0],T=E[1],C=E[2];return p[0]=b[0]*x,p[1]=b[1]*x,p[2]=b[2]*x,p[3]=b[3]*x,p[4]=b[4]*T,p[5]=b[5]*T,p[6]=b[6]*T,p[7]=b[7]*T,p[8]=b[8]*C,p[9]=b[9]*C,p[10]=b[10]*C,p[11]=b[11]*C,p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15],p},Ut.rotate=function(p,b,E,x){var T,C,L,k,V,j,B,q,Z,Q,ce,oe,ae,Se,se,be,Me,Ie,Le,Ue,je,Fe,tt,dt,Xe=x[0],Bt=x[1],Et=x[2],yt=Math.hypot(Xe,Bt,Et);return yt<e.EPSILON?null:(Xe*=yt=1/yt,Bt*=yt,Et*=yt,T=Math.sin(E),C=Math.cos(E),V=b[1],j=b[2],B=b[3],Z=b[5],Q=b[6],ce=b[7],ae=b[9],Se=b[10],se=b[11],be=Xe*Xe*(L=1-C)+C,Le=Xe*Bt*L-Et*T,Ue=Bt*Bt*L+C,je=Et*Bt*L+Xe*T,Fe=Xe*Et*L+Bt*T,tt=Bt*Et*L-Xe*T,dt=Et*Et*L+C,p[0]=(k=b[0])*be+(q=b[4])*(Me=Bt*Xe*L+Et*T)+(oe=b[8])*(Ie=Et*Xe*L-Bt*T),p[1]=V*be+Z*Me+ae*Ie,p[2]=j*be+Q*Me+Se*Ie,p[3]=B*be+ce*Me+se*Ie,p[4]=k*Le+q*Ue+oe*je,p[5]=V*Le+Z*Ue+ae*je,p[6]=j*Le+Q*Ue+Se*je,p[7]=B*Le+ce*Ue+se*je,p[8]=k*Fe+q*tt+oe*dt,p[9]=V*Fe+Z*tt+ae*dt,p[10]=j*Fe+Q*tt+Se*dt,p[11]=B*Fe+ce*tt+se*dt,b!==p&&(p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15]),p)},Ut.rotateX=function(p,b,E){var x=Math.sin(E),T=Math.cos(E),C=b[4],L=b[5],k=b[6],V=b[7],j=b[8],B=b[9],q=b[10],Z=b[11];return b!==p&&(p[0]=b[0],p[1]=b[1],p[2]=b[2],p[3]=b[3],p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15]),p[4]=C*T+j*x,p[5]=L*T+B*x,p[6]=k*T+q*x,p[7]=V*T+Z*x,p[8]=j*T-C*x,p[9]=B*T-L*x,p[10]=q*T-k*x,p[11]=Z*T-V*x,p},Ut.rotateY=function(p,b,E){var x=Math.sin(E),T=Math.cos(E),C=b[0],L=b[1],k=b[2],V=b[3],j=b[8],B=b[9],q=b[10],Z=b[11];return b!==p&&(p[4]=b[4],p[5]=b[5],p[6]=b[6],p[7]=b[7],p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15]),p[0]=C*T-j*x,p[1]=L*T-B*x,p[2]=k*T-q*x,p[3]=V*T-Z*x,p[8]=C*x+j*T,p[9]=L*x+B*T,p[10]=k*x+q*T,p[11]=V*x+Z*T,p},Ut.rotateZ=function(p,b,E){var x=Math.sin(E),T=Math.cos(E),C=b[0],L=b[1],k=b[2],V=b[3],j=b[4],B=b[5],q=b[6],Z=b[7];return b!==p&&(p[8]=b[8],p[9]=b[9],p[10]=b[10],p[11]=b[11],p[12]=b[12],p[13]=b[13],p[14]=b[14],p[15]=b[15]),p[0]=C*T+j*x,p[1]=L*T+B*x,p[2]=k*T+q*x,p[3]=V*T+Z*x,p[4]=j*T-C*x,p[5]=B*T-L*x,p[6]=q*T-k*x,p[7]=Z*T-V*x,p},Ut.fromTranslation=function(p,b){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=b[0],p[13]=b[1],p[14]=b[2],p[15]=1,p},Ut.fromScaling=function(p,b){return p[0]=b[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=b[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=b[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},Ut.fromRotation=function(p,b,E){var x,T,C,L=E[0],k=E[1],V=E[2],j=Math.hypot(L,k,V);return j<e.EPSILON?null:(L*=j=1/j,k*=j,V*=j,x=Math.sin(b),T=Math.cos(b),p[0]=L*L*(C=1-T)+T,p[1]=k*L*C+V*x,p[2]=V*L*C-k*x,p[3]=0,p[4]=L*k*C-V*x,p[5]=k*k*C+T,p[6]=V*k*C+L*x,p[7]=0,p[8]=L*V*C+k*x,p[9]=k*V*C-L*x,p[10]=V*V*C+T,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p)},Ut.fromXRotation=function(p,b){var E=Math.sin(b),x=Math.cos(b);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=E,p[7]=0,p[8]=0,p[9]=-E,p[10]=x,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},Ut.fromYRotation=function(p,b){var E=Math.sin(b),x=Math.cos(b);return p[0]=x,p[1]=0,p[2]=-E,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=E,p[9]=0,p[10]=x,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},Ut.fromZRotation=function(p,b){var E=Math.sin(b),x=Math.cos(b);return p[0]=x,p[1]=E,p[2]=0,p[3]=0,p[4]=-E,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},Ut.fromRotationTranslation=a,Ut.fromQuat2=function(p,b){var E=new e.ARRAY_TYPE(3),x=-b[0],T=-b[1],C=-b[2],L=b[3],k=b[4],V=b[5],j=b[6],B=b[7],q=x*x+T*T+C*C+L*L;return q>0?(E[0]=2*(k*L+B*x+V*C-j*T)/q,E[1]=2*(V*L+B*T+j*x-k*C)/q,E[2]=2*(j*L+B*C+k*T-V*x)/q):(E[0]=2*(k*L+B*x+V*C-j*T),E[1]=2*(V*L+B*T+j*x-k*C),E[2]=2*(j*L+B*C+k*T-V*x)),a(p,b,E),p},Ut.getTranslation=function(p,b){return p[0]=b[12],p[1]=b[13],p[2]=b[14],p},Ut.getScaling=h,Ut.getRotation=function(p,b){var E=new e.ARRAY_TYPE(3);h(E,b);var x=1/E[0],T=1/E[1],C=1/E[2],L=b[0]*x,k=b[1]*T,V=b[2]*C,j=b[4]*x,B=b[5]*T,q=b[6]*C,Z=b[8]*x,Q=b[9]*T,ce=b[10]*C,oe=L+B+ce,ae=0;return oe>0?(ae=2*Math.sqrt(oe+1),p[3]=.25*ae,p[0]=(q-Q)/ae,p[1]=(Z-V)/ae,p[2]=(k-j)/ae):L>B&&L>ce?(ae=2*Math.sqrt(1+L-B-ce),p[3]=(q-Q)/ae,p[0]=.25*ae,p[1]=(k+j)/ae,p[2]=(Z+V)/ae):B>ce?(ae=2*Math.sqrt(1+B-L-ce),p[3]=(Z-V)/ae,p[0]=(k+j)/ae,p[1]=.25*ae,p[2]=(q+Q)/ae):(ae=2*Math.sqrt(1+ce-L-B),p[3]=(k-j)/ae,p[0]=(Z+V)/ae,p[1]=(q+Q)/ae,p[2]=.25*ae),p},Ut.fromRotationTranslationScale=function(p,b,E,x){var T=b[0],C=b[1],L=b[2],k=b[3],V=T+T,j=C+C,B=L+L,q=T*V,Z=T*j,Q=T*B,ce=C*j,oe=C*B,ae=L*B,Se=k*V,se=k*j,be=k*B,Me=x[0],Ie=x[1],Le=x[2];return p[0]=(1-(ce+ae))*Me,p[1]=(Z+be)*Me,p[2]=(Q-se)*Me,p[3]=0,p[4]=(Z-be)*Ie,p[5]=(1-(q+ae))*Ie,p[6]=(oe+Se)*Ie,p[7]=0,p[8]=(Q+se)*Le,p[9]=(oe-Se)*Le,p[10]=(1-(q+ce))*Le,p[11]=0,p[12]=E[0],p[13]=E[1],p[14]=E[2],p[15]=1,p},Ut.fromRotationTranslationScaleOrigin=function(p,b,E,x,T){var C=b[0],L=b[1],k=b[2],V=b[3],j=C+C,B=L+L,q=k+k,Z=C*j,Q=C*B,ce=C*q,oe=L*B,ae=L*q,Se=k*q,se=V*j,be=V*B,Me=V*q,Ie=x[0],Le=x[1],Ue=x[2],je=T[0],Fe=T[1],tt=T[2],dt=(1-(oe+Se))*Ie,Xe=(Q+Me)*Ie,Bt=(ce-be)*Ie,Et=(Q-Me)*Le,yt=(1-(Z+Se))*Le,ut=(ae+se)*Le,ni=(ce+be)*Ue,Ft=(ae-se)*Ue,qt=(1-(Z+oe))*Ue;return p[0]=dt,p[1]=Xe,p[2]=Bt,p[3]=0,p[4]=Et,p[5]=yt,p[6]=ut,p[7]=0,p[8]=ni,p[9]=Ft,p[10]=qt,p[11]=0,p[12]=E[0]+je-(dt*je+Et*Fe+ni*tt),p[13]=E[1]+Fe-(Xe*je+yt*Fe+Ft*tt),p[14]=E[2]+tt-(Bt*je+ut*Fe+qt*tt),p[15]=1,p},Ut.fromQuat=function(p,b){var E=b[0],x=b[1],T=b[2],C=b[3],L=E+E,k=x+x,V=T+T,j=E*L,B=x*L,q=x*k,Z=T*L,Q=T*k,ce=T*V,oe=C*L,ae=C*k,Se=C*V;return p[0]=1-q-ce,p[1]=B+Se,p[2]=Z-ae,p[3]=0,p[4]=B-Se,p[5]=1-j-ce,p[6]=Q+oe,p[7]=0,p[8]=Z+ae,p[9]=Q-oe,p[10]=1-j-q,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},Ut.frustum=function(p,b,E,x,T,C,L){var k=1/(E-b),V=1/(T-x),j=1/(C-L);return p[0]=2*C*k,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2*C*V,p[6]=0,p[7]=0,p[8]=(E+b)*k,p[9]=(T+x)*V,p[10]=(L+C)*j,p[11]=-1,p[12]=0,p[13]=0,p[14]=L*C*2*j,p[15]=0,p},Ut.perspectiveNO=g,Ut.perspectiveZO=function(p,b,E,x,T){var C,L=1/Math.tan(b/2);return p[0]=L/E,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=L,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,T!=null&&T!==1/0?(p[10]=T*(C=1/(x-T)),p[14]=T*x*C):(p[10]=-1,p[14]=-x),p},Ut.perspectiveFromFieldOfView=function(p,b,E,x){var T=Math.tan(b.upDegrees*Math.PI/180),C=Math.tan(b.downDegrees*Math.PI/180),L=Math.tan(b.leftDegrees*Math.PI/180),k=Math.tan(b.rightDegrees*Math.PI/180),V=2/(L+k),j=2/(T+C);return p[0]=V,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=j,p[6]=0,p[7]=0,p[8]=-(L-k)*V*.5,p[9]=(T-C)*j*.5,p[10]=x/(E-x),p[11]=-1,p[12]=0,p[13]=0,p[14]=x*E/(E-x),p[15]=0,p},Ut.orthoNO=w,Ut.orthoZO=function(p,b,E,x,T,C,L){var k=1/(b-E),V=1/(x-T),j=1/(C-L);return p[0]=-2*k,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=j,p[11]=0,p[12]=(b+E)*k,p[13]=(T+x)*V,p[14]=C*j,p[15]=1,p},Ut.lookAt=function(p,b,E,x){var T,C,L,k,V,j,B,q,Z,Q,ce=b[0],oe=b[1],ae=b[2],Se=x[0],se=x[1],be=x[2],Me=E[0],Ie=E[1],Le=E[2];return Math.abs(ce-Me)<e.EPSILON&&Math.abs(oe-Ie)<e.EPSILON&&Math.abs(ae-Le)<e.EPSILON?s(p):(B=ce-Me,q=oe-Ie,Z=ae-Le,T=se*(Z*=Q=1/Math.hypot(B,q,Z))-be*(q*=Q),C=be*(B*=Q)-Se*Z,L=Se*q-se*B,(Q=Math.hypot(T,C,L))?(T*=Q=1/Q,C*=Q,L*=Q):(T=0,C=0,L=0),k=q*L-Z*C,V=Z*T-B*L,j=B*C-q*T,(Q=Math.hypot(k,V,j))?(k*=Q=1/Q,V*=Q,j*=Q):(k=0,V=0,j=0),p[0]=T,p[1]=k,p[2]=B,p[3]=0,p[4]=C,p[5]=V,p[6]=q,p[7]=0,p[8]=L,p[9]=j,p[10]=Z,p[11]=0,p[12]=-(T*ce+C*oe+L*ae),p[13]=-(k*ce+V*oe+j*ae),p[14]=-(B*ce+q*oe+Z*ae),p[15]=1,p)},Ut.targetTo=function(p,b,E,x){var T=b[0],C=b[1],L=b[2],k=x[0],V=x[1],j=x[2],B=T-E[0],q=C-E[1],Z=L-E[2],Q=B*B+q*q+Z*Z;Q>0&&(B*=Q=1/Math.sqrt(Q),q*=Q,Z*=Q);var ce=V*Z-j*q,oe=j*B-k*Z,ae=k*q-V*B;return(Q=ce*ce+oe*oe+ae*ae)>0&&(ce*=Q=1/Math.sqrt(Q),oe*=Q,ae*=Q),p[0]=ce,p[1]=oe,p[2]=ae,p[3]=0,p[4]=q*ae-Z*oe,p[5]=Z*ce-B*ae,p[6]=B*oe-q*ce,p[7]=0,p[8]=B,p[9]=q,p[10]=Z,p[11]=0,p[12]=T,p[13]=C,p[14]=L,p[15]=1,p},Ut.str=function(p){return"mat4("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+", "+p[8]+", "+p[9]+", "+p[10]+", "+p[11]+", "+p[12]+", "+p[13]+", "+p[14]+", "+p[15]+")"},Ut.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15])},Ut.add=function(p,b,E){return p[0]=b[0]+E[0],p[1]=b[1]+E[1],p[2]=b[2]+E[2],p[3]=b[3]+E[3],p[4]=b[4]+E[4],p[5]=b[5]+E[5],p[6]=b[6]+E[6],p[7]=b[7]+E[7],p[8]=b[8]+E[8],p[9]=b[9]+E[9],p[10]=b[10]+E[10],p[11]=b[11]+E[11],p[12]=b[12]+E[12],p[13]=b[13]+E[13],p[14]=b[14]+E[14],p[15]=b[15]+E[15],p},Ut.subtract=A,Ut.multiplyScalar=function(p,b,E){return p[0]=b[0]*E,p[1]=b[1]*E,p[2]=b[2]*E,p[3]=b[3]*E,p[4]=b[4]*E,p[5]=b[5]*E,p[6]=b[6]*E,p[7]=b[7]*E,p[8]=b[8]*E,p[9]=b[9]*E,p[10]=b[10]*E,p[11]=b[11]*E,p[12]=b[12]*E,p[13]=b[13]*E,p[14]=b[14]*E,p[15]=b[15]*E,p},Ut.multiplyScalarAndAdd=function(p,b,E,x){return p[0]=b[0]+E[0]*x,p[1]=b[1]+E[1]*x,p[2]=b[2]+E[2]*x,p[3]=b[3]+E[3]*x,p[4]=b[4]+E[4]*x,p[5]=b[5]+E[5]*x,p[6]=b[6]+E[6]*x,p[7]=b[7]+E[7]*x,p[8]=b[8]+E[8]*x,p[9]=b[9]+E[9]*x,p[10]=b[10]+E[10]*x,p[11]=b[11]+E[11]*x,p[12]=b[12]+E[12]*x,p[13]=b[13]+E[13]*x,p[14]=b[14]+E[14]*x,p[15]=b[15]+E[15]*x,p},Ut.exactEquals=function(p,b){return p[0]===b[0]&&p[1]===b[1]&&p[2]===b[2]&&p[3]===b[3]&&p[4]===b[4]&&p[5]===b[5]&&p[6]===b[6]&&p[7]===b[7]&&p[8]===b[8]&&p[9]===b[9]&&p[10]===b[10]&&p[11]===b[11]&&p[12]===b[12]&&p[13]===b[13]&&p[14]===b[14]&&p[15]===b[15]},Ut.equals=function(p,b){var E=p[0],x=p[1],T=p[2],C=p[3],L=p[4],k=p[5],V=p[6],j=p[7],B=p[8],q=p[9],Z=p[10],Q=p[11],ce=p[12],oe=p[13],ae=p[14],Se=p[15],se=b[0],be=b[1],Me=b[2],Ie=b[3],Le=b[4],Ue=b[5],je=b[6],Fe=b[7],tt=b[8],dt=b[9],Xe=b[10],Bt=b[11],Et=b[12],yt=b[13],ut=b[14],ni=b[15];return Math.abs(E-se)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(se))&&Math.abs(x-be)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(be))&&Math.abs(T-Me)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Me))&&Math.abs(C-Ie)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Ie))&&Math.abs(L-Le)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(Le))&&Math.abs(k-Ue)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ue))&&Math.abs(V-je)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(je))&&Math.abs(j-Fe)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Fe))&&Math.abs(B-tt)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(tt))&&Math.abs(q-dt)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(dt))&&Math.abs(Z-Xe)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Xe))&&Math.abs(Q-Bt)<=e.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Bt))&&Math.abs(ce-Et)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Et))&&Math.abs(oe-yt)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(yt))&&Math.abs(ae-ut)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(ut))&&Math.abs(Se-ni)<=e.EPSILON*Math.max(1,Math.abs(Se),Math.abs(ni))},Ut.sub=Ut.mul=Ut.ortho=Ut.perspective=void 0;var e=function(p,b){if(p&&p.__esModule)return p;if(p===null||r(p)!=="object"&&typeof p!="function")return{default:p};var E=i(void 0);if(E&&E.has(p))return E.get(p);var x={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in p)if(C!=="default"&&Object.prototype.hasOwnProperty.call(p,C)){var L=T?Object.getOwnPropertyDescriptor(p,C):null;L&&(L.get||L.set)?Object.defineProperty(x,C,L):x[C]=p[C]}return x.default=p,E&&E.set(p,x),x}(Ke());function i(p){if(typeof WeakMap!="function")return null;var b=new WeakMap,E=new WeakMap;return(i=function(x){return x?E:b})(p)}function s(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function u(p,b,E){var x=b[0],T=b[1],C=b[2],L=b[3],k=b[4],V=b[5],j=b[6],B=b[7],q=b[8],Z=b[9],Q=b[10],ce=b[11],oe=b[12],ae=b[13],Se=b[14],se=b[15],be=E[0],Me=E[1],Ie=E[2],Le=E[3];return p[0]=be*x+Me*k+Ie*q+Le*oe,p[1]=be*T+Me*V+Ie*Z+Le*ae,p[2]=be*C+Me*j+Ie*Q+Le*Se,p[3]=be*L+Me*B+Ie*ce+Le*se,p[4]=(be=E[4])*x+(Me=E[5])*k+(Ie=E[6])*q+(Le=E[7])*oe,p[5]=be*T+Me*V+Ie*Z+Le*ae,p[6]=be*C+Me*j+Ie*Q+Le*Se,p[7]=be*L+Me*B+Ie*ce+Le*se,p[8]=(be=E[8])*x+(Me=E[9])*k+(Ie=E[10])*q+(Le=E[11])*oe,p[9]=be*T+Me*V+Ie*Z+Le*ae,p[10]=be*C+Me*j+Ie*Q+Le*Se,p[11]=be*L+Me*B+Ie*ce+Le*se,p[12]=(be=E[12])*x+(Me=E[13])*k+(Ie=E[14])*q+(Le=E[15])*oe,p[13]=be*T+Me*V+Ie*Z+Le*ae,p[14]=be*C+Me*j+Ie*Q+Le*Se,p[15]=be*L+Me*B+Ie*ce+Le*se,p}function a(p,b,E){var x=b[0],T=b[1],C=b[2],L=b[3],k=x+x,V=T+T,j=C+C,B=x*k,q=x*V,Z=x*j,Q=T*V,ce=T*j,oe=C*j,ae=L*k,Se=L*V,se=L*j;return p[0]=1-(Q+oe),p[1]=q+se,p[2]=Z-Se,p[3]=0,p[4]=q-se,p[5]=1-(B+oe),p[6]=ce+ae,p[7]=0,p[8]=Z+Se,p[9]=ce-ae,p[10]=1-(B+Q),p[11]=0,p[12]=E[0],p[13]=E[1],p[14]=E[2],p[15]=1,p}function h(p,b){var E=b[4],x=b[5],T=b[6],C=b[8],L=b[9],k=b[10];return p[0]=Math.hypot(b[0],b[1],b[2]),p[1]=Math.hypot(E,x,T),p[2]=Math.hypot(C,L,k),p}function g(p,b,E,x,T){var C,L=1/Math.tan(b/2);return p[0]=L/E,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=L,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,T!=null&&T!==1/0?(p[10]=(T+x)*(C=1/(x-T)),p[14]=2*T*x*C):(p[10]=-1,p[14]=-2*x),p}function w(p,b,E,x,T,C,L){var k=1/(b-E),V=1/(x-T),j=1/(C-L);return p[0]=-2*k,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*j,p[11]=0,p[12]=(b+E)*k,p[13]=(T+x)*V,p[14]=(L+C)*j,p[15]=1,p}function A(p,b,E){return p[0]=b[0]-E[0],p[1]=b[1]-E[1],p[2]=b[2]-E[2],p[3]=b[3]-E[3],p[4]=b[4]-E[4],p[5]=b[5]-E[5],p[6]=b[6]-E[6],p[7]=b[7]-E[7],p[8]=b[8]-E[8],p[9]=b[9]-E[9],p[10]=b[10]-E[10],p[11]=b[11]-E[11],p[12]=b[12]-E[12],p[13]=b[13]-E[13],p[14]=b[14]-E[14],p[15]=b[15]-E[15],p}return Ut.perspective=g,Ut.ortho=w,Ut.mul=u,Ut.sub=A,Ut}var Xr,li={},ui={};function vo(){if(Xr)return ui;function r(T){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},r(T)}Xr=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.create=s,ui.clone=function(T){var C=new e.ARRAY_TYPE(3);return C[0]=T[0],C[1]=T[1],C[2]=T[2],C},ui.length=u,ui.fromValues=function(T,C,L){var k=new e.ARRAY_TYPE(3);return k[0]=T,k[1]=C,k[2]=L,k},ui.copy=function(T,C){return T[0]=C[0],T[1]=C[1],T[2]=C[2],T},ui.set=function(T,C,L,k){return T[0]=C,T[1]=L,T[2]=k,T},ui.add=function(T,C,L){return T[0]=C[0]+L[0],T[1]=C[1]+L[1],T[2]=C[2]+L[2],T},ui.subtract=a,ui.multiply=h,ui.divide=g,ui.ceil=function(T,C){return T[0]=Math.ceil(C[0]),T[1]=Math.ceil(C[1]),T[2]=Math.ceil(C[2]),T},ui.floor=function(T,C){return T[0]=Math.floor(C[0]),T[1]=Math.floor(C[1]),T[2]=Math.floor(C[2]),T},ui.min=function(T,C,L){return T[0]=Math.min(C[0],L[0]),T[1]=Math.min(C[1],L[1]),T[2]=Math.min(C[2],L[2]),T},ui.max=function(T,C,L){return T[0]=Math.max(C[0],L[0]),T[1]=Math.max(C[1],L[1]),T[2]=Math.max(C[2],L[2]),T},ui.round=function(T,C){return T[0]=Math.round(C[0]),T[1]=Math.round(C[1]),T[2]=Math.round(C[2]),T},ui.scale=function(T,C,L){return T[0]=C[0]*L,T[1]=C[1]*L,T[2]=C[2]*L,T},ui.scaleAndAdd=function(T,C,L,k){return T[0]=C[0]+L[0]*k,T[1]=C[1]+L[1]*k,T[2]=C[2]+L[2]*k,T},ui.distance=w,ui.squaredDistance=A,ui.squaredLength=p,ui.negate=function(T,C){return T[0]=-C[0],T[1]=-C[1],T[2]=-C[2],T},ui.inverse=function(T,C){return T[0]=1/C[0],T[1]=1/C[1],T[2]=1/C[2],T},ui.normalize=function(T,C){var L=C[0],k=C[1],V=C[2],j=L*L+k*k+V*V;return j>0&&(j=1/Math.sqrt(j)),T[0]=C[0]*j,T[1]=C[1]*j,T[2]=C[2]*j,T},ui.dot=b,ui.cross=function(T,C,L){var k=C[0],V=C[1],j=C[2],B=L[0],q=L[1],Z=L[2];return T[0]=V*Z-j*q,T[1]=j*B-k*Z,T[2]=k*q-V*B,T},ui.lerp=function(T,C,L,k){var V=C[0],j=C[1],B=C[2];return T[0]=V+k*(L[0]-V),T[1]=j+k*(L[1]-j),T[2]=B+k*(L[2]-B),T},ui.hermite=function(T,C,L,k,V,j){var B=j*j,q=B*(2*j-3)+1,Z=B*(j-2)+j,Q=B*(j-1),ce=B*(3-2*j);return T[0]=C[0]*q+L[0]*Z+k[0]*Q+V[0]*ce,T[1]=C[1]*q+L[1]*Z+k[1]*Q+V[1]*ce,T[2]=C[2]*q+L[2]*Z+k[2]*Q+V[2]*ce,T},ui.bezier=function(T,C,L,k,V,j){var B=1-j,q=B*B,Z=j*j,Q=q*B,ce=3*j*q,oe=3*Z*B,ae=Z*j;return T[0]=C[0]*Q+L[0]*ce+k[0]*oe+V[0]*ae,T[1]=C[1]*Q+L[1]*ce+k[1]*oe+V[1]*ae,T[2]=C[2]*Q+L[2]*ce+k[2]*oe+V[2]*ae,T},ui.random=function(T,C){C=C||1;var L=2*e.RANDOM()*Math.PI,k=2*e.RANDOM()-1,V=Math.sqrt(1-k*k)*C;return T[0]=Math.cos(L)*V,T[1]=Math.sin(L)*V,T[2]=k*C,T},ui.transformMat4=function(T,C,L){var k=C[0],V=C[1],j=C[2],B=L[3]*k+L[7]*V+L[11]*j+L[15];return T[0]=(L[0]*k+L[4]*V+L[8]*j+L[12])/(B=B||1),T[1]=(L[1]*k+L[5]*V+L[9]*j+L[13])/B,T[2]=(L[2]*k+L[6]*V+L[10]*j+L[14])/B,T},ui.transformMat3=function(T,C,L){var k=C[0],V=C[1],j=C[2];return T[0]=k*L[0]+V*L[3]+j*L[6],T[1]=k*L[1]+V*L[4]+j*L[7],T[2]=k*L[2]+V*L[5]+j*L[8],T},ui.transformQuat=function(T,C,L){var k=L[0],V=L[1],j=L[2],B=C[0],q=C[1],Z=C[2],Q=V*Z-j*q,ce=j*B-k*Z,oe=k*q-V*B,ae=V*oe-j*ce,Se=j*Q-k*oe,se=k*ce-V*Q,be=2*L[3];return ce*=be,oe*=be,Se*=2,se*=2,T[0]=B+(Q*=be)+(ae*=2),T[1]=q+ce+Se,T[2]=Z+oe+se,T},ui.rotateX=function(T,C,L,k){var V=[],j=[];return V[0]=C[0]-L[0],V[1]=C[1]-L[1],V[2]=C[2]-L[2],j[0]=V[0],j[1]=V[1]*Math.cos(k)-V[2]*Math.sin(k),j[2]=V[1]*Math.sin(k)+V[2]*Math.cos(k),T[0]=j[0]+L[0],T[1]=j[1]+L[1],T[2]=j[2]+L[2],T},ui.rotateY=function(T,C,L,k){var V=[],j=[];return V[0]=C[0]-L[0],V[1]=C[1]-L[1],V[2]=C[2]-L[2],j[0]=V[2]*Math.sin(k)+V[0]*Math.cos(k),j[1]=V[1],j[2]=V[2]*Math.cos(k)-V[0]*Math.sin(k),T[0]=j[0]+L[0],T[1]=j[1]+L[1],T[2]=j[2]+L[2],T},ui.rotateZ=function(T,C,L,k){var V=[],j=[];return V[0]=C[0]-L[0],V[1]=C[1]-L[1],V[2]=C[2]-L[2],j[0]=V[0]*Math.cos(k)-V[1]*Math.sin(k),j[1]=V[0]*Math.sin(k)+V[1]*Math.cos(k),j[2]=V[2],T[0]=j[0]+L[0],T[1]=j[1]+L[1],T[2]=j[2]+L[2],T},ui.angle=function(T,C){var L=T[0],k=T[1],V=T[2],j=C[0],B=C[1],q=C[2],Z=Math.sqrt(L*L+k*k+V*V)*Math.sqrt(j*j+B*B+q*q),Q=Z&&b(T,C)/Z;return Math.acos(Math.min(Math.max(Q,-1),1))},ui.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T},ui.str=function(T){return"vec3("+T[0]+", "+T[1]+", "+T[2]+")"},ui.exactEquals=function(T,C){return T[0]===C[0]&&T[1]===C[1]&&T[2]===C[2]},ui.equals=function(T,C){var L=T[0],k=T[1],V=T[2],j=C[0],B=C[1],q=C[2];return Math.abs(L-j)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(j))&&Math.abs(k-B)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(B))&&Math.abs(V-q)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(q))},ui.forEach=ui.sqrLen=ui.len=ui.sqrDist=ui.dist=ui.div=ui.mul=ui.sub=void 0;var e=function(T,C){if(T&&T.__esModule)return T;if(T===null||r(T)!=="object"&&typeof T!="function")return{default:T};var L=i(void 0);if(L&&L.has(T))return L.get(T);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in T)if(j!=="default"&&Object.prototype.hasOwnProperty.call(T,j)){var B=V?Object.getOwnPropertyDescriptor(T,j):null;B&&(B.get||B.set)?Object.defineProperty(k,j,B):k[j]=T[j]}return k.default=T,L&&L.set(T,k),k}(Ke());function i(T){if(typeof WeakMap!="function")return null;var C=new WeakMap,L=new WeakMap;return(i=function(k){return k?L:C})(T)}function s(){var T=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0),T}function u(T){return Math.hypot(T[0],T[1],T[2])}function a(T,C,L){return T[0]=C[0]-L[0],T[1]=C[1]-L[1],T[2]=C[2]-L[2],T}function h(T,C,L){return T[0]=C[0]*L[0],T[1]=C[1]*L[1],T[2]=C[2]*L[2],T}function g(T,C,L){return T[0]=C[0]/L[0],T[1]=C[1]/L[1],T[2]=C[2]/L[2],T}function w(T,C){return Math.hypot(C[0]-T[0],C[1]-T[1],C[2]-T[2])}function A(T,C){var L=C[0]-T[0],k=C[1]-T[1],V=C[2]-T[2];return L*L+k*k+V*V}function p(T){var C=T[0],L=T[1],k=T[2];return C*C+L*L+k*k}function b(T,C){return T[0]*C[0]+T[1]*C[1]+T[2]*C[2]}ui.sub=a,ui.mul=h,ui.div=g,ui.dist=w,ui.sqrDist=A,ui.len=u,ui.sqrLen=p;var E,x=(E=s(),function(T,C,L,k,V,j){var B,q;for(C||(C=3),L||(L=0),q=k?Math.min(k*C+L,T.length):T.length,B=L;B<q;B+=C)E[0]=T[B],E[1]=T[B+1],E[2]=T[B+2],V(E,E,j),T[B]=E[0],T[B+1]=E[1],T[B+2]=E[2];return T});return ui.forEach=x,ui}var Yr,bs,Ei={};function zn(){if(Yr)return Ei;function r(x){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(x)}Yr=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.create=s,Ei.clone=function(x){var T=new e.ARRAY_TYPE(4);return T[0]=x[0],T[1]=x[1],T[2]=x[2],T[3]=x[3],T},Ei.fromValues=function(x,T,C,L){var k=new e.ARRAY_TYPE(4);return k[0]=x,k[1]=T,k[2]=C,k[3]=L,k},Ei.copy=function(x,T){return x[0]=T[0],x[1]=T[1],x[2]=T[2],x[3]=T[3],x},Ei.set=function(x,T,C,L,k){return x[0]=T,x[1]=C,x[2]=L,x[3]=k,x},Ei.add=function(x,T,C){return x[0]=T[0]+C[0],x[1]=T[1]+C[1],x[2]=T[2]+C[2],x[3]=T[3]+C[3],x},Ei.subtract=u,Ei.multiply=a,Ei.divide=h,Ei.ceil=function(x,T){return x[0]=Math.ceil(T[0]),x[1]=Math.ceil(T[1]),x[2]=Math.ceil(T[2]),x[3]=Math.ceil(T[3]),x},Ei.floor=function(x,T){return x[0]=Math.floor(T[0]),x[1]=Math.floor(T[1]),x[2]=Math.floor(T[2]),x[3]=Math.floor(T[3]),x},Ei.min=function(x,T,C){return x[0]=Math.min(T[0],C[0]),x[1]=Math.min(T[1],C[1]),x[2]=Math.min(T[2],C[2]),x[3]=Math.min(T[3],C[3]),x},Ei.max=function(x,T,C){return x[0]=Math.max(T[0],C[0]),x[1]=Math.max(T[1],C[1]),x[2]=Math.max(T[2],C[2]),x[3]=Math.max(T[3],C[3]),x},Ei.round=function(x,T){return x[0]=Math.round(T[0]),x[1]=Math.round(T[1]),x[2]=Math.round(T[2]),x[3]=Math.round(T[3]),x},Ei.scale=function(x,T,C){return x[0]=T[0]*C,x[1]=T[1]*C,x[2]=T[2]*C,x[3]=T[3]*C,x},Ei.scaleAndAdd=function(x,T,C,L){return x[0]=T[0]+C[0]*L,x[1]=T[1]+C[1]*L,x[2]=T[2]+C[2]*L,x[3]=T[3]+C[3]*L,x},Ei.distance=g,Ei.squaredDistance=w,Ei.length=A,Ei.squaredLength=p,Ei.negate=function(x,T){return x[0]=-T[0],x[1]=-T[1],x[2]=-T[2],x[3]=-T[3],x},Ei.inverse=function(x,T){return x[0]=1/T[0],x[1]=1/T[1],x[2]=1/T[2],x[3]=1/T[3],x},Ei.normalize=function(x,T){var C=T[0],L=T[1],k=T[2],V=T[3],j=C*C+L*L+k*k+V*V;return j>0&&(j=1/Math.sqrt(j)),x[0]=C*j,x[1]=L*j,x[2]=k*j,x[3]=V*j,x},Ei.dot=function(x,T){return x[0]*T[0]+x[1]*T[1]+x[2]*T[2]+x[3]*T[3]},Ei.cross=function(x,T,C,L){var k=C[0]*L[1]-C[1]*L[0],V=C[0]*L[2]-C[2]*L[0],j=C[0]*L[3]-C[3]*L[0],B=C[1]*L[2]-C[2]*L[1],q=C[1]*L[3]-C[3]*L[1],Z=C[2]*L[3]-C[3]*L[2],Q=T[0],ce=T[1],oe=T[2],ae=T[3];return x[0]=ce*Z-oe*q+ae*B,x[1]=-Q*Z+oe*j-ae*V,x[2]=Q*q-ce*j+ae*k,x[3]=-Q*B+ce*V-oe*k,x},Ei.lerp=function(x,T,C,L){var k=T[0],V=T[1],j=T[2],B=T[3];return x[0]=k+L*(C[0]-k),x[1]=V+L*(C[1]-V),x[2]=j+L*(C[2]-j),x[3]=B+L*(C[3]-B),x},Ei.random=function(x,T){var C,L,k,V,j,B;T=T||1;do j=(C=2*e.RANDOM()-1)*C+(L=2*e.RANDOM()-1)*L;while(j>=1);do B=(k=2*e.RANDOM()-1)*k+(V=2*e.RANDOM()-1)*V;while(B>=1);var q=Math.sqrt((1-j)/B);return x[0]=T*C,x[1]=T*L,x[2]=T*k*q,x[3]=T*V*q,x},Ei.transformMat4=function(x,T,C){var L=T[0],k=T[1],V=T[2],j=T[3];return x[0]=C[0]*L+C[4]*k+C[8]*V+C[12]*j,x[1]=C[1]*L+C[5]*k+C[9]*V+C[13]*j,x[2]=C[2]*L+C[6]*k+C[10]*V+C[14]*j,x[3]=C[3]*L+C[7]*k+C[11]*V+C[15]*j,x},Ei.transformQuat=function(x,T,C){var L=T[0],k=T[1],V=T[2],j=C[0],B=C[1],q=C[2],Z=C[3],Q=Z*L+B*V-q*k,ce=Z*k+q*L-j*V,oe=Z*V+j*k-B*L,ae=-j*L-B*k-q*V;return x[0]=Q*Z+ae*-j+ce*-q-oe*-B,x[1]=ce*Z+ae*-B+oe*-j-Q*-q,x[2]=oe*Z+ae*-q+Q*-B-ce*-j,x[3]=T[3],x},Ei.zero=function(x){return x[0]=0,x[1]=0,x[2]=0,x[3]=0,x},Ei.str=function(x){return"vec4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+")"},Ei.exactEquals=function(x,T){return x[0]===T[0]&&x[1]===T[1]&&x[2]===T[2]&&x[3]===T[3]},Ei.equals=function(x,T){var C=x[0],L=x[1],k=x[2],V=x[3],j=T[0],B=T[1],q=T[2],Z=T[3];return Math.abs(C-j)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(j))&&Math.abs(L-B)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(B))&&Math.abs(k-q)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(q))&&Math.abs(V-Z)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Z))},Ei.forEach=Ei.sqrLen=Ei.len=Ei.sqrDist=Ei.dist=Ei.div=Ei.mul=Ei.sub=void 0;var e=function(x,T){if(x&&x.__esModule)return x;if(x===null||r(x)!=="object"&&typeof x!="function")return{default:x};var C=i(void 0);if(C&&C.has(x))return C.get(x);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in x)if(V!=="default"&&Object.prototype.hasOwnProperty.call(x,V)){var j=k?Object.getOwnPropertyDescriptor(x,V):null;j&&(j.get||j.set)?Object.defineProperty(L,V,j):L[V]=x[V]}return L.default=x,C&&C.set(x,L),L}(Ke());function i(x){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(i=function(L){return L?C:T})(x)}function s(){var x=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(x[0]=0,x[1]=0,x[2]=0,x[3]=0),x}function u(x,T,C){return x[0]=T[0]-C[0],x[1]=T[1]-C[1],x[2]=T[2]-C[2],x[3]=T[3]-C[3],x}function a(x,T,C){return x[0]=T[0]*C[0],x[1]=T[1]*C[1],x[2]=T[2]*C[2],x[3]=T[3]*C[3],x}function h(x,T,C){return x[0]=T[0]/C[0],x[1]=T[1]/C[1],x[2]=T[2]/C[2],x[3]=T[3]/C[3],x}function g(x,T){return Math.hypot(T[0]-x[0],T[1]-x[1],T[2]-x[2],T[3]-x[3])}function w(x,T){var C=T[0]-x[0],L=T[1]-x[1],k=T[2]-x[2],V=T[3]-x[3];return C*C+L*L+k*k+V*V}function A(x){return Math.hypot(x[0],x[1],x[2],x[3])}function p(x){var T=x[0],C=x[1],L=x[2],k=x[3];return T*T+C*C+L*L+k*k}Ei.sub=u,Ei.mul=a,Ei.div=h,Ei.dist=g,Ei.sqrDist=w,Ei.len=A,Ei.sqrLen=p;var b,E=(b=s(),function(x,T,C,L,k,V){var j,B;for(T||(T=4),C||(C=0),B=L?Math.min(L*T+C,x.length):x.length,j=C;j<B;j+=T)b[0]=x[j],b[1]=x[j+1],b[2]=x[j+2],b[3]=x[j+3],k(b,b,V),x[j]=b[0],x[j+1]=b[1],x[j+2]=b[2],x[j+3]=b[3];return x});return Ei.forEach=E,Ei}function tn(){if(bs)return li;function r(se){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(be){return typeof be}:function(be){return be&&typeof Symbol=="function"&&be.constructor===Symbol&&be!==Symbol.prototype?"symbol":typeof be},r(se)}bs=1,Object.defineProperty(li,"__esModule",{value:!0}),li.create=g,li.identity=function(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=1,se},li.setAxisAngle=w,li.getAxisAngle=function(se,be){var Me=2*Math.acos(be[3]),Ie=Math.sin(Me/2);return Ie>e.EPSILON?(se[0]=be[0]/Ie,se[1]=be[1]/Ie,se[2]=be[2]/Ie):(se[0]=1,se[1]=0,se[2]=0),Me},li.getAngle=function(se,be){var Me=C(se,be);return Math.acos(2*Me*Me-1)},li.multiply=A,li.rotateX=function(se,be,Me){Me*=.5;var Ie=be[0],Le=be[1],Ue=be[2],je=be[3],Fe=Math.sin(Me),tt=Math.cos(Me);return se[0]=Ie*tt+je*Fe,se[1]=Le*tt+Ue*Fe,se[2]=Ue*tt-Le*Fe,se[3]=je*tt-Ie*Fe,se},li.rotateY=function(se,be,Me){Me*=.5;var Ie=be[0],Le=be[1],Ue=be[2],je=be[3],Fe=Math.sin(Me),tt=Math.cos(Me);return se[0]=Ie*tt-Ue*Fe,se[1]=Le*tt+je*Fe,se[2]=Ue*tt+Ie*Fe,se[3]=je*tt-Le*Fe,se},li.rotateZ=function(se,be,Me){Me*=.5;var Ie=be[0],Le=be[1],Ue=be[2],je=be[3],Fe=Math.sin(Me),tt=Math.cos(Me);return se[0]=Ie*tt+Le*Fe,se[1]=Le*tt-Ie*Fe,se[2]=Ue*tt+je*Fe,se[3]=je*tt-Ue*Fe,se},li.calculateW=function(se,be){var Me=be[0],Ie=be[1],Le=be[2];return se[0]=Me,se[1]=Ie,se[2]=Le,se[3]=Math.sqrt(Math.abs(1-Me*Me-Ie*Ie-Le*Le)),se},li.exp=p,li.ln=b,li.pow=function(se,be,Me){return b(se,be),T(se,se,Me),p(se,se),se},li.slerp=E,li.random=function(se){var be=e.RANDOM(),Me=e.RANDOM(),Ie=e.RANDOM(),Le=Math.sqrt(1-be),Ue=Math.sqrt(be);return se[0]=Le*Math.sin(2*Math.PI*Me),se[1]=Le*Math.cos(2*Math.PI*Me),se[2]=Ue*Math.sin(2*Math.PI*Ie),se[3]=Ue*Math.cos(2*Math.PI*Ie),se},li.invert=function(se,be){var Me=be[0],Ie=be[1],Le=be[2],Ue=be[3],je=Me*Me+Ie*Ie+Le*Le+Ue*Ue,Fe=je?1/je:0;return se[0]=-Me*Fe,se[1]=-Ie*Fe,se[2]=-Le*Fe,se[3]=Ue*Fe,se},li.conjugate=function(se,be){return se[0]=-be[0],se[1]=-be[1],se[2]=-be[2],se[3]=be[3],se},li.fromMat3=x,li.fromEuler=function(se,be,Me,Ie){var Le=.5*Math.PI/180;be*=Le,Me*=Le,Ie*=Le;var Ue=Math.sin(be),je=Math.cos(be),Fe=Math.sin(Me),tt=Math.cos(Me),dt=Math.sin(Ie),Xe=Math.cos(Ie);return se[0]=Ue*tt*Xe-je*Fe*dt,se[1]=je*Fe*Xe+Ue*tt*dt,se[2]=je*tt*dt-Ue*Fe*Xe,se[3]=je*tt*Xe+Ue*Fe*dt,se},li.str=function(se){return"quat("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"},li.setAxes=li.sqlerp=li.rotationTo=li.equals=li.exactEquals=li.normalize=li.sqrLen=li.squaredLength=li.len=li.length=li.lerp=li.dot=li.scale=li.mul=li.add=li.set=li.copy=li.fromValues=li.clone=void 0;var e=h(Ke()),i=h(Ri()),s=h(vo()),u=h(zn());function a(se){if(typeof WeakMap!="function")return null;var be=new WeakMap,Me=new WeakMap;return(a=function(Ie){return Ie?Me:be})(se)}function h(se,be){if(se&&se.__esModule)return se;if(se===null||r(se)!=="object"&&typeof se!="function")return{default:se};var Me=a(be);if(Me&&Me.has(se))return Me.get(se);var Ie={},Le=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ue in se)if(Ue!=="default"&&Object.prototype.hasOwnProperty.call(se,Ue)){var je=Le?Object.getOwnPropertyDescriptor(se,Ue):null;je&&(je.get||je.set)?Object.defineProperty(Ie,Ue,je):Ie[Ue]=se[Ue]}return Ie.default=se,Me&&Me.set(se,Ie),Ie}function g(){var se=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0),se[3]=1,se}function w(se,be,Me){Me*=.5;var Ie=Math.sin(Me);return se[0]=Ie*be[0],se[1]=Ie*be[1],se[2]=Ie*be[2],se[3]=Math.cos(Me),se}function A(se,be,Me){var Ie=be[0],Le=be[1],Ue=be[2],je=be[3],Fe=Me[0],tt=Me[1],dt=Me[2],Xe=Me[3];return se[0]=Ie*Xe+je*Fe+Le*dt-Ue*tt,se[1]=Le*Xe+je*tt+Ue*Fe-Ie*dt,se[2]=Ue*Xe+je*dt+Ie*tt-Le*Fe,se[3]=je*Xe-Ie*Fe-Le*tt-Ue*dt,se}function p(se,be){var Me=be[0],Ie=be[1],Le=be[2],Ue=be[3],je=Math.sqrt(Me*Me+Ie*Ie+Le*Le),Fe=Math.exp(Ue),tt=je>0?Fe*Math.sin(je)/je:0;return se[0]=Me*tt,se[1]=Ie*tt,se[2]=Le*tt,se[3]=Fe*Math.cos(je),se}function b(se,be){var Me=be[0],Ie=be[1],Le=be[2],Ue=be[3],je=Math.sqrt(Me*Me+Ie*Ie+Le*Le),Fe=je>0?Math.atan2(je,Ue)/je:0;return se[0]=Me*Fe,se[1]=Ie*Fe,se[2]=Le*Fe,se[3]=.5*Math.log(Me*Me+Ie*Ie+Le*Le+Ue*Ue),se}function E(se,be,Me,Ie){var Le,Ue,je,Fe,tt,dt=be[0],Xe=be[1],Bt=be[2],Et=be[3],yt=Me[0],ut=Me[1],ni=Me[2],Ft=Me[3];return(Ue=dt*yt+Xe*ut+Bt*ni+Et*Ft)<0&&(Ue=-Ue,yt=-yt,ut=-ut,ni=-ni,Ft=-Ft),1-Ue>e.EPSILON?(Le=Math.acos(Ue),je=Math.sin(Le),Fe=Math.sin((1-Ie)*Le)/je,tt=Math.sin(Ie*Le)/je):(Fe=1-Ie,tt=Ie),se[0]=Fe*dt+tt*yt,se[1]=Fe*Xe+tt*ut,se[2]=Fe*Bt+tt*ni,se[3]=Fe*Et+tt*Ft,se}function x(se,be){var Me,Ie=be[0]+be[4]+be[8];if(Ie>0)Me=Math.sqrt(Ie+1),se[3]=.5*Me,se[0]=(be[5]-be[7])*(Me=.5/Me),se[1]=(be[6]-be[2])*Me,se[2]=(be[1]-be[3])*Me;else{var Le=0;be[4]>be[0]&&(Le=1),be[8]>be[3*Le+Le]&&(Le=2);var Ue=(Le+1)%3,je=(Le+2)%3;Me=Math.sqrt(be[3*Le+Le]-be[3*Ue+Ue]-be[3*je+je]+1),se[Le]=.5*Me,se[3]=(be[3*Ue+je]-be[3*je+Ue])*(Me=.5/Me),se[Ue]=(be[3*Ue+Le]+be[3*Le+Ue])*Me,se[je]=(be[3*je+Le]+be[3*Le+je])*Me}return se}li.clone=u.clone,li.fromValues=u.fromValues,li.copy=u.copy,li.set=u.set,li.add=u.add,li.mul=A;var T=u.scale;li.scale=T;var C=u.dot;li.dot=C,li.lerp=u.lerp;var L=u.length;li.length=L,li.len=L;var k=u.squaredLength;li.squaredLength=k,li.sqrLen=k;var V=u.normalize;li.normalize=V,li.exactEquals=u.exactEquals,li.equals=u.equals;var j,B,q,Z=(j=s.create(),B=s.fromValues(1,0,0),q=s.fromValues(0,1,0),function(se,be,Me){var Ie=s.dot(be,Me);return Ie<-.999999?(s.cross(j,B,be),s.len(j)<1e-6&&s.cross(j,q,be),s.normalize(j,j),w(se,j,Math.PI),se):Ie>.999999?(se[0]=0,se[1]=0,se[2]=0,se[3]=1,se):(s.cross(j,be,Me),se[0]=j[0],se[1]=j[1],se[2]=j[2],se[3]=1+Ie,V(se,se))});li.rotationTo=Z;var Q,ce,oe=(Q=g(),ce=g(),function(se,be,Me,Ie,Le,Ue){return E(Q,be,Le,Ue),E(ce,Me,Ie,Ue),E(se,Q,ce,2*Ue*(1-Ue)),se});li.sqlerp=oe;var ae,Se=(ae=i.create(),function(se,be,Me,Ie){return ae[0]=Me[0],ae[3]=Me[1],ae[6]=Me[2],ae[1]=Ie[0],ae[4]=Ie[1],ae[7]=Ie[2],ae[2]=-be[0],ae[5]=-be[1],ae[8]=-be[2],V(se,x(se,ae))});return li.setAxes=Se,li}var nn,_i={};function Kr(){if(nn)return _i;function r(E){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},r(E)}nn=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=function(){var E=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[4]=0,E[5]=0,E[6]=0,E[7]=0),E[3]=1,E},_i.clone=function(E){var x=new e.ARRAY_TYPE(8);return x[0]=E[0],x[1]=E[1],x[2]=E[2],x[3]=E[3],x[4]=E[4],x[5]=E[5],x[6]=E[6],x[7]=E[7],x},_i.fromValues=function(E,x,T,C,L,k,V,j){var B=new e.ARRAY_TYPE(8);return B[0]=E,B[1]=x,B[2]=T,B[3]=C,B[4]=L,B[5]=k,B[6]=V,B[7]=j,B},_i.fromRotationTranslationValues=function(E,x,T,C,L,k,V){var j=new e.ARRAY_TYPE(8);j[0]=E,j[1]=x,j[2]=T,j[3]=C;var B=.5*L,q=.5*k,Z=.5*V;return j[4]=B*C+q*T-Z*x,j[5]=q*C+Z*E-B*T,j[6]=Z*C+B*x-q*E,j[7]=-B*E-q*x-Z*T,j},_i.fromRotationTranslation=h,_i.fromTranslation=function(E,x){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=.5*x[0],E[5]=.5*x[1],E[6]=.5*x[2],E[7]=0,E},_i.fromRotation=function(E,x){return E[0]=x[0],E[1]=x[1],E[2]=x[2],E[3]=x[3],E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},_i.fromMat4=function(E,x){var T=i.create();s.getRotation(T,x);var C=new e.ARRAY_TYPE(3);return s.getTranslation(C,x),h(E,T,C),E},_i.copy=g,_i.identity=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},_i.set=function(E,x,T,C,L,k,V,j,B){return E[0]=x,E[1]=T,E[2]=C,E[3]=L,E[4]=k,E[5]=V,E[6]=j,E[7]=B,E},_i.getDual=function(E,x){return E[0]=x[4],E[1]=x[5],E[2]=x[6],E[3]=x[7],E},_i.setDual=function(E,x){return E[4]=x[0],E[5]=x[1],E[6]=x[2],E[7]=x[3],E},_i.getTranslation=function(E,x){var T=x[4],C=x[5],L=x[6],k=x[7],V=-x[0],j=-x[1],B=-x[2],q=x[3];return E[0]=2*(T*q+k*V+C*B-L*j),E[1]=2*(C*q+k*j+L*V-T*B),E[2]=2*(L*q+k*B+T*j-C*V),E},_i.translate=function(E,x,T){var C=x[0],L=x[1],k=x[2],V=x[3],j=.5*T[0],B=.5*T[1],q=.5*T[2],Z=x[4],Q=x[5],ce=x[6],oe=x[7];return E[0]=C,E[1]=L,E[2]=k,E[3]=V,E[4]=V*j+L*q-k*B+Z,E[5]=V*B+k*j-C*q+Q,E[6]=V*q+C*B-L*j+ce,E[7]=-C*j-L*B-k*q+oe,E},_i.rotateX=function(E,x,T){var C=-x[0],L=-x[1],k=-x[2],V=x[3],j=x[4],B=x[5],q=x[6],Z=x[7],Q=j*V+Z*C+B*k-q*L,ce=B*V+Z*L+q*C-j*k,oe=q*V+Z*k+j*L-B*C,ae=Z*V-j*C-B*L-q*k;return i.rotateX(E,x,T),E[4]=Q*(V=E[3])+ae*(C=E[0])+ce*(k=E[2])-oe*(L=E[1]),E[5]=ce*V+ae*L+oe*C-Q*k,E[6]=oe*V+ae*k+Q*L-ce*C,E[7]=ae*V-Q*C-ce*L-oe*k,E},_i.rotateY=function(E,x,T){var C=-x[0],L=-x[1],k=-x[2],V=x[3],j=x[4],B=x[5],q=x[6],Z=x[7],Q=j*V+Z*C+B*k-q*L,ce=B*V+Z*L+q*C-j*k,oe=q*V+Z*k+j*L-B*C,ae=Z*V-j*C-B*L-q*k;return i.rotateY(E,x,T),E[4]=Q*(V=E[3])+ae*(C=E[0])+ce*(k=E[2])-oe*(L=E[1]),E[5]=ce*V+ae*L+oe*C-Q*k,E[6]=oe*V+ae*k+Q*L-ce*C,E[7]=ae*V-Q*C-ce*L-oe*k,E},_i.rotateZ=function(E,x,T){var C=-x[0],L=-x[1],k=-x[2],V=x[3],j=x[4],B=x[5],q=x[6],Z=x[7],Q=j*V+Z*C+B*k-q*L,ce=B*V+Z*L+q*C-j*k,oe=q*V+Z*k+j*L-B*C,ae=Z*V-j*C-B*L-q*k;return i.rotateZ(E,x,T),E[4]=Q*(V=E[3])+ae*(C=E[0])+ce*(k=E[2])-oe*(L=E[1]),E[5]=ce*V+ae*L+oe*C-Q*k,E[6]=oe*V+ae*k+Q*L-ce*C,E[7]=ae*V-Q*C-ce*L-oe*k,E},_i.rotateByQuatAppend=function(E,x,T){var C=T[0],L=T[1],k=T[2],V=T[3],j=x[0],B=x[1],q=x[2],Z=x[3];return E[0]=j*V+Z*C+B*k-q*L,E[1]=B*V+Z*L+q*C-j*k,E[2]=q*V+Z*k+j*L-B*C,E[3]=Z*V-j*C-B*L-q*k,E[4]=(j=x[4])*V+(Z=x[7])*C+(B=x[5])*k-(q=x[6])*L,E[5]=B*V+Z*L+q*C-j*k,E[6]=q*V+Z*k+j*L-B*C,E[7]=Z*V-j*C-B*L-q*k,E},_i.rotateByQuatPrepend=function(E,x,T){var C=x[0],L=x[1],k=x[2],V=x[3],j=T[0],B=T[1],q=T[2],Z=T[3];return E[0]=C*Z+V*j+L*q-k*B,E[1]=L*Z+V*B+k*j-C*q,E[2]=k*Z+V*q+C*B-L*j,E[3]=V*Z-C*j-L*B-k*q,E[4]=C*(Z=T[7])+V*(j=T[4])+L*(q=T[6])-k*(B=T[5]),E[5]=L*Z+V*B+k*j-C*q,E[6]=k*Z+V*q+C*B-L*j,E[7]=V*Z-C*j-L*B-k*q,E},_i.rotateAroundAxis=function(E,x,T,C){if(Math.abs(C)<e.EPSILON)return g(E,x);var L=Math.hypot(T[0],T[1],T[2]);C*=.5;var k=Math.sin(C),V=k*T[0]/L,j=k*T[1]/L,B=k*T[2]/L,q=Math.cos(C),Z=x[0],Q=x[1],ce=x[2],oe=x[3];E[0]=Z*q+oe*V+Q*B-ce*j,E[1]=Q*q+oe*j+ce*V-Z*B,E[2]=ce*q+oe*B+Z*j-Q*V,E[3]=oe*q-Z*V-Q*j-ce*B;var ae=x[4],Se=x[5],se=x[6],be=x[7];return E[4]=ae*q+be*V+Se*B-se*j,E[5]=Se*q+be*j+se*V-ae*B,E[6]=se*q+be*B+ae*j-Se*V,E[7]=be*q-ae*V-Se*j-se*B,E},_i.add=function(E,x,T){return E[0]=x[0]+T[0],E[1]=x[1]+T[1],E[2]=x[2]+T[2],E[3]=x[3]+T[3],E[4]=x[4]+T[4],E[5]=x[5]+T[5],E[6]=x[6]+T[6],E[7]=x[7]+T[7],E},_i.multiply=w,_i.scale=function(E,x,T){return E[0]=x[0]*T,E[1]=x[1]*T,E[2]=x[2]*T,E[3]=x[3]*T,E[4]=x[4]*T,E[5]=x[5]*T,E[6]=x[6]*T,E[7]=x[7]*T,E},_i.lerp=function(E,x,T,C){var L=1-C;return A(x,T)<0&&(C=-C),E[0]=x[0]*L+T[0]*C,E[1]=x[1]*L+T[1]*C,E[2]=x[2]*L+T[2]*C,E[3]=x[3]*L+T[3]*C,E[4]=x[4]*L+T[4]*C,E[5]=x[5]*L+T[5]*C,E[6]=x[6]*L+T[6]*C,E[7]=x[7]*L+T[7]*C,E},_i.invert=function(E,x){var T=b(x);return E[0]=-x[0]/T,E[1]=-x[1]/T,E[2]=-x[2]/T,E[3]=x[3]/T,E[4]=-x[4]/T,E[5]=-x[5]/T,E[6]=-x[6]/T,E[7]=x[7]/T,E},_i.conjugate=function(E,x){return E[0]=-x[0],E[1]=-x[1],E[2]=-x[2],E[3]=x[3],E[4]=-x[4],E[5]=-x[5],E[6]=-x[6],E[7]=x[7],E},_i.normalize=function(E,x){var T=b(x);if(T>0){T=Math.sqrt(T);var C=x[0]/T,L=x[1]/T,k=x[2]/T,V=x[3]/T,j=x[4],B=x[5],q=x[6],Z=x[7],Q=C*j+L*B+k*q+V*Z;E[0]=C,E[1]=L,E[2]=k,E[3]=V,E[4]=(j-C*Q)/T,E[5]=(B-L*Q)/T,E[6]=(q-k*Q)/T,E[7]=(Z-V*Q)/T}return E},_i.str=function(E){return"quat2("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+")"},_i.exactEquals=function(E,x){return E[0]===x[0]&&E[1]===x[1]&&E[2]===x[2]&&E[3]===x[3]&&E[4]===x[4]&&E[5]===x[5]&&E[6]===x[6]&&E[7]===x[7]},_i.equals=function(E,x){var T=E[0],C=E[1],L=E[2],k=E[3],V=E[4],j=E[5],B=E[6],q=E[7],Z=x[0],Q=x[1],ce=x[2],oe=x[3],ae=x[4],Se=x[5],se=x[6],be=x[7];return Math.abs(T-Z)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Z))&&Math.abs(C-Q)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))&&Math.abs(L-ce)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(ce))&&Math.abs(k-oe)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(oe))&&Math.abs(V-ae)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ae))&&Math.abs(j-Se)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Se))&&Math.abs(B-se)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(se))&&Math.abs(q-be)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(be))},_i.sqrLen=_i.squaredLength=_i.len=_i.length=_i.dot=_i.mul=_i.setReal=_i.getReal=void 0;var e=a(Ke()),i=a(tn()),s=a(cr());function u(E){if(typeof WeakMap!="function")return null;var x=new WeakMap,T=new WeakMap;return(u=function(C){return C?T:x})(E)}function a(E,x){if(E&&E.__esModule)return E;if(E===null||r(E)!=="object"&&typeof E!="function")return{default:E};var T=u(x);if(T&&T.has(E))return T.get(E);var C={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in E)if(k!=="default"&&Object.prototype.hasOwnProperty.call(E,k)){var V=L?Object.getOwnPropertyDescriptor(E,k):null;V&&(V.get||V.set)?Object.defineProperty(C,k,V):C[k]=E[k]}return C.default=E,T&&T.set(E,C),C}function h(E,x,T){var C=.5*T[0],L=.5*T[1],k=.5*T[2],V=x[0],j=x[1],B=x[2],q=x[3];return E[0]=V,E[1]=j,E[2]=B,E[3]=q,E[4]=C*q+L*B-k*j,E[5]=L*q+k*V-C*B,E[6]=k*q+C*j-L*V,E[7]=-C*V-L*j-k*B,E}function g(E,x){return E[0]=x[0],E[1]=x[1],E[2]=x[2],E[3]=x[3],E[4]=x[4],E[5]=x[5],E[6]=x[6],E[7]=x[7],E}function w(E,x,T){var C=x[0],L=x[1],k=x[2],V=x[3],j=T[4],B=T[5],q=T[6],Z=T[7],Q=x[4],ce=x[5],oe=x[6],ae=x[7],Se=T[0],se=T[1],be=T[2],Me=T[3];return E[0]=C*Me+V*Se+L*be-k*se,E[1]=L*Me+V*se+k*Se-C*be,E[2]=k*Me+V*be+C*se-L*Se,E[3]=V*Me-C*Se-L*se-k*be,E[4]=C*Z+V*j+L*q-k*B+Q*Me+ae*Se+ce*be-oe*se,E[5]=L*Z+V*B+k*j-C*q+ce*Me+ae*se+oe*Se-Q*be,E[6]=k*Z+V*q+C*B-L*j+oe*Me+ae*be+Q*se-ce*Se,E[7]=V*Z-C*j-L*B-k*q+ae*Me-Q*Se-ce*se-oe*be,E}_i.getReal=i.copy,_i.setReal=i.copy,_i.mul=w;var A=i.dot;_i.dot=A;var p=i.length;_i.length=p,_i.len=p;var b=i.squaredLength;return _i.squaredLength=b,_i.sqrLen=b,_i}var ur,Pr,gi={};function ts(){if(ur)return gi;function r(x){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(x)}ur=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.create=s,gi.clone=function(x){var T=new e.ARRAY_TYPE(2);return T[0]=x[0],T[1]=x[1],T},gi.fromValues=function(x,T){var C=new e.ARRAY_TYPE(2);return C[0]=x,C[1]=T,C},gi.copy=function(x,T){return x[0]=T[0],x[1]=T[1],x},gi.set=function(x,T,C){return x[0]=T,x[1]=C,x},gi.add=function(x,T,C){return x[0]=T[0]+C[0],x[1]=T[1]+C[1],x},gi.subtract=u,gi.multiply=a,gi.divide=h,gi.ceil=function(x,T){return x[0]=Math.ceil(T[0]),x[1]=Math.ceil(T[1]),x},gi.floor=function(x,T){return x[0]=Math.floor(T[0]),x[1]=Math.floor(T[1]),x},gi.min=function(x,T,C){return x[0]=Math.min(T[0],C[0]),x[1]=Math.min(T[1],C[1]),x},gi.max=function(x,T,C){return x[0]=Math.max(T[0],C[0]),x[1]=Math.max(T[1],C[1]),x},gi.round=function(x,T){return x[0]=Math.round(T[0]),x[1]=Math.round(T[1]),x},gi.scale=function(x,T,C){return x[0]=T[0]*C,x[1]=T[1]*C,x},gi.scaleAndAdd=function(x,T,C,L){return x[0]=T[0]+C[0]*L,x[1]=T[1]+C[1]*L,x},gi.distance=g,gi.squaredDistance=w,gi.length=A,gi.squaredLength=p,gi.negate=function(x,T){return x[0]=-T[0],x[1]=-T[1],x},gi.inverse=function(x,T){return x[0]=1/T[0],x[1]=1/T[1],x},gi.normalize=function(x,T){var C=T[0],L=T[1],k=C*C+L*L;return k>0&&(k=1/Math.sqrt(k)),x[0]=T[0]*k,x[1]=T[1]*k,x},gi.dot=function(x,T){return x[0]*T[0]+x[1]*T[1]},gi.cross=function(x,T,C){var L=T[0]*C[1]-T[1]*C[0];return x[0]=x[1]=0,x[2]=L,x},gi.lerp=function(x,T,C,L){var k=T[0],V=T[1];return x[0]=k+L*(C[0]-k),x[1]=V+L*(C[1]-V),x},gi.random=function(x,T){T=T||1;var C=2*e.RANDOM()*Math.PI;return x[0]=Math.cos(C)*T,x[1]=Math.sin(C)*T,x},gi.transformMat2=function(x,T,C){var L=T[0],k=T[1];return x[0]=C[0]*L+C[2]*k,x[1]=C[1]*L+C[3]*k,x},gi.transformMat2d=function(x,T,C){var L=T[0],k=T[1];return x[0]=C[0]*L+C[2]*k+C[4],x[1]=C[1]*L+C[3]*k+C[5],x},gi.transformMat3=function(x,T,C){var L=T[0],k=T[1];return x[0]=C[0]*L+C[3]*k+C[6],x[1]=C[1]*L+C[4]*k+C[7],x},gi.transformMat4=function(x,T,C){var L=T[0],k=T[1];return x[0]=C[0]*L+C[4]*k+C[12],x[1]=C[1]*L+C[5]*k+C[13],x},gi.rotate=function(x,T,C,L){var k=T[0]-C[0],V=T[1]-C[1],j=Math.sin(L),B=Math.cos(L);return x[0]=k*B-V*j+C[0],x[1]=k*j+V*B+C[1],x},gi.angle=function(x,T){var C=x[0],L=x[1],k=T[0],V=T[1],j=Math.sqrt(C*C+L*L)*Math.sqrt(k*k+V*V);return Math.acos(Math.min(Math.max(j&&(C*k+L*V)/j,-1),1))},gi.zero=function(x){return x[0]=0,x[1]=0,x},gi.str=function(x){return"vec2("+x[0]+", "+x[1]+")"},gi.exactEquals=function(x,T){return x[0]===T[0]&&x[1]===T[1]},gi.equals=function(x,T){var C=x[0],L=x[1],k=T[0],V=T[1];return Math.abs(C-k)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(L-V)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(V))},gi.forEach=gi.sqrLen=gi.sqrDist=gi.dist=gi.div=gi.mul=gi.sub=gi.len=void 0;var e=function(x,T){if(x&&x.__esModule)return x;if(x===null||r(x)!=="object"&&typeof x!="function")return{default:x};var C=i(void 0);if(C&&C.has(x))return C.get(x);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in x)if(V!=="default"&&Object.prototype.hasOwnProperty.call(x,V)){var j=k?Object.getOwnPropertyDescriptor(x,V):null;j&&(j.get||j.set)?Object.defineProperty(L,V,j):L[V]=x[V]}return L.default=x,C&&C.set(x,L),L}(Ke());function i(x){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(i=function(L){return L?C:T})(x)}function s(){var x=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(x[0]=0,x[1]=0),x}function u(x,T,C){return x[0]=T[0]-C[0],x[1]=T[1]-C[1],x}function a(x,T,C){return x[0]=T[0]*C[0],x[1]=T[1]*C[1],x}function h(x,T,C){return x[0]=T[0]/C[0],x[1]=T[1]/C[1],x}function g(x,T){return Math.hypot(T[0]-x[0],T[1]-x[1])}function w(x,T){var C=T[0]-x[0],L=T[1]-x[1];return C*C+L*L}function A(x){return Math.hypot(x[0],x[1])}function p(x){var T=x[0],C=x[1];return T*T+C*C}gi.len=A,gi.sub=u,gi.mul=a,gi.div=h,gi.dist=g,gi.sqrDist=w,gi.sqrLen=p;var b,E=(b=s(),function(x,T,C,L,k,V){var j,B;for(T||(T=2),C||(C=0),B=L?Math.min(L*T+C,x.length):x.length,j=C;j<B;j+=T)b[0]=x[j],b[1]=x[j+1],k(b,b,V),x[j]=b[0],x[j+1]=b[1];return x});return gi.forEach=E,gi}function Rr(){if(Pr)return xe;function r(x){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(x)}Pr=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.vec4=xe.vec3=xe.vec2=xe.quat2=xe.quat=xe.mat4=xe.mat3=xe.mat2d=xe.mat2=xe.glMatrix=void 0;var e=E(Ke());xe.glMatrix=e;var i=E(It());xe.mat2=i;var s=E(Dt());xe.mat2d=s;var u=E(Ri());xe.mat3=u;var a=E(cr());xe.mat4=a;var h=E(tn());xe.quat=h;var g=E(Kr());xe.quat2=g;var w=E(ts());xe.vec2=w;var A=E(vo());xe.vec3=A;var p=E(zn());function b(x){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(b=function(L){return L?C:T})(x)}function E(x,T){if(x&&x.__esModule)return x;if(x===null||r(x)!=="object"&&typeof x!="function")return{default:x};var C=b(T);if(C&&C.has(x))return C.get(x);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in x)if(V!=="default"&&Object.prototype.hasOwnProperty.call(x,V)){var j=k?Object.getOwnPropertyDescriptor(x,V):null;j&&(j.get||j.set)?Object.defineProperty(L,V,j):L[V]=x[V]}return L.default=x,C&&C.set(x,L),L}return xe.vec4=p,xe}var Qn,Mt,si,ii,ye=Rr(),sn=function(){if(Mt)return Qn;function r(e,i,s,u){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=u}return Mt=1,Qn=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,u=0;u<8;u++){var a=this.sampleCurveX(s)-e;if(Math.abs(a)<i)return s;var h=this.sampleCurveDerivativeX(s);if(Math.abs(h)<1e-6)break;s-=a/h}var g=0,w=1;for(s=e,u=0;u<20&&(a=this.sampleCurveX(s),!(Math.abs(a-e)<i));u++)e>a?g=s:w=s,s=.5*(w-g)+g;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Qn}(),Cn=ue(sn);function De(){if(ii)return si;function r(e,i){this.x=e,this.y=i}return ii=1,si=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),s=Math.sin(e),u=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=u,this},_rotateAround:function(e,i){var s=Math.cos(e),u=Math.sin(e),a=i.y+u*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-u*(this.y-i.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},si}var he=ue(De());function ct(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!ct(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!ct(r[i],e[i]))return!1;return!0}return r===e}const Ct=Math.PI/180,xt=180/Math.PI;function pt(r){return r*Ct}function Xt(r){return r*xt}const Zt=[[0,0],[1,0],[1,1],[0,1]];function $t(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Nt(r,e,i,s){const u=new Cn(r,e,i,s);return function(a){return u.solve(a)}}const Mi=Nt(.25,.1,.25,1);function vt(r,e,i){return Math.min(i,Math.max(e,r))}function xi(r,e,i){return(i=vt((i-r)/(e-r),0,1))*i*(3-2*i)}function Di(r,e,i){const s=i-e,u=((r-e)%s+s)%s+e;return u===e?i:u}function Hi(r,e,i){if(!r.length)return i(null,[]);let s=r.length;const u=new Array(r.length);let a=null;r.forEach((h,g)=>{e(h,(w,A)=>{w&&(a=w),u[g]=A,--s==0&&i(a,u)})})}function $i(r,...e){for(const i of e)for(const s in i)r[s]=i[s];return r}let Yi=1;function Dr(){return Yi++}function mr(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function jr(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function hr(r,e){return r.indexOf(e,r.length-e.length)!==-1}function bo(r,e,i){const s={};for(const u in r)s[u]=e.call(this,r[u],u,r);return s}function ws(r,e,i){const s={};for(const u in r)e.call(this,r[u],u,r)&&(s[u]=r[u]);return s}function er(r){return Array.isArray(r)?r.map(er):typeof r=="object"&&r?bo(r,er):r}const io={};function ji(r){io[r]||(typeof console<"u"&&console.warn(r),io[r]=!0)}function Zs(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function th(r){let e=0;for(let i,s,u=0,a=r.length,h=a-1;u<a;h=u++)i=r[u],s=r[h],e+=(s.x-i.x)*(i.y+s.y);return e}function Do([r,e,i]){const s=pt(e+90),u=pt(i);return{x:r*Math.cos(s)*Math.sin(u),y:r*Math.sin(s)*Math.sin(u),z:r*Math.cos(u),azimuthal:e,polar:i}}function Ua(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zc(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,a)=>{const h=u||a;return e[s]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Xc=null;function Jl(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Yc(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<s?e=u+1:i=u}return e}function Ze(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<=s?e=u+1:i=u}return e}function J(r){return r>0?1/(1.001-r):1+r}function ie(r){return r>0?1-1/(1.001-r):-r}const pe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!pe.API_URL)return null;try{const r=new URL(pe.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Pe(r){return pe.API_URL_REGEX.test(r)}function we(r){return pe.API_SPRITE_REGEX.test(r)}let ze,He,Be,We,Je,Qe;function gt(){return ze==null&&(ze=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ze}const Lt={now:()=>We!==void 0?We:performance.now(),setNow(r){We=r},restoreNow(){We=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:s}=r;Je||(Je=document.createElement("canvas"));const u=Je.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Je.width||s>Je.height)&&(Je.width=i,Je.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(r,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(He||(He=document.createElement("a")),He.href=r,He.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Be==null&&(Be=window.matchMedia("(prefers-reduced-motion: reduce)")),Be.matches)},hasCanvasFingerprintNoise(){if(Qe!==void 0)return Qe;if(!gt())return Qe=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<r.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const s=e.getImageData(0,0,r.width,r.height);i=0;for(let u=0;u<s.data.length;++u)if(u%4!=3&&i++!==s.data[u])return Qe=!0,!0;return Qe=!1,!1}};function Ht(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(r.slice(i));for(const u in e)s.set(u,e[u]);return`${r.slice(0,i)}?${s.toString()}`}function fi(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const s=new URLSearchParams,u=new URLSearchParams(r.slice(i));for(const h of e.persistentParams){const g=u.get(h);g&&s.set(h,g)}const a=s.toString();return`${r.slice(0,i)}${a.length>0?`?${a}`:""}`}const wi="mapbox-tiles";let Ti=500,yi=50;const pn=["language","worldview","jobid"];let rn,Li;function mn(){try{return caches}catch{}}function jn(){const r=mn();r&&rn==null&&(rn=r.open(wi))}let _r=1/0;const no={supported:!1,testSupport:function(r){!pa&&ro&&(Ts?ih(r):wr=r)}};let wr,ro,pa=!1,Ts=!1;const Kc=typeof self<"u"?self:{};function ih(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ro),r.isContextLost())return;no.supported=!0}catch{}r.deleteTexture(e),pa=!0}Kc.document&&(ro=Kc.document.createElement("img"),ro.onload=function(){wr&&ih(wr),wr=null,Ts=!0},ro.onerror=function(){pa=!0,wr=null},ro.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(nh);class pf extends Error{constructor(e,i,s){i===401&&Pe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const mf=Ua()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ul=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(mf())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,u){const a=new AbortController,h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:mf(),referrerPolicy:s.referrerPolicy,signal:a.signal});let g=!1,w=!1;const A=(p=h.url).indexOf("sku=")>0&&Pe(p);var p;s.type==="json"&&h.headers.set("Accept","application/json");const b=(x,T,C)=>{if(w)return;if(x&&x.message!=="SecurityError"&&ji(x.toString()),T&&C)return E(T);const L=Date.now();fetch(h).then(k=>{if(k.ok){const V=A?k.clone():null;return E(k,V,L)}return u(new pf(k.statusText,k.status,s.url))}).catch(k=>{k.name!=="AbortError"&&u(new Error(`${k.message} ${s.url}`))})},E=(x,T,C)=>{(s.type==="arrayBuffer"?x.arrayBuffer():s.type==="json"?x.json():x.text()).then(L=>{w||(T&&C&&function(k,V,j){if(jn(),rn==null)return;const B=Zc(V.headers.get("Cache-Control")||"");if(B["no-store"])return;const q={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((ce,oe)=>q.headers.set(oe,ce)),B["max-age"]&&q.headers.set("Expires",new Date(j+1e3*B["max-age"]).toUTCString());const Z=q.headers.get("Expires");if(!Z||new Date(Z).getTime()-j<42e4)return;let Q=fi(k.url,{persistentParams:pn});if(V.status===206){const ce=k.headers.get("Range");if(!ce)return;q.status=200,Q=Ht(Q,{range:ce})}(function(ce,oe){if(Li===void 0)try{new Response(new ReadableStream),Li=!0}catch{Li=!1}Li?oe(ce.body):ce.blob().then(oe)})(V,ce=>{const oe=new Response((ae=V.status)!==200&&ae!==404&&[101,103,204,205,304].includes(ae)?null:ce,q);var ae;jn(),rn!=null&&rn.then(Se=>Se.put(Q,oe)).catch(Se=>ji(Se.message))})}(h,T,C),g=!0,u(null,L,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(L=>{w||u(new Error(L.message))})};return A?function(x,T){if(jn(),rn==null)return T(null);rn.then(C=>{let L=fi(x.url,{persistentParams:pn});const k=x.headers.get("Range");k&&(L=Ht(L,{range:k})),C.match(L).then(V=>{const j=function(B){if(!B)return!1;const q=new Date(B.headers.get("Expires")||0),Z=Zc(B.headers.get("Cache-Control")||"");return q>Date.now()&&!Z["no-cache"]}(V);C.delete(L),j&&C.put(L,V.clone()),T(null,V,j)}).catch(T)}).catch(T)}(h,b):b(null,null),{cancel:()=>{w=!0,g||a.abort()}}}(r,e);if(Ua()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(s,u){const a=new XMLHttpRequest;a.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(a.responseType="arraybuffer");for(const h in s.headers)a.setRequestHeader(h,s.headers[h]);return s.type==="json"&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials=s.credentials==="include",a.onerror=()=>{u(new Error(a.statusText))},a.onload=()=>{if((a.status>=200&&a.status<300||a.status===0)&&a.response!==null){let h=a.response;if(s.type==="json")try{h=JSON.parse(a.response)}catch(g){return u(g)}u(null,h,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else u(new pf(a.statusText,a.status,s.url))},a.send(s.body),{cancel:()=>a.abort()}}(r,e)},hl=function(r,e){return ul($i(r,{type:"arrayBuffer"}),e)};function Uo(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Vo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ss,wo;Ss=[],wo=0;const jo=function(r,e){if(no.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),wo>=pe.MAX_PARALLEL_IMAGE_REQUESTS){const a={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ss.push(a),a}wo++;let i=!1;const s=()=>{if(!i)for(i=!0,wo--;Ss.length&&wo<pe.MAX_PARALLEL_IMAGE_REQUESTS;){const a=Ss.shift(),{requestParameters:h,callback:g,cancelled:w}=a;w||(a.cancel=jo(h,g).cancel)}},u=hl(r,(a,h,g,w)=>{s(),a?e(a):h&&(self.createImageBitmap?function(A,p){const b=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(b).then(E=>{p(null,E)}).catch(E=>{p(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(A,p)=>e(A,p,g,w)):function(A,p){const b=new Image;b.onload=()=>{p(null,b),URL.revokeObjectURL(b.src),b.onload=null,requestAnimationFrame(()=>{b.src=Vo})},b.onerror=()=>p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const E=new Blob([new Uint8Array(A)],{type:"image/png"});b.src=A.byteLength?URL.createObjectURL(E):Vo}(h,(A,p)=>e(A,p,g,w)))});return{cancel:()=>{u.cancel(),s()}}};var Ql,_f,rh,Es={exports:{}},ec={exports:{}},Wd={exports:{}},Zd=function(){if(rh)return Es.exports;rh=1;var r=(Ql||(Ql=1,ec.exports=function(i,s){var u,a,h,g,w,A,p,b;for(a=i.length-(u=3&i.length),h=s,w=3432918353,A=461845907,b=0;b<a;)p=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24,++b,h=27492+(65535&(g=5*(65535&(h=(h^=p=(65535&(p=(p=(65535&p)*w+(((p>>>16)*w&65535)<<16)&4294967295)<<15|p>>>17))*A+(((p>>>16)*A&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(p=0,u){case 3:p^=(255&i.charCodeAt(b+2))<<16;case 2:p^=(255&i.charCodeAt(b+1))<<8;case 1:h^=p=(65535&(p=(p=(65535&(p^=255&i.charCodeAt(b)))*w+(((p>>>16)*w&65535)<<16)&4294967295)<<15|p>>>17))*A+(((p>>>16)*A&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),ec.exports),e=(_f||(_f=1,Wd.exports=function(i,s){for(var u,a=i.length,h=s^a,g=0;a>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(u>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&i.charCodeAt(g+2))<<16;case 2:h^=(255&i.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),Wd.exports);return Es.exports=r,Es.exports.murmur3=r,Es.exports.murmur2=e,Es.exports}(),ho=ue(Zd);class Xs{constructor(e,...i){$i(this,i[0]||{}),this.type=e}}class Ys extends Xs{constructor(e,i={}){super("error",$i({error:e},i))}}function fl(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function oh(r,e,i){if(i&&i[r]){const s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class tc{on(e,i){return this._listeners=this._listeners||{},fl(e,i,this._listeners),this}off(e,i){return oh(e,i,this._listeners),oh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},fl(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){const s=typeof e=="string"?new Xs(e,i):e,u=s.type;if(this.listens(u)){s.target=this;const a=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of a)w.call(this,s);const h=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of h)oh(u,w,this._oneTimeListeners),w.call(this,s);const g=this._eventedParent;g&&($i(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(s))}else s instanceof Ys&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var sh,Ki={},ah=function(){if(sh)return Ki;sh=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(a){return(a=Math.round(a))<0?0:a>255?255:a}function i(a){return e(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function s(a){return(h=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:h>1?1:h;var h}function u(a,h,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?a+(h-a)*g*6:2*g<1?h:3*g<2?a+(h-a)*(2/3-g)*6:a}try{Ki.parseCSSColor=function(a){var h,g=a.replace(/ /g,"").toLowerCase();if(g in r)return r[g].slice();if(g[0]==="#")return g.length===4?(h=parseInt(g.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:g.length===7&&(h=parseInt(g.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var w=g.indexOf("("),A=g.indexOf(")");if(w!==-1&&A+1===g.length){var p=g.substr(0,w),b=g.substr(w+1,A-(w+1)).split(","),E=1;switch(p){case"rgba":if(b.length!==4)return null;E=s(b.pop());case"rgb":return b.length!==3?null:[i(b[0]),i(b[1]),i(b[2]),E];case"hsla":if(b.length!==4)return null;E=s(b.pop());case"hsl":if(b.length!==3)return null;var x=(parseFloat(b[0])%360+360)%360/360,T=s(b[1]),C=s(b[2]),L=C<=.5?C*(T+1):C+T-C*T,k=2*C-L;return[e(255*u(k,L,x+1/3)),e(255*u(k,L,x)),e(255*u(k,L,x-1/3)),E];default:return null}}return null}}catch{}return Ki}();class _n{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof _n)return e;if(typeof e!="string")return;const i=ah.parseCSSColor(e);return i?new _n(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${u})`}toRenderColor(e){const{r:i,g:s,b:u,a}=this;return new lm(e,i,s,u,a)}}class lm{constructor(e,i,s,u,a){if(e){const h=e.image.height,g=h*h;i=a===0?0:i/a*(h-1),s=a===0?0:s/a*(h-1),u=a===0?0:u/a*(h-1);const w=Math.floor(i),A=Math.floor(s),p=Math.floor(u),b=Math.ceil(i),E=Math.ceil(s),x=Math.ceil(u),T=i-w,C=s-A,L=u-p,k=e.image.data,V=4*(w+A*g+p*h),j=4*(w+A*g+x*h),B=4*(w+E*g+p*h),q=4*(w+E*g+x*h),Z=4*(b+A*g+p*h),Q=4*(b+A*g+x*h),ce=4*(b+E*g+p*h),oe=4*(b+E*g+x*h);if(V<0||oe>=k.length)throw new Error("out of range");this.r=hi(hi(hi(k[V],k[j],L),hi(k[B],k[q],L),C),hi(hi(k[Z],k[Q],L),hi(k[ce],k[oe],L),C),T)/255*a,this.g=hi(hi(hi(k[V+1],k[j+1],L),hi(k[B+1],k[q+1],L),C),hi(hi(k[Z+1],k[Q+1],L),hi(k[ce+1],k[oe+1],L),C),T)/255*a,this.b=hi(hi(hi(k[V+2],k[j+2],L),hi(k[B+2],k[q+2],L),C),hi(hi(k[Z+2],k[Q+2],L),hi(k[ce+2],k[oe+2],L),C),T)/255*a,this.a=a}else this.r=i,this.g=s,this.b=u,this.a=a}toArray(){const{r:e,g:i,b:s,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*s/u,u]}toArray01(){const{r:e,g:i,b:s,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,s/u,u]}toArray01Scaled(e){const{r:i,g:s,b:u,a}=this;return a===0?[0,0,0]:[i/a*e,s/a*e,u/a*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:u}=this;return[e,i,s,u]}toArray01Linear(){const{r:e,g:i,b:s,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(i/u,2.2),Math.pow(s/u,2.2),u]}}function hi(r,e,i){return r*(1-i)+e*i}function Jc(r,e,i){return r.map((s,u)=>hi(s,e[u],i))}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1),_n.blue=new _n(0,0,1,1);var Va=Object.freeze({__proto__:null,array:Jc,color:function(r,e,i){return new _n(hi(r.r,e.r,i),hi(r.g,e.g,i),hi(r.b,e.b,i),hi(r.a,e.a,i))},number:hi});function ic(r,...e){for(const i of e)for(const s in i)r[s]=i[s];return r}class As extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class lh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new lh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ms={kind:"null"},Gt={kind:"number"},Wi={kind:"string"},Zi={kind:"boolean"},Lo={kind:"color"},fo={kind:"object"},Ji={kind:"value"},tr={kind:"collator"},Hn={kind:"formatted"},nc={kind:"resolvedImage"};function To(r,e){return{kind:"array",itemType:r,N:e}}function fr(r){if(r.kind==="array"){const e=fr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Xd=[Ms,Gt,Wi,Zi,Lo,Hn,fo,To(Ji),nc];function rc(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!rc(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Xd)if(!rc(i,e))return null}}return`Expected ${fr(r)} but found ${fr(e)} instead.`}function oc(r,e){return e.some(i=>i.kind===r.kind)}function Is(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}class ch{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yn{constructor(e,i,s,u,a){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=a}}class oo{constructor(e){this.sections=e}static fromString(e){return new oo([new Yn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof oo?e:oo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class Lr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Lr({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function gf(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ks(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof _n||r instanceof ch||r instanceof oo||r instanceof Lr)return!0;if(Array.isArray(r)){for(const e of r)if(!Ks(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ks(r[e]))return!1;return!0}return!1}function On(r){if(r===null)return Ms;if(typeof r=="string")return Wi;if(typeof r=="boolean")return Zi;if(typeof r=="number")return Gt;if(r instanceof _n)return Lo;if(r instanceof ch)return tr;if(r instanceof oo)return Hn;if(r instanceof Lr)return nc;if(Array.isArray(r)){const e=r.length;let i;for(const s of r){const u=On(s);if(i){if(i===u)continue;i=Ji;break}i=u}return To(i||Ji,e)}return fo}function po(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof _n||r instanceof oo||r instanceof Lr?r.toString():JSON.stringify(r)}class is{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ks(e[1]))return i.error("invalid value");const s=e[1];let u=On(s);const a=i.expectedType;return u.kind!=="array"||u.N!==0||!a||a.kind!=="array"||typeof a.N=="number"&&a.N!==0||(u=a),new is(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _n?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof oo?this.value.serialize():this.value}}class zr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const uh={string:Wi,number:Gt,boolean:Zi,object:fo};class ns{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const a=e[0];if(a==="array"){let g,w;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in uh)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=uh[A],u++}else g=Ji;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}s=To(g,w)}else s=uh[a];const h=[];for(;u<e.length;u++){const g=i.parse(e[u],u,Ji);if(!g)return null;h.push(g)}return new ns(s,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!rc(this.type,On(s)))return s;if(i===this.args.length-1)throw new zr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${fr(On(s))} but was expected to be of type ${fr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}class dl{constructor(e){this.type=Hn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const u=[];let a=!1;for(let h=1;h<=e.length-1;++h){const g=e[h];if(a&&typeof g=="object"&&!Array.isArray(g)){a=!1;let w=null;if(g["font-scale"]&&(w=i.parseObjectValue(g["font-scale"],h,"font-scale",Gt),!w))return null;let A=null;if(g["text-font"]&&(A=i.parseObjectValue(g["text-font"],h,"text-font",To(Wi)),!A))return null;let p=null;if(g["text-color"]&&(p=i.parseObjectValue(g["text-color"],h,"text-color",Lo),!p))return null;const b=u[u.length-1];b.scale=w,b.font=A,b.textColor=p}else{const w=i.parse(e[h],h,Ji);if(!w)return null;const A=w.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new dl(u)}evaluate(e){return new oo(this.sections.map(i=>{const s=i.content.evaluate(e);return On(s)===nc?new Yn("",s,null,null,null):new Yn(po(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Jr{constructor(e,i){this.type=nc,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const s=i.parse(e[1],1,Wi);if(!s)return i.error("No image name provided.");if(e.length===2)return new Jr(s);const u=i.parse(e[2],1,Wi);return u?new Jr(s,u):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Lr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function pl(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const So={"to-boolean":Zi,"to-color":Lo,"to-number":Gt,"to-string":Wi};class ma{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],u=[];let a=Ms;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);a=To(i.expectedType.itemType,h)}else{if(!(h>0&&Ks(e[1][0])))return null;a=To(On(e[1][0]),h)}for(let g=0;g<h;g++){const w=e[1][g];let A;if(pl(w)==="array")A=i.parse(w,void 0,a.itemType);else{const p=pl(w);if(p!==a.itemType.kind)return i.error(`Expected ${a.itemType.kind} but found ${p}.`);A=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!A)return null;u.push(A)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");a=So[s];for(let h=1;h<e.length;h++){const g=i.parse(e[h],h,Ji);if(!g)return null;u.push(g)}}return new ma(a,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof _n)return i;if(typeof i=="string"){const a=e.parseColor(i);if(a)return a}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:gf(i[0],i[1],i[2],i[3]),!s))return new _n(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new zr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new zr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?oo.fromString(po(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Lr.fromString(po(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):po(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Yd=["Unknown","Point","LineString","Polygon"];class _a{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=_n.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class co{constructor(e,i,s,u,a){this.name=e,this.type=i,this._evaluate=s,this.args=u,this._overloadIndex=a}evaluate(e){if(!this._evaluate){const i=co.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],u=co.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(u)?u[0]:u.type,h=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,g=[];let w=null,A=-1;for(const[p,b]of h){if(Array.isArray(p)&&p.length!==e.length-1)continue;g.push(p),A++,w=new Qd(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const E=[];let x=!1;for(let T=1;T<e.length;T++){const C=e[T],L=Array.isArray(p)?p[T-1]:p.type,k=w.parse(C,1+E.length,L);if(!k){x=!0;break}E.push(k)}if(!x)if(Array.isArray(p)&&p.length!==E.length)w.error(`Expected ${p.length} arguments, but found ${E.length} instead.`);else{for(let T=0;T<E.length;T++){const C=Array.isArray(p)?p[T]:p.type,L=E[T];w.concat(T+1).checkSubtype(C,L.type)}if(w.errors.length===0)return new co(s,a,b,E,A)}}if(g.length===1)i.errors.push(...w.errors);else{const p=(g.length?g:h.map(([E])=>E)).map(yf).join(" | "),b=[];for(let E=1;E<e.length;E++){const x=i.parse(e[E],1+b.length);if(!x)return null;b.push(fr(x.type))}i.error(`Expected arguments of type ${p}, but found (${b.join(", ")}) instead.`)}return null}static register(e,i){co.definitions=i;for(const s in i)e[s]=co}}function yf(r){return Array.isArray(r)?`(${r.map(fr).join(", ")})`:`(${fr(r.type)}...)`}class ir{constructor(e,i,s){this.type=tr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=s["case-sensitive"]===void 0?i.parse(!1,1,Zi):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Zi);if(!u)return null;const a=s["diacritic-sensitive"]===void 0?i.parse(!1,1,Zi):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Zi);if(!a)return null;let h=null;return s.locale&&(h=i.parseObjectValue(s.locale,1,"locale",Wi),!h)?null:new ir(u,a,h)}evaluate(e){return new ch(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ga(r,e,i=0,s=r.length-1,u=sc){for(;s>i;){if(s-i>600){const w=s-i+1,A=e-i+1,p=Math.log(w),b=.5*Math.exp(2*p/3),E=.5*Math.sqrt(p*b*(w-b)/w)*(A-w/2<0?-1:1);ga(r,e,Math.max(i,Math.floor(e-A*b/w+E)),Math.min(s,Math.floor(e+(w-A)*b/w+E)),u)}const a=r[e];let h=i,g=s;for(ja(r,i,e),u(r[s],a)>0&&ja(r,i,s);h<g;){for(ja(r,h,g),h++,g--;u(r[h],a)<0;)h++;for(;u(r[g],a)>0;)g--}u(r[i],a)===0?ja(r,i,g):(g++,ja(r,g,s)),g<=e&&(i=g+1),e<=g&&(s=g-1)}}function ja(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function sc(r,e){return r<e?-1:r>e?1:0}function xf(r){let e=0;for(let i,s,u=0,a=r.length,h=a-1;u<a;h=u++)i=r[u],s=r[h],e+=(s.x-i.x)*(i.y+s.y);return e}function Qc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ml(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function cm(r,e,i){const s=r[0]-e[0],u=r[1]-e[1],a=r[0]-i[0],h=r[1]-i[1];return s*h-a*u==0&&s*a<=0&&u*h<=0}function _l(r,e,i=!1){let s=!1;for(let g=0,w=e.length;g<w;g++){const A=e[g];for(let p=0,b=A.length,E=b-1;p<b;E=p++){const x=A[E],T=A[p];if(cm(r,x,T))return i;(a=x)[1]>(u=r)[1]!=(h=T)[1]>u[1]&&u[0]<(h[0]-a[0])*(u[1]-a[1])/(h[1]-a[1])+a[0]&&(s=!s)}}var u,a,h;return s}function eu(r,e,i,s){const u=s[0]-i[0],a=s[1]-i[1],h=(r[0]-i[0])*a-u*(r[1]-i[1]),g=(e[0]-i[0])*a-u*(e[1]-i[1]);return h>0&&g<0||h<0&&g>0}function ya(r,e,i,s){return(u=[s[0]-i[0],s[1]-i[1]])[0]*(a=[e[0]-r[0],e[1]-r[1]])[1]-u[1]*a[0]!=0&&!(!eu(r,e,i,s)||!eu(i,s,r,e));var u,a}const Go=8192;function Oi(r,e){const i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Go),Math.round(s*u*Go)]}function oi(r,e){for(let i=0;i<e.length;i++)if(_l(r,e[i]))return!0;return!1}function tu(r,e,i){for(const s of i)for(let u=0,a=s.length,h=a-1;u<a;h=u++)if(ya(r,e,s[h],s[u]))return!0;return!1}function vi(r,e){for(let i=0;i<r.length;++i)if(!_l(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(tu(r[i],r[i+1],e))return!1;return!0}function hh(r,e){for(let i=0;i<e.length;i++)if(vi(r,e[i]))return!0;return!1}function iu(r,e,i){const s=[];for(let u=0;u<r.length;u++){const a=[];for(let h=0;h<r[u].length;h++){const g=Oi(r[u][h],i);Qc(e,g),a.push(g)}s.push(a)}return s}function di(r,e,i){const s=[];for(let u=0;u<r.length;u++){const a=iu(r[u],e,i);s.push(a)}return s}function nu(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){const u=.5*s;let a=r[0]-i[0]>u?-s:i[0]-r[0]>u?s:0;a===0&&(a=r[0]-i[2]>u?-s:i[2]-r[0]>u?s:0),r[0]+=a}Qc(e,r)}function fh(r,e,i,s){const u=Math.pow(2,s.z)*Go,a=[s.x*Go,s.y*Go],h=[];if(!r)return h;for(const g of r)for(const w of g){const A=[w.x+a[0],w.y+a[1]];nu(A,e,i,u),h.push(A)}return h}function dh(r,e,i,s){const u=Math.pow(2,s.z)*Go,a=[s.x*Go,s.y*Go],h=[];if(!r)return h;for(const w of r){const A=[];for(const p of w){const b=[p.x+a[0],p.y+a[1]];Qc(e,b),A.push(b)}h.push(A)}if(e[2]-e[0]<=u/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const w of h)for(const A of w)nu(A,e,i,u)}var g;return h}class Gr{constructor(e,i){this.type=Zi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ks(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const a=s.features[u].geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Gr(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Gr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Gr(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const u=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const g=iu(s.coordinates,a,h),w=fh(i.geometry(),u,a,h);if(!ml(u,a))return!1;for(const A of w)if(!_l(A,g))return!1}if(s.type==="MultiPolygon"){const g=di(s.coordinates,a,h),w=fh(i.geometry(),u,a,h);if(!ml(u,a))return!1;for(const A of w)if(!oi(A,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const u=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const g=iu(s.coordinates,a,h),w=dh(i.geometry(),u,a,h);if(!ml(u,a))return!1;for(const A of w)if(!vi(A,g))return!1}if(s.type==="MultiPolygon"){const g=di(s.coordinates,a,h),w=dh(i.geometry(),u,a,h);if(!ml(u,a))return!1;for(const A of w)if(!hh(A,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xa={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Or=1/298.257223563,ru=Or*(2-Or),gl=Math.PI/180;class ac{static fromTile(e,i,s){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),a=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/gl;return new ac(a,s)}static get units(){return xa}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!xa[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(xa).join(", ")}`);const s=6378.137*gl*(i?xa[i]:1),u=Math.cos(e*gl),a=1/(1-ru*(1-u*u)),h=Math.sqrt(a);this.kx=s*h*u,this.ky=s*h*a*(1-ru)}distance(e,i){const s=nr(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+u*u)}bearing(e,i){const s=nr(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/gl}destination(e,i,s){const u=s*gl;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const u=e[s];for(let a=0,h=u.length,g=h-1;a<h;g=a++)i+=nr(u[a][0]-u[g][0])*(u[a][1]+u[g][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const a=e[u],h=e[u+1],g=this.distance(a,h);if(s+=g,s>i)return va(a,h,(i-(s-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[u,a]=i,h=nr(s[0]-u)*this.kx,g=(s[1]-a)*this.ky;if(h!==0||g!==0){const w=(nr(e[0]-u)*this.kx*h+(e[1]-a)*this.ky*g)/(h*h+g*g);w>1?(u=s[0],a=s[1]):w>0&&(u+=h/this.kx*w,a+=g/this.ky*w)}return h=nr(e[0]-u)*this.kx,g=(e[1]-a)*this.ky,Math.sqrt(h*h+g*g)}pointOnLine(e,i){let s=1/0,u=e[0][0],a=e[0][1],h=0,g=0;for(let w=0;w<e.length-1;w++){let A=e[w][0],p=e[w][1],b=nr(e[w+1][0]-A)*this.kx,E=(e[w+1][1]-p)*this.ky,x=0;b===0&&E===0||(x=(nr(i[0]-A)*this.kx*b+(i[1]-p)*this.ky*E)/(b*b+E*E),x>1?(A=e[w+1][0],p=e[w+1][1]):x>0&&(A+=b/this.kx*x,p+=E/this.ky*x)),b=nr(i[0]-A)*this.kx,E=(i[1]-p)*this.ky;const T=b*b+E*E;T<s&&(s=T,u=A,a=p,h=w,g=x)}return{point:[u,a],index:h,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,s){let u=this.pointOnLine(s,e),a=this.pointOnLine(s,i);if(u.index>a.index||u.index===a.index&&u.t>a.t){const A=u;u=a,a=A}const h=[u.point],g=u.index+1,w=a.index;!ph(s[g],h[0])&&g<=w&&h.push(s[g]);for(let A=g+1;A<=w;A++)h.push(s[A]);return ph(s[w],a.point)||h.push(a.point),h}lineSliceAlong(e,i,s){let u=0;const a=[];for(let h=0;h<s.length-1;h++){const g=s[h],w=s[h+1],A=this.distance(g,w);if(u+=A,u>e&&a.length===0&&a.push(va(g,w,(e-(u-A))/A)),u>=i)return a.push(va(g,w,(i-(u-A))/A)),a;u>e&&a.push(w)}return a}bufferPoint(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[0]+u,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[2]+u,e[3]+s]}insideBBox(e,i){return nr(e[0]-i[0])>=0&&nr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function ph(r,e){return r[0]===e[0]&&r[1]===e[1]}function va(r,e,i){const s=nr(e[0]-r[0]);return[r[0]+s*i,r[1]+(e[1]-r[1])*i]}function nr(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class vf{constructor(e=[],i=(s,u)=>s<u?-1:s>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const a=e-1>>1,h=i[a];if(s(u,h)>=0)break;i[e]=h,e=a}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,a=i[e];for(;e<u;){let h=1+(e<<1);const g=h+1;if(g<this.length&&s(i[g],i[h])<0&&(h=g),s(i[h],a)>=0)break;i[e]=i[h],e=h}i[e]=a}}var wt=8192;function Kd(r,e){return e.dist-r.dist}const lc=100,cc=50;function ou(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function Cs(r){return r[1]-r[0]+1}function rs(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function bf(r,e){if(r[0]>r[1])return[null,null];const i=Cs(r);if(e){if(i===2)return[r,null];const s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(i===1)return[r,null];const s=Math.floor(i/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function qo(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!rs(e,r.length))return i;for(let s=e[0];s<=e[1];++s)Qc(i,r[s]);return i}function mh(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let s=0;s<r[i].length;++s)Qc(e,r[i][s]);return e}function Ps(r,e,i){if(ou(r)||ou(e))return NaN;let s=0,u=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(u=r[1]-e[3]),r[3]<e[1]&&(u=e[1]-r[3]),i.distance([0,0],[s,u])}function os(r){return 360*r-180}function wf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function $o(r,e){const i=Math.pow(2,e.z),s=(r.y/wt+e.y)/i;return[os((r.x/wt+e.x)/i),wf(s)]}function Jd(r,e){const i=[];for(let s=0;s<r.length;++s)i.push($o(r[s],e));return i}function Tf(r,e,i){const s=i.pointOnLine(e,r).point;return i.distance(r,s)}function Sf(r,e,i,s,u){const a=i.slice(s[0],s[1]+1);let h=1/0;for(let g=e[0];g<=e[1];++g)if((h=Math.min(h,Tf(r[g],a,u)))===0)return 0;return h}function _h(r,e,i,s,u){const a=Math.min(u.pointToSegmentDistance(r,i,s),u.pointToSegmentDistance(e,i,s)),h=Math.min(u.pointToSegmentDistance(i,r,e),u.pointToSegmentDistance(s,r,e));return Math.min(a,h)}function yl(r,e,i,s,u){if(!rs(e,r.length)||!rs(s,i.length))return NaN;let a=1/0;for(let h=e[0];h<e[1];++h)for(let g=s[0];g<s[1];++g){if(ya(r[h],r[h+1],i[g],i[g+1]))return 0;a=Math.min(a,_h(r[h],r[h+1],i[g],i[g+1],u))}return a}function et(r,e,i,s,u){if(!rs(e,r.length)||!rs(s,i.length))return NaN;let a=1/0;for(let h=e[0];h<=e[1];++h)for(let g=s[0];g<=s[1];++g)if((a=Math.min(a,u.distance(r[h],i[g])))===0)return a;return a}function Tt(r,e,i){if(_l(r,e,!0))return 0;let s=1/0;for(const u of e){const a=u.length;if(a<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[a-1]&&(s=Math.min(s,i.pointToSegmentDistance(r,u[a-1],u[0])))===0||(s=Math.min(s,Tf(r,u,i)))===0)return s}return s}function mt(r,e,i,s){if(!rs(e,r.length))return NaN;for(let a=e[0];a<=e[1];++a)if(_l(r[a],i,!0))return 0;let u=1/0;for(let a=e[0];a<e[1];++a)for(const h of i)for(let g=0,w=h.length,A=w-1;g<w;A=g++){if(ya(r[a],r[a+1],h[A],h[g]))return 0;u=Math.min(u,_h(r[a],r[a+1],h[A],h[g],s))}return u}function pi(r,e){for(const i of r)for(let s=0;s<=i.length-1;++s)if(_l(i[s],e,!0))return!0;return!1}function Qi(r,e,i,s=1/0){const u=mh(r),a=mh(e);if(s!==1/0&&Ps(u,a,i)>=s)return s;if(ml(u,a)){if(pi(r,e))return 0}else if(pi(e,r))return 0;let h=s;for(const g of r)for(let w=0,A=g.length,p=A-1;w<A;p=w++)for(const b of e)for(let E=0,x=b.length,T=x-1;E<x;T=E++){if(ya(g[p],g[w],b[T],b[E]))return 0;h=Math.min(h,_h(g[p],g[w],b[T],b[E],i))}return h}function Pn(r,e,i,s,u,a,h){if(a===null||h===null)return;const g=Ps(qo(s,a),qo(u,h),i);g<e&&r.push({dist:g,range1:a,range2:h})}function Tr(r,e,i,s,u=1/0){let a=Math.min(s.distance(r[0],i[0][0]),u);if(a===0)return a;const h=new vf([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Kd),g=e?cc:lc,w=mh(i);for(;h.length;){const A=h.pop();if(A.dist>=a)continue;const p=A.range1;if(Cs(p)<=g){if(!rs(p,r.length))return NaN;if(e){const b=mt(r,p,i,s);if((a=Math.min(a,b))===0)return a}else for(let b=p[0];b<=p[1];++b){const E=Tt(r[b],i,s);if((a=Math.min(a,E))===0)return a}}else{const b=bf(p,e);if(b[0]!==null){const E=Ps(qo(r,b[0]),w,s);E<a&&h.push({dist:E,range1:b[0],range2:[0,0]})}if(b[1]!==null){const E=Ps(qo(r,b[1]),w,s);E<a&&h.push({dist:E,range1:b[1],range2:[0,0]})}}}return a}function Wn(r,e,i,s,u,a=1/0){let h=Math.min(a,u.distance(r[0],i[0]));if(h===0)return h;const g=new vf([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Kd),w=e?cc:lc,A=s?cc:lc;for(;g.length;){const p=g.pop();if(p.dist>=h)continue;const b=p.range1,E=p.range2;if(Cs(b)<=w&&Cs(E)<=A){if(!rs(b,r.length)||!rs(E,i.length))return NaN;if(e&&s?h=Math.min(h,yl(r,b,i,E,u)):e||s?e&&!s?h=Math.min(h,Sf(i,E,r,b,u)):!e&&s&&(h=Math.min(h,Sf(r,b,i,E,u))):h=Math.min(h,et(r,b,i,E,u)),h===0)return h}else{const x=bf(b,e),T=bf(E,s);Pn(g,h,u,r,i,x[0],T[0]),Pn(g,h,u,r,i,x[0],T[1]),Pn(g,h,u,r,i,x[1],T[0]),Pn(g,h,u,r,i,x[1],T[1])}}return h}function Ga(r,e,i,s,u=1/0){let a=u;const h=qo(r,[0,r.length-1]);for(const g of i)if(!(a!==1/0&&Ps(h,qo(g,[0,g.length-1]),s)>=a)&&(a=Math.min(a,Wn(r,e,g,!0,s,a)),a===0))return a;return a}function su(r,e,i,s,u=1/0){let a=u;const h=qo(r,[0,r.length-1]);for(const g of i){if(a!==1/0&&Ps(h,mh(g),s)>=a)continue;const w=Tr(r,e,g,s,a);if(isNaN(w))return w;if((a=Math.min(a,w))===0)return a}return a}function Eo(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Rs{constructor(e,i){this.type=Gt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ks(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let u=0;u<s.features.length;++u)if(Eo(s.features[u].geometry.type))return new Rs(s,s.features[u].geometry)}else if(s.type==="Feature"){if(Eo(s.geometry.type))return new Rs(s,s.geometry)}else if(Eo(s.type))return new Rs(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(u,a,h){const g=[];for(const A of u)for(const p of A)g.push($o(p,a));const w=new ac(g[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Wn(g,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",w):h.type==="MultiLineString"?Ga(g,!1,h.coordinates,w):h.type==="Polygon"||h.type==="MultiPolygon"?su(g,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,w):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(u,a,h){const g=[];for(const A of u){const p=[];for(const b of A)p.push($o(b,a));g.push(p)}const w=new ac(g[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Ga(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,w);if(h.type==="MultiLineString"){let A=1/0;for(let p=0;p<h.coordinates.length;p++){const b=Ga(h.coordinates[p],!0,g,w,A);if(isNaN(b))return b;if((A=Math.min(A,b))===0)return A}return A}if(h.type==="Polygon"||h.type==="MultiPolygon"){let A=1/0;for(let p=0;p<g.length;p++){const b=su(g[p],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,w,A);if(isNaN(b))return b;if((A=Math.min(A,b))===0)return A}return A}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(u,a,h){const g=[];for(const A of function(p,b){const E=p.length;if(E<=1)return[p];const x=[];let T,C;for(let L=0;L<E;L++){const k=xf(p[L]);k!==0&&(p[L].area=Math.abs(k),C===void 0&&(C=k<0),C===k<0?(T&&x.push(T),T=[p[L]]):T.push(p[L]))}return T&&x.push(T),x}(u)){const p=[];for(let b=0;b<A.length;++b)p.push(Jd(A[b],a));g.push(p)}const w=new ac(g[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return su(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,w);if(h.type==="MultiLineString"){let A=1/0;for(let p=0;p<h.coordinates.length;p++){const b=su(h.coordinates[p],!0,g,w,A);if(isNaN(b))return b;if((A=Math.min(A,b))===0)return A}return A}return h.type==="Polygon"||h.type==="MultiPolygon"?function(A,p,b){let E=1/0;for(const x of A)for(const T of p){const C=Qi(x,T,b,E);if(isNaN(C))return C;if((E=Math.min(E,C))===0)return E}return E}(h.type==="Polygon"?[h.coordinates]:h.coordinates,g,w):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qa(r,e){switch(r){case"string":return po(e);case"number":return+e;case"boolean":return!!e;case"color":return _n.parse(e);case"formatted":return oo.fromString(po(e));case"resolvedImage":return Lr.fromString(po(e))}return e}function ki(r,e,i,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class ba{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=Ji),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof is))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const a=i.parse(e[2],2);return a instanceof is?new ba(s,po(u.value),po(a.value)):i.error("Scope of 'config' expression must be a string literal.")}return new ba(s,po(u.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:u,value:a,values:h,minValue:g,maxValue:w,stepValue:A}=s,p=s.default.evaluate(e);let b=p;if(a){const E=e.scope;e.scope=(E||"").split("").slice(1).join(""),b=a.evaluate(e),e.scope=E}return u&&(b=qa(u,b)),b===void 0||g===void 0&&w===void 0&&A===void 0||(typeof b=="number"?b=ki(b,g,w,A):Array.isArray(b)&&(b=b.map(E=>typeof E=="number"?ki(E,g,w,A):E))),a!==void 0&&b!==void 0&&h&&!h.includes(b)&&(b=p,u&&(b=qa(u,b))),(u&&u!==this.type||b!==void 0&&On(b)!==this.type)&&(b=qa(this.type.kind,b)),b}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function $a(r){if(r instanceof co&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Gr||r instanceof Rs)return!1;let e=!0;return r.eachChild(i=>{e&&!$a(i)&&(e=!1)}),e}function Gn(r){if(r instanceof co&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Gn(i)&&(e=!1)}),e}function au(r){if(r instanceof ba)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...au(i)])}),e}function xl(r,e){if(r instanceof co&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(s=>{i&&!xl(s,e)&&(i=!1)}),i}class vn{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new vn(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ef{constructor(e,i=[],s,u=new lh,a=[],h,g){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=u,this.errors=a,this.expectedType=s,this._scope=h,this.options=g}parse(e,i,s,u,a={}){return i||s?this.concat(i,null,s,u)._parse(e,a):this._parse(e,a)}parseObjectValue(e,i,s,u,a,h={}){return this.concat(i,s,u,a)._parse(e,h)}_parse(e,i){function s(u,a,h){return h==="assert"?new ns(a,[u]):h==="coerce"?new ma(a,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let a=u.parse(e,this);if(!a)return null;if(this.expectedType){const h=this.expectedType,g=a.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||g.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(h,g))return null}else a=s(a,h,i.typeAnnotation||"coerce");else a=s(a,h,i.typeAnnotation||"assert")}if(!(a instanceof is)&&a.type.kind!=="resolvedImage"&&Af(a)){const h=new _a(this._scope,this.options);try{a=new is(a.type,a.evaluate(h))}catch(g){return this.error(g.message),null}}return a}return ma.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,u){let a=typeof e=="number"?this.path.concat(e):this.path;a=typeof i=="string"?a.concat(i):a;const h=u?this.scope.concat(u):this.scope;return new Ef(this.registry,a,s||null,h,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new As(s,e))}checkSubtype(e,i){const s=rc(e,i);return s&&this.error(s),s}}var Qd=Ef;function Af(r){if(r instanceof vn)return Af(r.boundExpression);if(r instanceof co&&r.name==="error"||r instanceof ir||r instanceof Gr||r instanceof Rs||r instanceof ba)return!1;const e=r instanceof ma||r instanceof ns;let i=!0;return r.eachChild(s=>{i=e?i&&Af(s):i&&s instanceof is}),!!i&&$a(r)&&xl(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function vl(r,e){const i=r.length-1;let s,u,a=0,h=i,g=0;for(;a<=h;)if(g=Math.floor((a+h)/2),s=r[g],u=r[g+1],s<=e){if(g===i||e<u)return g;a=g+1}else{if(!(s>e))throw new zr("Input is not a number.");h=g-1}return 0}class ss{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,a]of s)this.labels.push(u),this.outputs.push(a)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Gt);if(!s)return null;const u=[];let a=null;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);for(let h=1;h<e.length;h+=2){const g=h===1?-1/0:e[h],w=e[h+1],A=h,p=h+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(u.length&&u[u.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const b=i.parse(w,p,a);if(!b)return null;a=a||b.type,u.push([g,b])}return new ss(a,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const a=i.length;return u>=i[a-1]?s[a-1].evaluate(e):s[vl(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const lu=.95047,Mf=1.08883,cu=4/29,bl=6/29,If=3*bl*bl,gh=bl*bl*bl,ep=Math.PI/180,uu=180/Math.PI;function wa(r){return r>gh?Math.pow(r,1/3):r/If+cu}function uc(r){return r>bl?r*r*r:If*(r-cu)}function Cf(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Pf(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function tp(r){const e=Pf(r.r),i=Pf(r.g),s=Pf(r.b),u=wa((.4124564*e+.3575761*i+.1804375*s)/lu),a=wa((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*a-16,a:500*(u-a),b:200*(a-wa((.0193339*e+.119192*i+.9503041*s)/Mf)),alpha:r.a}}function hu(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*uc(e),i=lu*uc(i),s=Mf*uc(s),new _n(Cf(3.2404542*i-1.5371385*e-.4985314*s),Cf(-.969266*i+1.8760108*e+.041556*s),Cf(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function yh(r,e,i){const s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const wl={forward:tp,reverse:hu,interpolate:function(r,e,i){return{l:hi(r.l,e.l,i),a:hi(r.a,e.a,i),b:hi(r.b,e.b,i),alpha:hi(r.alpha,e.alpha,i)}}},fu={forward:function(r){const{l:e,a:i,b:s}=tp(r),u=Math.atan2(s,i)*uu;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*ep,i=r.c;return hu({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:yh(r.h,e.h,i),c:hi(r.c,e.c,i),l:hi(r.l,e.l,i),alpha:hi(r.alpha,e.alpha,i)}}};var Rf=Object.freeze({__proto__:null,hcl:fu,lab:wl});class Ho{constructor(e,i,s,u,a){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static interpolationFactor(e,i,s,u){let a=0;if(e.name==="exponential")a=Df(i,e.base,s,u);else if(e.name==="linear")a=Df(i,1,s,u);else if(e.name==="cubic-bezier"){const h=e.controlPoints;a=new Cn(h[0],h[1],h[2],h[3]).solve(Df(i,1,s,u))}return a}static parse(e,i){let[s,u,a,...h]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const A=u[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:A}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const A=u.slice(1);if(A.length!==4||A.some(p=>typeof p!="number"||p<0||p>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(a=i.parse(a,2,Gt),!a)return null;const g=[];let w=null;s==="interpolate-hcl"||s==="interpolate-lab"?w=Lo:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let A=0;A<h.length;A+=2){const p=h[A],b=h[A+1],E=A+3,x=A+4;if(typeof p!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(g.length&&g[g.length-1][0]>=p)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);const T=i.parse(b,x,w);if(!T)return null;w=w||T.type,g.push([p,T])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Ho(w,s,u,a,g):i.error(`Type ${fr(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const a=i.length;if(u>=i[a-1])return s[a-1].evaluate(e);const h=vl(i,u),g=Ho.interpolationFactor(this.interpolation,u,i[h],i[h+1]),w=s[h].evaluate(e),A=s[h+1].evaluate(e);return this.operator==="interpolate"?Va[this.type.kind.toLowerCase()](w,A,g):this.operator==="interpolate-hcl"?fu.reverse(fu.interpolate(fu.forward(w),fu.forward(A),g)):wl.reverse(wl.interpolate(wl.forward(w),wl.forward(A),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function Df(r,e,i,s){const u=s-i,a=r-i;return u===0?0:e===1?a/u:(Math.pow(e,a)-1)/(Math.pow(e,u)-1)}class Sr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&u.kind!=="value"&&(s=u);const a=[];for(const g of e.slice(1)){const w=i.parse(g,1+a.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,a.push(w)}const h=u&&a.some(g=>rc(u,g.type));return new Sr(h?Ji:s,a)}evaluate(e){let i,s=null,u=0;for(const a of this.args){if(u++,s=a.evaluate(e),s&&s instanceof Lr&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Qr{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let a=1;a<e.length-1;a+=2){const h=e[a];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,a);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",a);const g=i.parse(e[a+1],a+1);if(!g)return null;s.push([h,g])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new Qr(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Lf{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Gt),u=i.parse(e[2],2,To(i.expectedType||Ji));return s&&u?new Lf(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new zr(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new zr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const u=Math.floor(i),a=Math.ceil(i),h=s[u],g=s[a];if(typeof h!="number"||typeof g!="number")throw new zr(`Cannot interpolate between non-number values at index ${i}.`);const w=i-u;return h*(1-w)+g*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class zf{constructor(e,i){this.type=Zi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ji),u=i.parse(e[2],2,Ji);return s&&u?oc(s.type,[Zi,Wi,Gt,Ms,Ji])?new zf(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${fr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Is(i,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${fr(On(i))} instead.`);if(!Is(s,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${fr(On(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class du{constructor(e,i,s){this.type=Gt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ji),u=i.parse(e[2],2,Ji);if(!s||!u)return null;if(!oc(s.type,[Zi,Wi,Gt,Ms,Ji]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${fr(s.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,Gt);return a?new du(s,u,a):null}return new du(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Is(i,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${fr(On(i))} instead.`);if(!Is(s,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${fr(On(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Of{constructor(e,i,s,u,a,h){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=a,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const a={},h=[];for(let A=2;A<e.length-1;A+=2){let p=e[A];const b=e[A+1];Array.isArray(p)||(p=[p]);const E=i.concat(A);if(p.length===0)return E.error("Expected at least one branch label.");for(const T of p){if(typeof T!="number"&&typeof T!="string")return E.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof T=="number"&&Math.floor(T)!==T)return E.error("Numeric branch labels must be integer values.");if(s){if(E.checkSubtype(s,On(T)))return null}else s=On(T);if(a[String(T)]!==void 0)return E.error("Branch labels must be unique.");a[String(T)]=h.length}const x=i.parse(b,A,u);if(!x)return null;u=u||x.type,h.push(x)}const g=i.parse(e[1],1,Ji);if(!g)return null;const w=i.parse(e[e.length-1],e.length-1,u);return w?g.type.kind!=="value"&&i.concat(1).checkSubtype(s,g.type)?null:new Of(s,u,g,a,h,w):null}evaluate(e){const i=this.input.evaluate(e);return(On(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const h of i){const g=u[this.cases[h]];g===void 0?(u[this.cases[h]]=s.length,s.push([this.cases[h],[h]])):s[g][1].push(h)}const a=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,g]of s)e.push(g.length===1?a(g[0]):g.map(a)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class Tl{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const u=[];for(let h=1;h<e.length-1;h+=2){const g=i.parse(e[h],h,Zi);if(!g)return null;const w=i.parse(e[h+1],h+1,s);if(!w)return null;u.push([g,w]),s=s||w.type}const a=i.parse(e[e.length-1],e.length-1,s);return a?new Tl(s,u,a):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Ha{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ji),u=i.parse(e[2],2,Gt);if(!s||!u)return null;if(!oc(s.type,[To(Ji),Wi,Ji]))return i.error(`Expected first argument to be of type array or string, but found ${fr(s.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,Gt);return a?new Ha(s.type,s,u,a):null}return new Ha(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Is(i,["string","array"]))throw new zr(`Expected first argument to be of type array or string, but found ${fr(On(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pu(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sl(r,e,i,s){return s.compare(e,i)===0}function Js(r,e,i){const s=r!=="=="&&r!=="!=";return class YT{constructor(a,h,g){this.type=Zi,this.lhs=a,this.rhs=h,this.collator=g,this.hasUntypedArgument=a.type.kind==="value"||h.type.kind==="value"}static parse(a,h){if(a.length!==3&&a.length!==4)return h.error("Expected two or three arguments.");const g=a[0];let w=h.parse(a[1],1,Ji);if(!w)return null;if(!pu(g,w.type))return h.concat(1).error(`"${g}" comparisons are not supported for type '${fr(w.type)}'.`);let A=h.parse(a[2],2,Ji);if(!A)return null;if(!pu(g,A.type))return h.concat(2).error(`"${g}" comparisons are not supported for type '${fr(A.type)}'.`);if(w.type.kind!==A.type.kind&&w.type.kind!=="value"&&A.type.kind!=="value")return h.error(`Cannot compare types '${fr(w.type)}' and '${fr(A.type)}'.`);s&&(w.type.kind==="value"&&A.type.kind!=="value"?w=new ns(A.type,[w]):w.type.kind!=="value"&&A.type.kind==="value"&&(A=new ns(w.type,[A])));let p=null;if(a.length===4){if(w.type.kind!=="string"&&A.type.kind!=="string"&&w.type.kind!=="value"&&A.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(p=h.parse(a[3],3,tr),!p)return null}return new YT(w,A,p)}evaluate(a){const h=this.lhs.evaluate(a),g=this.rhs.evaluate(a);if(s&&this.hasUntypedArgument){const w=On(h),A=On(g);if(w.kind!==A.kind||w.kind!=="string"&&w.kind!=="number")throw new zr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=On(h),A=On(g);if(w.kind!=="string"||A.kind!=="string")return e(a,h,g)}return this.collator?i(a,h,g,this.collator.evaluate(a)):e(a,h,g)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}serialize(){const a=[r];return this.eachChild(h=>{a.push(h.serialize())}),a}}}const mu=Js("==",function(r,e,i){return e===i},Sl),_u=Js("!=",function(r,e,i){return e!==i},function(r,e,i,s){return!Sl(0,e,i,s)}),El=Js("<",function(r,e,i){return e<i},function(r,e,i,s){return s.compare(e,i)<0}),hc=Js(">",function(r,e,i){return e>i},function(r,e,i,s){return s.compare(e,i)>0}),ip=Js("<=",function(r,e,i){return e<=i},function(r,e,i,s){return s.compare(e,i)<=0}),np=Js(">=",function(r,e,i){return e>=i},function(r,e,i,s){return s.compare(e,i)>=0});class kf{constructor(e,i,s,u,a,h){this.type=Wi,this.number=e,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=a,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Gt);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let a=null;if(u.locale&&(a=i.parseObjectValue(u.locale,2,"locale",Wi),!a))return null;let h=null;if(u.currency&&(h=i.parseObjectValue(u.currency,2,"currency",Wi),!h))return null;let g=null;if(u.unit&&(g=i.parseObjectValue(u.unit,2,"unit",Wi),!g))return null;let w=null;if(u["min-fraction-digits"]&&(w=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Gt),!w))return null;let A=null;return u["max-fraction-digits"]&&(A=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Gt),!A)?null:new kf(s,a,h,g,w,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gu{constructor(e){this.type=Gt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${fr(s.type)} instead.`):new gu(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new zr(`Expected value to be of type string or array, but found ${fr(On(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Al(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Qs={"==":mu,"!=":_u,">":hc,"<":El,">=":np,"<=":ip,array:ns,at:Lf,boolean:ns,case:Tl,coalesce:Sr,collator:ir,format:dl,image:Jr,in:zf,"index-of":du,interpolate:Ho,"interpolate-hcl":Ho,"interpolate-lab":Ho,length:gu,let:Qr,literal:is,match:Of,number:ns,"number-format":kf,object:ns,slice:Ha,step:ss,string:ns,"to-boolean":ma,"to-color":ma,"to-number":ma,"to-string":ma,var:vn,within:Gr,distance:Rs,config:ba};function Ff(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const a=u?u.evaluate(r):1,h=gf(e,i,s,a);if(h)throw new zr(h);return new _n(e/255*a,i/255*a,s/255*a,a)}function _e(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const a=u?u.evaluate(r):1,h=function(A,p,b,E){return typeof A=="number"&&A>=0&&A<=360?typeof p=="number"&&p>=0&&p<=100&&typeof b=="number"&&b>=0&&b<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[A,p,b,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[A,p,b,E]:[A,p,b]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[A,p,b,E]:[A,p,b]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,a);if(h)throw new zr(h);const g=`hsla(${e}, ${i}%, ${s}%, ${a})`,w=_n.parse(g);if(!w)throw new zr(`Failed to parse HSLA color: ${g}`);return w}function Wa(r,e){return r in e}function fc(r,e){const i=e[r];return i===void 0?null:i}function so(r){return{type:r}}function En(r){return{result:"success",value:r}}function Ta(r){return{result:"error",value:r}}function xh(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ml(r){return r["property-type"]==="data-driven"}function Za(r){return xh(r.expression,"measure-light")}function Bf(r){return xh(r.expression,"zoom")}function Nf(r){return!!r.expression&&r.expression.interpolated}function Uf(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function rp(r){return r}function Vf(r,e){const i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",u=s||!(s||r.property!==void 0),a=r.type||(Nf(e)?"exponential":"interval");if(i&&((r=ic({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],_n.parse(A[1])])),r.default=_n.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Rf[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let h,g,w;if(a==="exponential")h=jf;else if(a==="interval")h=hm;else if(a==="categorical"){h=um,g=Object.create(null);for(const A of r.stops)g[A[0]]=A[1];w=typeof r.stops[0][0]}else{if(a!=="identity")throw new Error(`Unknown function type "${a}"`);h=fm}if(s){const A={},p=[];for(let x=0;x<r.stops.length;x++){const T=r.stops[x],C=T[0].zoom;A[C]===void 0&&(A[C]={zoom:C,type:r.type,property:r.property,default:r.default,stops:[]},p.push(C)),A[C].stops.push([T[0].value,T[1]])}const b=[];for(const x of p)b.push([A[x].zoom,Vf(A[x],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Ho.interpolationFactor.bind(void 0,E),zoomStops:b.map(x=>x[0]),evaluate:({zoom:x},T)=>jf({stops:b,base:r.base},e,x).evaluate(x,T)}}if(u){const A=a==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ho.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(p=>p[0]),evaluate:({zoom:p})=>h(r,e,p,g,w)}}return{kind:"source",evaluate(A,p){const b=p&&p.properties?p.properties[r.property]:void 0;return b===void 0?Wo(r.default,e.default):h(r,e,b,g,w)}}}function Wo(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function um(r,e,i,s,u){return Wo(typeof i===u?s[i]:void 0,r.default,e.default)}function hm(r,e,i){if(pl(i)!=="number")return Wo(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const u=vl(r.stops.map(a=>a[0]),i);return r.stops[u][1]}function jf(r,e,i){const s=r.base!==void 0?r.base:1;if(pl(i)!=="number")return Wo(r.default,e.default);const u=r.stops.length;if(u===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[u-1][0])return r.stops[u-1][1];const a=vl(r.stops.map(p=>p[0]),i),h=function(p,b,E,x){const T=x-E,C=p-E;return T===0?0:b===1?C/T:(Math.pow(b,C)-1)/(Math.pow(b,T)-1)}(i,s,r.stops[a][0],r.stops[a+1][0]),g=r.stops[a][1],w=r.stops[a+1][1];let A=Va[e.type]||rp;if(r.colorSpace&&r.colorSpace!=="rgb"){const p=Rf[r.colorSpace];A=(b,E)=>p.reverse(p.interpolate(p.forward(b),p.forward(E),h))}return typeof g.evaluate=="function"?{evaluate(...p){const b=g.evaluate.apply(void 0,p),E=w.evaluate.apply(void 0,p);if(b!==void 0&&E!==void 0)return A(b,E,h)}}:A(g,w,h)}function fm(r,e,i){return e.type==="color"?i=_n.parse(i):e.type==="formatted"?i=oo.fromString(i.toString()):e.type==="resolvedImage"?i=Lr.fromString(i.toString()):pl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Wo(i,r.default,e.default)}co.register(Qs,{error:[{kind:"error"},[Wi],(r,[e])=>{throw new zr(e.evaluate(r))}],typeof:[Wi,[Ji],(r,[e])=>fr(On(e.evaluate(r)))],"to-rgba":[To(Gt,4),[Lo],(r,[e])=>e.evaluate(r).toRenderColor(null).toArray()],rgb:[Lo,[Gt,Gt,Gt],Ff],rgba:[Lo,[Gt,Gt,Gt,Gt],Ff],hsl:[Lo,[Gt,Gt,Gt],_e],hsla:[Lo,[Gt,Gt,Gt,Gt],_e],has:{type:Zi,overloads:[[[Wi],(r,[e])=>Wa(e.evaluate(r),r.properties())],[[Wi,fo],(r,[e,i])=>Wa(e.evaluate(r),i.evaluate(r))]]},get:{type:Ji,overloads:[[[Wi],(r,[e])=>fc(e.evaluate(r),r.properties())],[[Wi,fo],(r,[e,i])=>fc(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Ji,[Wi],(r,[e])=>fc(e.evaluate(r),r.featureState||{})],properties:[fo,[],r=>r.properties()],"geometry-type":[Wi,[],r=>r.geometryType()],id:[Ji,[],r=>r.id()],zoom:[Gt,[],r=>r.globals.zoom],pitch:[Gt,[],r=>r.globals.pitch||0],"distance-from-center":[Gt,[],r=>r.distanceFromCenter()],"measure-light":[Gt,[Wi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Gt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Gt,[],r=>r.globals.lineProgress||0],"raster-value":[Gt,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Gt,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Gt,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ji,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Gt,so(Gt),(r,e)=>{let i=0;for(const s of e)i+=s.evaluate(r);return i}],"*":[Gt,so(Gt),(r,e)=>{let i=1;for(const s of e)i*=s.evaluate(r);return i}],"-":{type:Gt,overloads:[[[Gt,Gt],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Gt],(r,[e])=>-e.evaluate(r)]]},"/":[Gt,[Gt,Gt],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Gt,[Gt,Gt],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Gt,[Gt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Gt,[Gt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Gt,[Gt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Gt,[Gt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Gt,[Gt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Gt,[Gt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Gt,[Gt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Gt,[Gt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Gt,[Gt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Gt,[Gt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Gt,so(Gt),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Gt,so(Gt),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Gt,[Gt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Gt,[Gt],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Gt,[Gt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Gt,[Gt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Zi,[Wi,Ji],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Zi,[Ji],(r,[e])=>r.id()===e.value],"filter-type-==":[Zi,[Wi],(r,[e])=>r.geometryType()===e.value],"filter-<":[Zi,[Wi,Ji],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Zi,[Ji],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Zi,[Wi,Ji],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Zi,[Ji],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Zi,[Wi,Ji],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Zi,[Ji],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Zi,[Wi,Ji],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Zi,[Ji],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Zi,[Ji],(r,[e])=>e.value in r.properties()],"filter-has-id":[Zi,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Zi,[To(Wi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Zi,[To(Ji)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Zi,[Wi,To(Ji)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Zi,[Wi,To(Ji)],(r,[e,i])=>function(s,u,a,h){for(;a<=h;){const g=a+h>>1;if(u[g]===s)return!0;u[g]>s?h=g-1:a=g+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Zi,overloads:[[[Zi,Zi],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[so(Zi),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Zi,overloads:[[[Zi,Zi],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[so(Zi),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Zi,[Zi],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Zi,[Wi],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Wi,[Wi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Wi,[Wi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Wi,so(Ji),(r,e)=>e.map(i=>po(i.evaluate(r))).join("")],"resolved-locale":[Wi,[tr],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Gt,[Gt,Gt,Ji],(r,e)=>{const[i,s,u]=e.map(h=>h.evaluate(r));if(i>s||i===s)return i;let a;if(typeof u=="string")a=function(h){let g=0;if(h.length===0)return g;for(let w=0;w<h.length;w++)g=(g<<5)-g+h.charCodeAt(w),g|=0;return g}(u);else{if(typeof u!="number")throw new zr(`Invalid seed input: ${u}`);a=u}return i+Al(a)()*(s-i)}]});class Gf{constructor(e,i,s,u){this.expression=e,this._warningHistory={},this._evaluator=new _a(s,u),this._defaultValue=i?function(a){return a.type==="color"&&(Uf(a.default)||Array.isArray(a.default))?new _n(0,0,0,0):a.type==="color"?_n.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=au(e)}evaluateWithoutErrorHandling(e,i,s,u,a,h,g,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,a,h,g,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=w||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new zr(`Expected value to be one of ${Object.keys(this._enumValues).map(p=>JSON.stringify(p)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function as(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Qs}function dc(r,e,i,s){const u=new Qd(Qs,[],e?function(h){const g={color:Lo,string:Wi,number:Gt,enum:Wi,boolean:Zi,formatted:Hn,resolvedImage:nc};return h.type==="array"?To(g[h.value]||Ji,h.length):g[h.type]}(e):void 0,void 0,void 0,i,s),a=u.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?En(new Gf(a,e,i,s)):Ta(u.errors)}class vh{constructor(e,i,s){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!Gn(i.expression),this.configDependencies=au(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,a,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,a,h)}evaluate(e,i,s,u,a,h){return this._styleExpression.evaluate(e,i,s,u,a,h)}}class yu{constructor(e,i,s,u,a){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Gn(i.expression),this.isLightConstant=a,this.configDependencies=au(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,a,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,a,h)}evaluate(e,i,s,u,a,h){return this._styleExpression.evaluate(e,i,s,u,a,h)}interpolationFactor(e,i,s){return this.interpolationType?Ho.interpolationFactor(this.interpolationType,e,i,s):0}}function Il(r,e,i,s){if((r=dc(r,e,i,s)).result==="error")return r;const u=r.value.expression,a=$a(u);if(!a&&!Ml(e))return Ta([new As("","data expressions not supported")]);const h=xl(u,["zoom","pitch","distance-from-center"]);if(!h&&!Bf(e))return Ta([new As("","zoom expressions not supported")]);const g=xl(u,["measure-light"]);if(!g&&!Za(e))return Ta([new As("","measure-light expression not supported")]);const w=xl(u,["line-progress"]);if(!w&&!function(b){return xh(b.expression,"line-progress")}(e))return Ta([new As("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,p=ea(u);return p||h||A?p instanceof As?Ta([p]):p instanceof Ho&&!Nf(e)?Ta([new As("",'"interpolate" expressions cannot be used with this property')]):En(p?new yu(a&&w?"camera":"composite",r.value,p.labels,p instanceof Ho?p.interpolation:void 0,g):new vh(a&&w?"constant":"source",r.value,g)):Ta([new As("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bh{constructor(e,i){this._parameters=e,this._specification=i,ic(this,Vf(this._parameters,this._specification))}static deserialize(e){return new bh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ea(r){let e=null;if(r instanceof Qr)e=ea(r.result);else if(r instanceof Sr){for(const i of r.args)if(e=ea(i),e)break}else(r instanceof ss||r instanceof Ho)&&r.input instanceof co&&r.input.name==="zoom"&&(e=r);return e instanceof As||r.eachChild(i=>{const s=ea(i);s instanceof As?e=s:e&&s&&e!==s&&(e=new As("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var qf,$f,ls=function(){if($f)return qf;$f=1,qf=e;var r=3;function e(i,s,u){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(s=h[1])+2*(u=h[2]);for(var g=0;g<this.d*this.d;g++){var w=h[r+g],A=h[r+g+1];a.push(w===A?null:h.subarray(w,A))}var p=h[r+a.length+1];this.keys=h.subarray(h[r+a.length],p),this.bboxes=h.subarray(p),this.insert=this._insertReadonly}else{this.d=s+2*u;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=u,this.scale=s/i,this.uid=0;var E=u/s*i;this.min=-E,this.max=i+E}return e.prototype.insert=function(i,s,u,a,h){this._forEachCell(s,u,a,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,u,a,h,g){this.cells[h].push(g)},e.prototype.query=function(i,s,u,a,h){var g=this.min,w=this.max;if(i<=g&&s<=g&&w<=u&&w<=a&&!h)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,s,u,a,this._queryCell,A,{},h),A},e.prototype._queryCell=function(i,s,u,a,h,g,w,A){var p=this.cells[h];if(p!==null)for(var b=this.keys,E=this.bboxes,x=0;x<p.length;x++){var T=p[x];if(w[T]===void 0){var C=4*T;(A?A(E[C+0],E[C+1],E[C+2],E[C+3]):i<=E[C+2]&&s<=E[C+3]&&u>=E[C+0]&&a>=E[C+1])?(w[T]=!0,g.push(b[T])):w[T]=!1}}},e.prototype._forEachCell=function(i,s,u,a,h,g,w,A){for(var p=this._convertToCellCoord(i),b=this._convertToCellCoord(s),E=this._convertToCellCoord(u),x=this._convertToCellCoord(a),T=p;T<=E;T++)for(var C=b;C<=x;C++){var L=this.d*C+T;if((!A||A(this._convertFromCellCoord(T),this._convertFromCellCoord(C),this._convertFromCellCoord(T+1),this._convertFromCellCoord(C+1)))&&h.call(this,i,s,u,a,L,g,w,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=r+this.cells.length+1+1,u=0,a=0;a<this.cells.length;a++)u+=this.cells[a].length;var h=new Int32Array(s+u+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=s,w=0;w<i.length;w++){var A=i[w];h[r+w]=g,h.set(A,g),g+=A.length}return h[r+i.length]=g,h.set(this.keys,g),h[r+i.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer},qf}(),Cl=ue(ls);const xu={};function Vt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),xu[e]={klass:r,omit:i.omit||[]}}Vt(Object,"Object"),Cl.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Cl.deserialize=function(r){return new Cl(r.buffer)},Object.defineProperty(Cl,"name",{value:"Grid"}),Vt(Cl,"Grid"),Vt(_n,"Color"),Vt(Error,"Error"),Vt(oo,"Formatted"),Vt(Yn,"FormattedSection"),Vt(pf,"AJAXError"),Vt(Lr,"ResolvedImage"),Vt(bh,"StylePropertyFunction"),Vt(Gf,"StyleExpression",{omit:["_evaluator"]}),Vt(yu,"ZoomDependentExpression"),Vt(vh,"ZoomConstantExpression"),Vt(co,"CompoundExpression",{omit:["_evaluate"]});for(const r in Qs)xu[Qs[r]._classRegistryKey]||Vt(Qs[r],`Expression${r}`);function wh(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Hf(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Xa(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(wh(r)||Hf(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.add(i.buffer),i}if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const s of r)i.push(Xa(s,e));return i}if(r instanceof Map){const i={$name:"Map"};for(const[s,u]of r.entries())i[s]=Xa(u);return i}if(r instanceof Set){const i={$name:"Set"};let s=0;for(const u of r.values())i[++s]=Xa(u);return i}if(typeof r=="object"){const i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const a in r)r.hasOwnProperty(a)&&(xu[s].omit.indexOf(a)>=0||(u[a]=Xa(r[a],e)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof r)}function Ao(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||wh(r)||Hf(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ao);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const u=new Map;for(const a of Object.keys(r))a!=="$name"&&u.set(a,Ao(r[a]));return u}if(e==="Set"){const u=new Set;for(const a of Object.keys(r))a!=="$name"&&u.add(Ao(r[a]));return u}const{klass:i}=xu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const s=Object.create(i.prototype);for(const u of Object.keys(r))u!=="$name"&&(s[u]=Ao(r[u]));return s}throw new Error("can't deserialize object of type "+typeof r)}const Qt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Wf(r){for(const e of r)if(Sa(e.charCodeAt(0)))return!0;return!1}function Th(r){for(const e of r)if(!vu(e.charCodeAt(0)))return!1;return!0}function vu(r){return!(Qt.Arabic(r)||Qt["Arabic Supplement"](r)||Qt["Arabic Extended-A"](r)||Qt["Arabic Presentation Forms-A"](r)||Qt["Arabic Presentation Forms-B"](r))}function Sa(r){return!(r!==746&&r!==747&&(r<4352||!(Qt["Bopomofo Extended"](r)||Qt.Bopomofo(r)||Qt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Qt["CJK Compatibility Ideographs"](r)||Qt["CJK Compatibility"](r)||Qt["CJK Radicals Supplement"](r)||Qt["CJK Strokes"](r)||!(!Qt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Qt["CJK Unified Ideographs Extension A"](r)||Qt["CJK Unified Ideographs"](r)||Qt["Enclosed CJK Letters and Months"](r)||Qt["Hangul Compatibility Jamo"](r)||Qt["Hangul Jamo Extended-A"](r)||Qt["Hangul Jamo Extended-B"](r)||Qt["Hangul Jamo"](r)||Qt["Hangul Syllables"](r)||Qt.Hiragana(r)||Qt["Ideographic Description Characters"](r)||Qt.Kanbun(r)||Qt["Kangxi Radicals"](r)||Qt["Katakana Phonetic Extensions"](r)||Qt.Katakana(r)&&r!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Qt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](r)||Qt["Unified Canadian Aboriginal Syllabics Extended"](r)||Qt["Vertical Forms"](r)||Qt["Yijing Hexagram Symbols"](r)||Qt["Yi Syllables"](r)||Qt["Yi Radicals"](r))))}function Zf(r){return!(Sa(r)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function pc(r){return r>=1424&&r<=2303||Qt["Arabic Presentation Forms-A"](r)||Qt["Arabic Presentation Forms-B"](r)}function op(r,e){return!(!e&&pc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Qt.Khmer(r))}function Ea(r){for(const e of r)if(pc(e.charCodeAt(0)))return!0;return!1}const bu="deferred",Ds="loading",mo="loaded";let Sh=null,ao="unavailable",zo=null;const mc=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ao="error"),Sh&&Sh(r)};function ta(){Eh.fire(new Xs("pluginStateChange",{pluginStatus:ao,pluginURL:zo}))}const Eh=new tc,Xf=function(){return ao},wu=function(){if(ao!==bu||!zo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ao=Ds,ta(),zo&&hl({url:zo},r=>{r?mc(r):(ao=mo,ta())})},Zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ao===mo||Zo.applyArabicShaping!=null,isLoading:()=>ao===Ds,setState(r){ao=r.pluginStatus,zo=r.pluginURL},isParsed:()=>Zo.applyArabicShaping!=null&&Zo.processBidirectionalText!=null&&Zo.processStyledBidirectionalText!=null,getPluginURL:()=>zo};class Kn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const u of i)if(!op(u.charCodeAt(0),s))return!1;return!0}(e,Zo.isLoaded())}}class qr{constructor(e,i,s,u){this.property=e,this.value=i,this.expression=function(a,h,g,w){if(Uf(a))return new bh(a,h);if(as(a)||Array.isArray(a)&&a.length>0){const A=Il(a,h,g,w);if(A.result==="error")throw new Error(A.value.map(p=>`${p.key}: ${p.message}`).join(", "));return A.value}{let A=a;return typeof a=="string"&&h.type==="color"&&(A=_n.parse(a)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(i===void 0?e.specification.default:i,e.specification,s,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class Tu{constructor(e,i,s){this.property=e,this.value=new qr(e,void 0,i,s)}transitioned(e,i){return new Ls(this.property,this.value,i,$i({},e.transition,this.transition),e.now)}untransitioned(){return new Ls(this.property,this.value,null,{},0)}}class Yf{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return er(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Tu(this._values[e].property,this._scope,this._options)),this._values[e].value=new qr(this._values[e].property,i===null?void 0:er(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const u in e){const a=e[u];if(hr(u,"-transition")){const h=u.slice(0,-11);s[h]&&this.setTransition(h,a)}else s.hasOwnProperty(u)&&this.setValue(u,a)}}getTransition(e){return er(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Tu(this._values[e].property)),this._values[e].transition=er(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new Ah(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new Ah(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ls{constructor(e,i,s,u,a){const h=u.delay||0,g=u.duration||0;a=a||0,this.property=e,this.value=i,this.begin=a+h,this.end=this.begin+g,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,a=this.value.possiblyEvaluate(e,i,s),h=this.prior;if(h){if(u>this.end)return this.prior=null,a;if(this.value.isDataDriven())return this.prior=null,a;if(u<this.begin)return h.possiblyEvaluate(e,i,s);{const g=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,s),a,$t(g))}}return a}}class Ah{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new Pl(this._properties);for(const a of Object.keys(this._values))u._values[a]=this._values[a].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Mh{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return er(this._values[e].value)}setValue(e,i){this._values[e]=new qr(this._values[e].property,i===null?void 0:er(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const u=new Pl(this._properties);for(const a of Object.keys(this._values))u._values[a]=this._values[a].possiblyEvaluate(e,i,s);return u}}class cs{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u)}}class Pl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ht{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=Va[this.specification.type];return u?u(e,i,s):e}}class ei{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u){return new cs(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,u)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new cs(this,{kind:"constant",value:void 0},e.parameters);const u=Va[this.specification.type];return u?new cs(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,a,h){return e.kind==="constant"?e.value:e.evaluate(i,s,u,a,h)}}class _c{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class Bn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Kn(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const a=this.defaultPropertyValues[s]=new qr(u,void 0),h=this.defaultTransitionablePropertyValues[s]=new Tu(u);this.defaultTransitioningPropertyValues[s]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=a.possiblyEvaluate(i)}}}Vt(ei,"DataDrivenProperty"),Vt(ht,"DataConstantProperty"),Vt(_c,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Su(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Rl(r){if(Array.isArray(r))return r.map(Rl);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Rl(r[i]);return e}return Su(r)}function Dl(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Dl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Eu(r,e="",i=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Dl(r)||(r=Au(r));const u=r;let a=!0;try{a=function(p){if(!Mo(p))return p;let b=Rl(p);return Kf(b),b=Aa(b),b}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let h=null,g=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){g=Ve[`filter_${s}`];const p=dc(a,g,e,i);if(p.result==="error")throw new Error(p.value.map(b=>`${b.key}: ${b.message}`).join(", "));h=(b,E,x)=>p.value.evaluate(b,E,{},x)}let w=null,A=null;if(a!==u){const p=dc(u,g,e,i);if(p.result==="error")throw new Error(p.value.map(b=>`${b.key}: ${b.message}`).join(", "));w=(b,E,x,T,C)=>p.value.evaluate(b,E,{},x,void 0,void 0,T,C),A=!$a(p.value.expression)}return{filter:h,dynamicFilter:w||void 0,needGeometry:Ih(a),needFeature:!!A}}function Aa(r){if(!Array.isArray(r))return r;const e=function(i){if(dm.has(i[0])){for(let s=1;s<i.length;s++)if(Mo(i[s]))return!0}return i}(r);return e===!0?e:e.map(i=>Aa(i))}function Kf(r){let e=!1;const i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||Mo(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Mo(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Mo(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)Kf(r[s])}function Mo(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Mo(r[i]))return!0;return!1}const dm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function pm(r,e){return r<e?-1:r>e?1:0}function Ih(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Ih(r[e]))return!0;return!1}function Au(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Jf(r[1],r[2],"=="):e==="!="?Ya(Jf(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Jf(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Au))):e==="all"?["all"].concat(r.slice(1).map(Au)):e==="none"?["all"].concat(r.slice(1).map(Au).map(Ya)):e==="in"?Qf(r[1],r.slice(2)):e==="!in"?Ya(Qf(r[1],r.slice(2))):e==="has"?Ch(r[1]):e!=="!has"||Ya(Ch(r[1]));var i}function Jf(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Qf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(pm)]]:["filter-in-small",r,["literal",e]]}}function Ch(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ya(r){return["!",r]}const Ll="";function Ph(r,e){return e?`${r}${Ll}${e}`:r}const Rh="-transition",zs=new Set(["fill","line","background","hillshade","raster"]);class _o extends tc{constructor(e,i,s,u,a){if(super(),this.id=e.id,this.fqid=Ph(this.id,s),this.type=e.type,this.scope=s,this.lut=u,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const h=dc(this.filter,Ve[`filter_${e.type}`]);h.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...h.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Mh(i.layout,this.scope,a),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Yf(i.paint,this.scope,a);for(const h in e.paint)this.setPaintProperty(h,e.paint[h]);for(const h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pl(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&zs.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return hr(e,Rh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,u=s._properties.properties;if(hr(e,Rh)){const b=e.slice(0,-11);return u[b]&&s.setTransition(b,i||void 0),!1}if(!u[e])return!1;const a=s._values[e],h=a.value.isDataDriven(),g=a.value;s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=s._values[e].value,A=w.isDataDriven(),p=hr(e,"pattern")||e==="line-dasharray";return A||h||p||this._handleOverridablePaintPropertyUpdate(e,g,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return ws({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof cs&&Ml(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Eu(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,u,a,h,g,w,A){}queryIntersectsMatchingFeature(e,i,s,u){}}const ed={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ka{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function on(r,e=1){let i=0,s=0;return{members:r.map(u=>{const a=ed[u.type].BYTES_PER_ELEMENT,h=i=td(i,Math.max(e,a)),g=u.components||1;return s=Math.max(s,a),i+=a*g,{name:u.name,type:u.type,components:g,offset:h}}),size:td(i,Math.max(s,e)),alignment:e}}function td(r,e){return Math.ceil(r/e)*e}class Ja extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}Ja.prototype.bytesPerElement=4,Vt(Ja,"StructArrayLayout2i4");class Mu extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const a=3*e;return this.int16[a+0]=i,this.int16[a+1]=s,this.int16[a+2]=u,e}}Mu.prototype.bytesPerElement=6,Vt(Mu,"StructArrayLayout3i6");class gc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s,u)}emplace(e,i,s,u,a){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=s,this.int16[h+2]=u,this.int16[h+3]=a,e}}gc.prototype.bytesPerElement=8,Vt(gc,"StructArrayLayout4i8");class Iu extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,u,a)}emplace(e,i,s,u,a,h){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=a,this.int16[g+4]=h,e}}Iu.prototype.bytesPerElement=10,Vt(Iu,"StructArrayLayout5i10");class yc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,a,h,g)}emplace(e,i,s,u,a,h,g,w){const A=6*e,p=12*e,b=3*e;return this.int16[A+0]=i,this.int16[A+1]=s,this.uint8[p+4]=u,this.uint8[p+5]=a,this.uint8[p+6]=h,this.uint8[p+7]=g,this.float32[b+2]=w,e}}yc.prototype.bytesPerElement=12,Vt(yc,"StructArrayLayout2i4ub1f12");class Os extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s,u)}emplace(e,i,s,u,a){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=s,this.float32[h+2]=u,this.float32[h+3]=a,e}}Os.prototype.bytesPerElement=16,Vt(Os,"StructArrayLayout4f16");class Qa extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const a=3*e;return this.float32[a+0]=i,this.float32[a+1]=s,this.float32[a+2]=u,e}}Qa.prototype.bytesPerElement=12,Vt(Qa,"StructArrayLayout3f12");class ks extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,u,a)}emplace(e,i,s,u,a,h){const g=6*e,w=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=u,this.uint16[g+3]=a,this.float32[w+2]=h,e}}ks.prototype.bytesPerElement=12,Vt(ks,"StructArrayLayout4ui1f12");class an extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s,u)}emplace(e,i,s,u,a){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,this.uint16[h+2]=u,this.uint16[h+3]=a,e}}an.prototype.bytesPerElement=8,Vt(an,"StructArrayLayout4ui8");class Cu extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,a,h)}emplace(e,i,s,u,a,h,g){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+3]=a,this.int16[w+4]=h,this.int16[w+5]=g,e}}Cu.prototype.bytesPerElement=12,Vt(Cu,"StructArrayLayout6i12");class xc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b,E){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,a,h,g,w,A,p,b,E)}emplace(e,i,s,u,a,h,g,w,A,p,b,E,x){const T=12*e;return this.int16[T+0]=i,this.int16[T+1]=s,this.int16[T+2]=u,this.int16[T+3]=a,this.uint16[T+4]=h,this.uint16[T+5]=g,this.uint16[T+6]=w,this.uint16[T+7]=A,this.int16[T+8]=p,this.int16[T+9]=b,this.int16[T+10]=E,this.int16[T+11]=x,e}}xc.prototype.bytesPerElement=24,Vt(xc,"StructArrayLayout4i4ui4i24");class zl extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,a,h)}emplace(e,i,s,u,a,h,g){const w=10*e,A=5*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=u,this.float32[A+2]=a,this.float32[A+3]=h,this.float32[A+4]=g,e}}zl.prototype.bytesPerElement=20,Vt(zl,"StructArrayLayout3i3f20");class Dh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Dh.prototype.bytesPerElement=4,Vt(Dh,"StructArrayLayout1ul4");class el extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}el.prototype.bytesPerElement=4,Vt(el,"StructArrayLayout2ui4");class id extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b,E,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,u,a,h,g,w,A,p,b,E,x)}emplace(e,i,s,u,a,h,g,w,A,p,b,E,x,T){const C=20*e,L=10*e;return this.int16[C+0]=i,this.int16[C+1]=s,this.int16[C+2]=u,this.int16[C+3]=a,this.int16[C+4]=h,this.float32[L+3]=g,this.float32[L+4]=w,this.float32[L+5]=A,this.float32[L+6]=p,this.int16[C+14]=b,this.uint32[L+8]=E,this.uint16[C+18]=x,this.uint16[C+19]=T,e}}id.prototype.bytesPerElement=40,Vt(id,"StructArrayLayout5i4f1i1ul2ui40");class Io extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,a,h,g)}emplace(e,i,s,u,a,h,g,w){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=s,this.int16[A+2]=u,this.int16[A+4]=a,this.int16[A+5]=h,this.int16[A+6]=g,this.int16[A+7]=w,e}}Io.prototype.bytesPerElement=16,Vt(Io,"StructArrayLayout3i2i2i16");class vc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,u,a)}emplace(e,i,s,u,a,h){const g=4*e,w=8*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=u,this.int16[w+6]=a,this.int16[w+7]=h,e}}vc.prototype.bytesPerElement=16,Vt(vc,"StructArrayLayout2f1f2i16");class Ma extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,a,h)}emplace(e,i,s,u,a,h,g){const w=20*e,A=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=s,this.float32[A+1]=u,this.float32[A+2]=a,this.float32[A+3]=h,this.float32[A+4]=g,e}}Ma.prototype.bytesPerElement=20,Vt(Ma,"StructArrayLayout2ub4f20");class qn extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const a=3*e;return this.uint16[a+0]=i,this.uint16[a+1]=s,this.uint16[a+2]=u,e}}qn.prototype.bytesPerElement=6,Vt(qn,"StructArrayLayout3ui6");class Ol extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q)}emplace(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q,Z){const Q=30*e,ce=15*e,oe=60*e;return this.int16[Q+0]=i,this.int16[Q+1]=s,this.int16[Q+2]=u,this.float32[ce+2]=a,this.float32[ce+3]=h,this.uint16[Q+8]=g,this.uint16[Q+9]=w,this.uint32[ce+5]=A,this.uint32[ce+6]=p,this.uint32[ce+7]=b,this.uint16[Q+16]=E,this.uint16[Q+17]=x,this.uint16[Q+18]=T,this.float32[ce+10]=C,this.float32[ce+11]=L,this.uint8[oe+48]=k,this.uint8[oe+49]=V,this.uint8[oe+50]=j,this.uint32[ce+13]=B,this.int16[Q+28]=q,this.uint8[oe+58]=Z,e}}Ol.prototype.bytesPerElement=60,Vt(Ol,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Lh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q,Z,Q,ce,oe,ae,Se,se,be,Me,Ie,Le){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q,Z,Q,ce,oe,ae,Se,se,be,Me,Ie,Le)}emplace(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k,V,j,B,q,Z,Q,ce,oe,ae,Se,se,be,Me,Ie,Le,Ue){const je=20*e,Fe=40*e,tt=80*e;return this.float32[je+0]=i,this.float32[je+1]=s,this.int16[Fe+4]=u,this.int16[Fe+5]=a,this.int16[Fe+6]=h,this.int16[Fe+7]=g,this.int16[Fe+8]=w,this.int16[Fe+9]=A,this.int16[Fe+10]=p,this.int16[Fe+11]=b,this.int16[Fe+12]=E,this.uint16[Fe+13]=x,this.uint16[Fe+14]=T,this.uint16[Fe+15]=C,this.uint16[Fe+16]=L,this.uint16[Fe+17]=k,this.uint16[Fe+18]=V,this.uint16[Fe+19]=j,this.uint16[Fe+20]=B,this.uint16[Fe+21]=q,this.uint16[Fe+22]=Z,this.uint16[Fe+23]=Q,this.uint16[Fe+24]=ce,this.uint16[Fe+25]=oe,this.uint16[Fe+26]=ae,this.uint16[Fe+27]=Se,this.uint32[je+14]=se,this.float32[je+15]=be,this.float32[je+16]=Me,this.float32[je+17]=Ie,this.float32[je+18]=Le,this.uint8[tt+76]=Ue,e}}Lh.prototype.bytesPerElement=80,Vt(Lh,"StructArrayLayout2f9i15ui1ul4f1ub80");class lo extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}lo.prototype.bytesPerElement=4,Vt(lo,"StructArrayLayout1f4");class Oo extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,u,a)}emplace(e,i,s,u,a,h){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=a,this.float32[g+4]=h,e}}Oo.prototype.bytesPerElement=20,Vt(Oo,"StructArrayLayout5f20");class Pu extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,a,h,g)}emplace(e,i,s,u,a,h,g,w){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=s,this.float32[A+2]=u,this.float32[A+3]=a,this.float32[A+4]=h,this.float32[A+5]=g,this.float32[A+6]=w,e}}Pu.prototype.bytesPerElement=28,Vt(Pu,"StructArrayLayout7f28");class Ru extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,a,h,g,w,A,p,b)}emplace(e,i,s,u,a,h,g,w,A,p,b,E){const x=11*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.float32[x+3]=a,this.float32[x+4]=h,this.float32[x+5]=g,this.float32[x+6]=w,this.float32[x+7]=A,this.float32[x+8]=p,this.float32[x+9]=b,this.float32[x+10]=E,e}}Ru.prototype.bytesPerElement=44,Vt(Ru,"StructArrayLayout11f44");class Du extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u,a,h,g,w,A)}emplace(e,i,s,u,a,h,g,w,A,p){const b=9*e;return this.float32[b+0]=i,this.float32[b+1]=s,this.float32[b+2]=u,this.float32[b+3]=a,this.float32[b+4]=h,this.float32[b+5]=g,this.float32[b+6]=w,this.float32[b+7]=A,this.float32[b+8]=p,e}}Du.prototype.bytesPerElement=36,Vt(Du,"StructArrayLayout9f36");class bc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s,u)}emplace(e,i,s,u,a){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=s,this.uint16[h+3]=u,this.uint16[h+4]=a,e}}bc.prototype.bytesPerElement=12,Vt(bc,"StructArrayLayout1ul3ui12");class Lu extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Lu.prototype.bytesPerElement=2,Vt(Lu,"StructArrayLayout1ui2");class wc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}wc.prototype.bytesPerElement=8,Vt(wc,"StructArrayLayout2f8");class kl extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L)}emplace(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k){const V=16*e;return this.float32[V+0]=i,this.float32[V+1]=s,this.float32[V+2]=u,this.float32[V+3]=a,this.float32[V+4]=h,this.float32[V+5]=g,this.float32[V+6]=w,this.float32[V+7]=A,this.float32[V+8]=p,this.float32[V+9]=b,this.float32[V+10]=E,this.float32[V+11]=x,this.float32[V+12]=T,this.float32[V+13]=C,this.float32[V+14]=L,this.float32[V+15]=k,e}}kl.prototype.bytesPerElement=64,Vt(kl,"StructArrayLayout16f64");class Tc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,a,h,g)}emplace(e,i,s,u,a,h,g,w){const A=10*e,p=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=s,this.uint16[A+2]=u,this.uint16[A+3]=a,this.float32[p+2]=h,this.float32[p+3]=g,this.float32[p+4]=w,e}}Tc.prototype.bytesPerElement=20,Vt(Tc,"StructArrayLayout4ui3f20");class Fs extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Fs.prototype.bytesPerElement=2,Vt(Fs,"StructArrayLayout1i2");class zh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}zh.prototype.bytesPerElement=1,Vt(zh,"StructArrayLayout1ub1");class Ia extends Ka{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ia.prototype.size=40;class zu extends id{get(e){return new Ia(this,e)}}Vt(zu,"CollisionBoxArray");class Sc extends Ka{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sc.prototype.size=60;class Ou extends Ol{get(e){return new Sc(this,e)}}Vt(Ou,"PlacedSymbolArray");class sp extends Ka{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}sp.prototype.size=80;class nd extends Lh{get(e){return new sp(this,e)}}Vt(nd,"SymbolInstanceArray");class ap extends lo{getoffsetX(e){return this.float32[1*e+0]}}Vt(ap,"GlyphOffsetArray");class ku extends Ja{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Vt(ku,"SymbolLineVertexArray");class rd extends Ka{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rd.prototype.size=12;class lp extends bc{get(e){return new rd(this,e)}}Vt(lp,"FeatureIndexArray");class od extends el{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Vt(od,"FillExtrusionCentroidArray");class sd extends Ka{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}sd.prototype.size=6;class go extends Mu{get(e){return new sd(this,e)}}Vt(go,"FillExtrusionWallArray");const ia=on([{name:"a_pos",components:2,type:"Int16"}],4),mm=on([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class rr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,u){let a=this.segments[this.segments.length-1];return e>rr.MAX_VERTEX_ARRAY_LENGTH&&ji(`Max vertices per segment is ${rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!a||a.vertexLength+e>rr.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==u)&&(a={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},u!==void 0&&(a.sortKey=u),this.segments.push(a)),a}prepareSegment(e,i,s,u){return this._prepareSegment(e,i.length,s.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new rr([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function Fu(r,e){return 256*(r=vt(Math.floor(r),0,255))+vt(Math.floor(e),0,255)}rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt(rr,"SegmentVector");const Ec=on([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),cp=on([{name:"a_dash",components:4,type:"Uint16"}]);class Ac{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(up(e)),this.positions.push(i,s,u)}eachPosition(e,i){const s=up(e);let u=0,a=this.ids.length-1;for(;u<a;){const h=u+a>>1;this.ids[h]>=s?a=h:u=h+1}for(;this.ids[u]===s;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Fl(s,u,0,s.length-1),i&&(i.add(s.buffer),i.add(u.buffer)),{ids:s,positions:u}}static deserialize(e){const i=new Ac;let s;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==s&&i.uniqueIds.push(u),s=u;return i.indexed=!0,i}}function up(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ho(String(r))}function Fl(r,e,i,s){for(;i<s;){const u=r[i+s>>1];let a=i-1,h=s+1;for(;;){do a++;while(r[a]<u);do h--;while(r[h]>u);if(a>=h)break;Ca(r,a,h),Ca(e,3*a,3*h),Ca(e,3*a+1,3*h+1),Ca(e,3*a+2,3*h+2)}h-i<s-h?(Fl(r,e,i,h),i=h+1):(Fl(r,e,h+1,s),s=h)}}function Ca(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}Vt(Ac,"FeaturePositionMap");class Xo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Bl extends Xo{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Er extends Xo{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Bs extends Xo{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Mc extends Xo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Bu extends Xo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Ic extends Xo{constructor(e){super(e),this.current=_n.transparent.toRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Oh=new Float32Array(16);class tl extends Xo{constructor(e){super(e),this.current=Oh}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const _m=new Float32Array(9),ad=new Float32Array(4);class Nl extends Xo{constructor(e){super(e),this.current=ad}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function kh(r){return[Fu(255*r.r,255*r.g),Fu(255*r.b,255*r.a)]}class Ul{constructor(e,i,s,u){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=s,this.context=u}setUniform(e,i,s,u,a){const h=u.constantOr(this.value);i.set(e,a,h instanceof _n?h.toRenderColor(this.context.lut):h)}getBinding(e,i){return this.type==="color"?new Ic(e):new Er(e)}}class Cc{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,u,a){const h=a==="u_pattern"||a==="u_dash"?this.pattern:a==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,a,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Bu(e):new Er(e)}}class na{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(a=>({name:`a_${a}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,a,h,g){const w=this.paintVertexArray.length,A=this.expression.evaluate(new Kn(0,{brightness:h}),i,{},a,u,g);this.paintVertexArray.resize(e),this._setPaintValue(w,e,A,this.context)}updatePaintArray(e,i,s,u,a,h,g){const w=this.expression.evaluate({zoom:0,brightness:g},s,u,void 0,a);this._setPaintValue(e,i,w,this.context)}_setPaintValue(e,i,s,u){if(this.type==="color"){const a=kh(s.toRenderColor(u.lut));for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(e,i,s,u,a,h){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=u,this.context=a,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,s,u,a,h,g){const w=this.expression.evaluate(new Kn(this.context.zoom,{brightness:h}),i,{},a,u,g),A=this.expression.evaluate(new Kn(this.context.zoom+1,{brightness:h}),i,{},a,u,g),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,w,A,this.context)}updatePaintArray(e,i,s,u,a,h,g){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:g},s,u,void 0,a),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},s,u,void 0,a);this._setPaintValue(e,i,w,A,this.context)}_setPaintValue(e,i,s,u,a){if(this.type==="color"){const h=kh(s.toRenderColor(a.lut)),g=kh(s.toRenderColor(a.lut));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,h[0],h[1],g[0],g[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,u,a){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=vt(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);i.set(e,a,g)}getBinding(e,i){return new Er(e)}}class ra{constructor(e,i,s,u,a){this.expression=e,this.layerId=a,this.paintVertexAttributes=(s==="array"?cp:Ec).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new u}populatePaintArray(e,i,s,u){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,a,h,g){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,i,s,u){if(!u||!s)return;const a=u[s];if(!a)return;const{tl:h,br:g,pixelRatio:w}=a;for(let A=e;A<i;A++)this.paintVertexArray.emplace(A,h[0],h[1],g[0],g[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oa{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const u=[];for(const a in e.paint._values){const h=e.paint.get(a);if(!s(a)||!(h instanceof cs&&Ml(h.property.specification)))continue;const g=gm(a,e.type),w=h.value,A=h.property.specification.type,p=!!h.property.useIntegerZoom,b=a==="line-dasharray"||a.endsWith("pattern"),E=a==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||E)if(w.kind==="source"||E||b){const x=Fh(a,A,"source");this.binders[a]=b?new ra(w,g,A,x,e.id):new na(w,g,A,x),u.push(`/a_${a}`)}else{const x=Fh(a,A,"composite");this.binders[a]=new eo(w,g,A,p,i,x),u.push(`/z_${a}`)}else this.binders[a]=b?new Cc(w.value,g):new Ul(w.value,g,A,i),u.push(`/u_${a}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof na||i instanceof eo?i.maxValue:0}populatePaintArrays(e,i,s,u,a,h,g){for(const w in this.binders){const A=this.binders[w];A.context=this.context,(A instanceof na||A instanceof eo||A instanceof ra)&&A.populatePaintArray(e,i,s,u,a,h,g)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof Cc&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,u,a,h,g,w){let A=!1;const p=Object.keys(e),b=p.length!==0,E=b?p:i.uniqueIds;this.context.lut=a.lut;for(const x in this.binders){const T=this.binders[x];if(T.context=this.context,(T instanceof na||T instanceof eo||T instanceof ra)&&(T.expression.isStateDependent===!0||T.expression.isLightConstant===!1)){const C=a.paint.get(x);T.expression=C.value;for(const L of E){const k=e[L.toString()];i.eachPosition(L,(V,j,B)=>{const q=u.feature(V);T.updatePaintArray(j,B,q,k,h,g,w)})}if(!b)for(const L of s.uniqueIds){const k=e[L.toString()];s.eachPosition(L,(V,j,B)=>{const q=u.feature(V);T.updatePaintArray(j,B,q,k,h,g,w)})}A=!0}}return A}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Ul||s instanceof Cc)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof na||s instanceof eo||s instanceof ra)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ul||s instanceof Cc||s instanceof eo)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Ul||u instanceof Cc||u instanceof eo)for(const a of u.uniformNames)i.push({name:a,property:s,binding:u.getBinding(e,a)})}return i}setUniforms(e,i,s,u,a){for(const{name:h,property:g,binding:w}of s)this.binders[g].setUniform(e,w,a,u.get(g),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof na||i instanceof eo||i instanceof ra)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof na||s instanceof eo||s instanceof ra)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof na||i instanceof eo||i instanceof ra)&&i.destroy()}}}class sa{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new oa(u,i,s);this.needsUpload=!1,this._featureMap=new Ac,this._featureMapWithoutIds=new Ac,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,u,a,h,g,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,i,u,a,h,g,w);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,a,h){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,g,u,a,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const hp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gm(r,e){return hp[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const ym={"line-pattern":{source:ks,composite:ks},"fill-pattern":{source:ks,composite:ks},"fill-extrusion-pattern":{source:ks,composite:ks},"line-dasharray":{source:an,composite:an}},Pa={color:{source:wc,composite:Os},number:{source:lo,composite:wc}};function Fh(r,e,i){const s=ym[r];return s&&s[i]||Pa[e][i]}Vt(Ul,"ConstantBinder"),Vt(Cc,"PatternConstantBinder"),Vt(na,"SourceExpressionBinder"),Vt(ra,"PatternCompositeBinder"),Vt(eo,"CompositeExpressionBinder"),Vt(oa,"ProgramConfiguration",{omit:["_buffers"]}),Vt(sa,"ProgramConfigurationSet");const to=wt/Math.PI/2,Bh=5,l=6,t=16383,n=64,c=[n,32,16],f=-to,_=to;function y(r,e,i,s=to){return i=pt(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function M(r,e,i){return y(Math.cos(pt(r)),Math.sin(pt(r)),e,i)}const P=63710088e-1,D=2*Math.PI*P;class R{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new R(Di(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,a=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return P*Math.acos(Math.min(a,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new F({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return M(this.lat,this.lng,to+e*to/P)}static convert(e){if(e instanceof R)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new R(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new R(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class F{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}setSouthWest(e){return this._sw=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,a;if(e instanceof R)u=e,a=e;else{if(!(e instanceof F))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(F.convert(e)):this.extend(R.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(R.convert(e)):this;if(u=e._sw,a=e._ne,!u||!a)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(a.lng,s.lng),s.lat=Math.max(a.lat,s.lat)):(this._sw=new R(u.lng,u.lat),this._ne=new R(a.lng,a.lat)),this}getCenter(){return new R((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new R(this.getWest(),this.getNorth())}getSouthEast(){return new R(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=R.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){if(e)return e instanceof F?e:new F(e)}}const N=0,G=25.5;function X(r){return D*Math.cos(r*Math.PI/180)}function W(r){return(180+r)/360}function K(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Y(r,e){return r/X(e)}function te(r){return 360*r-180}function re(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function le(r,e){return r*X(re(e))}const fe=85.051129;function me(r){return Math.cos(pt(vt(r,-fe,fe)))}function de(r,e){const i=vt(e,N,G),s=Math.pow(2,i);return me(r)*D/(512*s)}function ge(r){return 1/Math.cos(r*Math.PI/180)}function Te(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/wt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/wt/(1<<r.z)}class Ce{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=R.convert(e);return new Ce(W(s.lng),K(s.lat),Y(i,s.lat))}toLngLat(){return new R(te(this.x),re(this.y))}toAltitude(){return le(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/D*ge(re(this.y))}}function Ae(r,e,i,s,u,a,h,g,w){const A=(e+s)/2,p=(i+u)/2,b=new he(A,p);g(b),function(E,x,T,C,L,k){const V=T-L,j=C-k;return Math.abs((C-x)*V-(T-E)*j)/Math.hypot(V,j)}(b.x,b.y,a.x,a.y,h.x,h.y)>=w?(Ae(r,e,i,A,p,a,b,g,w),Ae(r,A,p,s,u,b,h,g,w)):r.push(h)}function Ee(r,e,i){let s=r[0],u=s.x,a=s.y;e(s);const h=[s];for(let g=1;g<r.length;g++){const w=r[g],{x:A,y:p}=w;e(w),Ae(h,u,a,A,p,s,w,e,i),u=A,a=p,s=w}return h}function Ge(r,e,i,s){if(s(e,i)){const u=e.add(i)._mult(.5);Ge(r,e,u,s),Ge(r,u,i,s)}else r.push(i)}function Ye(r,e){let i=r[0];const s=[i];for(let u=1;u<r.length;u++){const a=r[u];Ge(s,i,a,e),i=a}return s}const at=Math.pow(2,14)-1,_t=-at-1;function bt(r,e){const i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=vt(i,_t,at),r.y=vt(s,_t,at),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function ke(r,e,i){const s=r.loadGeometry(),u=r.extent,a=wt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:g,x:w,y:A,projection:p}=i,b=E=>{const x=te((e.x+E.x/u)/h),T=re((e.y+E.y/u)/h),C=p.project(x,T);E.x=(C.x*g-w)*u,E.y=(C.y*g-A)*u};for(let E=0;E<s.length;E++)if(r.type!==1)s[E]=Ee(s[E],b,1);else{const x=[];for(const T of s[E])T.x<0||T.x>=u||T.y<0||T.y>=u||(b(T),x.push(T));s[E]=x}}for(const h of s)for(const g of h)bt(g,a);return s}function rt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?ke(r):[]}}function $e(r,e,i,s,u){r.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}function nt(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ja,this.indexArray=new qn,this.segments=new rr,this.programConfigurations=new sa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,s,u){const a=this.layers[0],h=[];let g=null;a.type==="circle"&&(g=a.layout.get("circle-sort-key"));for(const{feature:A,id:p,index:b,sourceLayerIndex:E}of e){const x=this.layers[0]._featureFilter.needGeometry,T=rt(A,x);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),T,s))continue;const C=g?g.evaluate(T,{},s):void 0,L={id:p,properties:A.properties,type:A.type,sourceLayerIndex:E,index:b,geometry:x?T.geometry:ke(A,s,u),patterns:{},sortKey:C};h.push(L)}g&&h.sort((A,p)=>A.sortKey-p.sortKey);let w=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Cu,w=u.projection);for(const A of h){const{geometry:p,index:b,sourceLayerIndex:E}=A,x=e[b].feature;this.addFeature(A,p,b,i.availableImages,s,w,i.brightness),i.featureIndex.insert(x,p,b,E,this.index)}}update(e,i,s,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,s,u,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ia.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,u,a,h,g){for(const w of i)for(const A of w){const p=A.x,b=A.y;if(p<0||p>=wt||b<0||b>=wt)continue;if(h){const T=h.projectTilePoint(p,b,a),C=h.upVector(a,p,b),L=this.globeExtVertexArray;nt(L,T,C),nt(L,T,C),nt(L,T,C),nt(L,T,C)}const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),x=E.vertexLength;$e(this.layoutVertexArray,p,b,-1,-1),$e(this.layoutVertexArray,p,b,1,-1),$e(this.layoutVertexArray,p,b,1,1),$e(this.layoutVertexArray,p,b,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,a,g)}}function ot(r,e){for(let i=0;i<r.length;i++)if(Ui(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Ui(r,e[i]))return!0;return!!kt(r,e)}function St(r,e,i){return!!Ui(r,e)||!!zt(e,r,i)}function Wt(r,e){if(r.length===1)return Si(e,r[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(Ui(r,s[u]))return!0}for(let i=0;i<r.length;i++)if(Si(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(kt(r,e[i]))return!0;return!1}function ti(r,e,i){if(r.length>1){if(kt(r,e))return!0;for(let s=0;s<e.length;s++)if(zt(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(zt(r[s],e,i))return!0;return!1}function kt(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const s=r[i],u=r[i+1];for(let a=0;a<e.length-1;a++)if(Kt(s,u,e[a],e[a+1]))return!0}return!1}function Kt(r,e,i,s){return Zs(r,i,s)!==Zs(e,i,s)&&Zs(r,e,i)!==Zs(r,e,s)}function zt(r,e,i){const s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(ai(r,e[u-1],e[u])<s)return!0;return!1}function ai(r,e,i){const s=e.distSqr(i);if(s===0)return r.distSqr(e);const u=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Si(r,e){let i,s,u,a=!1;for(let h=0;h<r.length;h++){i=r[h];for(let g=0,w=i.length-1;g<i.length;w=g++)s=i[g],u=i[w],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(a=!a)}return a}function Ui(r,e){let i=!1;for(let s=0,u=r.length-1;s<r.length;u=s++){const a=r[s],h=r[u];a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(i=!i)}return i}function Mn(r,e,i,s,u){for(const h of r)if(e<=h.x&&i<=h.y&&s>=h.x&&u>=h.y)return!0;const a=[new he(e,i),new he(e,u),new he(s,u),new he(s,i)];if(r.length>2){for(const h of a)if(Ui(r,h))return!0}for(let h=0;h<r.length-1;h++)if(en(r[h],r[h+1],a))return!0;return!1}function en(r,e,i){const s=i[0],u=i[2];if(r.x<s.x&&e.x<s.x||r.x>u.x&&e.x>u.x||r.y<s.y&&e.y<s.y||r.y>u.y&&e.y>u.y)return!1;const a=Zs(r,e,i[0]);return a!==Zs(r,e,i[1])||a!==Zs(r,e,i[2])||a!==Zs(r,e,i[3])}function kn(r,e,i,s,u,a){let h=e.y-r.y,g=r.x-e.x;if(a=a||0){const w=h*h+g*g;if(w===0)return!0;const A=Math.sqrt(w);h/=A,g/=A}return!((i.x-r.x)*h+(i.y-r.y)*g-a<0||(s.x-r.x)*h+(s.y-r.y)*g-a<0||(u.x-r.x)*h+(u.y-r.y)*g-a<0)}function ln(r,e,i,s,u,a,h){return!(kn(r,e,s,u,a,h)||kn(e,i,s,u,a,h)||kn(i,r,s,u,a,h)||kn(s,u,r,e,i,h)||kn(u,a,r,e,i,h)||kn(a,s,r,e,i,h))}function In(r,e,i){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Fi(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function An(r,e,i,s,u){if(!e[0]&&!e[1])return r;const a=he.convert(e)._mult(u);i==="viewport"&&a._rotate(-s);const h=[];for(let g=0;g<r.length;g++)h.push(r[g].sub(a));return h}function bn(r,e,i,s){const u=he.convert(r)._mult(s);return e==="viewport"&&u._rotate(-i),u}let hn,Un;Vt(lt,"CircleBucket",{omit:["layers"]});var gr,ko={exports:{}},us=(gr||(gr=1,function(r,e){(function(i){function s(a,h,g){var w=u(256*a,256*(h=Math.pow(2,g)-h-1),g),A=u(256*(a+1),256*(h+1),g);return w[0]+","+w[1]+","+A[0]+","+A[1]}function u(a,h,g){var w=2*Math.PI*6378137/256/Math.pow(2,g);return[a*w-2*Math.PI*6378137/2,h*w-2*Math.PI*6378137/2]}i.getURL=function(a,h,g,w,A,p){return p=p||{},a+"?"+["bbox="+s(g,w,A),"format="+(p.format||"image/png"),"service="+(p.service||"WMS"),"version="+(p.version||"1.1.1"),"request="+(p.request||"GetMap"),"srs="+(p.srs||"EPSG:3857"),"width="+(p.width||256),"height="+(p.height||256),"layers="+h].join("&")},i.getTileBBox=s,i.getMercCoords=u,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,ko.exports)),ko.exports);class kr{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=cn(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=us.getTileBBox(this.x,this.y,this.z),u=function(a,h,g){let w,A="";for(let p=a;p>0;p--)w=1<<p-1,A+=(h&w?1:0)+(g&w?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xi{constructor(e,i){this.wrap=e,this.canonical=i,this.key=cn(e,i.z,i.z,i.x,i.y)}}class Vi{constructor(e,i,s,u,a){this.overscaledZ=e,this.wrap=i,this.canonical=new kr(s,+u,+a),this.key=i===0&&e===s?this.canonical.key:cn(i,e,s,u,a)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Vi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return cn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return cn(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Vi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Vi(i,this.wrap,i,s,u),new Vi(i,this.wrap,i,s+1,u),new Vi(i,this.wrap,i,s,u+1),new Vi(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function cn(r,e,i,s,u){const a=1<<Math.min(i,22);let h=a*(u%a)+s%a;return r&&i<22&&(h+=a*a*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}const Rn=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new Vi(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new Vi(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new Vi(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Vi(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Vt(kr,"CanonicalTileID"),Vt(Vi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const or=on([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$n}=or,$r=on([{name:"a_pos_3",components:3,type:"Int16"}]);var aa=on([{name:"a_pos",type:"Int16",components:2}]);class dr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=ye.vec3.dot(i,this.dir);if(Math.abs(u)<1e-6)return!1;const a=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*a,s[1]=this.pos[1]+this.dir[1]*a,s[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(e,i,s){if(ye.vec3.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[u,a,h]=this.dir,g=this.pos[0]-e[0],w=this.pos[1]-e[1],A=this.pos[2]-e[2],p=u*u+a*a+h*h,b=2*(g*u+w*a+A*h),E=b*b-4*p*(g*g+w*w+A*A-i*i);if(E<0){const x=Math.max(-b/2,0),T=g+u*x,C=w+a*x,L=A+h*x,k=Math.hypot(T,C,L);return s[0]=T*i/k,s[1]=C*i/k,s[2]=L*i/k,!1}{const x=(-b-Math.sqrt(E))/(2*p);if(x<0){const T=Math.hypot(g,w,A);return s[0]=g*i/T,s[1]=w*i/T,s[2]=A*i/T,!1}return s[0]=g+u*x,s[1]=w+a*x,s[2]=A+h*x,!0}}}class Fo{constructor(e,i,s,u,a){this.TL=e,this.TR=i,this.BR=s,this.BL=u,this.horizon=a}static fromInvProjectionMatrix(e,i,s){const u=[-1,1,1],a=[1,1,1],h=[1,-1,1],g=[-1,-1,1],w=ye.vec3.transformMat4(u,u,e),A=ye.vec3.transformMat4(a,a,e),p=ye.vec3.transformMat4(h,h,e),b=ye.vec3.transformMat4(g,g,e);return new Fo(w,A,p,b,i/s)}}function hs(r,e,i){let s=1/0,u=-1/0;const a=[];for(const h of r){ye.vec3.sub(a,h,e);const g=ye.vec3.dot(a,i);s=Math.min(s,g),u=Math.max(u,g)}return[s,u]}function Ns(r,e){let i=!0;for(let s=0;s<r.planes.length;s++){const u=r.planes[s];let a=0;for(let h=0;h<e.length;h++)a+=ye.vec3.dot(u,e[h])+u[3]>=0;if(a===0)return 0;a!==e.length&&(i=!1)}return i?2:1}function Co(r,e){for(const i of r.projections){const s=hs(e,r.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Ra(r,e){let i=0;const s=[0,0,0,0];for(let u=0;u<r.length;u++)s[0]=r[u][0],s[1]=r[u][1],s[2]=r[u][2],s[3]=1,ye.vec4.dot(s,e)>=0&&i++;return i}class fs{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=gn.fromPoints(this.points),this.projections=[],this.frustumEdges=[ye.vec3.sub([],this.points[2],this.points[3]),ye.vec3.sub([],this.points[0],this.points[3]),ye.vec3.sub([],this.points[4],this.points[0]),ye.vec3.sub([],this.points[5],this.points[1]),ye.vec3.sub([],this.points[6],this.points[2]),ye.vec3.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const u=[0,-s[2],s[1]],a=[s[2],0,-s[0]];this.projections.push({axis:u,projection:hs(this.points,this.points[0],u)}),this.projections.push({axis:a,projection:hs(this.points,this.points[0],a)})}}static fromInvProjectionMatrix(e,i,s,u){const a=Math.pow(2,s),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const p=ye.vec4.transformMat4([],A,e),b=1/p[3]/i*a;return ye.vec4.mul(p,p,[b,b,u?1/p[3]:b,b])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const p=ye.vec3.sub([],h[A[0]],h[A[1]]),b=ye.vec3.sub([],h[A[2]],h[A[1]]),E=ye.vec3.normalize([],ye.vec3.cross([],p,b)),x=-ye.vec3.dot(E,h[A[1]]);return E.concat(x)}),w=[];for(let A=0;A<h.length;A++)w.push([h[A][0],h[A][1],h[A][2]]);return new fs(w,g)}intersectsPrecise(e,i,s){for(let u=0;u<i.length;u++)if(!Ra(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Ra(e,this.planes[u]))return 0;for(const u of s)for(const a of this.frustumEdges){const h=ye.vec3.cross([],u,a),g=ye.vec3.length(h);if(g===0)continue;ye.vec3.scale(h,h,1/g);const w=hs(this.points,this.points[0],h),A=hs(e,this.points[0],h);if(w[0]>A[1]||A[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(ye.vec3.dot([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class gn{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)ye.vec3.min(i,i,u),ye.vec3.max(s,s,u);return new gn(i,s)}static fromTileIdAndHeight(e,i,s){const u=1<<e.canonical.z,a=e.canonical.x,h=e.canonical.y;return new gn([a/u,h/u,i],[(a+1)/u,(h+1)/u,s])}static applyTransform(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)ye.vec3.transformMat4(s[u],s[u],i);return gn.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],u=[...s];for(let a=0;a<3;a++)for(let h=0;h<3;h++){const g=i[4*h+a],w=g*e.min[h],A=g*e.max[h];s[a]+=Math.min(w,A),u[a]+=Math.max(w,A)}return new gn(s,u)}static projectAabbCorners(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)ye.vec3.transformMat4(s[u],s[u],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=ye.vec3.scale([],ye.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=ye.vec3.clone(this.min),u=ye.vec3.clone(this.max);for(let a=0;a<i.length;a++)s[a]=i[a]?this.min[a]:this.center[a],u[a]=i[a]?this.center[a]:this.max[a];return u[2]=this.max[2],new gn(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ns(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ns(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Co(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Co(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Pc(r){return r*to/P}Vt(gn,"Aabb");const Nu=[new gn([f,f,f],[_,_,_]),new gn([f,f,f],[0,0,_]),new gn([0,f,f],[_,0,_]),new gn([f,0,f],[0,_,_]),new gn([0,0,f],[_,_,_])];function Rc(r,e,i,s=!0){const u=ye.vec3.scale([],r._camera.position,r.worldSize),a=[e,i,1,1];ye.vec4.transformMat4(a,a,r.pixelMatrixInverse),ye.vec4.scale(a,a,1/a[3]);const h=ye.vec3.sub([],a,u),g=ye.vec3.normalize([],h),w=r.globeMatrix,A=[w[12],w[13],w[14]],p=ye.vec3.sub([],A,u),b=ye.vec3.length(p),E=ye.vec3.normalize([],p),x=r.worldSize/(2*Math.PI),T=ye.vec3.dot(E,g),C=Math.asin(x/b);if(C<Math.acos(T)){if(!s)return null;const Se=[],se=[];ye.vec3.scale(Se,g,b/T),ye.vec3.normalize(se,ye.vec3.sub(se,Se,p)),ye.vec3.normalize(g,ye.vec3.add(g,p,ye.vec3.scale(g,se,Math.tan(C)*b)))}const L=[];new dr(u,g).closestPointOnSphere(A,x,L);const k=ye.vec3.normalize([],Jl(w,0)),V=ye.vec3.normalize([],Jl(w,1)),j=ye.vec3.normalize([],Jl(w,2)),B=ye.vec3.dot(k,L),q=ye.vec3.dot(V,L),Z=ye.vec3.dot(j,L),Q=Xt(Math.asin(-q/x));let ce=Xt(Math.atan2(B,Z));ce=r.center.lng+function(Se,se){const be=(se-Se+180)%360-180;return be<-180?be+360:be}(r.center.lng,ce);const oe=W(ce),ae=vt(K(Q),0,1);return new Ce(oe,ae)}class ld{constructor(e,i,s){this.a=ye.vec3.sub([],e,s),this.b=ye.vec3.sub([],i,s),this.center=s;const u=ye.vec3.normalize([],this.a),a=ye.vec3.normalize([],this.b);this.angle=Math.acos(ye.vec3.dot(u,a))}}function Uu(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(s,u,a,h){const g=Math.sin(a);return s*(Math.sin((1-h)*a)/g)+u*(Math.sin(h*a)/g)}(r.a[e],r.b[e],r.angle,vt(i,0,1))+r.center[e]}function il(r){if(r.z<=1)return Nu[r.z+2*r.y+r.x];const e=xm(fp(r));return gn.fromPoints(e)}function Vl(r,e,i){return ye.vec3.scale(r,r,1-i),ye.vec3.scaleAndAdd(r,r,e,i)}function q_(r,e,i){for(const s of r)ye.vec3.transformMat4(s,s,e),ye.vec3.scale(s,s,i)}function $_(r,e,i,s){const u=e/r.worldSize,a=r.globeMatrix;if(i.z<=1){const oe=il(i).getCorners();return q_(oe,a,u),gn.fromPoints(oe)}const h=fp(i,s),g=xm(h,to+Pc(r._tileCoverLift));q_(g,a,u);const w=Number.MAX_VALUE,A=[-w,-w,-w],p=[w,w,w];if(h.contains(r.center)){for(const Se of g)ye.vec3.min(p,p,Se),ye.vec3.max(A,A,Se);A[2]=0;const oe=r.point,ae=[oe.x*u,oe.y*u,0];return ye.vec3.min(p,p,ae),ye.vec3.max(A,A,ae),new gn(p,A)}if(r._tileCoverLift>0){for(const oe of g)ye.vec3.min(p,p,oe),ye.vec3.max(A,A,oe);return new gn(p,A)}const b=[a[12]*u,a[13]*u,a[14]*u],E=h.getCenter(),x=vt(r.center.lat,-fe,fe),T=vt(E.lat,-fe,fe),C=W(r.center.lng),L=K(x);let k=C-W(E.lng);const V=L-K(T);k>.5?k-=1:k<-.5&&(k+=1);let j=0;if(Math.abs(k)>Math.abs(V))j=k>=0?1:3;else{j=V>=0?0:2;const oe=[a[4]*u,a[5]*u,a[6]*u],ae=-Math.sin(pt(V>=0?h.getSouth():h.getNorth()))*to;ye.vec3.scaleAndAdd(b,b,oe,ae)}const B=g[j],q=g[(j+1)%4],Z=new ld(B,q,b),Q=[Uu(Z,0)||B[0],Uu(Z,1)||B[1],Uu(Z,2)||B[2]],ce=Dc(r.zoom);if(ce>0){const oe=function({x:Se,y:se,z:be},Me,Ie,Le,Ue){const je=1/(1<<be);let Fe=Se*je,tt=Fe+je,dt=se*je,Xe=dt+je,Bt=0;const Et=(Fe+tt)/2-Le;return Et>.5?Bt=-1:Et<-.5&&(Bt=1),Fe=((Fe+Bt)*Me-(Le*=Me))*Ie+Le,tt=((tt+Bt)*Me-Le)*Ie+Le,dt=(dt*Me-(Ue*=Me))*Ie+Ue,Xe=(Xe*Me-Ue)*Ie+Ue,[[Fe,Xe,0],[tt,Xe,0],[tt,dt,0],[Fe,dt,0]]}(i,e,r._pixelsPerMercatorPixel,C,L);for(let Se=0;Se<g.length;Se++)Vl(g[Se],oe[Se],ce);const ae=ye.vec3.add([],oe[j],oe[(j+1)%4]);ye.vec3.scale(ae,ae,.5),Vl(Q,ae,ce)}for(const oe of g)ye.vec3.min(p,p,oe),ye.vec3.max(A,A,oe);return p[2]=Math.min(B[2],q[2]),ye.vec3.min(p,p,Q),ye.vec3.max(A,A,Q),new gn(p,A)}function fp({x:r,y:e,z:i},s=!1){const u=1/(1<<i),a=new R(te(r*u),e===(1<<i)-1&&s?-90:re((e+1)*u)),h=new R(te((r+1)*u),e===0&&s?90:re(e*u));return new F(a,h)}function xm(r,e=to){const i=pt(r.getNorth()),s=pt(r.getSouth()),u=Math.cos(i),a=Math.cos(s),h=Math.sin(i),g=Math.sin(s),w=r.getWest(),A=r.getEast();return[y(a,g,w,e),y(a,g,A,e),y(u,h,A,e),y(u,h,w,e)]}function cd(r,e,i,s){const u=1<<i.z,a=(r/wt+i.x)/u;return M(re((e/wt+i.y)/u),te(a),s)}function dp({min:r,max:e}){return t/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const H_=new Float64Array(16);function pp(r){const e=dp(r),i=ye.mat4.fromScaling(H_,[e,e,e]);return ye.mat4.translate(i,i,ye.vec3.negate([],r.min))}function vm(r){const e=ye.mat4.fromTranslation(H_,r.min),i=1/dp(r);return ye.mat4.scale(e,e,[i,i,i])}function bm(r){const e=wt/(2*Math.PI);return r/(2*Math.PI)/e}function W_(r,e){return wt/(512*Math.pow(2,r))*dp(il(e))}function Z_(r,e,i,s,u){const a=bm(i),h=[r,e,-i/(2*Math.PI)],g=ye.mat4.identity(new Float64Array(16));return ye.mat4.translate(g,g,h),ye.mat4.scale(g,g,[a,a,a]),ye.mat4.rotateX(g,g,pt(-u)),ye.mat4.rotateY(g,g,pt(-s)),g}function Dc(r){return xi(Bh,l,r)}function X_(r,e){const i=M(e.lat,e.lng),s=function(a){const h=M(a._center.lat,a._center.lng),g=ye.vec3.fromValues(0,1,0);let w=ye.vec3.cross([],g,h);const A=ye.mat4.fromRotation([],-a.angle,h);w=ye.vec3.transformMat4(w,w,A),ye.mat4.fromRotation(A,-a._pitch,w);const p=ye.vec3.normalize([],h);return ye.vec3.scale(p,p,Pc(a.cameraToCenterDistance/a.pixelsPerMeter)),ye.vec3.transformMat4(p,p,A),ye.vec3.add([],h,p)}(r),u=ye.vec3.subtract([],s,i);return ye.vec3.angle(u,i)}function wm(r,e){return X_(r,e)>Math.PI/2*1.01}const mp=pt(85),Y_=Math.cos(mp),_0=Math.sin(mp),g0=ye.mat4.create(),K_=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function J_(r,e,i,s,u,a,h,g,w){if(a&&r.queryGeometry.isAboveHorizon)return!1;a&&(w*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,p=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const b of e)for(const E of b){const x=E.add(g),T=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(x.x,x.y,!0):0,C=i.projection.projectTilePoint(x.x,x.y,A);if(T>0){const j=i.projection.upVector(A,x.x,x.y);C.x+=j[0]*p*T,C.y+=j[1]*p*T,C.z+=j[2]*p*T}const L=a?x:y0(C.x,C.y,C.z,s),k=a?r.tilespaceRays.map(j=>v0(j,T)):r.queryGeometry.screenGeometry,V=ye.vec4.transformMat4([],[C.x,C.y,C.z,1],s);if(!h&&a?w*=V[3]/i.cameraToCenterDistance:h&&!a&&(w*=i.cameraToCenterDistance/V[3]),a){const j=re((E.y/wt+A.y)/(1<<A.z));w/=i.projection.pixelsPerMeter(j,1)/Y(1,j)}if(St(k,L,w))return!0}return!1}function y0(r,e,i,s){const u=ye.vec4.transformMat4([],[r,e,i,1],s);return new he(u[0]/u[3],u[1]/u[3])}const Q_=ye.vec3.fromValues(0,0,0),x0=ye.vec3.fromValues(0,0,1);function v0(r,e){const i=ye.vec3.create();return Q_[2]=e,r.intersectsPlane(Q_,x0,i),new he(i[0],i[1])}class Tm extends lt{}let eg,ud,tg,ig;function ng(r,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=u,r}function rg(r,e,i){const{width:s,height:u}=e;s===r.width&&u===r.height||(Sm(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,u)},i,null),r.width=s,r.height=u,r.data=e.data)}function Sm(r,e,i,s,u,a,h,g){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||i.x>r.width-u.width||i.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const w=r.data,A=e.data,p=a===4&&g;for(let b=0;b<u.height;b++){const E=((i.y+b)*r.width+i.x)*a,x=((s.y+b)*e.width+s.x)*a;if(p)for(let T=0;T<u.width;T++){const C=E+T*a+3,L=x+T*a;A[L+0]=255,A[L+1]=255,A[L+2]=255,A[L+3]=w[C]}else if(h)for(let T=0;T<u.width;T++){const C=E+T*a,L=x+T*a,k=w[C+3],V=new _n(w[C+0]/255*k,w[C+1]/255*k,w[C+2]/255*k,k).toRenderColor(h).toArray();A[L+0]=V[0],A[L+1]=V[1],A[L+2]=V[2],A[L+3]=V[3]}else for(let T=0;T<u.width*a;T++)A[x+T]=w[E+T]}return e}Vt(Tm,"HeatmapBucket",{omit:["layers"]});class Lc{constructor(e,i){ng(this,e,1,i)}resize(e){rg(this,new Lc(e),1)}clone(){return new Lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,a){Sm(e,i,s,u,a,1,null)}}class Po{constructor(e,i){ng(this,e,4,i)}resize(e){rg(this,new Po(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,a,h,g){Sm(e,i,s,u,a,4,h,g)}}class og{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function hd(r){const e={},i=r.resolution||256,s=r.clips?r.clips.length:1,u=r.image||new Po({width:i,height:s}),a=(h,g,w)=>{e[r.evaluationKey]=w;const A=r.expression.evaluate(e);A&&(u.data[h+g+0]=Math.floor(255*A.r/A.a),u.data[h+g+1]=Math.floor(255*A.g/A.a),u.data[h+g+2]=Math.floor(255*A.b/A.a),u.data[h+g+3]=Math.floor(255*A.a))};if(r.clips)for(let h=0,g=0;h<s;++h,g+=4*i)for(let w=0,A=0;w<i;w++,A+=4){const p=w/(i-1),{start:b,end:E}=r.clips[h];a(g,A,b*(1-p)+E*p)}else for(let h=0,g=0;h<i;h++,g+=4)a(0,g,h/(i-1));return u}Vt(Lc,"AlphaImage"),Vt(Po,"RGBAImage");const b0=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:w0}=b0;function fd(r,e,i=2){const s=e&&e.length,u=s?e[0]*i:r.length;let a=sg(r,0,u,i,!0);const h=[];if(!a||a.next===a.prev)return h;let g,w,A;if(s&&(a=function(p,b,E,x){const T=[];for(let C=0,L=b.length;C<L;C++){const k=sg(p,b[C]*x,C<L-1?b[C+1]*x:p.length,x,!1);k===k.next&&(k.steiner=!0),T.push(I0(k))}T.sort(E0);for(let C=0;C<T.length;C++)E=A0(T[C],E);return E}(r,e,a,i)),r.length>80*i){g=1/0,w=1/0;let p=-1/0,b=-1/0;for(let E=i;E<u;E+=i){const x=r[E],T=r[E+1];x<g&&(g=x),T<w&&(w=T),x>p&&(p=x),T>b&&(b=T)}A=Math.max(p-g,b-w),A=A!==0?32767/A:0}return dd(a,h,i,g,w,A,0),h}function sg(r,e,i,s,u){let a;if(u===function(h,g,w,A){let p=0;for(let b=g,E=w-A;b<w;b+=A)p+=(h[E]-h[b])*(h[b+1]+h[E+1]),E=b;return p}(r,e,i,s)>0)for(let h=e;h<i;h+=s)a=hg(h/s|0,r[h],r[h+1],a);else for(let h=i-s;h>=e;h-=s)a=hg(h/s|0,r[h],r[h+1],a);return a&&_p(a,a.next)&&(zc(a),a=a.next),a}function Vu(r,e){if(!r)return r;e||(e=r);let i,s=r;do if(i=!1,s.steiner||!_p(s,s.next)&&Fr(s.prev,s,s.next)!==0)s=s.next;else{if(zc(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function dd(r,e,i,s,u,a,h){if(!r)return;!h&&a&&function(w,A,p,b){let E=w;do E.z===0&&(E.z=Nh(E.x,E.y,A,p,b)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==w);E.prevZ.nextZ=null,E.prevZ=null,function(x){let T,C=1;do{let L,k=x;x=null;let V=null;for(T=0;k;){T++;let j=k,B=0;for(let Z=0;Z<C&&(B++,j=j.nextZ,j);Z++);let q=C;for(;B>0||q>0&&j;)B!==0&&(q===0||!j||k.z<=j.z)?(L=k,k=k.nextZ,B--):(L=j,j=j.nextZ,q--),V?V.nextZ=L:x=L,L.prevZ=V,V=L;k=j}V.nextZ=null,C*=2}while(T>1)}(E)}(r,s,u,a);let g=r;for(;r.prev!==r.next;){const w=r.prev,A=r.next;if(a?ag(r,s,u,a):T0(r))e.push(w.i,r.i,A.i),zc(r),r=A.next,g=A.next;else if((r=A)===g){h?h===1?dd(r=lg(Vu(r),e),e,i,s,u,a,2):h===2&&S0(r,e,i,s,u,a):dd(Vu(r),e,i,s,u,a,1);break}}}function T0(r){const e=r.prev,i=r,s=r.next;if(Fr(e,i,s)>=0)return!1;const u=e.x,a=i.x,h=s.x,g=e.y,w=i.y,A=s.y,p=u<a?u<h?u:h:a<h?a:h,b=g<w?g<A?g:A:w<A?w:A,E=u>a?u>h?u:h:a>h?a:h,x=g>w?g>A?g:A:w>A?w:A;let T=s.next;for(;T!==e;){if(T.x>=p&&T.x<=E&&T.y>=b&&T.y<=x&&Uh(u,g,a,w,h,A,T.x,T.y)&&Fr(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function ag(r,e,i,s){const u=r.prev,a=r,h=r.next;if(Fr(u,a,h)>=0)return!1;const g=u.x,w=a.x,A=h.x,p=u.y,b=a.y,E=h.y,x=g<w?g<A?g:A:w<A?w:A,T=p<b?p<E?p:E:b<E?b:E,C=g>w?g>A?g:A:w>A?w:A,L=p>b?p>E?p:E:b>E?b:E,k=Nh(x,T,e,i,s),V=Nh(C,L,e,i,s);let j=r.prevZ,B=r.nextZ;for(;j&&j.z>=k&&B&&B.z<=V;){if(j.x>=x&&j.x<=C&&j.y>=T&&j.y<=L&&j!==u&&j!==h&&Uh(g,p,w,b,A,E,j.x,j.y)&&Fr(j.prev,j,j.next)>=0||(j=j.prevZ,B.x>=x&&B.x<=C&&B.y>=T&&B.y<=L&&B!==u&&B!==h&&Uh(g,p,w,b,A,E,B.x,B.y)&&Fr(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;j&&j.z>=k;){if(j.x>=x&&j.x<=C&&j.y>=T&&j.y<=L&&j!==u&&j!==h&&Uh(g,p,w,b,A,E,j.x,j.y)&&Fr(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;B&&B.z<=V;){if(B.x>=x&&B.x<=C&&B.y>=T&&B.y<=L&&B!==u&&B!==h&&Uh(g,p,w,b,A,E,B.x,B.y)&&Fr(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function lg(r,e){let i=r;do{const s=i.prev,u=i.next.next;!_p(s,u)&&cg(s,i,i.next,u)&&pd(s,u)&&pd(u,s)&&(e.push(s.i,i.i,u.i),zc(i),zc(i.next),i=r=u),i=i.next}while(i!==r);return Vu(i)}function S0(r,e,i,s,u,a){let h=r;do{let g=h.next.next;for(;g!==h.prev;){if(h.i!==g.i&&C0(h,g)){let w=ug(h,g);return h=Vu(h,h.next),w=Vu(w,w.next),dd(h,e,i,s,u,a,0),void dd(w,e,i,s,u,a,0)}g=g.next}h=h.next}while(h!==r)}function E0(r,e){return r.x-e.x}function A0(r,e){const i=function(u,a){let h=a;const g=u.x,w=u.y;let A,p=-1/0;do{if(w<=h.y&&w>=h.next.y&&h.next.y!==h.y){const C=h.x+(w-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(C<=g&&C>p&&(p=C,A=h.x<h.next.x?h:h.next,C===g))return A}h=h.next}while(h!==a);if(!A)return null;const b=A,E=A.x,x=A.y;let T=1/0;h=A;do{if(g>=h.x&&h.x>=E&&g!==h.x&&Uh(w<x?g:p,w,E,x,w<x?p:g,w,h.x,h.y)){const C=Math.abs(w-h.y)/(g-h.x);pd(h,u)&&(C<T||C===T&&(h.x>A.x||h.x===A.x&&M0(A,h)))&&(A=h,T=C)}h=h.next}while(h!==b);return A}(r,e);if(!i)return e;const s=ug(i,r);return Vu(s,s.next),Vu(i,i.next)}function M0(r,e){return Fr(r.prev,r,e.prev)<0&&Fr(e.next,r,r.next)<0}function Nh(r,e,i,s,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function I0(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Uh(r,e,i,s,u,a,h,g){return(u-h)*(e-g)>=(r-h)*(a-g)&&(r-h)*(s-g)>=(i-h)*(e-g)&&(i-h)*(a-g)>=(u-h)*(s-g)}function C0(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,s){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&cg(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(r,e)&&(pd(r,e)&&pd(e,r)&&function(i,s){let u=i,a=!1;const h=(i.x+s.x)/2,g=(i.y+s.y)/2;do u.y>g!=u.next.y>g&&u.next.y!==u.y&&h<(u.next.x-u.x)*(g-u.y)/(u.next.y-u.y)+u.x&&(a=!a),u=u.next;while(u!==i);return a}(r,e)&&(Fr(r.prev,r,e.prev)||Fr(r,e.prev,e))||_p(r,e)&&Fr(r.prev,r,r.next)>0&&Fr(e.prev,e,e.next)>0)}function Fr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function _p(r,e){return r.x===e.x&&r.y===e.y}function cg(r,e,i,s){const u=yp(Fr(r,e,i)),a=yp(Fr(r,e,s)),h=yp(Fr(i,s,r)),g=yp(Fr(i,s,e));return u!==a&&h!==g||!(u!==0||!gp(r,i,e))||!(a!==0||!gp(r,s,e))||!(h!==0||!gp(i,r,s))||!(g!==0||!gp(i,e,s))}function gp(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function yp(r){return r>0?1:r<0?-1:0}function pd(r,e){return Fr(r.prev,r,r.next)<0?Fr(r,e,r.next)>=0&&Fr(r,r.prev,e)>=0:Fr(r,e,r.prev)<0||Fr(r,r.next,e)<0}function ug(r,e){const i=Em(r.i,r.x,r.y),s=Em(e.i,e.x,e.y),u=r.next,a=e.prev;return r.next=e,e.prev=r,i.next=u,u.prev=i,s.next=i,i.prev=s,a.next=s,s.prev=a,s}function hg(r,e,i,s){const u=Em(r,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function zc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Em(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function md(r,e){const i=r.length;if(i<=1)return[r];const s=[];let u,a;for(let h=0;h<i;h++){const g=th(r[h]);g!==0&&(r[h].area=Math.abs(g),a===void 0&&(a=g<0),a===g<0?(u&&s.push(u),u=[r[h]]):u.push(r[h]))}if(u&&s.push(u),e>1)for(let h=0;h<s.length;h++)s[h].length<=e||(ga(s[h],e,1,s[h].length-1,fg),s[h]=s[h].slice(0,e));return s}function fg(r,e){return e.area-r.area}function _d(r,e,i){const s=i.patternDependencies;let u=!1;for(const a of e){const h=a.paint.get(`${r}-pattern`);h.isConstant()||(u=!0);const g=h.constantOr(null);g&&(u=!0,s[g]=!0)}return u}function xp(r,e,i,s,u){const a=u.patternDependencies;for(const h of e){const g=h.paint.get(`${r}-pattern`).value;if(g.kind!=="constant"){let w=g.evaluate({zoom:s},i,{},u.availableImages);w=w&&w.name?w.name:w,a[w]=!0,i.patterns[h.id]=w}}return i}class vp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ja,this.indexArray=new qn,this.indexArray2=new el,this.programConfigurations=new sa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new rr,this.segments2=new rr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,s,u){this.hasPattern=_d("fill",this.layers,i);const a=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:g,id:w,index:A,sourceLayerIndex:p}of e){const b=this.layers[0]._featureFilter.needGeometry,E=rt(g,b);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),E,s))continue;const x=a?a.evaluate(E,{},s,i.availableImages):void 0,T={id:w,properties:g.properties,type:g.type,sourceLayerIndex:p,index:A,geometry:b?E.geometry:ke(g,s,u),patterns:{},sortKey:x};h.push(T)}a&&h.sort((g,w)=>g.sortKey-w.sortKey);for(const g of h){const{geometry:w,index:A,sourceLayerIndex:p}=g;if(this.hasPattern){const b=xp("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(b)}else this.addFeature(g,w,A,s,{},i.availableImages,i.brightness);i.featureIndex.insert(e[A].feature,w,A,p,this.index)}}update(e,i,s,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,s,u,a)}addFeatures(e,i,s,u,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,u,a,h=[],g){for(const w of md(i,500)){let A=0;for(const C of w)A+=C.length;const p=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),b=p.vertexLength,E=[],x=[];for(const C of w){if(C.length===0)continue;C!==w[0]&&x.push(E.length/2);const L=this.segments2.prepareSegment(C.length,this.layoutVertexArray,this.indexArray2),k=L.vertexLength;this.layoutVertexArray.emplaceBack(C[0].x,C[0].y),this.indexArray2.emplaceBack(k+C.length-1,k),E.push(C[0].x),E.push(C[0].y);for(let V=1;V<C.length;V++)this.layoutVertexArray.emplaceBack(C[V].x,C[V].y),this.indexArray2.emplaceBack(k+V-1,k+V),E.push(C[V].x),E.push(C[V].y);L.vertexLength+=C.length,L.primitiveLength+=C.length}const T=fd(E,x);for(let C=0;C<T.length;C+=3)this.indexArray.emplaceBack(b+T[C],b+T[C+1],b+T[C+2]);p.vertexLength+=A,p.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,a,h,u,g)}}let Am,Mm,dg,pg;Vt(vp,"FillBucket",{omit:["layers","patternFeatures"]});class Im{constructor(e,i,s,u){if(this.triangleCount=i.length/3,this.min=new he(0,0),this.max=new he(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[a,h]=[e[0].clone(),e[0].clone()];for(let b=1;b<e.length;++b){const E=e[b];a.x=Math.min(a.x,E.x),a.y=Math.min(a.y,E.y),h.x=Math.max(h.x,E.x),h.y=Math.max(h.y,E.y)}if(u){const b=Math.ceil(Math.max(h.x-a.x,h.y-a.y)/u);s=Math.max(s,b)}if(s===0)return;this.min=a,this.max=h;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const w=Math.max(g.x,g.y)/s;this.cellsX=Math.max(1,Math.ceil(g.x/w)),this.cellsY=Math.max(1,Math.ceil(g.y/w)),this.xScale=1/w,this.yScale=1/w;const A=[];for(let b=0;b<this.triangleCount;b++){const E=e[i[3*b+0]].sub(this.min),x=e[i[3*b+1]].sub(this.min),T=e[i[3*b+2]].sub(this.min),C=Us(Math.floor(Math.min(E.x,x.x,T.x)),this.xScale,this.cellsX),L=Us(Math.floor(Math.max(E.x,x.x,T.x)),this.xScale,this.cellsX),k=Us(Math.floor(Math.min(E.y,x.y,T.y)),this.yScale,this.cellsY),V=Us(Math.floor(Math.max(E.y,x.y,T.y)),this.yScale,this.cellsY),j=new he(0,0),B=new he(0,0),q=new he(0,0),Z=new he(0,0);for(let Q=k;Q<=V;++Q){j.y=B.y=Q*w,q.y=Z.y=(Q+1)*w;for(let ce=C;ce<=L;++ce)j.x=q.x=ce*w,B.x=Z.x=(ce+1)*w,(ln(E,x,T,j,B,Z)||ln(E,x,T,j,Z,q))&&A.push({cellIdx:Q*this.cellsX+ce,triIdx:b})}}if(A.length===0)return;A.sort((b,E)=>b.cellIdx-E.cellIdx||b.triIdx-E.triIdx);let p=0;for(;p<A.length;){const b=A[p].cellIdx,E={start:this.payload.length,len:0};for(;p<A.length&&A[p].cellIdx===b;)++E.len,this.payload.push(A[p++].triIdx);this.cells[b]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Us(e.x-this.min.x,this.xScale,this.cellsX),u=Us(e.y-this.min.y,this.yScale,this.cellsY),a=this.cells[u*this.cellsX+s];if(a){this._lazyInitLookup();for(let h=0;h<a.len;h++){const g=this.payload[a.start+h],w=Math.floor(g/8),A=1<<g%8;if(!(this.lookup[w]&A)&&(this.lookup[w]|=A,i.push(g),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=Us(e.x-this.min.x,this.xScale,this.cellsX),a=Us(i.x-this.min.x,this.xScale,this.cellsX),h=Us(e.y-this.min.y,this.yScale,this.cellsY),g=Us(i.y-this.min.y,this.yScale,this.cellsY);for(let w=h;w<=g;w++)for(let A=u;A<=a;A++){const p=this.cells[w*this.cellsX+A];if(p)for(let b=0;b<p.len;b++){const E=this.payload[p.start+b],x=Math.floor(E/8),T=1<<E%8;if(!(this.lookup[x]&T)&&(this.lookup[x]|=T,s.push(E),s.length===this.triangleCount))return}}}}function Us(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Vt(Im,"TriangleGridIndex");class gd{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}populate(e,i,s,u){const a=[];for(const{feature:h,id:g,index:w,sourceLayerIndex:A}of e){const p=this.layers[0]._featureFilter.needGeometry,b=rt(h,p);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),b,s))continue;const E={id:g,properties:h.properties,type:h.type,sourceLayerIndex:A,index:w,geometry:p?b.geometry:ke(h,s,u),patterns:{}};a.push(E)}for(const h of a){const{geometry:g,index:w,sourceLayerIndex:A}=h;this.addFeature(h,g,w,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,g,w,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,u,a){}destroy(){}addFeature(e,i,s,u,a,h=[],g){for(const w of md(i,2)){const A=[],p=[],b=[],E=new he(1/0,1/0),x=new he(-1/0,-1/0);for(const L of w)if(L.length!==0){L!==w[0]&&b.push(p.length/2);for(let k=0;k<L.length;k++)p.push(L[k].x),p.push(L[k].y),A.push(L[k]),E.x=Math.min(E.x,L[k].x),E.y=Math.min(E.y,L[k].y),x.x=Math.max(x.x,L[k].x),x.y=Math.max(x.y,L[k].y)}const T=fd(p,b),C=new Im(A,T,8,256);this.footprints.push({vertices:A,indices:T,grid:C,min:E,max:x})}}}Vt(gd,"ClipBucket",{omit:["layers"]});const P0=on([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),R0=on([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Cm=on([{name:"a_centroid_pos",components:2,type:"Uint16"}]),mg=on([{name:"a_join_normal_inside",components:3,type:"Int16"}]),D0=on([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),L0=on([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:z0}=P0;var Pm,_g,Rm,gg,Dm,yg,xg,bp={};function vg(){if(_g)return Pm;_g=1;var r=De();function e(u,a,h,g,w){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=g,this._values=w,u.readFields(i,this,a)}function i(u,a,h){u==1?a.id=h.readVarint():u==2?function(g,w){for(var A=g.readVarint()+g.pos;g.pos<A;){var p=w._keys[g.readVarint()],b=w._values[g.readVarint()];w.properties[p]=b}}(h,a):u==3?a.type=h.readVarint():u==4&&(a._geometry=h.pos)}function s(u){for(var a,h,g=0,w=0,A=u.length,p=A-1;w<A;p=w++)g+=((h=u[p]).x-(a=u[w]).x)*(a.y+h.y);return g}return Pm=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var a,h=u.readVarint()+u.pos,g=1,w=0,A=0,p=0,b=[];u.pos<h;){if(w<=0){var E=u.readVarint();g=7&E,w=E>>3}if(w--,g===1||g===2)A+=u.readSVarint(),p+=u.readSVarint(),g===1&&(a&&b.push(a),a=[]),a.push(new r(A,p));else{if(g!==7)throw new Error("unknown command "+g);a&&a.push(a[0].clone())}}return a&&b.push(a),b},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var a=u.readVarint()+u.pos,h=1,g=0,w=0,A=0,p=1/0,b=-1/0,E=1/0,x=-1/0;u.pos<a;){if(g<=0){var T=u.readVarint();h=7&T,g=T>>3}if(g--,h===1||h===2)(w+=u.readSVarint())<p&&(p=w),w>b&&(b=w),(A+=u.readSVarint())<E&&(E=A),A>x&&(x=A);else if(h!==7)throw new Error("unknown command "+h)}return[p,E,b,x]},e.prototype.toGeoJSON=function(u,a,h){var g,w,A=this.extent*Math.pow(2,h),p=this.extent*u,b=this.extent*a,E=this.loadGeometry(),x=e.types[this.type];function T(k){for(var V=0;V<k.length;V++){var j=k[V];k[V]=[360*(j.x+p)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+b)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(g=0;g<E.length;g++)C[g]=E[g][0];T(E=C);break;case 2:for(g=0;g<E.length;g++)T(E[g]);break;case 3:for(E=function(k){var V=k.length;if(V<=1)return[k];for(var j,B,q=[],Z=0;Z<V;Z++){var Q=s(k[Z]);Q!==0&&(B===void 0&&(B=Q<0),B===Q<0?(j&&q.push(j),j=[k[Z]]):j.push(k[Z]))}return j&&q.push(j),q}(E),g=0;g<E.length;g++)for(w=0;w<E[g].length;w++)T(E[g][w])}E.length===1?E=E[0]:x="Multi"+x;var L={type:"Feature",geometry:{type:x,coordinates:E},properties:this.properties};return"id"in this&&(L.id=this.id),L},Pm}function la(){if(gg)return Rm;gg=1;var r=vg();function e(s,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,u),this.length=this._features.length}function i(s,u,a){s===15?u.version=a.readVarint():s===1?u.name=a.readString():s===5?u.extent=a.readVarint():s===2?u._features.push(a.pos):s===3?u._keys.push(a.readString()):s===4&&u._values.push(function(h){for(var g=null,w=h.readVarint()+h.pos;h.pos<w;){var A=h.readVarint()>>3;g=A===1?h.readString():A===2?h.readFloat():A===3?h.readDouble():A===4?h.readVarint64():A===5?h.readVarint():A===6?h.readSVarint():A===7?h.readBoolean():null}return g}(a))}return Rm=e,e.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var u=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,u,this.extent,this._keys,this._values)},Rm}function bg(){return xg||(xg=1,bp.VectorTile=function(){if(yg)return Dm;yg=1;var r=la();function e(i,s,u){if(i===3){var a=new r(u,u.readVarint()+u.pos);a.length&&(s[a.name]=a)}}return Dm=function(i,s){this.layers=i.readFields(e,{},s)},Dm}(),bp.VectorTileFeature=vg(),bp.VectorTileLayer=la()),bp}var Vh=bg();class Vs extends he{constructor(e,i,s){super(e,i),this.z=s}}class un extends Vs{constructor(e,i,s,u){super(e,i,s),this.w=u}}function wp(r,e,i,s){const u=[],a=s===0?(h,g,w,A,p,b)=>{h.push(new he(b,w+(b-g)/(A-g)*(p-w)))}:(h,g,w,A,p,b)=>{h.push(new he(g+(b-w)/(p-w)*(A-g),b))};for(const h of r){const g=[];for(const w of h){if(w.length<=2)continue;const A=[];for(let E=0;E<w.length-1;E++){const x=w[E].x,T=w[E].y,C=w[E+1].x,L=w[E+1].y,k=s===0?x:T,V=s===0?C:L;k<e?V>e&&a(A,x,T,C,L,e):k>i?V<i&&a(A,x,T,C,L,i):A.push(w[E]),V<e&&k>=e&&a(A,x,T,C,L,e),V>i&&k<=i&&a(A,x,T,C,L,i)}let p=w[w.length-1];const b=s===0?p.x:p.y;b>=e&&b<=i&&A.push(p),A.length&&(p=A[A.length-1],A[0].x===p.x&&A[0].y===p.y||A.push(A[0]),g.push(A))}g.length&&u.push(g)}return u}function Yo(r,e,i,s){const u=i==="x"?"y":"x",a=(s-r[i])/(e[i]-r[i]);r[u]=r[u]+(e[u]-r[u])*a,r[i]=s,r.hasOwnProperty("z")&&(r.z=hi(r.z,e.z,a)),r.hasOwnProperty("w")&&(r.w=hi(r.w,e.w,a))}function Hr(r,e,i,s){const u=i,a=s;for(const h of["x","y"]){let g=r,w=e;g[h]>=w[h]&&(g=e,w=r),g[h]<u&&w[h]>u&&Yo(g,w,h,u),g[h]<a&&w[h]>a&&Yo(w,g,h,a)}}const Tp=Number.MAX_SAFE_INTEGER;function jl(r,e,i,s){return r.order<e||r.order===Tp||!(r.clipMask&i)||function(u,a){return a.length!==0&&a.find(h=>h===u)===void 0}(s,r.clipScope)}function Sp(r,e){return r.x-e.x||r.y-e.y}function wg(r,e){return Sp(r.min,e.min)===0&&Sp(r.max,e.max)===0}function Lm(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function zm(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!wg(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!ct(r[i].clipScope,e[i].clipScope))return!1;return!0}function Tg(r,e,i){const s=1/wt,u=1/(1<<i.canonical.z),a=(e.x*s+i.canonical.x)*u+i.wrap,h=(e.y*s+i.canonical.y)*u;return{min:new he((r.x*s+i.canonical.x)*u+i.wrap,(r.y*s+i.canonical.y)*u),max:new he(a,h)}}function Om(r,e,i){const s=1<<i.canonical.z,u=((e.x-i.wrap)*s-i.canonical.x)*wt,a=(e.y*s-i.canonical.y)*wt;return{min:new he(((r.x-i.wrap)*s-i.canonical.x)*wt,(r.y*s-i.canonical.y)*wt),max:new he(u,a)}}function Sg(r,e,i,s,u,a,h){const g=r.indices,w=r.vertices,A=[];for(let p=s;p<s+u;p+=3){const b=e[i[p+0]+a],E=e[i[p+1]+a],x=e[i[p+2]+a],T=Math.min(b.x,E.x,x.x),C=Math.max(b.x,E.x,x.x),L=Math.min(b.y,E.y,x.y),k=Math.max(b.y,E.y,x.y);A.length=0,r.grid.query(new he(T,L),new he(C,k),A);for(let V=0;V<A.length;V++){const j=A[V];if(ln(w[g[3*j+0]],w[g[3*j+1]],w[g[3*j+2]],b,E,x,h))return!0}}return!1}function nl(r,e,i,s){if(!r||!i)return!1;let u=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<r.vertices.length)return nl(i,s,r,e);const a=e.canonical,h=s.canonical,g=Math.pow(2,h.z-a.z);u=r.vertices.map(w=>new he((w.x+a.x*wt)*g-h.x*wt,(w.y+a.y*wt)*g-h.y*wt))}return Sg(i,u,r.indices,0,r.indices.length,0,0)}function km(r,e,i,s){const u=Math.pow(2,s.z-i.z);return new he((r+i.x*wt)*u-s.x*wt,(e+i.y*wt)*u-s.y*wt)}function yd(r,e){const i=[];e.grid.queryPoint(r,i);const s=e.indices,u=e.vertices;for(let a=0;a<i.length;a++){const h=i[a];if(Ui([u[s[3*h+0]],u[s[3*h+1]],u[s[3*h+2]]],r))return!0}return!1}const yr=[new he(0,0),new he(wt,0),new he(wt,wt),new he(0,wt)];function Br(r,e){const i=[];let s=[];if(!e||r.length<2)return[r];if(r.length===2)return en(r[0],r[1],yr)?[r]:[];for(let u=0;u<r.length+2;u++){const a=r[u%r.length],h=r[(u+1)%r.length],g=en(u===0?r[r.length-1]:r[(u-1)%r.length],a,yr),w=en(a,h,yr),A=g||w;A&&s.push(a),A&&w||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const Ep=Vh.VectorTileFeature.types,O0=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],k0=["fill-extrusion-flood-light-ground-radius"],F0=Math.pow(2,13),B0=Math.pow(2,15)-1,Eg=new he(0,1),Oc=2147483648;function jh(r,e,i,s,u,a,h,g){r.emplaceBack((e<<1)+h,(i<<1)+a,(Math.floor(s*F0)<<1)+u,Math.round(g))}function Gl(r,e,i){r.emplaceBack(e.x*wt,e.y*wt,i?1:0)}function Gh(r,e,i,s,u,a){r.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+u,a)}function xd(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Fm{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class vd{constructor(){this.centroidXY=new he(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new he(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new he(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new he(this.max.x-this.min.x,this.max.y-this.min.y)}}class ds{constructor(){this.acc=new he(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===wt)&&i.x===s.x)!=((i.y===0||i.y===wt)&&i.y===s.y)&&this.processBorderOverlap(i,s),u&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,hi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>wt!=e.x>wt&&this.addBorderIntersection(1,hi(i.y,e.y,(wt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,hi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>wt!=e.y>wt&&this.addBorderIntersection(3,hi(i.x,e.x,(wt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new he(0,0):new he(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function ju(r,e){const i=r.add(e)._unit(),s=vt(r.x*i.x+r.y*i.y,-1,1);var u,a,h;return h=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(h)))/4*B0*((u=r).x*(a=e).y-u.y*a.x<0?-1:1)}const N0=[r=>r.x<0,r=>r.x>wt,r=>r.y<0,r=>r.y>wt];function U0(r,e,i,s){const u=[4];if(s===0)return u;i._mult(s);const a=r.sub(i),h=e.sub(i),g=[r,e,a,h];for(let w=0;w<4;w++)for(const A of g)if(N0[w](A)){u.push(w);break}return u}class Ag{constructor(e){this.vertexArray=new Iu,this.indexArray=new qn,this.programConfigurations=new sa(e.layers,{zoom:e.zoom,lut:e.lut},i=>k0.includes(i)),this._segments=new rr,this.hiddenByLandmarkVertexArray=new zh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new rr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,u=!1){const a=e.length;if(a>2){let h=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*a,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let w;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const A=e[0],p=e[1];w=ju(A.sub(e[a-1])._perp()._unit(),p.sub(A)._perp()._unit())}for(let A=0;A<a;A++){const p=A===a-1?0:A+1,b=e[A],E=e[p],x=e[p===a-1?0:p+1],T=E.sub(b)._perp()._unit(),C=ju(T,x.sub(E)._perp()._unit()),L=w,k=C;if(fn(b,E,i)||u&&Bm(b,i)&&Bm(E,i)){w=C;continue}const V=g.vertexLength;Gh(this.vertexArray,b,E,1,1,L),Gh(this.vertexArray,b,E,1,0,L),Gh(this.vertexArray,b,E,0,1,k),Gh(this.vertexArray,b,E,0,0,k),g.vertexLength+=4;const j=U0(b,E,T,s);for(const B of j)this._segmentToGroundQuads[h].push({id:V,region:B}),this._segmentToRegionTriCounts[h][B]+=2,g.primitiveLength+=2;w=C}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((u,a)=>u.region-a.region);for(let s=0;s<i;s++){const u=this._segmentToGroundQuads[s],a=e[s],h=this._segmentToRegionTriCounts[s];h.reduce((w,A)=>w+A,0);let g=0;for(let w=0;w<=4;w++){const A=h[w];if(A!==0){let p=this.regionSegments[w];p||(p=this.regionSegments[w]=new rr);const b={vertexOffset:a.vertexOffset,primitiveOffset:a.primitiveOffset+g,vertexLength:a.vertexLength,primitiveLength:A};p.get().push(b)}g+=A}for(let w=0;w<u.length;w++){const A=u[w].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,u,a,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,u,a,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,R0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,u,a,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,u,a,h)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&Oc?1:0;for(let u=e.groundVertexArrayOffset;u<i;++u)this.hiddenByLandmarkVertexArray.emplace(u,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,D0.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Ap{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qn,this.footprintVertices=new Ja,this.footprintSegments=[],this.layoutVertexArray=new gc,this.centroidVertexArray=new od,this.wallVertexArray=new go,this.indexArray=new qn,this.programConfigurations=new sa(e.layers,{zoom:e.zoom,lut:e.lut},i=>O0.includes(i)),this.segments=new rr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Ag(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,s,u){this.features=[],this.hasPattern=_d("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Te(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:a,id:h,index:g,sourceLayerIndex:w}of e){const A=this.layers[0]._featureFilter.needGeometry,p=rt(a,A);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),p,s))continue;const b={id:h,sourceLayerIndex:w,index:g,geometry:A?p.geometry:ke(a,s,u),properties:a.properties,type:a.type,patterns:{}},E=this.layoutVertexArray.length,x=Ep[b.type]==="Polygon";if(this.hasPattern)this.features.push(xp("fill-extrusion",this.layers,b,this.zoom,i));else if(this.wallMode)for(const T of b.geometry)for(const C of Br(T,x))this.addFeature(b,[C],g,s,{},i.availableImages,u,i.brightness);else this.addFeature(b,b.geometry,g,s,{},i.availableImages,u,i.brightness);i.featureIndex.insert(a,b.geometry,g,w,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,u,a,h){for(const g of this.features){const w=Ep[g.type]==="Polygon",{geometry:A}=g;if(this.wallMode)for(const p of A)for(const b of Br(p,w))this.addFeature(g,[b],g.index,i,s,u,a,h);else this.addFeature(g,A,g.index,i,s,u,a,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,u,a){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const g=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,g,s,u,a),this.groundEffect.update(e,i,g,s,u,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,z0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,mg.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,L0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cm.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,a,h,g,w){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,p=[new he(0,0),new he(wt,wt)],b=g.projection,E=b.name==="globe",x=this.wallMode||Ep[e.type]==="Polygon",T=new ds;T.centroidDataIndex=this.centroidData.length;const C=new vd,L=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,k=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let V;if(C.height=k,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cu),this.wallMode){if(E)return void ji("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;V=function(ae){const Se=ae[0].x===ae[ae.length-1].x&&ae[0].y===ae[ae.length-1].y;(function(yt){let ut=0;const ni=yt.length;for(let Ft=0;Ft<ni;Ft++)ut+=(yt[(Ft+1)%ni].x-yt[Ft].x)*(yt[(Ft+1)%ni].y+yt[Ft].y);return ut>=0})(ae)||(ae=ae.reverse());const be={geometry:[],joinNormals:[],indices:[]},Me=[],Ie=[],Le=[];let Ue=ae.length;if(Ue<(Se?3:2))return be;for(;Ue>=2&&ae[Ue-1].equals(ae[Ue-2]);)Ue--;let je,Fe,tt,dt,Xe,Bt=0;for(;Bt<Ue-1&&ae[Bt].equals(ae[Bt+1]);)Bt++;Se&&(je=ae[Ue-2],Xe=ae[Bt].sub(je)._unit()._perp());for(let yt=Bt;yt<Ue;yt++){if(tt=yt===Ue-1?Se?ae[Bt+1]:void 0:ae[yt+1],tt&&ae[yt].equals(tt))continue;Xe&&(dt=Xe),je&&(Fe=je),je=ae[yt],Xe=tt?tt.sub(je)._unit()._perp():dt,dt=dt||Xe;let ut=dt.add(Xe);ut.x===0&&ut.y===0||ut._unit();const ni=ut.x*Xe.x+ut.y*Xe.y,Ft=ni!==0?1/ni:1/0,qt=dt.x*Xe.y-dt.y*Xe.x>0;let bi="miter";const Ci=2;bi==="miter"&&Ft>Ci&&(bi="bevel"),bi==="bevel"&&(Ft>100&&(bi="flipbevel"),Ft<Ci&&(bi="miter"));const Pi=(Ai,Ni,Bi,Vn)=>{const Ln=new he(Ai.x,Ai.y),mi=new he(Ai.x,Ai.y);Ln.x+=Ni.x*Vn,Ln.y+=Ni.y*Vn,mi.x-=Ni.x*Math.max(Bi,1),mi.y-=Ni.y*Math.max(Bi,1),Le.push(Ni),Me.push(Ln),Ie.push(mi)};if(bi==="miter")ut._mult(Ft),Pi(je,ut,0,0);else if(bi==="flipbevel")ut=Xe.mult(-1),Pi(je,ut,0,0),Pi(je,ut.mult(-1),0,0);else{const Ai=-Math.sqrt(Ft*Ft-1),Ni=qt?Ai:0,Bi=qt?0:Ai;Fe&&Pi(je,dt,Ni,Bi),tt&&Pi(je,Xe,Ni,Bi)}}be.geometry=[...Me,...Ie.reverse(),Me[0]],be.joinNormals=[...Le,...Le.reverse(),Le[Le.length-1]];const Et=be.geometry.length-1;for(let yt=0;yt<Et/2;yt++)if(yt+1<Et/2){let ut=yt,ni=yt+1,Ft=Et-1-yt,qt=Et-2-yt;ut=ut===0?Et-1:ut-1,ni=ni===0?Et-1:ni-1,Ft=Ft===0?Et-1:Ft-1,qt=qt===0?Et-1:qt-1,be.indices.push(Ft),be.indices.push(ni),be.indices.push(ut),be.indices.push(Ft),be.indices.push(qt),be.indices.push(ni)}return be}(i[0]),i=[V.geometry]}const j=(ae,Se)=>ae<(Se.length-1)/2||ae===Se.length-1,B=this.wallMode?[i]:md(i,500);for(let ae=B.length-1;ae>=0;ae--){const Se=B[ae];(Se.length===0||(q=Se[0]).every(se=>se.x<=0)||q.every(se=>se.x>=wt)||q.every(se=>se.y<=0)||q.every(se=>se.y>=wt))&&B.splice(ae,1)}var q;let Z;if(E)Z=Jn(B,p,u);else{Z=[];for(const ae of B)Z.push({polygon:ae,bounds:p})}const Q=x?this.edgeRadius:0,ce=Q>0&&this.zoom<17,oe=(ae,Se)=>{if(ae.length===0)return!1;const se=ae[ae.length-1];return Se.x===se.x&&Se.y===se.y};for(const{polygon:ae,bounds:Se}of Z){let se=0,be=0;for(const Ue of ae)x&&!Ue[0].equals(Ue[Ue.length-1])&&Ue.push(Ue[0]),be+=x?Ue.length-1:Ue.length;const Me=this.segments.prepareSegment((x?5:4)*be,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length),C.polygonSegIdx<0&&(C.polygonSegIdx=this.polygonSegments.length);const Ie={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new Fm;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],x){const Ue=[],je=[];se=Me.vertexLength;for(let tt=0;tt<ae.length;tt++){const dt=ae[tt];dt.length&&tt!==0&&je.push(Ue.length/2);const Xe=[];let Bt,Et;Bt=dt[1].sub(dt[0])._perp()._unit(),Le.ringIndices.push(dt.length-1);for(let yt=1;yt<dt.length;yt++){const ut=dt[yt],ni=dt[yt===dt.length-1?1:yt+1],Ft=ut.clone();if(Q){Et=ni.sub(ut)._perp()._unit();const qt=Bt.add(Et)._unit(),bi=Q*Math.min(4,1/(Bt.x*qt.x+Bt.y*qt.y));Ft.x+=bi*qt.x,Ft.y+=bi*qt.y,Ft.x=Math.round(Ft.x),Ft.y=Math.round(Ft.y),Bt=Et}if(!L||Q!==0&&!ce||oe(Xe,Ft)||Xe.push(Ft),jh(this.layoutVertexArray,Ft.x,Ft.y,0,0,1,1,0),this.wallMode){const qt=j(yt,dt);Gl(this.wallVertexArray,V.joinNormals[yt],!qt)}Me.vertexLength++,this.footprintVertices.emplaceBack(ut.x,ut.y),Ue.push(ut.x,ut.y),E&&xd(this.layoutVertexExtArray,b.projectTilePoint(Ft.x,Ft.y,u),b.upVector(u,Ft.x,Ft.y))}L&&(Q===0||ce)&&(Xe.length!==0&&oe(Xe,Xe[0])&&Xe.pop(),this.groundEffect.addData(Xe,Se,A))}const Fe=this.wallMode?V.indices:fd(Ue,je);for(let tt=0;tt<Fe.length;tt+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+Fe[tt+0],Le.vertexOffset+Fe[tt+1],Le.vertexOffset+Fe[tt+2]),this.indexArray.emplaceBack(se+Fe[tt],se+Fe[tt+2],se+Fe[tt+1]),Me.primitiveLength++;Le.indexCount+=Fe.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let Ue=0;Ue<ae.length;Ue++){const je=ae[Ue];T.startRing(C,je[0]);let Fe=je.length>4&&js(je[je.length-2],je[0],je[1]),tt=Q?Ig(je[je.length-2],je[0],je[1],Q):0;const dt=[];let Xe,Bt,Et;Bt=je[1].sub(je[0])._perp()._unit();let yt=!0;for(let ut=1,ni=0;ut<je.length;ut++){let Ft=je[ut-1],qt=je[ut];const bi=je[ut===je.length-1?1:ut+1];if(T.appendEdge(C,qt,Ft),fn(qt,Ft,Se)){Q&&(Bt=bi.sub(qt)._perp()._unit(),yt=!yt);continue}const Ci=qt.sub(Ft)._perp(),Pi=Ci.x/(Math.abs(Ci.x)+Math.abs(Ci.y)),Ai=Ci.y>0?1:0,Ni=Ft.dist(qt);if(ni+Ni>32768&&(ni=0),Q){Et=bi.sub(qt)._perp()._unit();let mi=rl(Ft,qt,bi,Mg(Bt,Et),Q);isNaN(mi)&&(mi=0);const yn=qt.sub(Ft)._unit();Ft=Ft.add(yn.mult(tt))._round(),qt=qt.add(yn.mult(-mi))._round(),tt=mi,Bt=Et,L&&this.zoom>=17&&(oe(dt,Ft)||dt.push(Ft),oe(dt,qt)||dt.push(qt))}const Bi=Me.vertexLength,Vn=je.length>4&&js(Ft,qt,bi);let Ln=Nm(ni,Fe,yt);if(jh(this.layoutVertexArray,Ft.x,Ft.y,Pi,Ai,0,0,Ln),jh(this.layoutVertexArray,Ft.x,Ft.y,Pi,Ai,0,1,Ln),this.wallMode){const mi=j(ut-1,je),yn=V.joinNormals[ut-1];Gl(this.wallVertexArray,yn,mi),Gl(this.wallVertexArray,yn,mi)}if(ni+=Ni,Ln=Nm(ni,Vn,!yt),Fe=Vn,jh(this.layoutVertexArray,qt.x,qt.y,Pi,Ai,0,0,Ln),jh(this.layoutVertexArray,qt.x,qt.y,Pi,Ai,0,1,Ln),this.wallMode){const mi=j(ut,je),yn=V.joinNormals[ut];Gl(this.wallVertexArray,yn,mi),Gl(this.wallVertexArray,yn,mi)}if(Me.vertexLength+=4,this.indexArray.emplaceBack(Bi+0,Bi+1,Bi+2),this.indexArray.emplaceBack(Bi+1,Bi+3,Bi+2),Me.primitiveLength+=2,Q){const mi=se+(ut===1?je.length-2:ut-2),yn=ut===1?se:mi+1;if(this.indexArray.emplaceBack(Bi+1,mi,Bi+3),this.indexArray.emplaceBack(mi,yn,Bi+3),Me.primitiveLength+=2,Xe===void 0&&(Xe=Bi),!fn(bi,je[ut],Se)){const Tn=ut===je.length-1?Xe:Me.vertexLength;this.indexArray.emplaceBack(Bi+2,Bi+3,Tn),this.indexArray.emplaceBack(Bi+3,Tn+1,Tn),this.indexArray.emplaceBack(Bi+3,yn,Tn+1),Me.primitiveLength+=3}yt=!yt}if(E){const mi=this.layoutVertexExtArray,yn=b.projectTilePoint(Ft.x,Ft.y,u),Tn=b.projectTilePoint(qt.x,qt.y,u),Xn=b.upVector(u,Ft.x,Ft.y),xr=b.upVector(u,qt.x,qt.y);xd(mi,yn,Xn),xd(mi,yn,Xn),xd(mi,Tn,xr),xd(mi,Tn,xr)}}x&&(se+=je.length-1),L&&Q&&this.zoom>=17&&(dt.length!==0&&oe(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Se,A,Q>0))}this.footprintSegments.push(Le),Ie.triangleCount=this.indexArray.length-Ie.triangleArrayOffset,this.polygonSegments.push(Ie),++C.footprintSegLen,++C.polygonSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,C.vertexCount!==0){if(C.centroidXY=T.borders?Eg:this.encodeCentroid(T,C),this.centroidData.push(C),T.borders){this.featuresOnBorder.push(T);const ae=this.featuresOnBorder.length-1;for(let Se=0;Se<T.borders.length;Se++)T.borders[Se][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Se].push(ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,a,h,u,w),this.groundEffect.addPaintPropertiesData(e,s,a,h,u,w),this.maxHeight=Math.max(this.maxHeight,k)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const w=this.centroidData[g],A=+(w.min.y+w.max.y>wt),p=2*A+(+(w.min.x+w.max.x>wt)^A);for(let b=0;b<w.polygonSegLen;b++){const E=w.polygonSegIdx+b;e.push({centroidIdx:g,subtile:p,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}const i=new qn;e.sort((g,w)=>g.triangleSegmentIdx===w.triangleSegmentIdx?g.subtile-w.subtile:g.triangleSegmentIdx-w.triangleSegmentIdx);let s=0,u=0,a=0;for(const g of e){if(g.triangleSegmentIdx!==s)break;a++}const h=e.length;for(;u!==e.length;){s=e[u].triangleSegmentIdx;let g=0,w=u,A=u;for(let p=w;p<a&&e[p].subtile===g;p++)A++;for(;w!==a;){const p=e[w];g=p.subtile;const b=this.centroidData[p.centroidIdx].min.clone(),E=this.centroidData[p.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let T=w;T<A;T++){const C=e[T],L=this.polygonSegments[C.polygonSegmentIdx],k=this.centroidData[C.centroidIdx].min,V=this.centroidData[C.centroidIdx].max,j=this.indexArray.uint16;for(let B=L.triangleArrayOffset;B<L.triangleArrayOffset+L.triangleCount;B++)i.emplaceBack(j[3*B],j[3*B+1],j[3*B+2]);x.primitiveLength+=L.triangleCount,b.x=Math.min(b.x,k.x),b.y=Math.min(b.y,k.y),E.x=Math.max(E.x,V.x),E.y=Math.max(E.y,V.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:b,max:E}),w=A;for(let T=w;T<a&&e[T].subtile===e[w].subtile;T++)A++}u=a;for(let p=u;p<h&&e[p].triangleSegmentIdx===e[u].triangleSegmentIdx;p++)a++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const u=new rr;if(this.wallMode){for(const C of this.triangleSubSegments)u.segments.push(C.segment);return u}let a=0,h=0;const g=1<<e.canonical.z;if(i){const C=i.getMinMaxForTile(e);C&&(a=C.min,h=C.max)}h+=this.maxHeight;const w=e.toUnwrapped();let A;const p=[w.canonical.x/g+w.wrap,w.canonical.y/g],b=[(w.canonical.x+1)/g+w.wrap,(w.canonical.y+1)/g],E=(C,L,k)=>[C[0]*(1-k[0])+L[0]*k[0],C[1]*(1-k[1])+L[1]*k[1]],x=[],T=[];for(const C of this.triangleSubSegments){x[0]=C.min.x/wt,x[1]=C.min.y/wt,T[0]=C.max.x/wt,T[1]=C.max.y/wt;const L=E(p,b,x),k=E(p,b,T);if(new gn([L[0],L[1],a],[k[0],k[1],h]).intersectsPrecise(s)===0){A&&(u.segments.push(A),A=void 0);continue}const V=C.segment;A&&A.vertexOffset!==V.vertexOffset&&(u.segments.push(A),A=void 0),A?(A.vertexLength+=V.vertexLength,A.primitiveLength+=V.primitiveLength):A={vertexOffset:V.vertexOffset,primitiveLength:V.primitiveLength,vertexLength:V.vertexLength,primitiveOffset:V.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&u.segments.push(A),u}encodeCentroid(e,i){const s=e.centroid(),u=i.span(),a=Math.min(7,Math.round(u.x*this.tileToMeter/10)),h=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new he(vt(s.x,1,wt-1)<<3|a,vt(s.y,1,wt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new he(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const u=i[0][0]!==s?0:1;return new he(6|(i[0][0]!==s?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==s?2:3;return new he((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Oc,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,u=e.flags&Oc?Eg:e.centroidXY,a=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||a!==u.x){for(let h=i;h<s;++h)this.centroidVertexArray.emplace(h,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(zm(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const a=[];for(const h of this.activeReplacements){if(h.order<s)continue;const g=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&Oc||h.min.x>w.max.x||w.min.x>h.max.x||h.min.y>w.max.y||w.min.y>h.max.y))for(let A=0;A<w.footprintSegLen;A++){const p=this.footprintSegments[w.footprintSegIdx+A];if(a.length=0,V0(this.footprintVertices,p.vertexOffset,p.vertexCount,h.footprintTileId.canonical,e.canonical,a),Sg(h.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-g)){w.flags|=Oc;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let u=!1;for(let a=0;a<s.footprintSegLen;a++){const h=this.footprintSegments[s.footprintSegIdx+a];let g=0;for(const w of h.ringIndices){for(let A=g,p=w+g-1;A<w+g;p=A++){const b=this.footprintVertices.int16[2*(A+h.vertexOffset)+0],E=this.footprintVertices.int16[2*(A+h.vertexOffset)+1],x=this.footprintVertices.int16[2*(p+h.vertexOffset)+1];E>i!=x>i&&e<(this.footprintVertices.int16[2*(p+h.vertexOffset)+0]-b)*(i-E)/(x-E)+b&&(u=!u)}g=w}}return u}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,u=!0;const a=4*(e+wt)*wt+(i+wt);if(this.partLookup.hasOwnProperty(a)){const h=this.partLookup[a];return h?{height:h.height,hidden:!!(h.flags&Oc)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||this.footprintContainsPoint(e,i,h)&&h&&h.height>s&&(s=h.height,this.partLookup[a]=h,u=!!(h.flags&Oc));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.partLookup[a]=void 0}}function Mg(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function Ig(r,e,i,s){const u=e.sub(r)._perp()._unit(),a=i.sub(e)._perp()._unit();return rl(r,e,i,Mg(u,a),s)}function rl(r,e,i,s,u){const a=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(i)/3,u*a/s)}function fn(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function Bm(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function js(r,e,i){if(r.x<0||r.x>=wt||e.x<0||e.x>=wt||i.x<0||i.x>=wt)return!1;const s=i.sub(e),u=s.perp(),a=r.sub(e);return(s.x*a.x+s.y*a.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(a.x*a.x+a.y*a.y))>-.866&&u.x*a.x+u.y*a.y<0}function Nm(r,e,i){const s=e?2|r:-3&r;return i?1|s:-2&s}function Cg(){const r=Math.PI/32,e=Math.tan(r),i=P;return i*Math.sqrt(1+2*e*e)-i}function Jn(r,e,i){const s=1<<i.z,u=te(i.x/s),a=te((i.x+1)/s),h=re(i.y/s),g=re((i.y+1)/s);return function(w,A,p,b,E=0,x){const T=[];if(!w.length||!p||!b)return T;const C=(Z,Q)=>{for(const ce of Z)T.push({polygon:ce,bounds:Q})},L=Math.ceil(Math.log2(p)),k=Math.ceil(Math.log2(b)),V=L-k,j=[];for(let Z=0;Z<Math.abs(V);Z++)j.push(V>0?0:1);for(let Z=0;Z<Math.min(L,k);Z++)j.push(0),j.push(1);let B=w;if(B=wp(B,A[0].y-E,A[1].y+E,1),B=wp(B,A[0].x-E,A[1].x+E,0),!B.length)return T;const q=[];for(j.length?q.push({polygons:B,bounds:A,depth:0}):C(B,A);q.length;){const Z=q.pop(),Q=Z.depth,ce=j[Q],oe=Z.bounds[0],ae=Z.bounds[1],Se=ce===0?oe.x:oe.y,se=ce===0?ae.x:ae.y,be=x?x(ce,Se,se):.5*(Se+se),Me=wp(Z.polygons,Se-E,be+E,ce),Ie=wp(Z.polygons,be-E,se+E,ce);if(Me.length){const Le=[oe,new he(ce===0?be:ae.x,ce===1?be:ae.y)];j.length>Q+1?q.push({polygons:Me,bounds:Le,depth:Q+1}):C(Me,Le)}if(Ie.length){const Le=[new he(ce===0?be:oe.x,ce===1?be:oe.y),ae];j.length>Q+1?q.push({polygons:Ie,bounds:Le,depth:Q+1}):C(Ie,Le)}}return T}(r,e,Math.ceil((a-u)/11.25),Math.ceil((h-g)/11.25),1,(w,A,p)=>{if(w===0)return .5*(A+p);{const b=re((i.y+A/wt)/s);return(K(.5*(re((i.y+p/wt)/s)+b))*s-i.y)*wt}})}function V0(r,e,i,s,u,a){const h=Math.pow(2,s.z-u.z);for(let g=0;g<i;g++){let w=r.int16[2*(g+e)+0],A=r.int16[2*(g+e)+1];w=(w+u.x*wt)*h-s.x*wt,A=(A+u.y*wt)*h-s.y*wt,a.push(new he(w,A))}}let Um,bd;function wd(r,e){return r.x*e.x+r.y*e.y}function Pg(r,e){if(r.length===1){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const a=e[i],h=r[0],g=u.sub(s),w=a.sub(s),A=h.sub(s),p=wd(g,g),b=wd(g,w),E=wd(w,w),x=wd(A,g),T=wd(A,w),C=p*E-b*b,L=(E*x-b*T)/C,k=(p*T-b*x)/C,V=s.z*(1-L-k)+u.z*L+a.z*k;if(isFinite(V))return V}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Rg(r,e,i,s,u,a,h,g){const w=h*u.getElevationAt(r,e,!0,!0),A=a[0]!==0,p=A?a[1]===0?h*(a[0]/7-450):h*function(b,E,x){const T=Math.floor(E[0]/8),C=Math.floor(E[1]/8),L=10*(E[0]-8*T),k=10*(E[1]-8*C),V=b.getElevationAt(T,C,!0,!0),j=b.getMeterToDEM(x),B=Math.floor(.5*(L*j-1)),q=Math.floor(.5*(k*j-1)),Z=b.tileCoordToPixel(T,C),Q=2*B+1,ce=2*q+1,oe=function(Ie,Le,Ue,je,Fe){return[Ie.getElevationAtPixel(Le,Ue,!0),Ie.getElevationAtPixel(Le+Fe,Ue,!0),Ie.getElevationAtPixel(Le,Ue+Fe,!0),Ie.getElevationAtPixel(Le+je,Ue+Fe,!0)]}(b,Z.x-B,Z.y-q,Q,ce),ae=Math.abs(oe[0]-oe[1]),Se=Math.abs(oe[2]-oe[3]),se=Math.abs(oe[0]-oe[2])+Math.abs(oe[1]-oe[3]),be=Math.min(.25,.5*j*(ae+Se)/Q),Me=Math.min(.25,.5*j*se/ce);return V+Math.max(be*L,Me*k)}(u,a,g):w;return{base:w+(i===0?-1:i),top:A?Math.max(p+s,w+i+2):w+s}}Vt(Ap,"FillExtrusionBucket",{omit:["layers","features"]}),Vt(vd,"PartData"),Vt(Fm,"FootprintSegment"),Vt(ds,"BorderCentroidData"),Vt(Ag,"GroundEffect");const j0=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),G0=on([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:q0}=j0,$0=on([{name:"a_packed",components:4,type:"Float32"}]),{members:H0}=$0,W0=on([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Z0}=W0;class Dg{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Lc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=mr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let a=e.length%2==1?-e[e.length-1]*s:0,h=e[0]*s,g=!0;u.push({left:a,right:h,isDash:g,zeroLength:e[0]===0});let w=e[0];for(let A=1;A<e.length;A++){g=!g;const p=e[A];a=w*s,w+=p,h=w*s,u.push({left:a,right:h,isDash:g,zeroLength:p===0})}return u}addRoundDash(e,i,s){const u=i/2;for(let a=-s;a<=s;a++){const h=this.width*(this.nextRow+s+a);let g=0,w=e[g];for(let A=0;A<this.width;A++){A/w.right>1&&(w=e[++g]);const p=Math.abs(A-w.left),b=Math.abs(A-w.right),E=Math.min(p,b);let x;const T=a/s*(u+1);if(w.isDash){const C=u-Math.abs(T);x=Math.sqrt(E*E+C*C)}else x=u-Math.sqrt(E*E+T*T);this.image.data[h+A]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const A=e[w],p=e[w+1];A.zeroLength?e.splice(w,1):p&&p.isDash===A.isDash&&(p.left=A.left,e.splice(w,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const a=this.width*this.nextRow;let h=0,g=e[h];for(let w=0;w<this.width;w++){w/g.right>1&&(g=e[++h]);const A=Math.abs(w-g.left),p=Math.abs(w-g.right),b=Math.min(A,p);this.image.data[a+w]=Math.max(0,Math.min(255,(g.isDash?b:-b)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u=i==="round",a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return ji("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let p=0;p<e.length;p++)e[p]<0&&(ji("Negative value is found in line dasharray, replacing values with 0"),e[p]=0),g+=e[p];if(g!==0){const p=this.width/g,b=this.getDashRanges(e,this.width,p);u?this.addRoundDash(b,p,a):this.addRegularDash(b,i==="square"?.5*p:0)}const w=this.nextRow+a;this.nextRow+=h;const A={tl:[w,a],br:[g,0]};return this.positions[s]=A,A}}Vt(Dg,"LineAtlas");const X0=Vh.VectorTileFeature.types,Y0=Math.cos(Math.PI/180*37.5),Vm=Math.cos(Math.PI/180*5);class jm{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new yc,this.layoutVertexArray2=new Os,this.patternVertexArray=new Qa,this.indexArray=new qn,this.programConfigurations=new sa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new rr,this.maxLineLength=0,this.zOffsetVertexArray=new lo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:wt/64}updateFootprints(e,i){}populate(e,i,s,u){this.hasPattern=_d("line",this.layers,i);const a=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const h=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&h==="none"&&ji(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&g!==void 0;const w=[];for(const{feature:E,id:x,index:T,sourceLayerIndex:C}of e){const L=this.layers[0]._featureFilter.needGeometry,k=rt(E,L);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),k,s))continue;const V=a?a.evaluate(k,{},s):void 0,j={id:x,properties:E.properties,type:E.type,sourceLayerIndex:C,index:T,geometry:L?k.geometry:ke(E,s,u),patterns:{},sortKey:V};w.push(j)}a&&w.sort((E,x)=>E.sortKey-x.sortKey);const{lineAtlas:A,featureIndex:p}=i,b=this.addConstantDashes(A);for(const E of w){const{geometry:x,index:T,sourceLayerIndex:C}=E;if(b&&this.addFeatureDashes(E,A),this.hasPattern){const L=xp("line",this.layers,E,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(E,x,T,s,A.positions,i.availableImages,i.brightness);p.insert(e[T].feature,x,T,C,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,a=s.layout.get("line-cap").value;if(u.kind!=="constant"||a.kind!=="constant")i=!0;else{const h=a.value,g=u.value;if(!g)continue;e.addDash(g,h)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const a=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(a.kind==="constant"&&h.kind==="constant")continue;let g,w;if(a.kind==="constant"){if(g=a.value,!g)continue}else g=a.evaluate({zoom:s},e);w=h.kind==="constant"?h.value:h.evaluate({zoom:s},e),i.addDash(g,w),e.patterns[u.id]=i.getKey(g,w)}}update(e,i,s,u,a){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,s,u,a)}addFeatures(e,i,s,u,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,H0)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Z0)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,G0.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,q0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,u,a,h,g){const w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),p=w.get("line-cap").evaluate(e,{}),b=w.get("line-miter-limit"),E=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;for(const x of i)this.addLine(x,e,u,A,p,b,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,a,h,u,g)}addLine(e,i,s,u,a,h,g){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=u==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=X0[i.type]==="Polygon";let p=e.length;for(;p>=2&&e[p-1].equals(e[p-2]);)p--;let b=0;for(;b<p-1&&e[b].equals(e[b+1]);)b++;if(p<(A?3:2))return;u==="bevel"&&(h=1.05);const E=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let x,T,C,L,k,V;this.e1=this.e2=-1,A&&(x=e[p-2],k=e[b].sub(x)._unit()._perp());for(let j=b;j<p;j++){if(C=j===p-1?A?e[b+1]:void 0:e[j+1],C&&e[j].equals(C))continue;k&&(L=k),x&&(T=x),x=e[j],V=this.hasZOffset?this.evaluateElevationValue(T?T.dist(x):0):null,k=C?C.sub(x)._unit()._perp():L,L=L||k;const B=T&&C;let q=B?u:A||w?"butt":a;const Z=L.x*k.x+L.y*k.y;if(w){const Me=function(Ie){if(Ie.patternJoinNone){const Le=Ie.segmentPoints.length/2,Ue=Ie.lineSoFar-Ie.segmentStart;for(let je=0;je<Le;++je){const Fe=Ie.segmentPoints[2*je+1],tt=Math.round(Ie.segmentPoints[2*je])+.5+.25*Fe;Ie.patternVertexArray.emplaceBack(tt,Ue,Ie.segmentStart),Ie.patternVertexArray.emplaceBack(tt,Ue,Ie.segmentStart)}Ie.segmentPoints.length=0}Ie.e1=Ie.e2=-1};if(B&&Z<Vm){this.updateDistance(T,x),this.addCurrentVertex(x,L,1,1,E,V),Me(this),this.addCurrentVertex(x,k,-1,-1,E,V);continue}if(T){if(!C){this.updateDistance(T,x),this.addCurrentVertex(x,L,1,1,E,V),Me(this);continue}q="miter"}}let Q=L.add(k);Q.x===0&&Q.y===0||Q._unit();const ce=Q.x*k.x+Q.y*k.y,oe=ce!==0?1/ce:1/0,ae=2*Math.sqrt(2-2*ce),Se=ce<Y0&&T&&C,se=L.x*k.y-L.y*k.x>0,be=this.overscaling<=16?15*wt/(512*this.overscaling):0;if(B&&q==="round"){if(oe<g)q="miter";else if(oe<=2){const Me=Td(x,-10,wt+10);q=this.hasZOffset&&(Me||this.hasCrossSlope)?"miter":"fakeround"}}if(q==="miter"&&oe>h&&(q="bevel"),q==="bevel"&&(oe>2&&(q="flipbevel"),oe<h&&(q="miter")),T&&!(q==="miter"&&Se)&&this.updateDistance(T,x),q==="miter")if(Se){const Me=x.dist(T);if(Me>2*be){const Le=x.sub(x.sub(T)._mult(be/Me)._round());this.updateDistance(T,Le),this.addCurrentVertex(Le,L,0,0,E,V),T=Le}this.updateDistance(T,x),Q._mult(oe),this.addCurrentVertex(x,Q,0,0,E,V);const Ie=x.dist(C);if(Ie>2*be){const Le=x.add(C.sub(x)._mult(be/Ie)._round());this.updateDistance(x,Le),this.addCurrentVertex(Le,k,0,0,E,V),x=Le}}else Q._mult(oe),this.addCurrentVertex(x,Q,0,0,E,V);else if(q==="flipbevel"){if(oe>100)Q=k.mult(-1);else{const Me=oe*L.add(k).mag()/L.sub(k).mag();Q._perp()._mult(Me*(se?-1:1))}this.addCurrentVertex(x,Q,0,0,E,V),this.addCurrentVertex(x,Q.mult(-1),0,0,E,V)}else if(q==="bevel"||q==="fakeround"){V!=null&&T&&this.addCurrentVertex(x,L,-1,-1,E,V);const Me=x.dist(T)<=2*be&&q!=="bevel",Ie=Q.mult(se?1:-1);Ie._mult(oe);const Le=k.mult(se?-1:1),Ue=L.mult(se?-1:1),je=this.evaluateElevationValue(this.distance);if(V==null&&(this.addHalfVertex(x,Ie.x,Ie.y,!1,!se,0,E,je),Me||this.addHalfVertex(x,Ie.x+2*Ue.x,Ie.y+2*Ue.y,!1,se,0,E,je)),q==="fakeround"){const Fe=Math.round(180*ae/Math.PI/20);this.addHalfVertex(x,Ue.x,Ue.y,!1,se,0,E,je);for(let tt=0;tt<Fe;tt++){let dt=tt/Fe;if(dt!==.5){const Bt=dt-.5;dt+=dt*Bt*(dt-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*Bt*Bt+(.848013+Z*(.215638*Z-1.06021)))}const Xe=Le.sub(Ue)._mult(dt)._add(Ue)._unit();this.addHalfVertex(x,Xe.x,Xe.y,!1,se,0,E,je)}this.addHalfVertex(x,Le.x,Le.y,!1,se,0,E,je)}Me||V!=null||this.addHalfVertex(x,Ie.x+2*Le.x,Ie.y+2*Le.y,!1,se,0,E,je),V!=null&&C&&this.addCurrentVertex(x,k,1,1,E,V)}else q==="butt"?this.addCurrentVertex(x,Q,0,0,E,V):q==="square"?(T||this.addCurrentVertex(x,Q,-1,-1,E,V),this.addCurrentVertex(x,Q,0,0,E,V),T&&this.addCurrentVertex(x,Q,1,1,E,V)):q==="round"&&(T&&(this.addCurrentVertex(x,L,0,0,E,V),this.addCurrentVertex(x,L,1,1,E,V,!0)),C&&(this.addCurrentVertex(x,k,-1,-1,E,V,!0),this.addCurrentVertex(x,k,0,0,E,V)))}}addVerticesTo(e,i,s,u,a,h,g,w,A,p){const b=(i.w-e.w)/this.tessellationStep|0;let E=0;const x=this.scaledDistance;if(b>1){this.lineSoFar=e.w;const C=(i.x-e.x)/b,L=(i.y-e.y)/b,k=(i.z-e.z)/b,V=(i.w-e.w)/b;for(let j=1;j<b;++j){e.x+=C,e.y+=L,e.z+=k,this.lineSoFar+=V,E+=V;const B=this.evaluateElevationValue(this.prevDistance+E);this.scaledDistance=(this.prevDistance+E)/this.totalDistance,this.addHalfVertex(e,s,u,p,!1,g,A,B),this.addHalfVertex(e,a,h,p,!0,-w,A,B)}}this.lineSoFar=i.w,this.scaledDistance=x;const T=this.evaluateElevationValue(this.distance);this.addHalfVertex(i,s,u,p,!1,g,A,T),this.addHalfVertex(i,a,h,p,!0,-w,A,T)}evaluateElevationValue(e){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ji(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(e,i,s,u,a,h,g=!1){const w=i.x+i.y*s,A=i.y-i.x*s,p=i.y*u-i.x,b=-i.y-i.x*u;if(h!=null){const x=wt+10,T=h,C=new un(e.x,e.y,T,this.lineSoFar),L=Td(e,-10,x),k=this.lineSoFar,V=this.distance;if(this.currentVertex)if(L){const j=this.currentVertexIsOutside,B=this.currentVertex,q=new un(e.x,e.y,T,this.lineSoFar);if(Hr(B,q,-10,x),!Td(q,-10,x)){if(j){this.e1=this.e2=-1,this.distance-=B.dist(C),this.lineSoFar=B.w;const Z=this.evaluateElevationValue(B.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(B,w,A,g,!1,s,a,Z),this.addHalfVertex(B,p,b,g,!0,-u,a,Z),this.prevDistance=this.distance}this.distance=this.prevDistance+B.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(B,q,w,A,p,b,s,u,a,g),this.distance=V,this.scaledDistance=this.distance/this.totalDistance}}else{const j=this.currentVertex;if(this.currentVertexIsOutside){Hr(j,C,-10,x),this.e1=this.e2=-1,this.distance-=j.dist(C),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=j.w;const B=this.evaluateElevationValue(j.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(j,w,A,g,!1,s,a,B),this.addHalfVertex(j,p,b,g,!0,-u,a,B),this.prevDistance=this.distance,this.distance=V,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(j,C,w,A,p,b,s,u,a,g)}else L||(this.addHalfVertex(e,w,A,g,!1,s,a,h),this.addHalfVertex(e,p,b,g,!0,-u,a,h));this.currentVertex=C,this.currentVertexIsOutside=L,this.lineSoFar=k}else this.addHalfVertex(e,w,A,g,!1,s,a,h),this.addHalfVertex(e,p,b,g,!0,-u,a,h)}addHalfVertex({x:e,y:i},s,u,a,h,g,w,A){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(a?1:0),(i<<1)+(h?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),w.primitiveLength++),h?this.e2=p:this.e1=p,A!=null&&this.zOffsetVertexArray.emplaceBack(A)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Td(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let Lg,zg;function Og(r,e,i){return e*(wt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Vt(jm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const uo=(r,e,i)=>(1-i)*r+i*e;function Ko(r,e){return 1/Og(r,1,e.tileZoom)}function kg(r,e,i,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Fg=r=>{const e=[];Bg(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=r.layout.get("line-join").constantOr("miter")==="none",u=!!r.paint.get("line-pattern").constantOr(1);return s&&u&&e.push("LINE_JOIN_NONE"),e};function Bg(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Mp;const Ng=()=>Mp||(Mp={layout:Lg||(Lg=new Bn({"line-cap":new ei(Ve.layout_line["line-cap"]),"line-join":new ei(Ve.layout_line["line-join"]),"line-miter-limit":new ht(Ve.layout_line["line-miter-limit"]),"line-round-limit":new ht(Ve.layout_line["line-round-limit"]),"line-sort-key":new ei(Ve.layout_line["line-sort-key"]),"line-z-offset":new ei(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new ht(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new ht(Ve.layout_line["line-cross-slope"]),visibility:new ht(Ve.layout_line.visibility)})),paint:zg||(zg=new Bn({"line-opacity":new ei(Ve.paint_line["line-opacity"]),"line-color":new ei(Ve.paint_line["line-color"]),"line-translate":new ht(Ve.paint_line["line-translate"]),"line-translate-anchor":new ht(Ve.paint_line["line-translate-anchor"]),"line-width":new ei(Ve.paint_line["line-width"]),"line-gap-width":new ei(Ve.paint_line["line-gap-width"]),"line-offset":new ei(Ve.paint_line["line-offset"]),"line-blur":new ei(Ve.paint_line["line-blur"]),"line-dasharray":new ei(Ve.paint_line["line-dasharray"]),"line-pattern":new ei(Ve.paint_line["line-pattern"]),"line-gradient":new _c(Ve.paint_line["line-gradient"]),"line-trim-offset":new ht(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new ht(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new ht(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new ht(Ve.paint_line["line-emissive-strength"]),"line-border-width":new ei(Ve.paint_line["line-border-width"]),"line-border-color":new ei(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new ht(Ve.paint_line["line-occlusion-opacity"])}))},Mp);class K0 extends ei{possiblyEvaluate(e,i){return i=new Kn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,u){return i=$i({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,u)}}let Sd;function Gm(r,e){return e>0?e+2*r:r}const J0=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q0=on([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ex=on([{name:"a_projected_pos",components:4,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ug=on([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Vg=on([{name:"a_texb",components:2,type:"Uint16"}]),tx=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ix=on([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jg=on([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nx=on([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),on([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ar=24;const Da=128;function qm(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Kn(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let a=0;for(;a<s.length&&s[a]<=r;)a++;a=Math.max(0,a-1);let h=a;for(;h<s.length&&s[h]<r+1;)h++;h=Math.min(s.length-1,h);const g=s[a],w=s[h];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:g,maxZoom:w,minSize:i.evaluate(new Kn(g)),maxSize:i.evaluate(new Kn(w)),interpolationType:u}}}function Ip(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return r.kind==="source"?s/Da:r.kind==="composite"?hi(s/Da,u/Da,i):e}function qh(r,e,i=1){let s=0,u=0;if(r.kind==="constant")u=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:a,minZoom:h,maxZoom:g}=r,w=a?vt(Ho.interpolationFactor(a,e,h,g),0,1):0;r.kind==="camera"?u=hi(r.minSize,r.maxSize,w)*i:s=w*i}return{uSizeT:s,uSize:u}}var rx=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Da,evaluateSizeForFeature:Ip,evaluateSizeForZoom:qh,getSizeData:qm});function Gg(r,e,i){return r.sections.forEach(s=>{s.text=function(u,a,h){const g=a.layout.get("text-transform").evaluate(h,{});return g==="uppercase"?u=u.toLocaleUpperCase():g==="lowercase"&&(u=u.toLocaleLowerCase()),Zo.applyArabicShaping&&(u=Zo.applyArabicShaping(u)),u}(s.text,e,i)}),r}const $h={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function ox(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function sx(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}var qg,$m,$g,Hm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ax(){return qg||(qg=1,Hm.read=function(r,e,i,s,u){var a,h,g=8*u-s-1,w=(1<<g)-1,A=w>>1,p=-7,b=i?u-1:0,E=i?-1:1,x=r[e+b];for(b+=E,a=x&(1<<-p)-1,x>>=-p,p+=g;p>0;a=256*a+r[e+b],b+=E,p-=8);for(h=a&(1<<-p)-1,a>>=-p,p+=s;p>0;h=256*h+r[e+b],b+=E,p-=8);if(a===0)a=1-A;else{if(a===w)return h?NaN:1/0*(x?-1:1);h+=Math.pow(2,s),a-=A}return(x?-1:1)*h*Math.pow(2,a-s)},Hm.write=function(r,e,i,s,u,a){var h,g,w,A=8*a-u-1,p=(1<<A)-1,b=p>>1,E=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=s?0:a-1,T=s?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,h=p):(h=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-h))<1&&(h--,w*=2),(e+=h+b>=1?E/w:E*Math.pow(2,1-b))*w>=2&&(h++,w/=2),h+b>=p?(g=0,h=p):h+b>=1?(g=(e*w-1)*Math.pow(2,u),h+=b):(g=e*Math.pow(2,b-1)*Math.pow(2,u),h=0));u>=8;r[i+x]=255&g,x+=T,g/=256,u-=8);for(h=h<<u|g,A+=u;A>0;r[i+x]=255&h,x+=T,h/=256,A-=8);r[i+x-T]|=128*C}),Hm}function Hg(){if($g)return $m;$g=1,$m=e;var r=ax();function e(B){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(B)?B:new Uint8Array(B||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,s=1/i,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function a(B){return B.type===e.Bytes?B.readVarint()+B.pos:B.pos+1}function h(B,q,Z){return Z?4294967296*q+(B>>>0):4294967296*(q>>>0)+(B>>>0)}function g(B,q,Z){var Q=q<=16383?1:q<=2097151?2:q<=268435455?3:Math.floor(Math.log(q)/(7*Math.LN2));Z.realloc(Q);for(var ce=Z.pos-1;ce>=B;ce--)Z.buf[ce+Q]=Z.buf[ce]}function w(B,q){for(var Z=0;Z<B.length;Z++)q.writeVarint(B[Z])}function A(B,q){for(var Z=0;Z<B.length;Z++)q.writeSVarint(B[Z])}function p(B,q){for(var Z=0;Z<B.length;Z++)q.writeFloat(B[Z])}function b(B,q){for(var Z=0;Z<B.length;Z++)q.writeDouble(B[Z])}function E(B,q){for(var Z=0;Z<B.length;Z++)q.writeBoolean(B[Z])}function x(B,q){for(var Z=0;Z<B.length;Z++)q.writeFixed32(B[Z])}function T(B,q){for(var Z=0;Z<B.length;Z++)q.writeSFixed32(B[Z])}function C(B,q){for(var Z=0;Z<B.length;Z++)q.writeFixed64(B[Z])}function L(B,q){for(var Z=0;Z<B.length;Z++)q.writeSFixed64(B[Z])}function k(B,q){return(B[q]|B[q+1]<<8|B[q+2]<<16)+16777216*B[q+3]}function V(B,q,Z){B[Z]=q,B[Z+1]=q>>>8,B[Z+2]=q>>>16,B[Z+3]=q>>>24}function j(B,q){return(B[q]|B[q+1]<<8|B[q+2]<<16)+(B[q+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(B,q,Z){for(Z=Z||this.length;this.pos<Z;){var Q=this.readVarint(),ce=Q>>3,oe=this.pos;this.type=7&Q,B(ce,q,this),this.pos===oe&&this.skip(Q)}return q},readMessage:function(B,q){return this.readFields(B,q,this.readVarint()+this.pos)},readFixed32:function(){var B=k(this.buf,this.pos);return this.pos+=4,B},readSFixed32:function(){var B=j(this.buf,this.pos);return this.pos+=4,B},readFixed64:function(){var B=k(this.buf,this.pos)+k(this.buf,this.pos+4)*i;return this.pos+=8,B},readSFixed64:function(){var B=k(this.buf,this.pos)+j(this.buf,this.pos+4)*i;return this.pos+=8,B},readFloat:function(){var B=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,B},readDouble:function(){var B=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,B},readVarint:function(B){var q,Z,Q=this.buf;return q=127&(Z=Q[this.pos++]),Z<128?q:(q|=(127&(Z=Q[this.pos++]))<<7,Z<128?q:(q|=(127&(Z=Q[this.pos++]))<<14,Z<128?q:(q|=(127&(Z=Q[this.pos++]))<<21,Z<128?q:function(ce,oe,ae){var Se,se,be=ae.buf;if(Se=(112&(se=be[ae.pos++]))>>4,se<128||(Se|=(127&(se=be[ae.pos++]))<<3,se<128)||(Se|=(127&(se=be[ae.pos++]))<<10,se<128)||(Se|=(127&(se=be[ae.pos++]))<<17,se<128)||(Se|=(127&(se=be[ae.pos++]))<<24,se<128)||(Se|=(1&(se=be[ae.pos++]))<<31,se<128))return h(ce,Se,oe);throw new Error("Expected varint not more than 10 bytes")}(q|=(15&(Z=Q[this.pos]))<<28,B,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var B=this.readVarint();return B%2==1?(B+1)/-2:B/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var B=this.readVarint()+this.pos,q=this.pos;return this.pos=B,B-q>=12&&u?function(Z,Q,ce){return u.decode(Z.subarray(Q,ce))}(this.buf,q,B):function(Z,Q,ce){for(var oe="",ae=Q;ae<ce;){var Se,se,be,Me=Z[ae],Ie=null,Le=Me>239?4:Me>223?3:Me>191?2:1;if(ae+Le>ce)break;Le===1?Me<128&&(Ie=Me):Le===2?(192&(Se=Z[ae+1]))==128&&(Ie=(31&Me)<<6|63&Se)<=127&&(Ie=null):Le===3?(se=Z[ae+2],(192&(Se=Z[ae+1]))==128&&(192&se)==128&&((Ie=(15&Me)<<12|(63&Se)<<6|63&se)<=2047||Ie>=55296&&Ie<=57343)&&(Ie=null)):Le===4&&(se=Z[ae+2],be=Z[ae+3],(192&(Se=Z[ae+1]))==128&&(192&se)==128&&(192&be)==128&&((Ie=(15&Me)<<18|(63&Se)<<12|(63&se)<<6|63&be)<=65535||Ie>=1114112)&&(Ie=null)),Ie===null?(Ie=65533,Le=1):Ie>65535&&(Ie-=65536,oe+=String.fromCharCode(Ie>>>10&1023|55296),Ie=56320|1023&Ie),oe+=String.fromCharCode(Ie),ae+=Le}return oe}(this.buf,q,B)},readBytes:function(){var B=this.readVarint()+this.pos,q=this.buf.subarray(this.pos,B);return this.pos=B,q},readPackedVarint:function(B,q){if(this.type!==e.Bytes)return B.push(this.readVarint(q));var Z=a(this);for(B=B||[];this.pos<Z;)B.push(this.readVarint(q));return B},readPackedSVarint:function(B){if(this.type!==e.Bytes)return B.push(this.readSVarint());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readSVarint());return B},readPackedBoolean:function(B){if(this.type!==e.Bytes)return B.push(this.readBoolean());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readBoolean());return B},readPackedFloat:function(B){if(this.type!==e.Bytes)return B.push(this.readFloat());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readFloat());return B},readPackedDouble:function(B){if(this.type!==e.Bytes)return B.push(this.readDouble());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readDouble());return B},readPackedFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed32());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readFixed32());return B},readPackedSFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed32());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readSFixed32());return B},readPackedFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed64());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readFixed64());return B},readPackedSFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed64());var q=a(this);for(B=B||[];this.pos<q;)B.push(this.readSFixed64());return B},skip:function(B){var q=7&B;if(q===e.Varint)for(;this.buf[this.pos++]>127;);else if(q===e.Bytes)this.pos=this.readVarint()+this.pos;else if(q===e.Fixed32)this.pos+=4;else{if(q!==e.Fixed64)throw new Error("Unimplemented type: "+q);this.pos+=8}},writeTag:function(B,q){this.writeVarint(B<<3|q)},realloc:function(B){for(var q=this.length||16;q<this.pos+B;)q*=2;if(q!==this.length){var Z=new Uint8Array(q);Z.set(this.buf),this.buf=Z,this.length=q}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(B){this.realloc(4),V(this.buf,B,this.pos),this.pos+=4},writeSFixed32:function(B){this.realloc(4),V(this.buf,B,this.pos),this.pos+=4},writeFixed64:function(B){this.realloc(8),V(this.buf,-1&B,this.pos),V(this.buf,Math.floor(B*s),this.pos+4),this.pos+=8},writeSFixed64:function(B){this.realloc(8),V(this.buf,-1&B,this.pos),V(this.buf,Math.floor(B*s),this.pos+4),this.pos+=8},writeVarint:function(B){(B=+B||0)>268435455||B<0?function(q,Z){var Q,ce;if(q>=0?(Q=q%4294967296|0,ce=q/4294967296|0):(ce=~(-q/4294967296),4294967295^(Q=~(-q%4294967296))?Q=Q+1|0:(Q=0,ce=ce+1|0)),q>=18446744073709552e3||q<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(oe,ae,Se){Se.buf[Se.pos++]=127&oe|128,oe>>>=7,Se.buf[Se.pos++]=127&oe|128,oe>>>=7,Se.buf[Se.pos++]=127&oe|128,oe>>>=7,Se.buf[Se.pos++]=127&oe|128,Se.buf[Se.pos]=127&(oe>>>=7)}(Q,0,Z),function(oe,ae){var Se=(7&oe)<<4;ae.buf[ae.pos++]|=Se|((oe>>>=3)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(ae.buf[ae.pos++]=127&oe)))))}(ce,Z)}(B,this):(this.realloc(4),this.buf[this.pos++]=127&B|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=B>>>7&127))))},writeSVarint:function(B){this.writeVarint(B<0?2*-B-1:2*B)},writeBoolean:function(B){this.writeVarint(!!B)},writeString:function(B){B=String(B),this.realloc(4*B.length),this.pos++;var q=this.pos;this.pos=function(Q,ce,oe){for(var ae,Se,se=0;se<ce.length;se++){if((ae=ce.charCodeAt(se))>55295&&ae<57344){if(!Se){ae>56319||se+1===ce.length?(Q[oe++]=239,Q[oe++]=191,Q[oe++]=189):Se=ae;continue}if(ae<56320){Q[oe++]=239,Q[oe++]=191,Q[oe++]=189,Se=ae;continue}ae=Se-55296<<10|ae-56320|65536,Se=null}else Se&&(Q[oe++]=239,Q[oe++]=191,Q[oe++]=189,Se=null);ae<128?Q[oe++]=ae:(ae<2048?Q[oe++]=ae>>6|192:(ae<65536?Q[oe++]=ae>>12|224:(Q[oe++]=ae>>18|240,Q[oe++]=ae>>12&63|128),Q[oe++]=ae>>6&63|128),Q[oe++]=63&ae|128)}return oe}(this.buf,B,this.pos);var Z=this.pos-q;Z>=128&&g(q,Z,this),this.pos=q-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(B){this.realloc(4),r.write(this.buf,B,this.pos,!0,23,4),this.pos+=4},writeDouble:function(B){this.realloc(8),r.write(this.buf,B,this.pos,!0,52,8),this.pos+=8},writeBytes:function(B){var q=B.length;this.writeVarint(q),this.realloc(q);for(var Z=0;Z<q;Z++)this.buf[this.pos++]=B[Z]},writeRawMessage:function(B,q){this.pos++;var Z=this.pos;B(q,this);var Q=this.pos-Z;Q>=128&&g(Z,Q,this),this.pos=Z-1,this.writeVarint(Q),this.pos+=Q},writeMessage:function(B,q,Z){this.writeTag(B,e.Bytes),this.writeRawMessage(q,Z)},writePackedVarint:function(B,q){q.length&&this.writeMessage(B,w,q)},writePackedSVarint:function(B,q){q.length&&this.writeMessage(B,A,q)},writePackedBoolean:function(B,q){q.length&&this.writeMessage(B,E,q)},writePackedFloat:function(B,q){q.length&&this.writeMessage(B,p,q)},writePackedDouble:function(B,q){q.length&&this.writeMessage(B,b,q)},writePackedFixed32:function(B,q){q.length&&this.writeMessage(B,x,q)},writePackedSFixed32:function(B,q){q.length&&this.writeMessage(B,T,q)},writePackedFixed64:function(B,q){q.length&&this.writeMessage(B,C,q)},writePackedSFixed64:function(B,q){q.length&&this.writeMessage(B,L,q)},writeBytesField:function(B,q){this.writeTag(B,e.Bytes),this.writeBytes(q)},writeFixed32Field:function(B,q){this.writeTag(B,e.Fixed32),this.writeFixed32(q)},writeSFixed32Field:function(B,q){this.writeTag(B,e.Fixed32),this.writeSFixed32(q)},writeFixed64Field:function(B,q){this.writeTag(B,e.Fixed64),this.writeFixed64(q)},writeSFixed64Field:function(B,q){this.writeTag(B,e.Fixed64),this.writeSFixed64(q)},writeVarintField:function(B,q){this.writeTag(B,e.Varint),this.writeVarint(q)},writeSVarintField:function(B,q){this.writeTag(B,e.Varint),this.writeSVarint(q)},writeStringField:function(B,q){this.writeTag(B,e.Bytes),this.writeString(q)},writeFloatField:function(B,q){this.writeTag(B,e.Fixed32),this.writeFloat(q)},writeDoubleField:function(B,q){this.writeTag(B,e.Fixed64),this.writeDouble(q)},writeBooleanField:function(B,q){this.writeVarintField(B,!!q)}},$m}var Cp=ue(Hg());const Wm=3;function lx(r,e,i){e.glyphs=[],r===1&&i.readMessage(cx,e)}function cx(r,e,i){if(r===3){const{id:s,bitmap:u,width:a,height:h,left:g,top:w,advance:A}=i.readMessage(ux,{});e.glyphs.push({id:s,bitmap:new Lc({width:a+2*Wm,height:h+2*Wm},u),metrics:{width:a,height:h,left:g,top:w,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function ux(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const Wg=Wm,Gs={horizontal:1,vertical:2,horizontalOnly:3};class Ed{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Ed;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Ed;return i.imageName=e,i}}class Hh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new Hh;for(let u=0;u<e.sections.length;u++){const a=e.sections[u];a.image?s.addImageSection(a):s.addTextSection(a,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let u="";for(let a=0;a<i.length;a++){const h=i.charCodeAt(a+1)||null,g=i.charCodeAt(a-1)||null;u+=!s&&(h&&Zf(h)&&!$h[i[a+1]]||g&&Zf(g)&&!$h[i[a-1]])||!$h[i[a]]?i[a]:$h[i[a]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Pp[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Pp[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new Hh;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ed.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void ji("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Ed.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zm(r,e,i,s,u,a,h,g,w,A,p,b,E,x,T){const C=Hh.fromFeature(r,u);b===Gs.vertical&&C.verticalizePunctuation(E);let L=[];const k=function(Z,Q,ce,oe,ae,Se){if(!Z)return[];const se=[],be=function(Ue,je,Fe,tt,dt,Xe){let Bt=0;for(let Et=0;Et<Ue.length();Et++){const yt=Ue.getSection(Et);Bt+=Zg(Ue.getCodePoint(Et),yt,tt,dt,je,Xe)}return Bt/Math.max(1,Math.ceil(Bt/Fe))}(Z,Q,ce,oe,ae,Se),Me=Z.text.indexOf("​")>=0;let Ie=0;for(let Ue=0;Ue<Z.length();Ue++){const je=Z.getSection(Ue),Fe=Z.getCodePoint(Ue);if(Pp[Fe]||(Ie+=Zg(Fe,je,oe,ae,Q,Se)),Ue<Z.length()-1){const tt=!((Le=Fe)<11904||!(Qt["Bopomofo Extended"](Le)||Qt.Bopomofo(Le)||Qt["CJK Compatibility Forms"](Le)||Qt["CJK Compatibility Ideographs"](Le)||Qt["CJK Compatibility"](Le)||Qt["CJK Radicals Supplement"](Le)||Qt["CJK Strokes"](Le)||Qt["CJK Symbols and Punctuation"](Le)||Qt["CJK Unified Ideographs Extension A"](Le)||Qt["CJK Unified Ideographs"](Le)||Qt["Enclosed CJK Letters and Months"](Le)||Qt["Halfwidth and Fullwidth Forms"](Le)||Qt.Hiragana(Le)||Qt["Ideographic Description Characters"](Le)||Qt["Kangxi Radicals"](Le)||Qt["Katakana Phonetic Extensions"](Le)||Qt.Katakana(Le)||Qt["Vertical Forms"](Le)||Qt["Yi Radicals"](Le)||Qt["Yi Syllables"](Le)));(hx[Fe]||tt||je.imageName)&&se.push(Yg(Ue+1,Ie,be,se,fx(Fe,Z.getCodePoint(Ue+1),tt&&Me),!1))}}var Le;return Kg(Yg(Z.length(),Ie,be,se,0,!0))}(C,A,a,e,s,x),{processBidirectionalText:V,processStyledBidirectionalText:j}=Zo;if(V&&C.sections.length===1){const Z=V(C.toString(),k);for(const Q of Z){const ce=new Hh;ce.text=Q,ce.sections=C.sections;for(let oe=0;oe<Q.length;oe++)ce.sectionIndex.push(0);L.push(ce)}}else if(j){const Z=j(C.text,C.sectionIndex,k);for(const Q of Z){const ce=new Hh;ce.text=Q[0],ce.sectionIndex=Q[1],ce.sections=C.sections,L.push(ce)}}else L=function(Z,Q){const ce=[],oe=Z.text;let ae=0;for(const Se of Q)ce.push(Z.substring(ae,Se)),ae=Se;return ae<oe.length&&ce.push(Z.substring(ae,oe.length)),ce}(C,k);const B=[],q={positionedLines:B,text:C.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:b,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Z,Q,ce,oe,ae,Se,se,be,Me,Ie,Le,Ue){let je=0,Fe=0,tt=0;const dt=be==="right"?1:be==="left"?0:.5;let Xe=!1;for(const Ft of ae){const qt=Ft.getSections();for(const bi of qt){if(bi.imageName)continue;const Ci=Q[bi.fontStack];if(Ci&&(Xe=Ci.ascender!==void 0&&Ci.descender!==void 0,!Xe))break}if(!Xe)break}let Bt=0;for(const Ft of ae){Ft.trim();const qt=Ft.getMaxScale(),bi=(qt-1)*Ar,Ci={positionedGlyphs:[],lineOffset:0};Z.positionedLines[Bt]=Ci;const Pi=Ci.positionedGlyphs;let Ai=0;if(!Ft.length()){Fe+=Se,++Bt;continue}let Ni=0,Bi=0;for(let Ln=0;Ln<Ft.length();Ln++){const mi=Ft.getSection(Ln),yn=Ft.getSectionIndex(Ln),Tn=Ft.getCodePoint(Ln);let Xn=mi.scale,xr=null,Ur=null,vr=null,pr=Ar,Ir=0;const Wr=!(Me===Gs.horizontal||!Le&&!Sa(Tn)||Le&&(Pp[Tn]||(Et=Tn,Qt.Arabic(Et)||Qt["Arabic Supplement"](Et)||Qt["Arabic Extended-A"](Et)||Qt["Arabic Presentation Forms-A"](Et)||Qt["Arabic Presentation Forms-B"](Et))));if(mi.imageName){const Ro=oe[mi.imageName];if(!Ro)continue;vr=mi.imageName,Z.iconsInText=Z.iconsInText||!0,Ur=Ro.paddedRect;const Zn=Ro.displaySize;Xn=Xn*Ar/Ue,xr={width:Zn[0],height:Zn[1],left:0,top:-Wg,advance:Wr?Zn[1]:Zn[0],localGlyph:!1},Ir=Xe?-xr.height*Xn:qt*Ar-17-Zn[1]*Xn,pr=xr.advance;const $s=(Wr?Zn[0]:Zn[1])*Xn-Ar*qt;$s>0&&$s>Ai&&(Ai=$s)}else{const Ro=ce[mi.fontStack];if(!Ro)continue;Ro[Tn]&&(Ur=Ro[Tn]);const Zn=Q[mi.fontStack];if(!Zn)continue;const $s=Zn.glyphs[Tn];if(!$s)continue;if(xr=$s.metrics,pr=Tn!==8203?Ar:0,Xe){const Xl=Zn.ascender!==void 0?Math.abs(Zn.ascender):0,sl=Zn.descender!==void 0?Math.abs(Zn.descender):0,al=(Xl+sl)*Xn;Ni<al&&(Ni=al,Bi=(Xl-sl)/2*Xn),Ir=-Xl*Xn}else Ir=(qt-Xn)*Ar-17}Wr?(Z.verticalizable=!0,Pi.push({glyph:Tn,imageName:vr,x:je,y:Fe+Ir,vertical:Wr,scale:Xn,localGlyph:xr.localGlyph,fontStack:mi.fontStack,sectionIndex:yn,metrics:xr,rect:Ur}),je+=pr*Xn+Ie):(Pi.push({glyph:Tn,imageName:vr,x:je,y:Fe+Ir,vertical:Wr,scale:Xn,localGlyph:xr.localGlyph,fontStack:mi.fontStack,sectionIndex:yn,metrics:xr,rect:Ur}),je+=xr.advance*Xn+Ie)}Pi.length!==0&&(tt=Math.max(je-Ie,tt),Xe?Xm(Pi,dt,Ai,Bi,Se*qt/2):Xm(Pi,dt,Ai,0,Se/2)),je=0;const Vn=Se*qt+Ai;Ci.lineOffset=Math.max(Ai,bi),Fe+=Vn,++Bt}var Et;const yt=Fe,{horizontalAlign:ut,verticalAlign:ni}=Ad(se);(function(Ft,qt,bi,Ci,Pi,Ai){const Ni=(qt-bi)*Pi,Bi=-Ai*Ci;for(const Vn of Ft)for(const Ln of Vn.positionedGlyphs)Ln.x+=Ni,Ln.y+=Bi})(Z.positionedLines,dt,ut,ni,tt,yt),Z.top+=-ni*yt,Z.bottom=Z.top+yt,Z.left+=-ut*tt,Z.right=Z.left+tt,Z.hasBaseline=Xe}(q,e,i,s,L,h,g,w,b,A,E,T),!function(Z){for(const Q of Z)if(Q.positionedGlyphs.length!==0)return!1;return!0}(B)&&q}const Pp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zg(r,e,i,s,u,a){if(e.imageName){const h=s[e.imageName];return h?h.displaySize[0]*e.scale*Ar/a+u:0}{const h=i[e.fontStack],g=h&&h.glyphs[r];return g?g.metrics.advance*e.scale+u:0}}function Xg(r,e,i,s){const u=Math.pow(r-e,2);return s?r<e?u/2:2*u:u+Math.abs(i)*i}function fx(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Yg(r,e,i,s,u,a){let h=null,g=Xg(e,i,u,a);for(const w of s){const A=Xg(e-w.x,i,u,a)+w.badness;A<=g&&(h=w,g=A)}return{index:r,x:e,priorBreak:h,badness:g}}function Kg(r){return r?Kg(r.priorBreak).concat(r.index):[]}function Ad(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Xm(r,e,i,s,u){if(!(e||i||s||u))return;const a=r.length-1,h=r[a],g=(h.x+h.metrics.advance*h.scale)*e;for(let w=0;w<=a;w++)r[w].x-=g,r[w].y+=i+s+u}function Jg(r,e,i,s){const{horizontalAlign:u,verticalAlign:a}=Ad(s),h=i[0]-r.displaySize[0]*u,g=i[1]-r.displaySize[1]*a;return{imagePrimary:r,imageSecondary:e,top:g,bottom:g+r.displaySize[1],left:h,right:h+r.displaySize[0]}}function Qg(r,e,i,s,u,a){const h=r.imagePrimary;let g;if(h.content){const L=h.content,k=h.pixelRatio||1;g=[L[0]/k,L[1]/k,h.displaySize[0]-L[2]/k,h.displaySize[1]-L[3]/k]}const w=e.left*a,A=e.right*a;let p,b,E,x;i==="width"||i==="both"?(x=u[0]+w-s[3],b=u[0]+A+s[1]):(x=u[0]+(w+A-h.displaySize[0])/2,b=x+h.displaySize[0]);const T=e.top*a,C=e.bottom*a;return i==="height"||i==="both"?(p=u[1]+T-s[0],E=u[1]+C+s[2]):(p=u[1]+(T+C-h.displaySize[1])/2,E=p+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:p,right:b,bottom:E,left:x,collisionPadding:g}}class ql extends he{constructor(e,i,s,u,a){super(e,i),this.angle=u,this.z=s,a!==void 0&&(this.segment=a)}clone(){return new ql(this.x,this.y,this.z,this.angle,this.segment)}}function ey(r,e,i,s,u){if(e.segment===void 0)return!0;let a=e,h=e.segment+1,g=0;for(;g>-i/2;){if(h--,h<0)return!1;g-=r[h].dist(a),a=r[h]}g+=r[h].dist(r[h+1]),h++;const w=[];let A=0;for(;g<i/2;){const p=r[h],b=r[h+1];if(!b)return!1;let E=r[h-1].angleTo(p)-p.angleTo(b);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:g,angleDelta:E}),A+=E;g-w[0].distance>s;)A-=w.shift().angleDelta;if(A>u)return!1;h++,g+=p.dist(b)}return!0}function Rp(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function ty(r,e,i){return r?.6*e*i:0}function iy(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function dx(r,e,i,s,u,a){const h=ty(i,u,a),g=iy(i,s)*a;let w=0;const A=Rp(r)/2;for(let p=0;p<r.length-1;p++){const b=r[p],E=r[p+1],x=b.dist(E);if(w+x>A){const T=(A-w)/x,C=hi(b.x,E.x,T),L=hi(b.y,E.y,T),k=new ql(C,L,0,E.angleTo(b),p);return!h||ey(r,k,g,h,e)?k:void 0}w+=x}}function ps(r,e,i,s,u,a,h,g,w){const A=ty(s,a,h),p=iy(s,u),b=p*h,E=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return e-b<e/4&&(e=b+e/4),Dp(r,E?e/2*g%e:(p/2+2*a)*h*g%e,e,A,i,b,E,!1,w)}function Dp(r,e,i,s,u,a,h,g,w){const A=a/2,p=Rp(r);let b=0,E=e-i,x=[];for(let T=0;T<r.length-1;T++){const C=r[T],L=r[T+1],k=C.dist(L),V=L.angleTo(C);for(;E+i<b+k;){E+=i;const j=(E-b)/k,B=hi(C.x,L.x,j),q=hi(C.y,L.y,j);if(B>=0&&B<w&&q>=0&&q<w&&E-A>=0&&E+A<=p){const Z=new ql(B,q,0,V,T);s&&!ey(r,Z,a,s,u)||x.push(Z)}}b+=k}return g||x.length||h||(x=Dp(r,b/2,i,s,u,a,h,!0,w)),x}function ny(r,e,i,s,u){const a=[];for(let h=0;h<r.length;h++){const g=r[h];let w;for(let A=0;A<g.length-1;A++){let p=g[A],b=g[A+1];p.x<e&&b.x<e||(p.x<e?p=new he(e,p.y+(e-p.x)/(b.x-p.x)*(b.y-p.y))._round():b.x<e&&(b=new he(e,p.y+(e-p.x)/(b.x-p.x)*(b.y-p.y))._round()),p.y<i&&b.y<i||(p.y<i?p=new he(p.x+(i-p.y)/(b.y-p.y)*(b.x-p.x),i)._round():b.y<i&&(b=new he(p.x+(i-p.y)/(b.y-p.y)*(b.x-p.x),i)._round()),p.x>=s&&b.x>=s||(p.x>=s?p=new he(s,p.y+(s-p.x)/(b.x-p.x)*(b.y-p.y))._round():b.x>=s&&(b=new he(s,p.y+(s-p.x)/(b.x-p.x)*(b.y-p.y))._round()),p.y>=u&&b.y>=u||(p.y>=u?p=new he(p.x+(u-p.y)/(b.y-p.y)*(b.x-p.x),u)._round():b.y>=u&&(b=new he(p.x+(u-p.y)/(b.y-p.y)*(b.x-p.x),u)._round()),w&&p.equals(w[w.length-1])||(w=[p],a.push(w)),w.push(b)))))}}return a}function ry(r){let e=0,i=0;for(const h of r)e+=h.w*h.h,i=Math.max(i,h.w);r.sort((h,g)=>g.h-h.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,a=0;for(const h of r)for(let g=s.length-1;g>=0;g--){const w=s[g];if(!(h.w>w.w||h.h>w.h)){if(h.x=w.x,h.y=w.y,a=Math.max(a,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===w.w&&h.h===w.h){const A=s.pop();g<s.length&&(s[g]=A)}else h.h===w.h?(w.x+=h.w,w.w-=h.w):h.w===w.w?(w.y+=h.h,w.h-=h.h):(s.push({x:w.x+h.w,y:w.y,w:w.w-h.w,h:h.h}),w.y+=h.h,w.h-=h.h);break}}return{w:u,h:a,fill:e/(u*a)||0}}Vt(ql,"Anchor");const Md=1;class Ym{constructor(e,{pixelRatio:i,version:s,stretchX:u,stretchY:a,content:h},g){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=a,this.content=h,this.version=s,this.padding=g}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Lp{constructor(e,i,s){const u={},a={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,u,Md,h),this.addImages(i,a,2,h);const{w:g,h:w}=ry(h),A=new Po({width:g||1,height:w||1});for(const p in e){const b=e[p],E=u[p].paddedRect;Po.copy(b.data,A,{x:0,y:0},{x:E.x+Md,y:E.y+Md},b.data,s,b.sdf)}for(const p in i){const b=i[p],E=a[p].paddedRect;let x=a[p].padding;const T=E.x+x,C=E.y+x,L=b.data.width,k=b.data.height;x=x>1?x-1:x,Po.copy(b.data,A,{x:0,y:0},{x:T,y:C},b.data,s),Po.copy(b.data,A,{x:0,y:k-x},{x:T,y:C-x},{width:L,height:x},s),Po.copy(b.data,A,{x:0,y:0},{x:T,y:C+k},{width:L,height:x},s),Po.copy(b.data,A,{x:L-x,y:0},{x:T-x,y:C},{width:x,height:k},s),Po.copy(b.data,A,{x:0,y:0},{x:T+L,y:C},{width:x,height:k},s),Po.copy(b.data,A,{x:L-x,y:k-x},{x:T-x,y:C-x},{width:x,height:x},s),Po.copy(b.data,A,{x:0,y:k-x},{x:T+L,y:C-x},{width:x,height:x},s),Po.copy(b.data,A,{x:0,y:0},{x:T+L,y:C+k},{width:x,height:x},s),Po.copy(b.data,A,{x:L-x,y:0},{x:T-x,y:C+k},{width:x,height:x},s)}this.image=A,this.iconPositions=u,this.patternPositions=a}addImages(e,i,s,u){for(const a in e){const h=e[a],g={x:0,y:0,w:h.data.width+2*s,h:h.data.height+2*s};u.push(g),i[a]=new Ym(g,h,s),h.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const u in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,s),i),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,a]=e.tl;s.update(i.data,{position:{x:u,y:a}})}}Vt(Ym,"ImagePosition"),Vt(Lp,"ImageAtlas");const Id=1e20;function zp(r,e,i,s,u,a,h,g,w){for(let A=e;A<e+s;A++)oy(r,i*a+A,a,u,h,g,w);for(let A=i;A<i+u;A++)oy(r,A*a+e,1,s,h,g,w)}function oy(r,e,i,s,u,a,h){a[0]=0,h[0]=-Id,h[1]=Id,u[0]=r[e];for(let g=1,w=0,A=0;g<s;g++){u[g]=r[e+g*i];const p=g*g;do{const b=a[w];A=(u[g]-u[b]+p-b*b)/(g-b)/2}while(A<=h[w]&&--w>-1);w++,a[w]=g,h[w]=A,h[w+1]=Id}for(let g=0,w=0;g<s;g++){for(;h[w+1]<g;)w++;const A=a[w],p=g-A;r[e+g*i]=u[A]+p*p}}const La=2,Km={none:0,ideographs:1,all:2};class Wh{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const u=[],a=this.urls[i]||pe.GLYPHS_URL;for(const h in e)for(const g of e[h])u.push({stack:h,id:g});Hi(u,({stack:h,id:g},w)=>{let A=this.entries[h];A||(A=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let p=A.glyphs[g];if(p!==void 0)return void w(null,{stack:h,id:g,glyph:p});if(p=this._tinySDF(A,h,g),p)return A.glyphs[g]=p,void w(null,{stack:h,id:g,glyph:p});const b=Math.floor(g/256);if(256*b>65535)return ji("glyphs > 65535 not supported"),void w(null,{stack:h,id:g,glyph:p});if(A.ranges[b])return void w(null,{stack:h,id:g,glyph:p});let E=A.requests[b];E||(E=A.requests[b]=[],Wh.loadGlyphRange(h,b,a,this.requestManager,(x,T)=>{if(T){A.ascender=T.ascender,A.descender=T.descender;for(const C in T.glyphs)this._doesCharSupportLocalGlyph(+C)||(A.glyphs[+C]=T.glyphs[+C]);A.ranges[b]=!0}for(const C of E)C(x,T);delete A.requests[b]})),E.push((x,T)=>{x?w(x):T&&w(null,{stack:h,id:g,glyph:T.glyphs[g]||null})})},(h,g)=>{if(h)s(h);else if(g){const w={};for(const{stack:A,id:p,glyph:b}of g)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[p]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;s(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Km.none&&(this.localGlyphMode===Km.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let a=e.tinySDF;if(!a){let C="400";/bold/i.test(i)?C="900":/medium/i.test(i)?C="500":/light/i.test(i)&&(C="200"),a=e.tinySDF=new Wh.TinySDF({fontFamily:u,fontWeight:C,fontSize:24*La,buffer:3*La,radius:8*La}),a.fontWeight=C}if(this.localGlyphs[a.fontWeight][s])return this.localGlyphs[a.fontWeight][s];const h=String.fromCodePoint(s),{data:g,width:w,height:A,glyphWidth:p,glyphHeight:b,glyphLeft:E,glyphTop:x,glyphAdvance:T}=a.draw(h);return this.localGlyphs[a.fontWeight][s]={id:s,bitmap:new Lc({width:w,height:A},g),metrics:{width:p/La,height:b/La,left:E/La,top:x/La-27,advance:T/La,localGlyph:!0}}}}Wh.loadGlyphRange=function(r,e,i,s,u){const a=256*e,h=a+255,g=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${a}-${h}`),nh.Glyphs);hl(g,(w,A)=>{if(w)u(w);else if(A){const p={},b=function(E){return new Cp(E).readFields(lx,{})}(A);for(const E of b.glyphs)p[E.id]=E;u(null,{glyphs:p,ascender:b.ascender,descender:b.descender})}})},Wh.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:a="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const g=this.size=r+4*e,w=this._createCanvas(g),A=this.ctx=w.getContext("2d",{willReadFrequently:!0});A.font=`${h} ${a} ${r}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:a}=this.ctx.measureText(r),h=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-u))),w=Math.min(this.size-this.buffer,h+Math.ceil(s)),A=g+2*this.buffer,p=w+2*this.buffer,b=Math.max(A*p,0),E=new Uint8ClampedArray(b),x={data:E,width:A,height:p,glyphWidth:g,glyphHeight:w,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(g===0||w===0)return x;const{ctx:T,buffer:C,gridInner:L,gridOuter:k}=this;T.clearRect(C,C,g,w),T.fillText(r,C,C+h);const V=T.getImageData(C,C,g,w);k.fill(Id,0,b),L.fill(0,0,b);for(let j=0;j<w;j++)for(let B=0;B<g;B++){const q=V.data[4*(j*g+B)+3]/255;if(q===0)continue;const Z=(j+C)*A+B+C;if(q===1)k[Z]=0,L[Z]=Id;else{const Q=.5-q;k[Z]=Q>0?Q*Q:0,L[Z]=Q<0?Q*Q:0}}zp(k,0,0,A,p,A,this.f,this.v,this.z),zp(L,C,C,g,w,A,this.f,this.v,this.z);for(let j=0;j<b;j++){const B=Math.sqrt(k[j])-Math.sqrt(L[j]);E[j]=Math.round(255-255*(B/this.radius+this.cutoff))}return x}};const $l=Md;function sy(r,e,i,s,u=1){const a=[],h=r.imagePrimary,g=h.pixelRatio,w=h.paddedRect.w-2*$l,A=h.paddedRect.h-2*$l,p=(r.right-r.left)*u,b=(r.bottom-r.top)*u,E=h.stretchX||[[0,w]],x=h.stretchY||[[0,A]],T=(se,be)=>se+be[1]-be[0],C=E.reduce(T,0),L=x.reduce(T,0),k=w-C,V=A-L;let j=0,B=C,q=0,Z=L,Q=0,ce=k,oe=0,ae=V;if(h.content&&s){const se=h.content;j=Op(E,0,se[0]),q=Op(x,0,se[1]),B=Op(E,se[0],se[2]),Z=Op(x,se[1],se[3]),Q=se[0]-j,oe=se[1]-q,ce=se[2]-se[0]-B,ae=se[3]-se[1]-Z}const Se=(se,be,Me,Ie)=>{const Le=Zh(se.stretch-j,B,p,r.left*u),Ue=Xh(se.fixed-Q,ce,se.stretch,C),je=Zh(be.stretch-q,Z,b,r.top*u),Fe=Xh(be.fixed-oe,ae,be.stretch,L),tt=Zh(Me.stretch-j,B,p,r.left*u),dt=Xh(Me.fixed-Q,ce,Me.stretch,C),Xe=Zh(Ie.stretch-q,Z,b,r.top*u),Bt=Xh(Ie.fixed-oe,ae,Ie.stretch,L),Et=new he(Le,je),yt=new he(tt,je),ut=new he(tt,Xe),ni=new he(Le,Xe),Ft=new he(Ue/g,Fe/g),qt=new he(dt/g,Bt/g),bi=e*Math.PI/180;if(bi){const Vn=Math.sin(bi),Ln=Math.cos(bi),mi=[Ln,-Vn,Vn,Ln];Et._matMult(mi),yt._matMult(mi),ni._matMult(mi),ut._matMult(mi)}const Ci=se.stretch+se.fixed,Pi=Me.stretch+Me.fixed,Ai=be.stretch+be.fixed,Ni=Ie.stretch+Ie.fixed,Bi=r.imageSecondary;return{tl:Et,tr:yt,bl:ni,br:ut,texPrimary:{x:h.paddedRect.x+$l+Ci,y:h.paddedRect.y+$l+Ai,w:Pi-Ci,h:Ni-Ai},texSecondary:Bi?{x:Bi.paddedRect.x+$l+Ci,y:Bi.paddedRect.y+$l+Ai,w:Pi-Ci,h:Ni-Ai}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ft,pixelOffsetBR:qt,minFontScaleX:ce/g/p,minFontScaleY:ae/g/b,isSDF:i}};if(s&&(h.stretchX||h.stretchY)){const se=ay(E,k,C),be=ay(x,V,L);for(let Me=0;Me<se.length-1;Me++){const Ie=se[Me],Le=se[Me+1];for(let Ue=0;Ue<be.length-1;Ue++)a.push(Se(Ie,be[Ue],Le,be[Ue+1]))}}else a.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return a}function Op(r,e,i){let s=0;for(const u of r)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function ay(r,e,i){const s=[{fixed:-$l,stretch:0}];for(const[u,a]of r){const h=s[s.length-1];s.push({fixed:u-h.stretch,stretch:h.stretch}),s.push({fixed:u-h.stretch,stretch:h.stretch+(a-u)})}return s.push({fixed:e+$l,stretch:i}),s}function Zh(r,e,i,s){return r/e*i+s}function Xh(r,e,i,s){return r-e*i/s}function px(r,e,i,s){const u=e+r.positionedLines[s].lineOffset;return s===0?i+u/2:i+(u+(e+r.positionedLines[s-1].lineOffset))/2}function mx(r,e=1,i=!1){let s=1/0,u=1/0,a=-1/0,h=-1/0;const g=r[0];for(let x=0;x<g.length;x++){const T=g[x];(!x||T.x<s)&&(s=T.x),(!x||T.y<u)&&(u=T.y),(!x||T.x>a)&&(a=T.x),(!x||T.y>h)&&(h=T.y)}const w=Math.min(a-s,h-u);let A=w/2;const p=new vf([],_x);if(w===0)return new he(s,u);for(let x=s;x<a;x+=w)for(let T=u;T<h;T+=w)p.push(new Yh(x+A,T+A,A,r));let b=function(x){let T=0,C=0,L=0;const k=x[0];for(let V=0,j=k.length,B=j-1;V<j;B=V++){const q=k[V],Z=k[B],Q=q.x*Z.y-Z.x*q.y;C+=(q.x+Z.x)*Q,L+=(q.y+Z.y)*Q,T+=3*Q}return new Yh(C/T,L/T,0,x)}(r),E=p.length;for(;p.length;){const x=p.pop();(x.d>b.d||!b.d)&&(b=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,E)),x.max-b.d<=e||(A=x.h/2,p.push(new Yh(x.p.x-A,x.p.y-A,A,r)),p.push(new Yh(x.p.x+A,x.p.y-A,A,r)),p.push(new Yh(x.p.x-A,x.p.y+A,A,r)),p.push(new Yh(x.p.x+A,x.p.y+A,A,r)),E+=4)}return i&&(console.log(`num probes: ${E}`),console.log(`best distance: ${b.d}`)),b.p}function _x(r,e){return e.max-r.max}class Yh{constructor(e,i,s,u){this.p=new he(e,i),this.h=s,this.d=function(a,h){let g=!1,w=1/0;for(let A=0;A<h.length;A++){const p=h[A];for(let b=0,E=p.length,x=E-1;b<E;x=b++){const T=p[b],C=p[x];T.y>a.y!=C.y>a.y&&a.x<(C.x-T.x)*(a.y-T.y)/(C.y-T.y)+T.x&&(g=!g),w=Math.min(w,ai(a,T,C))}}return(g?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Jm=Number.POSITIVE_INFINITY,gx=Math.sqrt(2);function ly(r,[e,i]){let s=0,u=0;if(i===Jm){e<0&&(e=0);const a=e/gx;switch(r){case"top-right":case"top-left":u=a-7;break;case"bottom-right":case"bottom-left":u=7-a;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(r){case"top-right":case"bottom-right":s=-a;break;case"top-left":case"bottom-left":s=a;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function Qm(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yx(r,e,i,s,u,a,h,g,w,A,p,b,E,x,T){let C=a.textMaxSize.evaluate(e,{},b);C===void 0?C=h*a.textScaleFactor:C*=a.textScaleFactor;const L=r.layers[0].layout,k=L.get("icon-offset").evaluate(e,{},b),V=uy(i.horizontal)||i.vertical,j=E.name==="globe",B=Ar,q=h*a.textScaleFactor/B,Z=r.tilePixelRatio*C/B,Q=(Ie=r.overscaling,r.zoom>18&&Ie>2&&(Ie>>=1),Math.max(wt/(512*Ie),1)*L.get("symbol-spacing")),ce=L.get("text-padding")*r.tilePixelRatio,oe=L.get("icon-padding")*r.tilePixelRatio,ae=pt(L.get("text-max-angle")),Se=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",se=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",be=L.get("symbol-placement"),Me=Q/2;var Ie;const Le=L.get("icon-text-fit").evaluate(e,{},b),Ue=L.get("icon-text-fit-padding").evaluate(e,{},b),je=Le!=="none";let Fe;r.hasAnyIconTextFit===!1&&je&&(r.hasAnyIconTextFit=!0),s&&je&&(r.allowVerticalPlacement&&i.vertical&&(Fe=Qg(s,i.vertical,Le,Ue,k,q)),V&&(s=Qg(s,V,Le,Ue,k,q)));const tt=(dt,Xe,Bt)=>{if(Xe.x<0||Xe.x>=wt||Xe.y<0||Xe.y>=wt)return;let Et=null;if(j){const{x:yt,y:ut,z:ni}=E.projectTilePoint(Xe.x,Xe.y,Bt);Et={anchor:new ql(yt,ut,ni,0,void 0),up:E.upVector(Bt,Xe.x,Xe.y)}}(function(yt,ut,ni,Ft,qt,bi,Ci,Pi,Ai,Ni,Bi,Vn,Ln,mi,yn,Tn,Xn,xr,Ur,vr,pr,Ir,Wr,Ro,Zn,$s,Xl){const sl=yt.addToLineVertexArray(ut,Ft);let al,zd,Qh,Od,d_,Zb,Xb,Yb=0,Kb=0,Jb=0,Qb=0,Zx=-1,Xx=-1;const Bc={};let ew=ho("");const kd=ni?ni.anchor:ut,Yx=Ai.layout.get("icon-text-fit").evaluate(pr,{},Zn)!=="none";let Kx=0,Jx=0;if(Ai._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Kx,Jx]=Ai.layout.get("text-offset").evaluate(pr,{},Zn).map(ua=>ua*Ar):(Kx=Ai.layout.get("text-radial-offset").evaluate(pr,{},Zn)*Ar,Jx=Jm),yt.allowVerticalPlacement&&qt.vertical){const ua=qt.vertical;if(yn)Zb=e_(ua),Pi&&(Xb=e_(Pi));else{const ha=Ai.layout.get("text-rotate").evaluate(pr,{},Zn)+90;Qh=kp(Ni,kd,ut,Bi,Vn,Ln,ua,mi,ha,Tn),Pi&&(Od=kp(Ni,kd,ut,Bi,Vn,Ln,Pi,xr,ha))}}if(bi){const ua=Ai.layout.get("icon-rotate").evaluate(pr,{},Zn),ha=sy(bi,ua,Wr,Yx,Ir.iconScaleFactor),Gp=Pi?sy(Pi,ua,Wr,Yx,Ir.iconScaleFactor):void 0;zd=kp(Ni,kd,ut,Bi,Vn,Ln,bi,xr,ua),Yb=4*ha.length;const tw=yt.iconSizeData;let Fd=null;tw.kind==="source"?(Fd=[Da*Ai.layout.get("icon-size").evaluate(pr,{},Zn)*Ir.iconScaleFactor],Fd[0]>kc&&ji(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Cd}. Reduce your "icon-size".`)):tw.kind==="composite"&&(Fd=[Da*Ir.compositeIconSizes[0].evaluate(pr,{},Zn)*Ir.iconScaleFactor,Da*Ir.compositeIconSizes[1].evaluate(pr,{},Zn)*Ir.iconScaleFactor],(Fd[0]>kc||Fd[1]>kc)&&ji(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Cd}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,ha,Fd,vr,Ur,pr,!1,ni,ut,sl.lineStartIndex,sl.lineLength,-1,Ro,Zn,$s,Xl),Zx=yt.icon.placedSymbolArray.length-1,Gp&&(Kb=4*Gp.length,yt.addSymbols(yt.icon,Gp,Fd,vr,Ur,pr,Gs.vertical,ni,ut,sl.lineStartIndex,sl.lineLength,-1,Ro,Zn,$s,Xl),Xx=yt.icon.placedSymbolArray.length-1)}for(const ua in qt.horizontal){const ha=qt.horizontal[ua];al||(ew=ho(ha.text),yn?d_=e_(ha):al=kp(Ni,kd,ut,Bi,Vn,Ln,ha,mi,Ai.layout.get("text-rotate").evaluate(pr,{},Zn),Tn));const Gp=ha.positionedLines.length===1;if(Jb+=cy(yt,ni,ut,ha,Ci,Ai,yn,pr,Tn,sl,qt.vertical?Gs.horizontal:Gs.horizontalOnly,Gp?Object.keys(qt.horizontal):[ua],Bc,Zx,Ir,Ro,Zn,$s),Gp)break}qt.vertical&&(Qb+=cy(yt,ni,ut,qt.vertical,Ci,Ai,yn,pr,Tn,sl,Gs.vertical,["vertical"],Bc,Xx,Ir,Ro,Zn,$s));let ef=-1;const Qx=(ua,ha)=>ua?Math.max(ua,ha):ha;ef=Qx(d_,ef),ef=Qx(Zb,ef),ef=Qx(Xb,ef);const OE=ef>-1?1:0;yt.glyphOffsetArray.length>=65535&&ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pr.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,pr.sortKey),yt.symbolInstances.emplaceBack(ut.x,ut.y,kd.x,kd.y,kd.z,Bc.right>=0?Bc.right:-1,Bc.center>=0?Bc.center:-1,Bc.left>=0?Bc.left:-1,Bc.vertical>=0?Bc.vertical:-1,Zx,Xx,ew,al!==void 0?al:yt.collisionBoxArray.length,al!==void 0?al+1:yt.collisionBoxArray.length,Qh!==void 0?Qh:yt.collisionBoxArray.length,Qh!==void 0?Qh+1:yt.collisionBoxArray.length,zd!==void 0?zd:yt.collisionBoxArray.length,zd!==void 0?zd+1:yt.collisionBoxArray.length,Od||yt.collisionBoxArray.length,Od?Od+1:yt.collisionBoxArray.length,Bi,Jb,Qb,Yb,Kb,OE,0,Kx,Jx,ef,0,Yx?1:0)})(r,Xe,Et,dt,i,s,u,Fe,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,ce,Se,w,0,oe,se,k,e,a,A,p,b,x,T)};if(be==="line")for(const dt of ny(e.geometry,0,0,wt,wt)){const Xe=ps(dt,Q,ae,i.vertical||V,s,B,Z,r.overscaling,wt);for(const Bt of Xe)V&&xx(r,V.text,Me,Bt)||tt(dt,Bt,b)}else if(be==="line-center"){for(const dt of e.geometry)if(dt.length>1){const Xe=dx(dt,ae,i.vertical||V,s,B,Z);Xe&&tt(dt,Xe,b)}}else if(e.type==="Polygon")for(const dt of md(e.geometry,0)){const Xe=mx(dt,16);tt(dt[0],new ql(Xe.x,Xe.y,0,0,void 0),b)}else if(e.type==="LineString")for(const dt of e.geometry)tt(dt,new ql(dt[0].x,dt[0].y,0,0,void 0),b);else if(e.type==="Point")for(const dt of e.geometry)for(const Xe of dt)tt([Xe],new ql(Xe.x,Xe.y,0,0,void 0),b)}const Cd=255,kc=Cd*Da;function cy(r,e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L,k){const V=function(q,Z,Q,ce,oe,ae,Se,se){const be=[];if(Z.positionedLines.length===0)return be;const Me=ce.layout.get("text-rotate").evaluate(ae,{})*Math.PI/180,Ie=function(tt){const dt=tt[0],Xe=tt[1],Bt=dt*Xe;return Bt>0?[dt,-Xe]:Bt<0?[-dt,Xe]:dt===0?[Xe,dt]:[Xe,-dt]}(Q);let Le=Math.abs(Z.top-Z.bottom);for(const tt of Z.positionedLines)Le-=tt.lineOffset;const Ue=Z.positionedLines.length,je=Le/Ue;let Fe=Z.top-Q[1];for(let tt=0;tt<Ue;++tt){const dt=Z.positionedLines[tt];Fe=px(Z,je,Fe,tt);for(const Xe of dt.positionedGlyphs){if(!Xe.rect)continue;const Bt=Xe.rect||{};let Et=Wg+1,yt=!0,ut=1,ni=0;if(Xe.imageName){const vr=Se[Xe.imageName];if(!vr)continue;if(vr.sdf){ji("SDF images are not supported in formatted text and will be ignored.");continue}yt=!1,ut=vr.pixelRatio,Et=Md/ut}const Ft=(oe||se)&&Xe.vertical,qt=Xe.metrics.advance*Xe.scale/2,bi=Xe.metrics,Ci=Xe.rect;if(Ci===null)continue;se&&Z.verticalizable&&(ni=Xe.imageName?qt-Xe.metrics.width*Xe.scale/2:0);const Pi=oe?[Xe.x+qt,Xe.y]:[0,0];let Ai=[0,0],Ni=[0,0],Bi=!1;oe||(Ft?(Ni=[Xe.x+qt+Ie[0],Xe.y+Ie[1]-ni],Bi=!0):Ai=[Xe.x+qt+Q[0],Xe.y+Q[1]-ni]);const Vn=Ci.w*Xe.scale/(ut*(Xe.localGlyph?La:1)),Ln=Ci.h*Xe.scale/(ut*(Xe.localGlyph?La:1));let mi,yn,Tn,Xn;if(Ft){const vr=Xe.y-Fe,pr=new he(-qt,qt-vr),Ir=-Math.PI/2,Wr=new he(...Ni);mi=new he(-qt+Ai[0],Ai[1]),mi._rotateAround(Ir,pr)._add(Wr),mi.x+=-vr+qt,mi.y-=(bi.left-Et)*Xe.scale;const Ro=Xe.imageName?bi.advance*Xe.scale:Ar*Xe.scale,Zn=String.fromCodePoint(Xe.glyph);ox(Zn)?mi.x+=(1-Et)*Xe.scale:sx(Zn)?mi.x+=Ro-bi.height*Xe.scale+(-Et-1)*Xe.scale:mi.x+=Xe.imageName||bi.width+2*Et===Ci.w&&bi.height+2*Et===Ci.h?(Ro-Ln)/2:(Ro-(bi.height+2*Et)*Xe.scale)/2,yn=new he(mi.x,mi.y-Vn),Tn=new he(mi.x+Ln,mi.y),Xn=new he(mi.x+Ln,mi.y-Vn)}else{const vr=(bi.left-Et)*Xe.scale-qt+Ai[0],pr=(-bi.top-Et)*Xe.scale+Ai[1],Ir=vr+Vn,Wr=pr+Ln;mi=new he(vr,pr),yn=new he(Ir,pr),Tn=new he(vr,Wr),Xn=new he(Ir,Wr)}if(Me){let vr;vr=oe?new he(0,0):Bi?new he(Ie[0],Ie[1]):new he(Q[0],Q[1]),mi._rotateAround(Me,vr),yn._rotateAround(Me,vr),Tn._rotateAround(Me,vr),Xn._rotateAround(Me,vr)}const xr=new he(0,0),Ur=new he(0,0);be.push({tl:mi,tr:yn,bl:Tn,br:Xn,texPrimary:Bt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:Pi,sectionIndex:Xe.sectionIndex,isSDF:yt,pixelOffsetTL:xr,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}}return be}(0,s,w,a,h,g,u,r.allowVerticalPlacement),j=r.textSizeData;let B=null;j.kind==="source"?(B=[Da*a.layout.get("text-size").evaluate(g,{},L)*T.textScaleFactor],B[0]>kc&&ji(`${r.layerIds[0]}: Value for "text-size" is >= ${Cd}. Reduce your "text-size".`)):j.kind==="composite"&&(B=[Da*T.compositeTextSizes[0].evaluate(g,{},L)*T.textScaleFactor,Da*T.compositeTextSizes[1].evaluate(g,{},L)*T.textScaleFactor],(B[0]>kc||B[1]>kc)&&ji(`${r.layerIds[0]}: Value for "text-size" is >= ${Cd}. Reduce your "text-size".`)),r.addSymbols(r.text,V,B,w,h,g,p,e,i,A.lineStartIndex,A.lineLength,x,C,L,k,!1);for(const q of b)E[q]=r.text.placedSymbolArray.length-1;return 4*V.length}function uy(r){for(const e in r)return r[e];return null}function kp(r,e,i,s,u,a,h,g,w,A){let p=h.top,b=h.bottom,E=h.left,x=h.right;const T=h.collisionPadding;if(T&&(E-=T[0],p-=T[1],x+=T[2],b+=T[3]),w){const C=new he(E,p),L=new he(x,p),k=new he(E,b),V=new he(x,b),j=pt(w);let B=new he(0,0);A&&(B=new he(A[0],A[1])),C._rotateAround(j,B),L._rotateAround(j,B),k._rotateAround(j,B),V._rotateAround(j,B),E=Math.min(C.x,L.x,k.x,V.x),x=Math.max(C.x,L.x,k.x,V.x),p=Math.min(C.y,L.y,k.y,V.y),b=Math.max(C.y,L.y,k.y,V.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,E,p,x,b,g,s,u,a),r.length-1}function e_(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function xx(r,e,i,s){const u=r.compareText;if(e in u){const a=u[e];for(let h=a.length-1;h>=0;h--)if(s.dist(a[h])<i)return!0}else u[e]=[];return u[e].push(s),!1}function hy(r,e){const i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),a=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let h=Math.sin(r._pitch)*a+u;const g=u*(1/r._horizonShift);return r.elevation&&r.elevation.exaggeration()!==0||(h*=1+Math.max(r.zoom-17,0)),Math.min(1.01*h,g)}function Pd(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),s=r.x*i,u=(r.x+1)*i,a=r.y*i,h=(r.y+1)*i,g=te(s),w=te(u),A=re(a),p=re(h),b=e.project(g,A),E=e.project(w,A),x=e.project(w,p),T=e.project(g,p);let C=Math.min(b.x,E.x,x.x,T.x),L=Math.min(b.y,E.y,x.y,T.y),k=Math.max(b.x,E.x,x.x,T.x),V=Math.max(b.y,E.y,x.y,T.y);const j=i/16;function B(Z,Q,ce,oe,ae,Se){const se=(ce+ae)/2,be=(oe+Se)/2,Me=e.project(te(se),re(be)),Ie=Math.max(0,C-Me.x,L-Me.y,Me.x-k,Me.y-V);C=Math.min(C,Me.x),k=Math.max(k,Me.x),L=Math.min(L,Me.y),V=Math.max(V,Me.y),Ie>j&&(B(Z,Me,ce,oe,se,be),B(Me,Q,se,be,ae,Se))}B(b,E,s,a,u,a),B(E,x,u,a,u,h),B(x,T,u,h,s,h),B(T,b,s,h,s,a),C-=j,L-=j,k+=j,V+=j;const q=1/Math.max(k-C,V-L);return{scale:q,x:C*q,y:L*q,x2:k*q,y2:V*q,projection:e}}function fy(r,{x:e,y:i},s=0){return new he(((e-s)*r.scale-r.x)*wt,(i*r.scale-r.y)*wt)}const vx=ye.mat4.identity(new Float32Array(16));class Fc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new R(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return Y(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return hy(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const a=e.horizonLineFromTop(!1),h=new he(i,Math.max(a,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,u))}pointCoordinate3D(e,i,s){const u=new he(i,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const a=this.pointCoordinate(e,u.x,u.y,0);return[a.x,a.y,a.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return vx}createTileMatrix(e,i,s){let u,a,h;const g=s.canonical,w=ye.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Pd(g,this);u=1,a=A.x+s.wrap*A.scale,h=A.y,ye.mat4.scale(w,w,[u/A.scale,u/A.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(g.z),a=(g.x+Math.pow(2,g.z)*s.wrap)*u,h=g.y*u;return ye.mat4.translate(w,w,[a,h,0]),ye.mat4.scale(w,w,[u/wt,u/wt,1]),w}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class m extends Fc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(pt(i));this.n=(u+Math.sin(pt(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:a}=this,h=pt(e-this.center[0]),g=pt(i),w=Math.sqrt(u-2*s*Math.sin(g))/s;return{x:w*Math.sin(h*s),y:w*Math.cos(h*s)-a,z:0}}unproject(e,i){const{n:s,c:u,r0:a}=this,h=a+i;let g=Math.atan2(e,Math.abs(h))*Math.sign(h);h*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(h));const w=pt(this.center[0])*s;g=Di(g,-Math.PI-w,Math.PI-w);const A=vt(Xt(g/s)+this.center[0],-180,180),p=Math.asin(vt((u-(e*e+h*h)*s*s)/(2*s),-1,1)),b=vt(Xt(p),-fe,fe);return new R(A,b)}}const S=1.340264,z=-.081106,H=893e-6,ne=.003796,ve=Math.sqrt(3)/2;class Ne extends Fc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(ve*Math.sin(i)),u=s*s,a=u*u*u;return{x:.5*(e*Math.cos(s)/(ve*(S+3*z*u+a*(7*H+9*ne*u)))/Math.PI+.5),y:1-.5*(s*(S+z*u+a*(H+ne*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,a=u*u*u;for(let p,b,E,x=0;x<12&&(b=s*(S+z*u+a*(H+ne*u))-i,E=S+3*z*u+a*(7*H+9*ne*u),p=b/E,s=vt(s-p,-Math.PI/3,Math.PI/3),u=s*s,a=u*u*u,!(Math.abs(p)<1e-12));++x);const h=ve*e*(S+3*z*u+a*(7*H+9*ne*u))/Math.cos(s),g=Math.asin(Math.sin(s)/ve),w=vt(180*h/Math.PI,-180,180),A=vt(180*g/Math.PI,-fe,fe);return new R(w,A)}}class qe extends Fc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=vt(360*(.5-i),-fe,fe);return new R(s,u)}}const it=Math.PI/2;function Pt(r){return Math.tan((it+r)/2)}class Ot extends Fc{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let u=pt(i),a=pt(s);this.southernCenter=u+a<0,this.southernCenter&&(u=-u,a=-a);const h=Math.cos(u),g=Pt(u);this.n=u===a?Math.sin(u):Math.log(h/Math.cos(a))/Math.log(Pt(a)/g),this.f=h*Math.pow(Pt(u),this.n)/this.n}project(e,i){i=pt(i),this.southernCenter&&(i=-i),e=pt(e-this.center[0]);const s=1e-6,{n:u,f:a}=this;a>0?i<-it+s&&(i=-it+s):i>it-s&&(i=it-s);const h=a/Math.pow(Pt(i),u);let g=h*Math.sin(u*e),w=a-h*Math.cos(u*e);return g=.5*(g/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:g,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,a=u-i,h=Math.sign(a),g=Math.sign(s)*Math.sqrt(e*e+a*a);let w=Math.atan2(e,Math.abs(a))*h;a*s<0&&(w-=Math.PI*Math.sign(e)*h);const A=vt(Xt(w/s)+this.center[0],-180,180),p=vt(Xt(2*Math.atan(Math.pow(u/g,1/s))-it),-fe,fe);return new R(A,this.southernCenter?-p:p)}}class jt extends Fc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:W(e),y:K(i),z:0}}unproject(e,i){const s=te(e),u=re(i);return new R(s,u)}}const ci=pt(fe);class Ii extends Fc{project(e,i){const s=(i=pt(i))*i,u=s*s;return{x:.5*((e=pt(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,a=0,h=s*s;do{h=s*s;const A=h*h;a=(s*(1.007226+h*(.015085+A*(.028874*h-.044475-.005916*A)))-i)/(1.007226+h*(.045255+A*(.259866*h-.311325-.005916*11*A))),s=vt(s-a,-ci,ci)}while(Math.abs(a)>1e-6&&--u>0);h=s*s;const g=vt(Xt(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),w=Xt(s);return new R(g,w)}}const Gi=pt(fe);class wn extends Fc{project(e,i){i=pt(i),e=pt(e);const s=Math.cos(i),u=2/Math.PI,a=Math.acos(s*Math.cos(e/2)),h=Math.sin(a)/a,g=.5*(e*u+2*s*Math.sin(e/2)/h)||0,w=.5*(i+Math.sin(i)/h)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,a=25;const h=1e-6;let g=0,w=0;do{const A=Math.cos(u),p=Math.sin(u),b=2*p*A,E=p*p,x=A*A,T=Math.cos(s/2),C=Math.sin(s/2),L=2*T*C,k=C*C,V=1-x*T*T,j=V?1/V:0,B=V?Math.acos(A*T)*Math.sqrt(1/V):0,q=.5*(2*B*A*C+2*s/Math.PI)-e,Z=.5*(B*p+u)-i,Q=.5*j*(x*k+B*A*T*E)+1/Math.PI,ce=j*(L*b/4-B*p*C),oe=.125*j*(b*C-B*p*x*L),ae=.5*j*(E*T+B*k*A)+.5,Se=ce*oe-ae*Q;g=(Z*ce-q*ae)/Se,w=(q*oe-Z*Q)/Se,s=vt(s-g,-Math.PI,Math.PI),u=vt(u-w,-Gi,Gi)}while((Math.abs(g)>h||Math.abs(w)>h)&&--a>0);return new R(Xt(s),Xt(u))}}class qi extends Fc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:pt(e)*u*s+.5,y:-Math.sin(pt(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,a=-(i-.5)/s,h=vt(Xt((e-.5)/s)/u,-180,180),g=Math.asin(vt(a*u,-1,1)),w=vt(Xt(g),-fe,fe);return new R(h,w)}}class Dn extends jt{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const u=cd(e,i,s),a=pp(il(s));return ye.vec3.transformMat4(u,u,a),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const s=M(i.lat,i.lng),u=ye.vec3.normalize([],s),a=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,h=Y(1,0)*wt*a;ye.vec3.scaleAndAdd(s,s,u,h);const g=ye.mat4.identity(new Float64Array(16));return ye.mat4.multiply(g,e.pixelMatrix,e.globeMatrix),ye.vec3.transformMat4(s,s,g),new he(s[0],s[1])}pixelsPerMeter(e,i){return Y(1,0)*i}pixelSpaceConversion(e,i,s){const u=Y(1,e)*i,a=hi(Y(1,45)*i,u,s);return this.pixelsPerMeter(e,i)/a}createTileMatrix(e,i,s){const u=vm(il(s.canonical));return ye.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:s}=e,u=pp(il(i));return ye.mat4.rotateY(u,u,pt(s.lng)),ye.mat4.rotateX(u,u,pt(s.lat)),ye.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,s,u){return Rc(e,i,s,!0)||new Ce(0,0)}pointCoordinate3D(e,i,s){const u=this.pointCoordinate(e,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!Rc(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,a){const h=u.cameraToCenterDistance,g=u._centerAltitude*a,w=u._camera,A=u._camera.forward(),p=ye.vec3.add([],ye.vec3.scale([],A,-h),[0,0,g]),b=u.worldSize/(2*Math.PI),E=[0,0,-b],x=u.width/u.height,T=Math.tan(u.fovAboveCenter),C=ye.vec3.scale([],w.up(),T),L=ye.vec3.scale([],w.right(),T*x),k=ye.vec3.normalize([],ye.vec3.add([],ye.vec3.add([],A,C),L)),V=[];let j;if(new dr(p,k).closestPointOnSphere(E,b,V)){const B=ye.vec3.add([],V,E),q=ye.vec3.sub([],B,p);j=Math.cos(u.fovAboveCenter)*ye.vec3.length(q)}else{const B=ye.vec3.sub([],p,E),q=ye.vec3.sub([],E,p);ye.vec3.normalize(q,q);const Z=ye.vec3.length(B)-b;j=Math.sqrt(Z*(Z+2*b));const Q=Math.acos(j/(b+Z))-Math.acos(ye.vec3.dot(A,q));j*=Math.cos(Q)}return 1.01*j}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Dc(e.zoom);if(s>0){const u=hy(e,Y(1,e.center.lat)*e.worldSize),a=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return hi(i,u+a*(1-Math.cos(h)),Math.pow(s,10))}return i}upVector(e,i,s){return cd(i,s,e,1)}upVectorScale(e){return{metersToTile:Pc(dp(il(e)))}}}function Fn(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new jt(r);case"equirectangular":return new qe(r);case"naturalEarth":return new Ii(r);case"equalEarth":return new Ne(r);case"winkelTripel":return new wn(r);case"albers":return i?new qi(r):new m(r);case"lambertConformalConic":return i?new qi(r):new Ot(r);case"globe":return new Dn(r)}throw new Error(`Invalid projection name: ${r.name}`)}const qs=Vh.VectorTileFeature.types,Jo=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bo(r,e,i,s,u,a,h,g,w,A,p,b,E){const x=g?Math.min(kc,Math.round(g[0])):0,T=g?Math.min(kc,Math.round(g[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*u),a,h,(x<<1)+(w?1:0),T,16*A,16*p,256*b,256*E)}function Mr(r,e,i){r.emplaceBack(e,i)}function ms(r,e,i,s,u,a,h){r.emplaceBack(e,i,s,u,a,h)}function ca(r,e,i,s,u){r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u)}function dy(r){for(const e of r.sections)if(Ea(e.text))return!0;return!1}class bx{constructor(e){this.layoutVertexArray=new xc,this.indexArray=new qn,this.programConfigurations=e,this.segments=new rr,this.dynamicLayoutVertexArray=new Os,this.opacityVertexArray=new Dh,this.placedSymbolArray=new Ou,this.iconTransitioningVertexArray=new el,this.globeExtVertexArray=new zl,this.zOffsetVertexArray=new lo}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,u,a){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,J0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ex.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jo,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Vg.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Q0.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||a)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ug.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Vt(bx,"SymbolBuffers");class wx{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new rr,this.collisionVertexArray=new Ma,this.collisionVertexArrayExt=new Os}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tx.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ix.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Vt(wx,"CollisionBuffers");class py{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ye.mat4.identity([]),this.placementViewportMatrix=ye.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qm(this.zoom,i["text-size"]),this.iconSizeData=qm(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),a=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=a!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(a==="viewport-y"||a==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(h=>Gs[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new bx(new sa(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new bx(new sa(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ap,this.lineVertexArray=new ku,this.symbolInstances=new nd}calculateGlyphDependencies(e,i,s,u,a){for(const h of e){const g=h.codePointAt(0);if(g===void 0)break;if(i[g]=!0,u&&a&&g<=65535){const w=$h[h];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!zm(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,i,s,u){const a=this.layers[0],h=a.layout,g=this.projection.name==="globe",w=h.get("text-font"),A=h.get("text-field"),p=h.get("icon-image"),b=(A.value.kind!=="constant"||A.value.value instanceof oo&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),E=p.value.kind!=="constant"||!!p.value.value||Object.keys(p.parameters).length>0,x=h.get("symbol-sort-key");if(this.features=[],!b&&!E)return;const T=i.iconDependencies,C=i.glyphDependencies,L=i.availableImages,k=new Kn(this.zoom);for(const{feature:V,id:j,index:B,sourceLayerIndex:q}of e){const Z=a._featureFilter.needGeometry,Q=rt(V,Z);if(!a._featureFilter.filter(k,Q,s))continue;if(Z||(Q.geometry=ke(V,s,u)),g&&V.type!==1&&s.z<=5){const Se=Q.geometry,se=.98078528056,be=(Me,Ie)=>{const Le=cd(Me.x,Me.y,s,1),Ue=cd(Ie.x,Ie.y,s,1);return ye.vec3.dot(Le,Ue)<se};for(let Me=0;Me<Se.length;Me++)Se[Me]=Ye(Se[Me],be)}let ce,oe;if(b){const Se=a.getValueAndResolveTokens("text-field",Q,s,L),se=oo.factory(Se);dy(se)&&(this.hasRTLText=!0),(!this.hasRTLText||Xf()==="unavailable"||this.hasRTLText&&Zo.isParsed())&&(ce=Gg(se,a,Q))}if(E){const Se=a.getValueAndResolveTokens("icon-image",Q,s,L);oe=Se instanceof Lr?Se:Lr.fromString(Se)}if(!ce&&!oe)continue;const ae=this.sortFeaturesByKey?x.evaluate(Q,{},s):void 0;if(this.features.push({id:j,text:ce,icon:oe,index:B,sourceLayerIndex:q,geometry:Q.geometry,properties:V.properties,type:qs[V.type],sortKey:ae}),oe&&(T[oe.namePrimary]=!0,oe.nameSecondary&&(T[oe.nameSecondary]=!0)),ce){const Se=w.evaluate(Q,{},s).join(","),se=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gs.vertical)>=0;for(const be of ce.sections)if(be.image)T[be.image.namePrimary]=!0;else{const Me=Wf(ce.toString()),Ie=be.fontStack||Se,Le=C[Ie]=C[Ie]||{};this.calculateGlyphDependencies(be.text,Le,se,this.allowVerticalPlacement,Me)}}}h.get("symbol-placement")==="line"&&(this.features=function(V){const j={},B={},q=[];let Z=0;function Q(Se){q.push(V[Se]),Z++}function ce(Se,se,be){const Me=B[Se];return delete B[Se],B[se]=Me,q[Me].geometry[0].pop(),q[Me].geometry[0]=q[Me].geometry[0].concat(be[0]),Me}function oe(Se,se,be){const Me=j[se];return delete j[se],j[Se]=Me,q[Me].geometry[0].shift(),q[Me].geometry[0]=be[0].concat(q[Me].geometry[0]),Me}function ae(Se,se,be){const Me=be?se[0][se[0].length-1]:se[0][0];return`${Se}:${Me.x}:${Me.y}`}for(let Se=0;Se<V.length;Se++){const se=V[Se],be=se.geometry,Me=se.text?se.text.toString():null;if(!Me){Q(Se);continue}const Ie=ae(Me,be),Le=ae(Me,be,!0);if(Ie in B&&Le in j&&B[Ie]!==j[Le]){const Ue=oe(Ie,Le,be),je=ce(Ie,Le,q[Ue].geometry);delete j[Ie],delete B[Le],B[ae(Me,q[je].geometry,!0)]=je,q[Ue].geometry=null}else Ie in B?ce(Ie,Le,be):Le in j?oe(Ie,Le,be):(Q(Se),j[Ie]=Z-1,B[Le]=Z-1)}return q.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,j)=>V.sortKey-j.sortKey)}update(e,i,s,u,a){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const g=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,g,s,u,a),this.icon.programConfigurations.updatePaintArrays(e,i,g,s,u,a)}updateZOffset(){const e=(a,h,g)=>{s+=h,s>a.length&&a.resize(s);for(let w=-h;w<0;w++)a.emplace(w+s,g)},i=(a,h,g)=>{u+=h,u>a.length&&a.resize(u);for(let w=-h;w<0;w++)a.emplace(w+u,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,u=0;for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:w,numIconVertices:A}=h,p=h.zOffset,b=A>0;if((g>0||w>0)&&(e(this.text.zOffsetVertexArray,g,p),e(this.text.zOffsetVertexArray,w,p)),b){const{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:x}=h;E>=0&&i(this.icon.zOffsetVertexArray,A,p),x>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,p)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Fn(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:a}of i)this.lineVertexArray.emplaceBack(u,a);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,a,h,g,w,A,p,b,E,x,T,C,L){const k=e.indexArray,V=e.layoutVertexArray,j=e.globeExtVertexArray,B=e.segments.prepareSegment(4*i.length,V,k,this.canOverlap?h.sortKey:void 0),q=this.glyphOffsetArray.length,Z=B.vertexLength,Q=this.allowVerticalPlacement&&g===Gs.vertical?Math.PI/2:0,ce=h.text&&h.text.sections;for(let ae=0;ae<i.length;ae++){const{tl:Se,tr:se,bl:be,br:Me,texPrimary:Ie,texSecondary:Le,pixelOffsetTL:Ue,pixelOffsetBR:je,minFontScaleX:Fe,minFontScaleY:tt,glyphOffset:dt,isSDF:Xe,sectionIndex:Bt}=i[ae],Et=B.vertexLength,yt=dt[1];if(Bo(V,A.x,A.y,Se.x,yt+Se.y,Ie.x,Ie.y,s,Xe,Ue.x,Ue.y,Fe,tt),Bo(V,A.x,A.y,se.x,yt+se.y,Ie.x+Ie.w,Ie.y,s,Xe,je.x,Ue.y,Fe,tt),Bo(V,A.x,A.y,be.x,yt+be.y,Ie.x,Ie.y+Ie.h,s,Xe,Ue.x,je.y,Fe,tt),Bo(V,A.x,A.y,Me.x,yt+Me.y,Ie.x+Ie.w,Ie.y+Ie.h,s,Xe,je.x,je.y,Fe,tt),w){const{x:ut,y:ni,z:Ft}=w.anchor,[qt,bi,Ci]=w.up;ms(j,ut,ni,Ft,qt,bi,Ci),ms(j,ut,ni,Ft,qt,bi,Ci),ms(j,ut,ni,Ft,qt,bi,Ci),ms(j,ut,ni,Ft,qt,bi,Ci),ca(e.dynamicLayoutVertexArray,ut,ni,Ft,Q)}else ca(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Q);if(L){const ut=Le||Ie;Mr(e.iconTransitioningVertexArray,ut.x,ut.y),Mr(e.iconTransitioningVertexArray,ut.x+ut.w,ut.y),Mr(e.iconTransitioningVertexArray,ut.x,ut.y+ut.h),Mr(e.iconTransitioningVertexArray,ut.x+ut.w,ut.y+ut.h)}k.emplaceBack(Et,Et+1,Et+2),k.emplaceBack(Et+1,Et+2,Et+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),ae!==i.length-1&&Bt===i[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,h,h.index,{},x,T,C,ce&&ce[Bt])}const oe=w?w.anchor:A;e.placedSymbolArray.emplaceBack(oe.x,oe.y,oe.z,A.x,A.y,q,this.glyphOffsetArray.length-q,Z,p,b,A.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],g,0,!1,0,E,0)}_commitLayoutVertex(e,i,s,u,a,h,g){e.emplaceBack(i,s,u,a,h,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,s,u,a,h,g){const w=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),A=w.vertexLength,p=g.tileAnchorX,b=g.tileAnchorY;for(let x=0;x<4;x++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(s.layoutVertexArray,u,a,h,p,b,new he(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,a,h,p,b,new he(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,a,h,p,b,new he(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,a,h,p,b,new he(e.x1,e.y2)),w.vertexLength+=4;const E=s.indexArray;E.emplaceBack(A,A+1),E.emplaceBack(A+1,A+2),E.emplaceBack(A+2,A+3),E.emplaceBack(A+3,A),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,a,h){for(let g=u;g<a;g++){const w=s.get(g),A=this.getSymbolInstanceTextSize(e,h,i,g);this._addCollisionDebugVertices(w,A,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,s,u,a,h){for(let g=u;g<a;g++){const w=s.get(g),A=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(w,A,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wx(Io,jg.members,el),this.iconCollisionBox=new wx(Io,jg.members,el);const u=qh(this.iconSizeData,e),a=qh(this.textSizeData,e,s);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(a,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(a,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,s,u){const a=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),h=Ip(this.textSizeData,e,a)/Ar;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),a=Ip(this.iconSizeData,e,u);return this.tilePixelRatio*a}_commitDebugCollisionVertexUpdate(e,i,s,u){e.emplaceBack(i,-s,-s,u),e.emplaceBack(i,s,-s,u),e.emplaceBack(i,s,s,u),e.emplaceBack(i,-s,s,u)}_updateTextDebugCollisionBoxes(e,i,s,u,a,h,g){for(let w=u;w<a;w++){const A=s.get(w),p=this.getSymbolInstanceTextSize(e,h,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,A.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,u,a,h,g){for(let w=u;w<a;w++){const A=s.get(w),p=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,A.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i,s,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=qh(this.iconSizeData,e,u),h=qh(this.textSizeData,e,s);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,s),this._updateTextDebugCollisionBoxes(h,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,s),this._updateIconDebugCollisionBoxes(a,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,u),this._updateIconDebugCollisionBoxes(a,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,a,h,g,w,A){const p={};if(i<s){const{x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B,featureIndex:q}=e.get(i);p.textBox={x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B},p.textFeatureIndex=q}if(u<a){const{x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B,featureIndex:q}=e.get(u);p.verticalTextBox={x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B},p.verticalTextFeatureIndex=q}if(h<g){const{x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B,featureIndex:q}=e.get(h);p.iconBox={x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B},p.iconFeatureIndex=q}if(w<A){const{x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B,featureIndex:q}=e.get(w);p.verticalIconBox={x1:b,y1:E,x2:x,y2:T,padding:C,projectedAnchorX:L,projectedAnchorY:k,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:B},p.verticalIconFeatureIndex=q}return p}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let a=s.vertexStartIndex;a<u;a+=4)e.indexArray.emplaceBack(a,a+1,a+2),e.indexArray.emplaceBack(a+1,a+2,a+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],a=[],h=[];for(let g=0;g<this.symbolInstances.length;++g){h.push(g);const w=this.symbolInstances.get(g);u.push(0|Math.round(i*w.tileAnchorX+s*w.tileAnchorY)),a.push(w.featureIndex)}return h.sort((g,w)=>u[g]-u[w]||a[w]-a[g]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:a,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:A}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),a>=0&&a!==u&&this.addIndicesForPlacedSymbol(this.text,a),h>=0&&h!==a&&h!==u&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let k1,F1,Tx;Vt(py,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),py.addDynamicAttributes=ca;class B1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ms,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt(B1,"FormatSectionOverride",{omit:["defaultValue"]});const Sx=()=>Tx||(Tx={layout:k1||(k1=new Bn({"symbol-placement":new ht(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ei(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ht(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ht(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ht(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ht(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new ei(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new ht(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ei(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ei(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new ei(Ve.layout_symbol["icon-image"]),"icon-rotate":new ei(Ve.layout_symbol["icon-rotate"]),"icon-padding":new ht(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new ei(Ve.layout_symbol["icon-offset"]),"icon-anchor":new ei(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new ei(Ve.layout_symbol["text-field"]),"text-font":new ei(Ve.layout_symbol["text-font"]),"text-size":new ei(Ve.layout_symbol["text-size"]),"text-size-scale-range":new ht(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new ei(Ve.layout_symbol["text-max-width"]),"text-line-height":new ei(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new ei(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new ei(Ve.layout_symbol["text-justify"]),"text-radial-offset":new ei(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new ei(Ve.layout_symbol["text-anchor"]),"text-max-angle":new ht(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new ei(Ve.layout_symbol["text-rotate"]),"text-padding":new ht(Ve.layout_symbol["text-padding"]),"text-keep-upright":new ht(Ve.layout_symbol["text-keep-upright"]),"text-transform":new ei(Ve.layout_symbol["text-transform"]),"text-offset":new ei(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new ht(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ht(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new ht(Ve.layout_symbol["text-optional"]),visibility:new ht(Ve.layout_symbol.visibility)})),paint:F1||(F1=new Bn({"icon-opacity":new ei(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ei(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ei(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ei(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new ei(Ve.paint_symbol["icon-color"]),"icon-halo-color":new ei(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new ei(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ei(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ei(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ei(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ei(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new ei(Ve.paint_symbol["text-color"],{runtimeType:Lo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ei(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new ei(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new ei(Ve.paint_symbol["text-halo-blur"]),"text-translate":new ht(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new ht(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ht(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ht(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ht(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ht(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ei(Ve.paint_symbol["symbol-z-offset"])}))},Tx);class my extends _o{constructor(e,i,s,u){super(e,Sx(),i,s,u),this._colorAdjustmentMatrix=ye.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const a of s)u.indexOf(a)<0&&u.push(a);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(a,h,g,w){a=ie(a),h=J(h);const A=ye.mat4.create(),p=a/3,b=1-2*p,E=[b,p,p,0,p,b,p,0,p,p,b,0,0,0,0,1],x=.5-.5*h,T=w-g;return ye.mat4.multiply(A,[T,0,0,0,0,T,0,0,0,0,T,0,g,g,g,1],[h,0,0,0,0,h,0,0,0,0,h,0,x,x,x,1]),ye.mat4.multiply(A,A,E),A}(e,i,s,u),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,u){const a=this.layout.get(e).evaluate(i,{},s,u),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||as(h.value)||!a?a:function(g,w){return w.replace(/{([^{}]+)}/g,(A,p)=>p in g?String(g[p]):"")}(i.properties,a)}createBucket(e){return new py(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Sx().paint.overridableProperties){if(!my.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new B1(i),u=new Gf(s,i.property.specification,this.scope,this.options);let a=null;a=i.value.kind==="constant"||i.value.kind==="source"?new vh("source",u):new yu("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new cs(i.property,a,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&my.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=Sx().paint.properties[i];let a=!1;const h=g=>{for(const w of g)if(u.overrides&&u.overrides.hasOverride(w))return void(a=!0)};if(s.value.kind==="constant"&&s.value.value instanceof oo)h(s.value.value.sections);else if(s.value.kind==="source"){const g=A=>{a||(A instanceof is&&On(A.value)===Hn?h(A.value.sections):A instanceof dl?h(A.sections):A.eachChild(g))},w=s.value;w._styleExpression&&g(w._styleExpression.expression)}return a}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new oa(this,{zoom:i,lut:s}),overrideFog:!1}}}let N1,U1,V1,j1;var Ex=on([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ax(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Mx(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ix{constructor(e,i,s,u){this.context=e,this.format=s,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:a}=this,{gl:h}=a,{x:g,y:w}=i&&i.position?i.position:{x:0,y:0},A=Math.max(g+s,this.size?this.size[0]:0),p=Math.max(w+u,this.size?this.size[1]:0);!this.size||this.size[0]===A&&this.size[1]===p||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!i||i.premultiply!==!1));const b=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&p>0){const E=this.useMipmap?Math.floor(Math.log2(Math.max(A,p)))+1:1;h.texStorage2D(h.TEXTURE_2D,E,this.format,A,p),this.size=[A,p]}if(this.size)if(b)h.texSubImage2D(h.TEXTURE_2D,0,g,w,Ax(this.format),Mx(this.format),e);else{const E=e.data;E&&h.texSubImage2D(h.TEXTURE_2D,0,g,w,s,u,Ax(this.format),Mx(this.format),E)}this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,i,s=!1){const{context:u}=this,{gl:a}=u;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,u){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),this.wrapS=s),u!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class _y{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}function gy(r,e,i,s,u,a,h,g){const w=[r,e,1,i,s,1,u,a,1],A=[h,g,1],p=ye.mat3.adjoint([],w),[b,E,x]=ye.vec3.transformMat3(A,A,p);return ye.mat3.multiply(w,w,[b,0,0,0,E,0,0,0,x])}function G1(r,e,i,s,u,a,h,g){const w=function(A,p,b,E,x,T,C,L){const k=gy(0,0,1,0,1,1,0,1),V=gy(A,p,b,E,x,T,C,L),j=ye.mat3.adjoint([],k);return ye.mat3.multiply(V,V,j)}(r,e,i,s,u,a,h,g);return[w[2]/w[8]/wt,w[5]/w[8]/wt]}function yy(r){return[r[0],Math.min(Math.max(r[1],-fe),fe)]}class q1 extends tc{constructor(e,i,s,u){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Xs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=jo(this.map._requestManager.transformRequest(this.url,nh.Image),(s,u)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Ys(s)):u&&(this.image=u instanceof HTMLImageElement?Lt.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new _y(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Xs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof _y||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const a of e)a[1]>s&&(s=a[1]),a[1]<i&&(i=a[1]);const u=(s+i)/2;if(u>fe?this.onNorthPole=!0:u<-fe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const a=e.map(Ce.fromLngLat);this.tileID=function(h){let g=1/0,w=1/0,A=-1/0,p=-1/0;for(const C of h)g=Math.min(g,C.x),w=Math.min(w,C.y),A=Math.max(A,C.x),p=Math.max(p,C.y);const b=Math.max(A-g,p-w),E=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),x=Math.pow(2,E);let T=Math.floor((g+A)/2*x);return T>1&&(T-=1),new kr(E,T,Math.floor((w+p)/2*x))}(a),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Xs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const k in this.tiles){const V=this.tiles[k];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Pd(new kr(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){const V=k[1].x-k[0].x,j=k[1].y-k[0].y,B=k[2].x-k[1].x,q=k[2].y-k[1].y,Z=k[3].x-k[2].x,Q=k[3].y-k[2].y,ce=k[0].x-k[3].x,oe=k[0].y-k[3].y,ae=V*q-B*j,Se=B*Q-Z*q,se=Z*oe-ce*Q,be=ce*j-V*oe;return ae>0&&Se>0&&se>0&&be>0||ae<0&&Se<0&&se<0&&be<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=Pd(this.tileID,this.map.transform.projection),[a,h,g,w]=this.coordinates.map(k=>{const V=u.projection.project(k[0],k[1]);return fy(u,V)._round()});this.perspectiveTransform=G1(a.x,a.y,h.x,h.y,g.x,g.y,w.x,w.y);const A=this._boundsArray=new gc;A.emplaceBack(a.x,a.y,0,0),A.emplaceBack(h.x,h.y,wt,0),A.emplaceBack(w.x,w.y,0,wt),A.emplaceBack(g.x,g.y,wt,wt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,Ex.members),this.boundsSegments=rr.simpleSegment(0,0,4,2);const p=[],b=[yy((E=this.coordinates)[0]),yy(E[1]),yy(E[2]),yy(E[3])];var E;const[x,T,C,L]=function(k){let V=k[0][0],j=V,B=k[0][1],q=B;for(let Z=1;Z<k.length;Z++)k[Z][0]<V?V=k[Z][0]:k[Z][0]>j&&(j=k[Z][0]),k[Z][1]<B?B=k[Z][1]:k[Z][1]>q&&(q=k[Z][1]);return[V,B,j-V,q-B]}(b);{const k=new gc,[V,j,B,q]=function(Ue){let je=Ue[0].x,Fe=je,tt=Ue[0].y,dt=tt;for(let Xe=1;Xe<Ue.length;Xe++)Ue[Xe].x<je?je=Ue[Xe].x:Ue[Xe].x>Fe&&(Fe=Ue[Xe].x),Ue[Xe].y<tt?tt=Ue[Xe].y:Ue[Xe].y>dt&&(dt=Ue[Xe].y);return[je,tt,Fe-je,dt-tt]}(s),Z=Ue=>[(Ue.x-V)/B,(Ue.y-j)/q],[Q,ce,oe,ae]=s.map(Z),Se=function(Ue,je,Fe,tt,dt,Xe,Bt,Et){const yt=gy(0,0,1,0,1,1,0,1),ut=gy(Ue,je,Fe,tt,dt,Xe,Bt,Et),ni=ye.mat3.adjoint([],ut);return ye.mat3.multiply(yt,yt,ni)}(Q[0],Q[1],ce[0],ce[1],oe[0],oe[1],ae[0],ae[1]);this.elevatedGlobePerspectiveTransform=G1(Q[0],Q[1],ce[0],ce[1],oe[0],oe[1],ae[0],ae[1]);const se=(Ue,je)=>{p.push(Ue.lng);const Fe=Math.round((Ue.lng-x)/C*wt),tt=Math.round((Ue.lat-T)/L*wt),dt=Z(je),Xe=ye.vec3.transformMat3([],[dt[0],dt[1],1],Se),Bt=Math.round(Xe[0]/Xe[2]*wt),Et=Math.round(Xe[1]/Xe[2]*wt);k.emplaceBack(Fe,tt,Bt,Et)},be=s[3].x-s[0].x,Me=s[3].y-s[0].y,Ie=s[2].x-s[1].x,Le=s[2].y-s[1].y;for(let Ue=0;Ue<65;Ue++){const je=Ue/64,Fe=[s[0].x+je*be,s[0].y+je*Me],tt=[s[1].x+je*Ie,s[1].y+je*Le],dt=tt[0]-Fe[0],Xe=tt[1]-Fe[1];for(let Bt=0;Bt<65;Bt++){const Et=Bt/64,yt={x:Fe[0]+dt*Et,y:Fe[1]+Xe*Et,z:0};se(i.projection.unproject(yt.x,yt.y),yt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,Ex.members)}{this.maxLongitudeTriangleSize=0;let k=[],V=new qn;const j=(B,q,Z)=>{V.emplaceBack(B,q,Z);const Q=p[B],ce=p[q],oe=p[Z],ae=Math.min(Math.min(Q,ce),oe),Se=Math.max(Math.max(Q,ce),oe)-ae;Se>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Se),k.push(ae+Se/2)};for(let B=0;B<64;B++)for(let q=0;q<64;q++){const Z=65*B+q,Q=Z+1,ce=Z+65,oe=ce+1;j(Z,ce,Q),j(Q,ce,oe)}[k,V]=function(B,q){const Z=Array.from({length:B.length},(oe,ae)=>ae);Z.sort((oe,ae)=>B[oe]-B[ae]);const Q=[],ce=new qn;for(let oe=0;oe<Z.length;oe++){const ae=Z[oe];Q.push(B[ae]);const Se=3*ae,se=Se+1;ce.emplaceBack(q.uint16[Se],q.uint16[se],q.uint16[se+1])}return[Q,ce]}(k,V),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(V)}this.elevatedGlobeSegments=rr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,C/wt,0,L/wt,0,0,T,x,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof _y||(this.texture?this.texture.update(this.image):(this.texture=new Ix(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let u=(a=e+180)+360*Math.round((s[0]-a)/360);var a;const h=new rr,g=(b,E)=>{h.segments.push({vertexOffset:0,primitiveOffset:b,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-u)<=w){const b=Ze(s,0,s.length,u+w);return b===s.length||g(b,Yc(s,b+1,s.length,u+360-w)-b),h}u<s[0]&&(u+=360);const A=Yc(s,0,s.length,u-w);if(A===s.length)return g(0,s.length),h;g(0,A-0);const p=Ze(s,A+1,s.length,u+w);return p!==s.length&&g(p,s.length-p),h}}const LS=(Math.pow(256,2)-1)/16907520;class $1 extends _o{constructor(e,i,s,u){super(e,{layout:V1||(V1=new Bn({visibility:new ht(Ve.layout_raster.visibility)})),paint:j1||(j1=new Bn({"raster-opacity":new ht(Ve.paint_raster["raster-opacity"]),"raster-color":new _c(Ve.paint_raster["raster-color"]),"raster-color-mix":new ht(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new ht(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new ht(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(Ve.paint_raster["raster-saturation"]),"raster-contrast":new ht(Ve.paint_raster["raster-contrast"]),"raster-resampling":new ht(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ht(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new ht(Ve.paint_raster["raster-array-band"]),"raster-elevation":new ht(Ve.paint_raster["raster-elevation"])}))},i,s,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof q1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(u)||s===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=hd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,u])}}let H1,W1,Z1,X1,Y1;class K1 extends _o{constructor(e,i,s,u){super(e,{layout:H1||(H1=new Bn({visibility:new ht(Ve["layout_raster-particle"].visibility)})),paint:W1||(W1=new Bn({"raster-particle-array-band":new ht(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ht(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _c(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ht(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ht(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ht(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ht(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ht(Ve["paint_raster-particle"]["raster-particle-elevation"])}))},i,s,u),this._updateColorRamp(),this.lastInvalidatedAt=Lt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=hd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Lt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class zS extends _o{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Cx(r,e,i){const s=[0,0,1],u=ye.quat.identity([]);return ye.quat.rotateY(u,u,i?-pt(r)+Math.PI:pt(r)),ye.quat.rotateX(u,u,-pt(e)),ye.vec3.transformQuat(s,s,u),ye.vec3.normalize(s,s)}function J1(r,e){const i=xy(r.projection,r.zoom,r.width,r.height),s=function(a,h,g,w,A){const p=new R(g.lng-180*Kh,g.lat),b=new R(g.lng+180*Kh,g.lat),E=a.project(p.lng,p.lat),x=a.project(b.lng,b.lat),T=-Math.atan2(x.y-E.y,x.x-E.x),C=Ce.fromLngLat(g);C.y=vt(C.y,-1+Kh,1-Kh);const L=C.toLngLat(),k=a.project(L.lng,L.lat),V=Ce.fromLngLat(L);V.x+=Kh;const j=V.toLngLat(),B=a.project(j.lng,j.lat),q=eb(B.x-k.x,B.y-k.y,T),Z=Ce.fromLngLat(L);Z.y+=Kh;const Q=Z.toLngLat(),ce=a.project(Q.lng,Q.lat),oe=eb(ce.x-k.x,ce.y-k.y,T),ae=Math.abs(q.x)/Math.abs(oe.y),Se=ye.mat4.identity([]);ye.mat4.rotateZ(Se,Se,-T*(1-(A?0:w)));const se=ye.mat4.identity([]);return ye.mat4.scale(se,se,[1,1-(1-ae)*w,1]),se[4]=-oe.x/oe.y*w,ye.mat4.rotateZ(se,se,T),ye.mat4.multiply(se,Se,se),se}(r.projection,0,r.center,i,e),u=Q1(r);return ye.mat4.scale(s,s,[u,u,1]),s}function Q1(r){const e=r.projection,i=xy(r.projection,r.zoom,r.width,r.height),s=Px(e,r.center),u=Px(e,R.convert(e.center));return Math.pow(2,s*i+(1-i)*u)}function xy(r,e,i,s,u=1/0){const a=r.range;if(!a)return 0;const h=Math.min(u,Math.max(i,s)),g=Math.log(h/1024)/Math.LN2;return xi(a[0]+g,a[1]+g,e)}const Kh=1/4e4;function Px(r,e){const i=vt(e.lat,-fe,fe),s=new R(e.lng-180*Kh,i),u=new R(e.lng+180*Kh,i),a=r.project(s.lng,i),h=r.project(u.lng,i),g=Ce.fromLngLat(s),w=Ce.fromLngLat(u),A=h.x-a.x,p=h.y-a.y,b=w.x-g.x,E=w.y-g.y,x=Math.sqrt((b*b+E*E)/(A*A+p*p));return Math.log(x)/Math.LN2}function eb(r,e,i){const s=Math.cos(i),u=Math.sin(i);return{x:r*s-e*u,y:r*u+e*s}}function tb(r,e,i){ye.mat4.identity(r),ye.mat4.rotateZ(r,r,pt(e[2])),ye.mat4.rotateX(r,r,pt(e[0])),ye.mat4.rotateY(r,r,pt(e[1])),ye.mat4.scale(r,r,i),ye.mat4.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vy(r,e,i,s,u,a,h,g){const w=[i[0]-e[0],i[1]-e[1],0],A=[s[0]-e[0],s[1]-e[1],0];if(ye.vec3.length(w)<1e-12||ye.vec3.length(A)<1e-12)return ye.quat.identity(r);const p=ye.vec3.cross([],w,A);ye.vec3.normalize(p,p),ye.vec3.subtract(A,s,e),w[2]=(a-u)*g,A[2]=(h-u)*g;const b=w;return ye.vec3.cross(b,w,A),ye.vec3.normalize(b,b),ye.quat.rotationTo(r,p,b)}function Rx(r,e,i=!1){const s=Dc(e.zoom),u=function(a,h,g){const w=h.worldSize,A=[a[12],a[13],a[14]],p=re(A[1]/w),b=te(A[0]/w),E=ye.mat4.identity([]),x=Y(1,p)*w,T=Y(1,0)*w*de(p,h.zoom),C=1/bm(w);let L=T*C;if(g){const B=xy(h.projection,h.zoom,h.width,h.height,1024);L=C*h.projection.pixelSpaceConversion(h.center.lat,w,B)}const k=M(p,b);ye.vec3.add(k,k,ye.vec3.scale([],ye.vec3.normalize([],k),x*L*A[2]));const V=function(B){const q=[B[0],B[1],B[2]];let Z=[0,1,0];const Q=ye.vec3.cross([],Z,q);return ye.vec3.cross(Z,q,Q),ye.vec3.squaredLength(Z)===0&&(Z=[0,1,0],ye.vec3.cross(Q,q,Z)),ye.vec3.normalize(Q,Q),ye.vec3.normalize(Z,Z),ye.vec3.normalize(q,q),[Q[0],Q[1],Q[2],0,Z[0],Z[1],Z[2],0,q[0],q[1],q[2],0,B[0],B[1],B[2],1]}(k);ye.mat4.scale(E,E,[L,L,L*x]),ye.mat4.translate(E,E,[-A[0],-A[1],-A[2]]);const j=ye.mat4.multiply([],h.globeMatrix,V);return ye.mat4.multiply(j,j,E),ye.mat4.multiply(j,j,a),j}(r,e,i);if(s>0){const a=function(h,g){const w=g.worldSize,A=Y(1,0)*w*de(g.center.lat,g.zoom)/bm(w),p=Y(1,g.center.lat)*w,b=ye.mat4.identity([]);return ye.mat4.rotateY(b,b,pt(g.center.lng)),ye.mat4.rotateX(b,b,pt(g.center.lat)),ye.mat4.translate(b,b,[0,0,to]),ye.mat4.scale(b,b,[A,A,A*p]),ye.mat4.translate(b,b,[g.point.x-.5*w,g.point.y-.5*w,0]),ye.mat4.multiply(b,b,h),ye.mat4.multiply(b,g.globeMatrix,b)}(r,e);return function(h,g,w){const A=(T,C,L)=>{const k=ye.vec3.length(T),V=ye.vec3.length(C),j=Vl(T,C,L);return ye.vec3.scale(j,j,1/ye.vec3.length(j)*hi(k,V,L))},p=A([h[0],h[1],h[2]],[g[0],g[1],g[2]],w),b=A([h[4],h[5],h[6]],[g[4],g[5],g[6]],w),E=A([h[8],h[9],h[10]],[g[8],g[9],g[10]],w),x=Vl([h[12],h[13],h[14]],[g[12],g[13],g[14]],w);return[p[0],p[1],p[2],0,b[0],b[1],b[2],0,E[0],E[1],E[2],0,x[0],x[1],x[2],1]}(u,a,s)}return u}function ib(r,e,i,s){const u=gn.projectAabbCorners(s,i);let a=Number.MAX_VALUE,h=-1;for(let A=0;A<u.length;++A){const p=u[A];p[0]=(.5*p[0]+.5)*e.width,p[1]=(.5-.5*p[1])*e.height,p[2]<a&&(h=A,a=p[2])}const g=A=>new he(u[A][0],u[A][1]);let w;switch(h){case 0:case 6:w=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:w=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:w=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:w=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(ot(r,w))return a}const OS=on([{name:"a_pos_3f",components:3,type:"Float32"}]),kS=on([{name:"a_color_3f",components:3,type:"Float32"}]),FS=on([{name:"a_color_4f",components:4,type:"Float32"}]),BS=on([{name:"a_uv_2f",components:2,type:"Float32"}]),NS=on([{name:"a_normal_3f",components:3,type:"Float32"}]),US=on([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),VS=on([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),nb={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class by{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function rb(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class ob{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sb{constructor(){this.instancedDataArray=new kl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Dx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,s,u){this.tileToMeter=Te(s);const a=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:g,index:w,sourceLayerIndex:A}of e){const p=g??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),b=rt(h,a);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),b,s))continue;const E={id:p,sourceLayerIndex:A,index:w,geometry:a?b.geometry:ke(h,s,u),properties:h.properties,type:h.type,patterns:{}},x=this.addFeature(E,E.geometry,b);x&&i.featureIndex.insert(h,E.geometry,w,A,this.index,this.instancesPerModel[x].instancedDataArray.length,wt/32)}this.lookup=null}update(e,i,s,u){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const g in e)h.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(h.features[h.idToFeaturesIndex[g]],e[g],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const u of s.features){const a=this.layers[0],h=u.feature,g=this.canonical,w=a.paint.get("model-rotation").evaluate(h,{},g),A=a.paint.get("model-scale").evaluate(h,{},g),p=a.paint.get("model-translation").evaluate(h,{},g);ye.vec3.exactEquals(u.rotation,w)&&ye.vec3.exactEquals(u.scale,A)&&ye.vec3.exactEquals(u.translation,p)||(this.evaluate(u,u.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(zm(this.activeReplacements,a))return!1;this.activeReplacements=a;let h=!1;for(const g in this.instancesPerModel){const w=this.instancesPerModel[g],A=w.instancedDataArray;for(const p of w.features){const b=p.instancedDataOffset,E=p.instancedDataCount;for(let x=0;x<E;x++){const T=16*(x+b);let C=A.float32[T+0];const L=C>wt;C=L?C-wt:C;const k=Math.floor(C),V=A.float32[T+1];let j=!1;for(const B of this.activeReplacements)if(!jl(B,s,nb.Model,u)&&!(B.min.x>k||k>B.max.x||B.min.y>V||V>B.max.y)&&(j=yd(km(k,V,e.canonical,B.footprintTileId.canonical),B.footprint),j))break;A.float32[T]=j?C+wt:C,h=h||j!==L}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,US.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,s){const u=this.layers[0],a=u.layout.get("model-id").evaluate(s,{},this.canonical);if(!a)return ji(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),a;rb(a,!1)&&(this.modelUris.includes(a)||this.modelUris.push(a)),this.instancesPerModel[a]||(this.instancesPerModel[a]=new sb);const h=this.instancesPerModel[a],g=h.instancedDataArray,w=new ob(s,g.length);for(const A of i)for(const p of A){if(p.x<0||p.x>=wt||p.y<0||p.y>=wt)continue;const b=(this.lookupDim-1)/wt,E=this.lookupDim*(p.y*b|0)+p.x*b|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;const x=g.length;g.resize(x+1),h.instancesEvaluatedElevation.push(0),g.float32[16*x]=p.x,g.float32[16*x+1]=p.y}return w.instancedDataCount=h.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(w),this.evaluate(w,{},h,!1)),a}getModelUris(){return this.modelUris}evaluate(e,i,s,u){const a=this.layers[0],h=e.feature,g=this.canonical,w=e.rotation=a.paint.get("model-rotation").evaluate(h,i,g),A=e.scale=a.paint.get("model-scale").evaluate(h,i,g),p=e.translation=a.paint.get("model-translation").evaluate(h,i,g),b=a.paint.get("model-color").evaluate(h,i,g);b.a=a.paint.get("model-color-mix-intensity").evaluate(h,i,g);const E=[];this.maxVerticalOffset<p[2]&&(this.maxVerticalOffset=p[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),tb(E,w,A);const x=Math.round(100*b.a)+b.b/1.05;for(let T=0;T<e.instancedDataCount;++T){const C=e.instancedDataOffset+T,L=16*C,k=s.instancedDataArray.float32;let V=0;u&&(V=k[L+6]-s.instancesEvaluatedElevation[C]);const j=0|k[L+1];k[L]=(0|k[L])+b.r/1.05,k[L+1]=j+b.g/1.05,k[L+2]=x,k[L+3]=1/(g.z>10?this.tileToMeter:Te(g,j)),k[L+4]=p[0],k[L+5]=p[1],k[L+6]=p[2]+V,k[L+7]=E[0],k[L+8]=E[1],k[L+9]=E[2],k[L+10]=E[4],k[L+11]=E[5],k[L+12]=E[6],k[L+13]=E[8],k[L+14]=E[9],k[L+15]=E[10],s.instancesEvaluatedElevation[C]=p[2]}}}let ab,lb;Vt(Dx,"ModelBucket",{omit:["layers"]}),Vt(sb,"PerModelAttributes"),Vt(ob,"ModelFeature");const Rd=64,Fp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function cb(r,e,i,s,u,a,h,g,w,A=!1){const p=i.zoom,b=i.project(s),E=de(s.lat,p),x=1/E;ye.mat4.identity(r),ye.mat4.translate(r,r,[b.x+h[0]*x,b.y+h[1]*x,h[2]]);let T=1,C=1;const L=i.worldSize;if(A){if(i.projection.name==="mercator"){let B=0;i.elevation&&(B=i.elevation.getAtPointOrZero(new Ce(b.x/L,b.y/L),0));const q=ye.vec4.transformMat4([],[b.x,b.y,B,1],i.projMatrix)[3]/i.cameraToCenterDistance;T=q,C=q*de(i.center.lat,p)}else if(i.projection.name==="globe"){const B=Rx(r,i),q=ye.mat4.multiply([],i.projMatrix,B),Z=[0,0,0,1];ye.vec4.transformMat4(Z,Z,q);const Q=Z[3]/i.cameraToCenterDistance,ce=Dc(p),oe=i.projection.pixelsPerMeter(s.lat,L)*de(s.lat,p),ae=i.projection.pixelsPerMeter(i.center.lat,L)*de(i.center.lat,p);T=Q/hi(oe,me(i.center.lat),ce),C=Q*E/oe,T*=ae,C*=ae}}else T=x;ye.mat4.scale(r,r,[T,T,C]);const k=[...r],V=e.orientation,j=[];if(tb(j,[V[0]+u[0],V[1]+u[1],V[2]+u[2]],a),ye.mat4.multiply(r,k,j),g&&i.elevation){let B=0;const q=[];if(w&&i.elevation){B=function(ce,oe,ae,Se,se){const be=oe.elevation;if(!be)return 0;const Me=gn.projectAabbCorners(ae,Se),Ie=Y(1,se.lat)*oe.worldSize,Le=function(ni,Ft){const qt=[0,0,1],bi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ci of bi){const Pi=ni[Ci.corners[0]],Ai=ni[Ci.corners[1]],Ni=ni[Ci.corners[2]],Bi=[Ai[0]-Pi[0],Ai[1]-Pi[1],Ft*(Ai[2]-Pi[2])],Vn=ye.vec3.cross(Bi,Bi,[Ni[0]-Pi[0],Ni[1]-Pi[1],Ft*(Ni[2]-Pi[2])]);ye.vec3.normalize(Vn,Vn),Ci.dotProductWithUp=ye.vec3.dot(Vn,qt)}return bi.sort((Ci,Pi)=>Ci.dotProductWithUp-Pi.dotProductWithUp),bi[0].corners}(Me,Ie),Ue=Me[Le[0]],je=Me[Le[1]],Fe=Me[Le[2]],tt=Me[Le[3]],dt=be.getAtPointOrZero(new Ce(Ue[0]/oe.worldSize,Ue[1]/oe.worldSize),0),Xe=be.getAtPointOrZero(new Ce(je[0]/oe.worldSize,je[1]/oe.worldSize),0),Bt=be.getAtPointOrZero(new Ce(Fe[0]/oe.worldSize,Fe[1]/oe.worldSize),0),Et=be.getAtPointOrZero(new Ce(tt[0]/oe.worldSize,tt[1]/oe.worldSize),0),yt=(dt+Et)/2,ut=(Xe+Bt)/2;return yt>ut?Xe<Bt?vy(ce,je,tt,Ue,Xe,Et,dt,Ie):vy(ce,Fe,Ue,tt,Bt,dt,Et,Ie):dt<Et?vy(ce,Ue,je,Fe,dt,Xe,Bt,Ie):vy(ce,tt,Fe,je,Et,Bt,Xe,Ie),Math.max(yt,ut)}(q,i,e.aabb,r,s);const Z=ye.mat4.fromQuat([],q),Q=ye.mat4.multiply([],Z,j);ye.mat4.multiply(r,k,Q)}else B=i.elevation.getAtPointOrZero(new Ce(b.x/L,b.y/L),0);B!==0&&(r[14]+=B)}}function t_(r,e,i=!1){r.uploaded||(r.gfxTexture=new Ix(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function jS(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,OS.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,NS.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,BS.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?kS:FS).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,VS.members,!0)),r.segments=rr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const s=r.material;s.pbrMetallicRoughness.baseColorTexture&&t_(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&t_(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&t_(s.normalTexture,e),s.occlusionTexture&&t_(s.occlusionTexture,e,i),s.emissionTexture&&t_(s.emissionTexture,e)}function Lx(r,e,i){if(r.meshes)for(const s of r.meshes)jS(s,e,i);if(r.children)for(const s of r.children)Lx(s,e,i)}function wy(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)wy(e)}function zx(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)zx(i)}class Bp{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const a=u.dem,h=u.tileID,g=1<<i.canonical.z-h.canonical.z;return new Bp(u,a.dim/wt/g,[(i.canonical.x/g-h.canonical.x)*a.dim,(i.canonical.y/g-h.canonical.y)*a.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),a=Math.floor(s);return new he(u,a)}getElevationAt(e,i,s,u){const a=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],g=Math.floor(a),w=Math.floor(h),A=this._dem;return u=!!u,s?hi(hi(A.get(g,w,u),A.get(g,w+1,u),h-w),hi(A.get(g+1,w,u),A.get(g+1,w+1,u),h-w),a-g):A.get(g,w,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Y(1,e)*this._dem.stride}}const Ox=new Float32Array(262144),Dd=new Uint8Array(262144);function ub(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,ub(i));return e}function hb(r,e,i){if(r.meshes)for(const s of r.meshes){if(s.aabb.min[0]===1/0)continue;const u=gn.applyTransform(s.aabb,r.matrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(r.children)for(const s of r.children)hb(s,e,i)}const fb=["","wall","door","roof","window","lamp","logo"];class db{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:ub(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=gn.applyTransformFast(s.aabb,this.node.matrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Ty{constructor(e,i,s,u,a,h,g){this.id=s,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=Fp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Fp.HasMapboxMeshFeatures),a&&(this.modelTraits|=Fp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const w of i)this.nodesInfo.push(new db(w)),hb(w,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(const s of this.getNodesInfo()){const u=s.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;for(const u of s)this.evaluate(u,e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const u=s.node;this.uploaded?this.updatePbrBuffer(u):Lx(u,e,!0)}for(const s of i)wy(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const u=e.transform.projectionOptions,a=e.style.getBrightness(),h=this.brightness!==a;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||i_(s.paint.get("model-color").value,h)||i_(s.paint.get("model-color-mix-intensity").value,h)||i_(s.paint.get("model-roughness").value,h)||i_(s.paint.get("model-emissive-strength").value,h)||i_(s.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=u,this.brightness=a,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),u=this.id.canonical;for(const a of s){const h=a.feature;a.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},u)}}evaluate(e,i){const s=this.getNodesInfo();for(const u of s){if(!u.node.meshes)continue;const a=u.feature,h=i&&i[a.id],g=u.node.meshes&&u.node.meshes[0].featureData,w=u.evaluatedColor[2],A=u.evaluatedRMEA[2],p=this.id.canonical;if(u.hasTranslucentParts=!1,g){for(let b=0;b<fb.length;b++){const E=fb[b];E.length&&(a.properties.part=E);const x=e.paint.get("model-color").evaluate(a,h,p).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(a,h,p);u.evaluatedColor[b]=[x.r,x.g,x.b,T],u.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(a,h,p),u.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(a,h,p),u.evaluatedRMEA[b][3]=x.a,u.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,h,p),!u.hasTranslucentParts&&x.a<1&&(u.hasTranslucentParts=!0)}delete a.properties.part,qS(u,w!==u.evaluatedColor[2]||A!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,h,p);u.evaluatedScale=e.paint.get("model-scale").evaluate(a,h,p),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,u){const a=e.findDEMTileFor(s);if(a&&(a.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(a.dem&&a.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=a.tileID.overscaledZ;const h=Bp.create(e,s,a);if(!h)return;this.modelTraits&Fp.HasMapboxMeshFeatures&&this.updateDEM(e,h,s,u);for(const g of this.getNodesInfo()){const w=g.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const A=w.footprint.vertices;let p=h.getElevationAt(A[0].x,A[0].y,!0,!0);for(let b=1;b<A.length;b++)p=Math.min(p,h.getElevationAt(A[b].x,A[b].y,!0,!0));w.elevation=p}}this.terrainTile=a.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,u){let a=i._dem._modifiedForSources[u];if(a===void 0&&(i._dem._modifiedForSources[u]=[],a=i._dem._modifiedForSources[u]),a.includes(s.canonical))return;const h=i._dem.dim;a.push(s.canonical);let g=!1;for(const w of this.getNodesInfo()){const A=w.node;if(!A.footprint||!A.footprint.grid)continue;const p=A.footprint.grid,b=i.tileCoordToPixel(p.min.x,p.min.y),E=i.tileCoordToPixel(p.max.x,p.max.y),x=Math.min(Math.min(h-E.y,b.x),Math.min(b.y,h-E.x));if(x<0)continue;const T=vt(x,2,5);let C=Math.max(0,b.x-T),L=Math.max(0,b.y-T),k=Math.min(E.x+T,h-1),V=Math.min(E.y+T,h-1);for(let Z=L;Z<=V;++Z)for(let Q=C;Q<=k;++Q)Dd[Z*h+Q]=255;let j=0,B=0;for(let Z=0;Z<p.cellsY;++Z)for(let Q=0;Q<p.cellsX;++Q){if(!p.cells[Z*p.cellsX+Q])continue;const ce=i.tileCoordToPixel(p.min.x+Q/p.xScale,p.min.y+Z/p.yScale),oe=i.tileCoordToPixel(p.min.x+(Q+1)/p.xScale,p.min.y+(Z+1)/p.yScale);for(let ae=ce.y;ae<=Math.min(oe.y+1,h-1);++ae)for(let Se=ce.x;Se<=Math.min(oe.x+1,h-1);++Se)Dd[ae*h+Se]===255&&(Dd[ae*h+Se]=0,j+=i.getElevationAtPixel(Se,ae),B++)}const q=j/B;C=Math.max(1,b.x-T),L=Math.max(1,b.y-T),k=Math.min(E.x+T,h-2),V=Math.min(E.y+T,h-2),g=!0;for(let Z=L;Z<=V;++Z)for(let Q=C;Q<=k;++Q)Dd[Z*h+Q]===0&&(Ox[Z*h+Q]=i._dem.set(Q,Z,q));for(let Z=1;Z<T;++Z){C=Math.max(1,b.x-Z),L=Math.max(1,b.y-Z),k=Math.min(E.x+Z,h-2),V=Math.min(E.y+Z,h-2);for(let Q=L;Q<=V;++Q)for(let ce=C;ce<=k;++ce){const oe=Q*h+ce;if(Dd[oe]===255){let ae=0,Se=0,se=-1,be=-1;for(let Me=-1;Me<=1;++Me)for(let Ie=-1;Ie<=1;++Ie){const Le=(Q+Me)*h+ce+Ie;if(Dd[Le]>=Z)continue;const Ue=Ox[Le],je=Math.abs(Ue);je>Se&&(ae=Ue,Se=je,se=Ie,be=Me)}if(Se>.1){const Me=1-(Z+.5*Math.abs(se*be))/T;let Ie=i._dem.get(ce,Q)+ae*Me;const Le=i._dem.get(ce+se,Q+be),Ue=i._dem.get(ce-se,Q-be,!0);(Ie-Le)*(Ie-Ue)>0&&(Ie=(Le+Ue)/2),Ox[oe]=i._dem.set(ce,Q,Ie),Dd[oe]=Z}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Lt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)wy(i.node),zx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let a=0;a<this.nodesInfo.length;a++){const h=u[a].node;u[a].hiddenByReplacement=!!h.footprint&&!s.find(g=>g.footprint===h.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),u=[],a=[0,0,0],h=ye.mat4.identity([]);for(let g=0;g<this.nodesInfo.length;g++){const w=s[g],A=w.node.meshes[0],p=A.transformedAabb;if(e<p.min[0]||i<p.min[1]||e>p.max[0]||i>p.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};ye.mat4.invert(h,w.node.matrix),a[0]=e,a[1]=i,ye.vec3.transformMat4(a,a,h);const b=(a[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*Rd|0,E=Math.min(63,(a[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*Rd|0)*Rd+Math.min(63,b),x=A.heightmap[E];if(!(x<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:x,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new he(e,i),new he(e,i),u),u.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function i_(r,e){return!r.isLightConstant&&e}function GS(r,e,i,s,u,a,h,g){let w=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,p=240&e|(240&e)>>4;i[3]>0&&(w=hi(w,255*i[0],i[3]),A=hi(A,255*i[1],i[3]),p=hi(p,255*i[2],i[3]));const b=w<<8|A,E=p<<8|Math.floor(255*s[3]),x=function(Z){const Q=vt(Z,0,2);return Math.min(Math.round(.5*Q*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],T=vt(u[0],0,1),C=vt(u[1],0,1),L=vt(u[2],0,1),k=vt(u[3],0,1);let V,j,B,q;if(T!==C&&h!==a&&C!==T){const Z=h-a;j=1/(Z*(C-T)),B=-(a+Z*T)/(Z*(C-T));const Q=vt(u[4],-1,1);q=Math.pow(10,Q),V=255*L<<8|255*k}else V=65535,j=0,B=1,q=1;if(r.emplaceBack(b,E,x,V,j,B,q),g){const Z=g.length;g.clear();for(let Q=0;Q<Z;Q++)g.emplaceBack(b,E,x,V,j,B,q)}}function qS(r,e,i){const s=r.node;let u=0;const a=i&Fp.HasMeshoptCompression;for(const h of s.meshes){if(s.lights&&s.lightMeshIndex===u||!h.featureData)continue;h.featureArray=new Tc,h.featureArray.reserve(h.featureData.length);let g=e;for(const w of h.featureData){const A=a?65535&w:w>>16&65535,p=a?w>>16&65535:65535&w,b=(15&p)<8?15&p:0,E=r.evaluatedRMEA[b],x=r.evaluatedColor[b],T=r.emissionHeightBasedParams[b];let C;if(g&&b===2&&s.lights&&(C=new Tc,C.resize(10*s.lights.length)),GS(h.featureArray,A,x,E,T,h.aabb.min[2],h.aabb.max[2],C),C&&g){g=!1;const L=s.meshes[s.lightMeshIndex];L.featureArray=C,L.featureArray._trim()}}h.featureArray._trim(),u++}}Vt(Ty,"Tiled3dModelBucket",{omit:["layers"]}),Vt(db,"Tiled3dModelFeature");const $S=["id","tile","layer","source","sourceLayer","state"];class n_{constructor(e,i,s,u,a){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e.properties,this.id=a}clone(){const e=new n_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state={...this.state}),this.layer&&(e.layer={...this.layer}),this.namespace&&(e.namespace=this.namespace),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of $S)this[i]!==void 0&&(e[i]=this[i]);return e}}function pb(r,e,i,s){const u=1<<r.z;e.lat=re((s/wt+r.y)/u),e.lng=te((i/wt+r.x)/u)}const HS={circle:class extends _o{constructor(r,e,i,s){super(r,{layout:hn||(hn=new Bn({"circle-sort-key":new ei(Ve.layout_circle["circle-sort-key"]),visibility:new ht(Ve.layout_circle.visibility)})),paint:Un||(Un=new Bn({"circle-radius":new ei(Ve.paint_circle["circle-radius"]),"circle-color":new ei(Ve.paint_circle["circle-color"]),"circle-blur":new ei(Ve.paint_circle["circle-blur"]),"circle-opacity":new ei(Ve.paint_circle["circle-opacity"]),"circle-translate":new ht(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ei(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ei(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ei(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ht(Ve.paint_circle["circle-emissive-strength"])}))},e,i,s)}createBucket(r){return new lt(r)}queryRadius(r){const e=r;return In("circle-radius",this,e)+In("circle-stroke-width",this,e)+Fi(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,u,a,h,g){const w=bn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return J_(r,s,a,h,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const s=K_(this);return{config:new oa(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}},heatmap:class extends _o{createBucket(r){return new Tm(r)}constructor(r,e,i,s){super(r,{layout:eg||(eg=new Bn({visibility:new ht(Ve.layout_heatmap.visibility)})),paint:ud||(ud=new Bn({"heatmap-radius":new ei(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ei(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _c(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(Ve.paint_heatmap["heatmap-opacity"])}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return In("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,u,a,h,g){const w=this.paint.get("heatmap-radius").evaluate(e,i);return J_(r,s,a,h,g,!0,!0,new he(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new oa(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends _o{constructor(r,e,i,s){super(r,{layout:tg||(tg=new Bn({visibility:new ht(Ve.layout_hillshade.visibility)})),paint:ig||(ig=new Bn({"hillshade-illumination-direction":new ht(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ht(Ve.paint_hillshade["hillshade-emissive-strength"])}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends _o{constructor(r,e,i,s){super(r,{layout:Am||(Am=new Bn({"fill-sort-key":new ei(Ve.layout_fill["fill-sort-key"]),visibility:new ht(Ve.layout_fill.visibility),"fill-elevation-reference":new ht(Ve.layout_fill["fill-elevation-reference"])})),paint:Mm||(Mm=new Bn({"fill-antialias":new ht(Ve.paint_fill["fill-antialias"]),"fill-opacity":new ei(Ve.paint_fill["fill-opacity"]),"fill-color":new ei(Ve.paint_fill["fill-color"]),"fill-outline-color":new ei(Ve.paint_fill["fill-outline-color"]),"fill-translate":new ht(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new ei(Ve.paint_fill["fill-pattern"]),"fill-emissive-strength":new ht(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ei(Ve.paint_fill["fill-z-offset"])}))},e,i,s)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new oa(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new vp(r)}queryRadius(){return Fi(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,u,a){return!r.queryGeometry.isAboveHorizon&&Wt(An(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends _o{constructor(r,e,i,s){super(r,{layout:Um||(Um=new Bn({visibility:new ht(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ht(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bd||(bd=new Bn({"fill-extrusion-opacity":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ei(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ht(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Ap(r)}queryRadius(){return Fi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,s,u,a,h,g,w){const A=bn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),p=this.paint.get("fill-extrusion-height").evaluate(e,i),b=this.paint.get("fill-extrusion-base").evaluate(e,i),E=[0,0],x=g&&a.elevation,T=a.elevation?a.elevation.exaggeration():1,C=r.tile.getBucket(this);if(x&&C instanceof Ap){const B=C.centroidVertexArray,q=w+1;q<B.length&&(E[0]=B.geta_centroid_pos0(q),E[1]=B.geta_centroid_pos1(q))}if(E[0]===0&&E[1]===1)return!1;a.projection.name==="globe"&&(s=Jn([s],[new he(0,0),new he(wt,wt)],r.tileID.canonical).map(B=>B.polygon).flat());const L=x?g:null,[k,V]=function(B,q,Z,Q,ce,oe,ae,Se,se,be,Me){return B.projection.name==="globe"?function(Ie,Le,Ue,je,Fe,tt,dt,Xe,Bt,Et,yt){const ut=[],ni=[],Ft=Ie.projection.upVectorScale(yt,Ie.center.lat,Ie.worldSize).metersToTile,qt=[0,0,0,1],bi=[0,0,0,1],Ci=(Ai,Ni,Bi,Vn)=>{Ai[0]=Ni,Ai[1]=Bi,Ai[2]=Vn,Ai[3]=1},Pi=Cg();Ue>0&&(Ue+=Pi),je+=Pi;for(const Ai of Le){const Ni=[],Bi=[];for(const Vn of Ai){const Ln=Vn.x+Fe.x,mi=Vn.y+Fe.y,yn=Ie.projection.projectTilePoint(Ln,mi,yt),Tn=Ie.projection.upVector(yt,Vn.x,Vn.y);let Xn=Ue,xr=je;if(dt){const Ur=Rg(Ln,mi,Ue,je,dt,Xe,Bt,Et);Xn+=Ur.base,xr+=Ur.top}Ue!==0?Ci(qt,yn.x+Tn[0]*Ft*Xn,yn.y+Tn[1]*Ft*Xn,yn.z+Tn[2]*Ft*Xn):Ci(qt,yn.x,yn.y,yn.z),Ci(bi,yn.x+Tn[0]*Ft*xr,yn.y+Tn[1]*Ft*xr,yn.z+Tn[2]*Ft*xr),ye.vec3.transformMat4(qt,qt,tt),ye.vec3.transformMat4(bi,bi,tt),Ni.push(new Vs(qt[0],qt[1],qt[2])),Bi.push(new Vs(bi[0],bi[1],bi[2]))}ut.push(Ni),ni.push(Bi)}return[ut,ni]}(B,q,Z,Q,ce,oe,ae,Se,se,be,Me):ae?function(Ie,Le,Ue,je,Fe,tt,dt,Xe,Bt){const Et=[],yt=[],ut=[0,0,0,1];for(const ni of Ie){const Ft=[],qt=[];for(const bi of ni){const Ci=bi.x+je.x,Pi=bi.y+je.y,Ai=Rg(Ci,Pi,Le,Ue,tt,dt,Xe,Bt);ut[0]=Ci,ut[1]=Pi,ut[2]=Ai.base,ut[3]=1,ye.vec4.transformMat4(ut,ut,Fe),ut[3]=Math.max(ut[3],1e-5);const Ni=new Vs(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);ut[0]=Ci,ut[1]=Pi,ut[2]=Ai.top,ut[3]=1,ye.vec4.transformMat4(ut,ut,Fe),ut[3]=Math.max(ut[3],1e-5);const Bi=new Vs(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);Ft.push(Ni),qt.push(Bi)}Et.push(Ft),yt.push(qt)}return[Et,yt]}(q,Z,Q,ce,oe,ae,Se,se,be):function(Ie,Le,Ue,je,Fe){const tt=[],dt=[],Xe=Fe[8]*Le,Bt=Fe[9]*Le,Et=Fe[10]*Le,yt=Fe[11]*Le,ut=Fe[8]*Ue,ni=Fe[9]*Ue,Ft=Fe[10]*Ue,qt=Fe[11]*Ue;for(const bi of Ie){const Ci=[],Pi=[];for(const Ai of bi){const Ni=Ai.x+je.x,Bi=Ai.y+je.y,Vn=Fe[0]*Ni+Fe[4]*Bi+Fe[12],Ln=Fe[1]*Ni+Fe[5]*Bi+Fe[13],mi=Fe[2]*Ni+Fe[6]*Bi+Fe[14],yn=Fe[3]*Ni+Fe[7]*Bi+Fe[15],Tn=Vn+Xe,Xn=Ln+Bt,xr=mi+Et,Ur=Math.max(yn+yt,1e-5),vr=Vn+ut,pr=Ln+ni,Ir=mi+Ft,Wr=Math.max(yn+qt,1e-5);Ci.push(new Vs(Tn/Ur,Xn/Ur,xr/Ur)),Pi.push(new Vs(vr/Wr,pr/Wr,Ir/Wr))}tt.push(Ci),dt.push(Pi)}return[tt,dt]}(q,Z,Q,ce,oe)}(a,s,b,p,A,h,L,E,T,a.center.lat,r.tileID.canonical),j=r.queryGeometry;return function(B,q,Z){let Q=1/0;Wt(Z,q)&&(Q=Pg(Z,q[0]));for(let ce=0;ce<q.length;ce++){const oe=q[ce],ae=B[ce];for(let Se=0;Se<oe.length-1;Se++){const se=oe[Se],be=[se,oe[Se+1],ae[Se+1],ae[Se],se];ot(Z,be)&&(Q=Math.min(Q,Pg(Z,be)))}}return Q!==1/0&&Q}(k,V,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends _o{constructor(r,e,i,s){const u=Ng();super(r,u,e,i,s),u.layout&&(this.layout=new Pl(u.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ss,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Sd)return Sd;const i=Ng();return Sd=new K0(i.paint.properties["line-width"].specification),Sd.useIntegerZoom=!0,Sd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new jm(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const s=Fg(this);return{config:new oa(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(r){const e=r,i=Gm(In("line-width",this,e),In("line-gap-width",this,e)),s=In("line-offset",this,e);return i/2+Math.abs(s)+Fi(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,u,a){if(r.queryGeometry.isAboveHorizon)return!1;const h=An(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*Gm(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(s=function(A,p){const b=[],E=new he(0,0);for(let x=0;x<A.length;x++){const T=A[x],C=[];for(let L=0;L<T.length;L++){const k=T[L],V=T[L+1],j=L===0?E:k.sub(T[L-1])._unit()._perp(),B=L===T.length-1?E:V.sub(k)._unit()._perp(),q=j._add(B)._unit();q._mult(1/(q.x*B.x+q.y*B.y)),C.push(q._mult(p)._add(k))}b.push(C)}return b}(s,w*r.pixelToTileUnitsFactor)),function(A,p,b){for(let E=0;E<p.length;E++){const x=p[E];if(A.length>=3){for(let T=0;T<x.length;T++)if(Ui(A,x[T]))return!0}if(ti(A,x,b))return!0}return!1}(h,s,g)}isTileClipped(){return!0}isDraped(r){const e=this.layout.get("line-z-offset"),i=e.isConstant()&&!e.constantOr(0),s=this.layout.get("line-elevation-reference");return!(s==="sea"||s==="ground")&&(i||s!=="none")}},symbol:my,background:class extends _o{constructor(r,e,i,s){super(r,{layout:N1||(N1=new Bn({visibility:new ht(Ve.layout_background.visibility)})),paint:U1||(U1=new Bn({"background-pitch-alignment":new ht(Ve.paint_background["background-pitch-alignment"]),"background-color":new ht(Ve.paint_background["background-color"]),"background-pattern":new ht(Ve.paint_background["background-pattern"]),"background-opacity":new ht(Ve.paint_background["background-opacity"]),"background-emissive-strength":new ht(Ve.paint_background["background-emissive-strength"])}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:$1,"raster-particle":K1,sky:class extends _o{constructor(r,e,i,s){super(r,{layout:Z1||(Z1=new Bn({visibility:new ht(Ve.layout_sky.visibility)})),paint:X1||(X1=new Bn({"sky-type":new ht(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new ht(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ht(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ht(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ht(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new _c(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ht(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ht(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ht(Ve.paint_sky["sky-opacity"])}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,a=r.style.light,h=a.properties.get("position");return u&&a.properties.get("anchor")==="viewport"&&ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Cx(h.azimuthal,90-h.polar,e):Cx(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Cx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends _o{constructor(r,e,i,s){super(r,{paint:Y1||(Y1=new Bn({}))},e,null)}},model:class extends _o{constructor(r,e,i,s){super(r,{layout:ab||(ab=new Bn({visibility:new ht(Ve.layout_model.visibility),"model-id":new ei(Ve.layout_model["model-id"])})),paint:lb||(lb=new Bn({"model-opacity":new ht(Ve.paint_model["model-opacity"]),"model-rotation":new ei(Ve.paint_model["model-rotation"]),"model-scale":new ei(Ve.paint_model["model-scale"]),"model-translation":new ei(Ve.paint_model["model-translation"]),"model-color":new ei(Ve.paint_model["model-color"]),"model-color-mix-intensity":new ei(Ve.paint_model["model-color-mix-intensity"]),"model-type":new ht(Ve.paint_model["model-type"]),"model-cast-shadows":new ht(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new ht(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ht(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ei(Ve.paint_model["model-emissive-strength"]),"model-roughness":new ei(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ei(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ht(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ht(Ve.paint_model["model-front-cutoff"])}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Dx(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Ty?wt-1:0}queryIntersectsFeature(r,e,i,s,u,a){if(!this.modelManager)return!1;const h=this.modelManager,g=r.tile.getBucket(this);if(!(g&&g instanceof Dx))return!1;const w=g;for(const A in w.instancesPerModel){const p=w.instancesPerModel[A],b=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(p.idToFeaturesIndex.hasOwnProperty(b)){const E=p.features[p.idToFeaturesIndex[b]],x=h.getModel(A,this.scope);if(!x)return!1;let T=ye.mat4.create();const C=new R(0,0),L=w.canonical;let k=Number.MAX_VALUE;for(let V=0;V<E.instancedDataCount;++V){const j=16*(E.instancedDataOffset+V),B=p.instancedDataArray.float32,q=[B[j+4],B[j+5],B[j+6]];pb(L,C,B[j],0|B[j+1]),cb(T,x,a,C,E.rotation,E.scale,q,!1,!1,!1),a.projection.name==="globe"&&(T=Rx(T,a));const Z=ye.mat4.multiply([],a.projMatrix,T),Q=r.queryGeometry,ce=ib(Q.isPointQuery()?Q.screenBounds:Q.screenGeometry,a,Z,x.aabb);ce!=null&&(k=Math.min(ce,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof yu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(r,e,i,s){const u=r.tile,a=u.getBucket(this);let h=null,g=Number.MAX_VALUE;if(!(a&&a instanceof Ty))return{queryFeature:h,intersectionZ:g};const w=a.getNodesInfo()[e];if(w.hiddenByReplacement||!w.node.meshes||!i.filter(new Kn(u.tileID.overscaledZ),w.feature,u.tileID.canonical))return{queryFeature:h,intersectionZ:g};const A=w.node,p=s.calculatePosMatrix(u.tileID.toUnwrapped(),s.worldSize),b=w.evaluatedScale;let E=0;s.elevation&&A.elevation&&(E=A.elevation*s.elevation.exaggeration()),ye.mat4.translate(p,p,[(A.anchor?A.anchor[0]:0)*(b[0]-1),(A.anchor?A.anchor[1]:0)*(b[1]-1),E]),ye.mat4.scale(p,p,b);const x=r.queryGeometry,T=x.isPointQuery()?x.screenBounds:x.screenGeometry,C=function(B){const q=ye.mat4.multiply([],p,B.matrix);ye.mat4.multiply(q,s.expandedFarZProjMatrix,q);for(let Z=0;Z<B.meshes.length;++Z){const Q=B.meshes[Z];if(Z===B.lightMeshIndex)continue;const ce=ib(T,s,q,Q.aabb);ce!=null&&(g=Math.min(ce,g))}if(B.children)for(const Z of B.children)C(Z)};if(C(A),g===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:g};const L=new R(0,0);pb(u.tileID.canonical,L,w.node.anchor[0],w.node.anchor[1]);const{z:k,x:V,y:j}=u.tileID.canonical;return h=new n_({},k,V,j,w.feature.id),h.properties=w.feature.properties,h.geometry={type:"Point",coordinates:[L.lng,L.lat]},h.layer={...this.serialize(),id:this.fqid},h.state={},h.tile=u.tileID.canonical,{queryFeature:h,intersectionZ:g}}},clip:class extends _o{constructor(r,e,i,s){super(r,{layout:dg||(dg=new Bn({"clip-layer-types":new ht(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new ht(Ve.layout_clip["clip-layer-scope"])})),paint:pg||(pg=new Bn({}))},e,i,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new gd(r)}isTileClipped(){return!0}is3D(){return!0}}};class WS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZS{constructor(){this.tasks={},this.taskQueue=[],jr(["process"],this),this.invoker=new WS(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=function({type:a,isSymbolTile:h,zoom:g}){return g=g||0,a==="message"?0:a!=="maybePrepare"||h?a!=="parseTile"||h?a==="parseTile"&&h?300-g:a==="maybePrepare"&&h?400-g:500:200-g:100-g}(i);if(u===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const a=this.tasks[this.taskQueue[u]];a.priority<i&&(i=a.priority,e=u)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class mb{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},jr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZS}send(e,i,s,u,a=!1,h){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=h,this.callbacks[g]=s);const w=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!s,targetMapId:u,mustQueue:a,sourceMapId:this.mapId,data:Xa(i,w)},w),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(i.mustQueue||Ua()){const u=this.callbacks[s],a=this.scheduler.add(()=>this.processTask(s,i),u&&u.metadata||{type:"message"});a&&(this.cancelCallbacks[s]=a)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Ao(i.error)):s(null,Ao(i.data)))}else{const s=new Set,u=i.hasCallback?(h,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?Xa(h):null,data:Xa(g,s)},s)}:()=>{},a=Ao(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,a,u);else if(this.parent.getWorkerSource){const h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],a.source,a.scope)[h[1]](a,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Np{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Dr();const s=this.workerPool.acquire(this.id);for(let u=0;u<s.length;u++){const a=new Np.Actor(s[u],i,this.id);a.name=`Worker ${u}`,this.actors.push(a)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){Hi(this.actors,(u,a)=>{u.send(e,i,a)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Np.Actor=mb;class _b{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function gb(r,e,i,s){let u=0,a=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(s[h])<1e-15){if(i[h]<r[h]||i[h]>e[h])return null}else{const g=1/s[h];let w=(r[h]-i[h])*g,A=(e[h]-i[h])*g;if(w>A){const p=w;w=A,A=p}if(w>u&&(u=w),A<a&&(a=A),u>a)return null}return u}function yb(r,e,i,s,u,a,h,g,w,A,p){const b=s-r,E=u-e,x=a-i,T=h-r,C=g-e,L=w-i,k=p[1]*L-p[2]*C,V=p[2]*T-p[0]*L,j=p[0]*C-p[1]*T,B=b*k+E*V+x*j;if(Math.abs(B)<1e-15)return null;const q=1/B,Z=A[0]-r,Q=A[1]-e,ce=A[2]-i,oe=(Z*k+Q*V+ce*j)*q;if(oe<0||oe>1)return null;const ae=Q*x-ce*E,Se=ce*b-Z*x,se=Z*E-Q*b,be=(p[0]*ae+p[1]*Se+p[2]*se)*q;return be<0||oe+be>1?null:(T*ae+C*Se+L*se)*q}function xb(r,e,i){return(r-e)/(i-e)}function vb(r,e,i,s,u,a,h,g,w){const A=1<<i,p=a-s,b=h-u,E=(r+1)/A*p+s,x=(e+0)/A*b+u,T=(e+1)/A*b+u;g[0]=(r+0)/A*p+s,g[1]=x,w[0]=E,w[1]=T}class bb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(a){const h=Math.ceil(Math.log2(a.dim/8)),g=[];let w=Math.ceil(Math.pow(2,h));const A=1/w,p=(x,T,C,L,k)=>{const V=L?1:0,j=(x+1)*C-V,B=T*C,q=(T+1)*C-V;k[0]=x*C,k[1]=B,k[2]=j,k[3]=q};let b=new _b(w);const E=[];for(let x=0;x<w*w;x++){p(x%w,Math.floor(x/w),A,!1,E);const T=Jh(E[0],E[1],a),C=Jh(E[2],E[1],a),L=Jh(E[2],E[3],a),k=Jh(E[0],E[3],a);b.minimums.push(Math.min(T,C,L,k)),b.maximums.push(Math.max(T,C,L,k)),b.leaves.push(1)}for(g.push(b),w/=2;w>=1;w/=2){const x=g[g.length-1];b=new _b(w);for(let T=0;T<w*w;T++){p(T%w,Math.floor(T/w),2,!0,E);const C=x.getElevation(E[0],E[1]),L=x.getElevation(E[2],E[1]),k=x.getElevation(E[2],E[3]),V=x.getElevation(E[0],E[3]),j=x.isLeaf(E[0],E[1]),B=x.isLeaf(E[2],E[1]),q=x.isLeaf(E[2],E[3]),Z=x.isLeaf(E[0],E[3]),Q=Math.min(C.min,L.min,k.min,V.min),ce=Math.max(C.max,L.max,k.max,V.max),oe=j&&B&&q&&Z;b.maximums.push(ce),b.minimums.push(Q),b.leaves.push(ce-Q<=5&&oe?1:0)}g.push(b)}return g}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,a,h,g=1){return gb([e,i,-100],[s,u,this.maximums[0]*g],a,h)}raycast(e,i,s,u,a,h,g=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,s,u,a,h,g);if(w==null)return null;const A=[],p=[],b=[],E=[],x=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;x.length>0;){const{idx:T,t:C,nodex:L,nodey:k,depth:V}=x.pop();if(this.leaves[T]){vb(L,k,V,e,i,s,u,b,E);const B=1<<V,q=(L+0)/B,Z=(L+1)/B,Q=(k+0)/B,ce=(k+1)/B,oe=Jh(q,Q,this.dem)*g,ae=Jh(Z,Q,this.dem)*g,Se=Jh(Z,ce,this.dem)*g,se=Jh(q,ce,this.dem)*g,be=yb(b[0],b[1],oe,E[0],b[1],ae,E[0],E[1],Se,a,h),Me=yb(E[0],E[1],Se,b[0],E[1],se,b[0],b[1],oe,a,h),Ie=Math.min(be!==null?be:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(Ie!==Number.MAX_VALUE)return Ie;{const Le=ye.vec3.scaleAndAdd([],a,h,C);if(wb(oe,ae,se,Se,xb(Le[0],b[0],E[0]),xb(Le[1],b[1],E[1]))>=Le[2])return C}continue}let j=0;for(let B=0;B<this._siblingOffset.length;B++){vb((L<<1)+this._siblingOffset[B][0],(k<<1)+this._siblingOffset[B][1],V+1,e,i,s,u,b,E),b[2]=-100,E[2]=this.maximums[this.childOffsets[T]+B]*g;const q=gb(b,E,a,h);if(q!=null){const Z=q;A[B]=Z;let Q=!1;for(let ce=0;ce<j&&!Q;ce++)Z>=A[p[ce]]&&(p.splice(ce,0,B),Q=!0);Q||(p[j]=B),j++}}for(let B=0;B<j;B++){const q=p[B];x.push({idx:this.childOffsets[T]+q,t:A[q],nodex:(L<<1)+this._siblingOffset[q][0],nodey:(k<<1)+this._siblingOffset[q][1],depth:V+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,a){if(e[u].isLeaf(i,s)===1)return;this.childOffsets[a]||(this.childOffsets[a]=this.nodeCount);const h=u-1,g=e[h];let w=0,A=0;for(let p=0;p<this._siblingOffset.length;p++){const b=2*i+this._siblingOffset[p][0],E=2*s+this._siblingOffset[p][1],x=g.getElevation(b,E),T=g.isLeaf(b,E),C=this._addNode(x.min,x.max,T);T&&(w|=1<<p),A||(A=C)}for(let p=0;p<this._siblingOffset.length;p++)w&1<<p||this._construct(e,2*i+this._siblingOffset[p][0],2*s+this._siblingOffset[p][1],h,A+p)}}function wb(r,e,i,s,u,a){return hi(hi(r,i,a),hi(e,s,a),u)}function Jh(r,e,i){const s=i.dim,u=vt(r*s-.5,0,s-1),a=vt(e*s-.5,0,s-1),h=Math.floor(u),g=Math.floor(a),w=Math.min(h+1,s-1),A=Math.min(g+1,s-1);return wb(i.get(h,g),i.get(w,g),i.get(h,A),i.get(w,A),u-h,a-g)}const XS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function YS(r,e,i){return(256*r*256+256*e+i)/10-1e4}function KS(r,e,i){return 256*r+e+i/256-32768}class Sy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void ji(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const a=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let w=0;w<a;w++)h[this._idx(-1,w)]=h[this._idx(0,w)],h[this._idx(a,w)]=h[this._idx(a-1,w)],h[this._idx(w,-1)]=h[this._idx(w,0)],h[this._idx(w,a)]=h[this._idx(w,a-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(a,-1)]=h[this._idx(a-1,0)],h[this._idx(-1,a)]=h[this._idx(0,a-1)],h[this._idx(a,a)]=h[this._idx(a-1,a-1)]}const g=s==="terrarium"?KS:YS;for(let w=0;w<h.length;++w){const A=4*w;this.floatView[w]=g(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Lt.now()}_buildQuadTree(){this._tree=new bb(this)}get(e,i,s=!1){s&&(e=vt(e,-1,this.dim),i=vt(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,s){const u=this._idx(e,i),a=this.floatView[u];return this.floatView[u]=s,s-a}static getUnpackVector(e){return XS[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],u=Sy.getUnpackVector(i);let a=Math.floor((e+u[3])/u[2]);return s[2]=a%256,a=Math.floor(a/256),s[1]=a%256,a=Math.floor(a/256),s[0]=a,s}getPixels(){return new og({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,a=i*this.dim+this.dim,h=s*this.dim,g=s*this.dim+this.dim;switch(i){case-1:u=a-1;break;case 1:a=u+1}switch(s){case-1:h=g-1;break;case 1:g=h+1}const w=-i*this.dim,A=-s*this.dim;for(let p=h;p<g;p++)for(let b=u;b<a;b++){const E=4*this._idx(b,p),x=4*this._idx(b+w,p+A);this.pixels[E+0]=e.pixels[x+0],this.pixels[E+1]=e.pixels[x+1],this.pixels[E+2]=e.pixels[x+2],this.pixels[E+3]=e.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function JS(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(s,u){return s.readFields(nE,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(i,i.readVarint()+i.pos))}function QS(r,e,i){r===1?(e.delta_filter=function(s,u){return s.readFields(eE,{blockSize:0},u)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function eE(r,e,i){r===1&&(e.blockSize=i.readVarint())}function tE(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function iE(r,e,i){let s=0,u=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(a,h){return a.readFields(QS,{},h)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(a,h){return a.readFields(tE,{},h)}(i,i.readVarint()+i.pos):r===5?u=i.readFloat():r===6?s=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=s)}function nE(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(s,u){return s.readFields(iE,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(i,i.readVarint()+i.pos))}function rE(r,e,i){if(r===2)(function(s,u,a){s.readFields(oE,a,u)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function oE(r,e,i){if(r===1){let s=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[s++]=i.readVarint()}}Vt(Sy,"DEMData"),Vt(bb,"DemMinMaxQuadTree",{omit:["dem"]});class sE{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}}function aE(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const u=s===1?1:0,a=s===2?1:0;for(let h=0;h<e[0];h++){const g=e[1]*h;for(let w=u;w<e[1];w++){const A=e[2]*(w+g);for(let p=a;p<e[2];p++){const b=e[3]*(p+A);for(let E=0;E<e[3];E++){const x=b+E;r[x]+=r[x-i]}}}}i*=e[s]}return r}function lE(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function cE(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const s=r[i],u=r[i+1];r[i]=(240&s)>>4|(61440&s)>>8|(240&u)<<4|61440&u,r[i+1]=15&s|(3840&s)>>4|(15&u)<<8|(3840&u)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const s=r[i],u=r[i+1],a=r[i+2],h=r[i+3];r[i+0]=(192&s)>>6|(192&u)>>4|(192&a)>>2|192&h,r[i+1]=(48&s)>>4|(48&u)>>2|48&a|(48&h)<<2,r[i+2]=(12&s)>>2|12&u|(12&a)<<2|(12&h)<<4,r[i+3]=3&s|(3&u)<<2|(3&a)<<4|(3&h)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}var za=Uint8Array,r_=Uint16Array,uE=Int32Array,Tb=new za([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Sb=new za([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hE=new za([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Eb=function(r,e){for(var i=new r_(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];var u=new uE(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)u[a]=a-i[s]<<5|s;return{b:i,r:u}},Ab=Eb(Tb,2),Mb=Ab.b,fE=Ab.r;Mb[28]=258,fE[258]=28;for(var dE=Eb(Sb,0).b,Ib=new r_(32768),Nr=0;Nr<32768;++Nr){var Up=(43690&Nr)>>1|(21845&Nr)<<1;Ib[Nr]=((65280&(Up=(61680&(Up=(52428&Up)>>2|(13107&Up)<<2))>>4|(3855&Up)<<4))>>8|(255&Up)<<8)>>1}var o_=function(r,e,i){for(var s=r.length,u=0,a=new r_(e);u<s;++u)r[u]&&++a[r[u]-1];var h,g=new r_(e);for(u=1;u<e;++u)g[u]=g[u-1]+a[u-1]<<1;h=new r_(1<<e);var w=15-e;for(u=0;u<s;++u)if(r[u])for(var A=u<<4|r[u],p=e-r[u],b=g[r[u]-1]++<<p,E=b|(1<<p)-1;b<=E;++b)h[Ib[b]>>w]=A;return h},s_=new za(288);for(Nr=0;Nr<144;++Nr)s_[Nr]=8;for(Nr=144;Nr<256;++Nr)s_[Nr]=9;for(Nr=256;Nr<280;++Nr)s_[Nr]=7;for(Nr=280;Nr<288;++Nr)s_[Nr]=8;var Cb=new za(32);for(Nr=0;Nr<32;++Nr)Cb[Nr]=5;var pE=o_(s_,9),mE=o_(Cb,5),kx=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Hl=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&i},Fx=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},_E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wl=function(r,e,i){var s=new Error(e||_E[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Wl),!i)throw s;return s},gE=new za(0),yE=typeof TextDecoder<"u"&&new TextDecoder;try{yE.decode(gE,{stream:!0})}catch{}const xE={gzip_data:"gzip"};class ol extends Error{constructor(e){super(e),this.name="MRTError"}}const vE={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Pb={uint32:1,uint16:2,uint8:4},bE={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Bx;class Nx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new ol(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new ol("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new ol(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const u=function(a,h){return a.readFields(JS,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Bx(i.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new ol(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const a of u.layers)this.layers[a.name]=new wE(a,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let u of e.blockIndices){const a=s.dataIndex[u],h=a.firstByte-e.firstByte,g=a.lastByte-e.firstByte;if(s._blocksInProgress.has(u))continue;const w={layerName:s.name,firstByte:h,lastByte:g,pixelFormat:s.pixelFormat,blockIndex:u,blockShape:[a.bands.length].concat(s.bandShape),buffer:s.buffer,codec:a.codec.codec,filters:a.filters.map(A=>A.filter)};s._blocksInProgress.add(u),i.push(w)}return new Rb(i,()=>{i.forEach(u=>s._blocksInProgress.delete(u.blockIndex))},(u,a)=>{if(i.forEach(h=>s._blocksInProgress.delete(h.blockIndex)),u)throw u;a.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class wE{constructor({version:e,name:i,units:s,tileSize:u,pixelFormat:a,buffer:h,dataIndex:g},w){if(this.version=e,this.version!==1)throw new ol(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=u,this.buffer=h,this.pixelFormat=vE[a],this.dataIndex=g,this.bandShape=[u+2*h,u+2*h,Pb[this.pixelFormat]],this._decodedBlocks=new sE(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Pb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,u]of this.dataIndex.entries()){for(const[a,h]of u.bands.entries())if(h===e)return{bandIndex:i+a,blockIndex:s,blockBandIndex:a};i+=u.bands.length}break;case"number":for(const[s,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new ol(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new ol(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0;const u=[],a=new Set;for(const h of e){const{blockIndex:g}=this.getBlockForBand(h);if(g<0)throw new ol(`Invalid band: ${JSON.stringify(h)}`);const w=this.dataIndex[g];u.includes(g)||u.push(g),a.add(g),i=Math.min(i,w.firstByte),s=Math.max(s,w.lastByte)}if(a.size>this.cacheSize)throw new ol(`Number of blocks to decode (${a.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),u=this._decodedBlocks.get(i.toString());if(!u)throw new ol(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const a=this.dataIndex[i],h=this.bandShape.reduce((A,p)=>A*p,1),g=s*h,w=u.subarray(g,g+h);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:a.offset,scale:a.scale}}}Nx.setPbf=function(r){Bx=r};class Rb{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Nx.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(s=>{const{layerName:u,firstByte:a,lastByte:h,pixelFormat:g,blockShape:w,blockIndex:A,filters:p,codec:b}=s,E=i.subarray(a,h+1),x=new Uint32Array(w[0]*w[1]*w[2]);let T;if(b!=="gzip_data")throw new ol(`Unhandled codec: ${b}`);return T=function(C,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((B=function(Q){Q[0]==31&&Q[1]==139&&Q[2]==8||Wl(6,"invalid gzip data");var ce=Q[3],oe=10;4&ce&&(oe+=2+(Q[10]|Q[11]<<8));for(var ae=(ce>>3&1)+(ce>>4&1);ae>0;ae-=!Q[oe++]);return oe+(2&ce)}(j=C))+8>j.length&&Wl(6,"invalid gzip data"),function(Q,ce,oe,ae){var Se=Q.length;if(!Se||ce.f&&!ce.l)return oe||new za(0);var se=!oe,be=se||ce.i!=2,Me=ce.i;se&&(oe=new za(3*Se));var Ie,Le,Ue=function(Qh){var Od=oe.length;if(Qh>Od){var d_=new za(Math.max(2*Od,Qh));d_.set(oe),oe=d_}},je=ce.f||0,Fe=ce.p||0,tt=ce.b||0,dt=ce.l,Xe=ce.d,Bt=ce.m,Et=ce.n,yt=8*Se;do{if(!dt){je=Hl(Q,Fe,1);var ut=Hl(Q,Fe+1,3);if(Fe+=3,!ut){var ni=Q[(mi=4+((Fe+7)/8|0))-4]|Q[mi-3]<<8,Ft=mi+ni;if(Ft>Se){Me&&Wl(0);break}be&&Ue(tt+ni),oe.set(Q.subarray(mi,Ft),tt),ce.b=tt+=ni,ce.p=Fe=8*Ft,ce.f=je;continue}if(ut==1)dt=pE,Xe=mE,Bt=9,Et=5;else if(ut==2){var qt=Hl(Q,Fe,31)+257,bi=Hl(Q,Fe+10,15)+4,Ci=qt+Hl(Q,Fe+5,31)+1;Fe+=14;for(var Pi=new za(Ci),Ai=new za(19),Ni=0;Ni<bi;++Ni)Ai[hE[Ni]]=Hl(Q,Fe+3*Ni,7);Fe+=3*bi;var Bi=kx(Ai),Vn=(1<<Bi)-1,Ln=o_(Ai,Bi);for(Ni=0;Ni<Ci;){var mi,yn=Ln[Hl(Q,Fe,Vn)];if(Fe+=15&yn,(mi=yn>>4)<16)Pi[Ni++]=mi;else{var Tn=0,Xn=0;for(mi==16?(Xn=3+Hl(Q,Fe,3),Fe+=2,Tn=Pi[Ni-1]):mi==17?(Xn=3+Hl(Q,Fe,7),Fe+=3):mi==18&&(Xn=11+Hl(Q,Fe,127),Fe+=7);Xn--;)Pi[Ni++]=Tn}}var xr=Pi.subarray(0,qt),Ur=Pi.subarray(qt);Bt=kx(xr),Et=kx(Ur),dt=o_(xr,Bt),Xe=o_(Ur,Et)}else Wl(1);if(Fe>yt){Me&&Wl(0);break}}be&&Ue(tt+131072);for(var vr=(1<<Bt)-1,pr=(1<<Et)-1,Ir=Fe;;Ir=Fe){var Wr=(Tn=dt[Fx(Q,Fe)&vr])>>4;if((Fe+=15&Tn)>yt){Me&&Wl(0);break}if(Tn||Wl(2),Wr<256)oe[tt++]=Wr;else{if(Wr==256){Ir=Fe,dt=null;break}var Ro=Wr-254;Wr>264&&(Ro=Hl(Q,Fe,(1<<(Xl=Tb[Ni=Wr-257]))-1)+Mb[Ni],Fe+=Xl);var Zn=Xe[Fx(Q,Fe)&pr],$s=Zn>>4;if(Zn||Wl(3),Fe+=15&Zn,Ur=dE[$s],$s>3){var Xl=Sb[$s];Ur+=Fx(Q,Fe)&(1<<Xl)-1,Fe+=Xl}if(Fe>yt){Me&&Wl(0);break}be&&Ue(tt+131072);var sl=tt+Ro;if(tt<Ur){var al=0-Ur,zd=Math.min(Ur,sl);for(al+tt<0&&Wl(3);tt<zd;++tt)oe[tt]=(void 0)[al+tt]}for(;tt<sl;++tt)oe[tt]=oe[tt-Ur]}}ce.l=dt,ce.p=Ir,ce.b=tt,ce.f=je,dt&&(je=1,ce.m=Bt,ce.d=Xe,ce.n=Et)}while(!je);return tt!=oe.length&&se?(Ie=oe,((Le=tt)==null||Le>Ie.length)&&(Le=Ie.length),new za(Ie.subarray(0,Le))):oe.subarray(0,tt)}(j.subarray(B,-8),{i:2},new za(((k=j)[(V=k.length)-4]|k[V-3]<<8|k[V-2]<<16|k[V-1]<<24)>>>0))));var k,V,j,B;const q=xE[L];if(!q)throw new Error(`Unhandled codec: ${L}`);const Z=new globalThis.DecompressionStream(q);return new Response(new Blob([C]).stream().pipeThrough(Z)).arrayBuffer().then(Q=>new Uint8Array(Q))}(E,b).then(C=>(function(L,k){L.readFields(rE,k)}(new Bx(C),x),new bE[g](x.buffer))),T.then(C=>{for(let L=p.length-1;L>=0;L--)switch(p[L]){case"delta_filter":aE(C,w);break;case"zigzag_filter":lE(C);break;case"bitshuffle_filter":cE(C,g);break;default:throw new ol(`Unhandled filter "${p[L]}"`)}return{layerName:u,blockIndex:A,data:C}}).catch(C=>{throw C})}))},Vt(Rb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var a_={workerUrl:"",workerClass:null,workerParams:void 0};const Ux="mapboxgl_preloaded_worker_pool";class l_{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<l_.workerCount;)this.workers.push(a_.workerClass!=null?new a_.workerClass:new self.Worker(a_.workerUrl,a_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ux]}numActive(){return Object.keys(this.active).length}}let c_;function Ey(){return c_||(c_=new l_),c_}l_.workerCount=2;let u_,Vx,Zl,Vp,jx,jp=null;function Db(){return Ua()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Vx||pe.DRACO_URL}function Lb(){if(Ua()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vp)return Vp;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vp=WebAssembly.validate(r)?pe.MESHOPT_SIMD_URL:pe.MESHOPT_URL,Vp}const Ay={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},h_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function zb(r,e,i){const s=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:u,byteLength:r.byteLength},i.buffers[u]=r}const Gx="KHR_draco_mesh_compression";function SE(r,e){const i=r.extensions&&r.extensions[Gx];if(!i)return;const s=new Zl.Decoder,u=Bb(e,i.bufferView),a=new Zl.Mesh;if(!s.DecodeArrayToMesh(u,u.byteLength,a))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[r.indices],g=Ay[h.componentType],w=h.count*g.BYTES_PER_ELEMENT,A=Zl._malloc(w);g===Uint16Array?s.GetTrianglesUInt16Array(a,w,A):s.GetTrianglesUInt32Array(a,w,A),zb(Zl.memory.buffer.slice(A,A+w),h,e),Zl._free(A);for(const p of Object.keys(i.attributes)){const b=s.GetAttributeByUniqueId(a,i.attributes[p]),E=e.json.accessors[r.attributes[p]],x=TE[E.componentType],T=E.count*h_[E.type]*Ay[E.componentType].BYTES_PER_ELEMENT,C=Zl._malloc(T);s.GetAttributeDataArrayForAllPoints(a,b,Zl[x],T,C),zb(Zl.memory.buffer.slice(C,C+T),E,e),Zl._free(C)}s.destroy(),a.destroy(),delete r.extensions[Gx]}const My="EXT_meshopt_compression";function EE(r,e){if(!r.extensions||!r.extensions[My])return;const i=r.extensions[My],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);jx.decodeGltfBuffer(u,i.count,i.byteStride,s,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=u.buffer,delete r.extensions[My]}const Ob=1179937895,kb=new TextDecoder("utf8");function Fb(r,e){return new URL(r,e).href}function AE(r,e,i,s){return fetch(Fb(r.uri,s)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[i]=u})}function Bb(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function ME(r,e,i,s){if(r.uri){const u=Fb(r.uri,s);return fetch(u).then(a=>a.blob()).then(a=>createImageBitmap(a)).then(a=>{e.images[i]=a})}if(r.bufferView!==void 0){const u=Bb(e,r.bufferView),a=new Blob([u],{type:r.mimeType});return createImageBitmap(a).then(h=>{e.images[i]=h})}}function Nb(r,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===Ob){const p=new Uint32Array(r,e);let b=2;const E=(p[b++]>>2)-3,x=p[b++]>>2;if(b++,s.json=JSON.parse(kb.decode(p.subarray(b,b+x))),b+=x,b<E){const T=p[b++];b++;const C=e+(b<<2);s.buffers[0]=r.slice(C,C+T)}}else s.json=JSON.parse(kb.decode(new Uint8Array(r,e)));const{buffers:u,images:a,meshes:h,extensionsUsed:g,bufferViews:w}=s.json;let A=Promise.resolve();if(u){const p=[];for(let b=0;b<u.length;b++){const E=u[b];E.uri?p.push(AE(E,s,b,i)):s.buffers[b]||(s.buffers[b]=null)}A=Promise.all(p)}return A.then(()=>{const p=[],b=g&&g.includes(Gx),E=g&&g.includes(My);if(b&&p.push(function(){if(!Zl)return u_??(u_=function(x){let T,C=null;function L(){T=new Uint8Array(C.buffer)}function k(){throw new Error("Unexpected Draco error.")}const V={a:{a:k,d:function(j,B,q){return T.copyWithin(j,B,B+q)},c:function(j){const B=T.length,q=Math.max(j>>>0,Math.ceil(1.2*B)),Z=Math.ceil((q-B)/65536);try{return C.grow(Z),L(),!0}catch{return!1}},b:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(x,V):x.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,V))).then(j=>{const{Rb:B,Qb:q,P:Z,T:Q,X:ce,Ja:oe,La:ae,Qa:Se,Va:se,Wa:be,eb:Me,jb:Ie,f:Le,e:Ue,yb:je,zb:Fe,Ab:tt,Bb:dt,Db:Xe,Gb:Bt}=j.instance.exports;C=Ue;const Et=(()=>{let yt=0,ut=0,ni=0,Ft=0;return qt=>{ni&&(B(Ft),B(yt),ut+=ni,ni=yt=0),yt||(ut+=128,yt=q(ut));const bi=qt.length+7&-8;let Ci=yt;bi>=ut&&(ni=bi,Ci=Ft=q(bi));for(let Pi=0;Pi<qt.length;Pi++)T[Ci+Pi]=qt[Pi];return Ci}})();return L(),Le(),{memory:Ue,_free:B,_malloc:q,Mesh:class{constructor(){this.ptr=Z()}destroy(){Q(this.ptr)}},Decoder:class{constructor(){this.ptr=oe()}destroy(){Ie(this.ptr)}DecodeArrayToMesh(yt,ut,ni){const Ft=Et(yt),qt=ae(this.ptr,Ft,ut,ni.ptr);return!!ce(qt)}GetAttributeByUniqueId(yt,ut){return{ptr:Se(this.ptr,yt.ptr,ut)}}GetTrianglesUInt16Array(yt,ut,ni){se(this.ptr,yt.ptr,ut,ni)}GetTrianglesUInt32Array(yt,ut,ni){be(this.ptr,yt.ptr,ut,ni)}GetAttributeDataArrayForAllPoints(yt,ut,ni,Ft,qt){Me(this.ptr,yt.ptr,ut.ptr,ni,Ft,qt)}},DT_INT8:je(),DT_UINT8:Fe(),DT_INT16:tt(),DT_UINT16:dt(),DT_UINT32:Xe(),DT_FLOAT32:Bt()}})}(fetch(Db())),u_.then(x=>{Zl=x,u_=void 0}))}()),E&&p.push(function(){if(jx)return;const x=function(T){let C;const L=WebAssembly.instantiateStreaming(T,{}).then(j=>{C=j.instance,C.exports.__wasm_call_ctors()}),k={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},V={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:L,supported:!0,decodeGltfBuffer(j,B,q,Z,Q,ce){(function(oe,ae,Se,se,be,Me,Ie){const Le=oe.exports.sbrk,Ue=se+3&-4,je=Le(Ue*be),Fe=Le(Me.length),tt=new Uint8Array(oe.exports.memory.buffer);tt.set(Me,Fe);const dt=ae(je,se,be,Fe,Me.length);if(dt===0&&Ie&&Ie(je,Ue,be),Se.set(tt.subarray(je,je+se*be)),Le(je-Le(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(C,C.exports[V[Q]],j,B,q,Z,C.exports[k[ce]])}}}(fetch(Lb()));return x.ready.then(()=>{jx=x})}()),a)for(let x=0;x<a.length;x++)p.push(ME(a[x],s,x,i));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(b&&h)for(const{primitives:x}of h)for(const T of x)SE(T,s);if(E&&h&&w)for(const x of w)EE(x,s);return s})})}function Ld(r,e){const i=r.json.bufferViews[e.bufferView],s=Ay[e.componentType];return new s(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==h_[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:h_[e.type]))}function qx(r,e,i,s){const u=Ay[e.componentType],a=function(p){switch(p){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),h=r.json.bufferViews[e.bufferView],g=h.byteStride?h.byteStride/u.BYTES_PER_ELEMENT:h_[e.type],w=i.float32,A=w.length/i.capacity;for(let p=0,b=0;p<e.count*g;p+=g,b+=A)for(let E=0;E<A;E++)w[b+E]=s[p+E]*a;i._trim()}function IE(r,e,i){const s=r.indices,u=r.attributes,a={};a.indexArray=new qn;const h=e.json.accessors[s],g=h.count/3;a.indexArray.reserve(g);const w=Ld(e,h);for(let E=0;E<g;E++)a.indexArray.emplaceBack(w[3*E],w[3*E+1],w[3*E+2]);a.indexArray._trim(),a.vertexArray=new Qa;const A=e.json.accessors[u.POSITION];a.vertexArray.reserve(A.count);const p=Ld(e,A);for(let E=0;E<A.count;E++)a.vertexArray.emplaceBack(p[3*E],p[3*E+1],p[3*E+2]);if(a.vertexArray._trim(),a.aabb=new gn(A.min,A.max),a.centroid=function(E,x){const T=[0,0,0],C=E.length;if(C>0){for(let L=0;L<C;L++){const k=3*E[L];T[0]+=x[k],T[1]+=x[k+1],T[2]+=x[k+2]}T[0]/=C,T[1]/=C,T[2]/=C}return T}(w,p),u.COLOR_0!==void 0){const E=e.json.accessors[u.COLOR_0],x=h_[E.type],T=Ld(e,E);a.colorArray=x===3?new Qa:new Os,a.colorArray.resize(E.count),qx(e,E,a.colorArray,T)}if(u.NORMAL!==void 0){a.normalArray=new Qa;const E=e.json.accessors[u.NORMAL];a.normalArray.resize(E.count);const x=Ld(e,E);qx(e,E,a.normalArray,x)}if(u.TEXCOORD_0!==void 0&&i.length>0){a.texcoordArray=new wc;const E=e.json.accessors[u.TEXCOORD_0];a.texcoordArray.resize(E.count);const x=Ld(e,E);qx(e,E,a.texcoordArray,x)}if(u._FEATURE_ID_RGBA4444!==void 0){const E=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=Ld(e,E))}u._FEATURE_RGBA4444!==void 0&&(a.featureData=new Uint32Array(Ld(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const b=r.material;return a.material=function(E,x){const{emissiveFactor:T=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:L=.5,normalTexture:k,occlusionTexture:V,emissiveTexture:j,doubleSided:B}=E,{baseColorFactor:q=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:Q=1,baseColorTexture:ce,metallicRoughnessTexture:oe}=E.pbrMetallicRoughness||{},ae=V?x[V.index]:void 0;if(V&&V.extensions&&V.extensions.KHR_texture_transform&&ae){const Se=V.extensions.KHR_texture_transform;ae.offsetScale=[Se.offset[0],Se.offset[1],Se.scale[0],Se.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _n(...q),metallicFactor:Z,roughnessFactor:Q,baseColorTexture:ce?x[ce.index]:void 0,metallicRoughnessTexture:oe?x[oe.index]:void 0},doubleSided:B,emissiveFactor:T,alphaMode:C,alphaCutoff:L,normalTexture:k?x[k.index]:void 0,occlusionTexture:ae,emissionTexture:j?x[j.index]:void 0,defined:E.defined===void 0}}(b!==void 0?e.json.materials[b]:{defined:!1},i),a}function Ub(r,e,i){const{matrix:s,rotation:u,translation:a,scale:h,mesh:g,extras:w,children:A}=r,p={};if(p.matrix=s||ye.mat4.fromRotationTranslationScale([],u||[0,0,0,1],a||[0,0,0],h||[1,1,1]),g!==void 0){p.meshes=i[g];const b=p.anchor=[0,0];for(const E of p.meshes){const{min:x,max:T}=E.aabb;b[0]+=x[0]+T[0],b[1]+=x[1]+T[1]}b[0]=Math.floor(b[0]/p.meshes.length/2),b[1]=Math.floor(b[1]/p.meshes.length/2)}if(w&&(w.id&&(p.id=w.id),w.lights&&(p.lights=function(b){if(!b.length)return[];const E=function(k){const V=atob(k),j=new Uint8Array(V.length);for(let B=0;B<V.length;B++)j[B]=V.codePointAt(B);return j}(b),x=[],T=E.length/24,C=new Uint16Array(E.buffer),L=new Float32Array(E.buffer);for(let k=0;k<T;k++){const V=C[2*k*6]/30,j=C[2*k*6+1]/30,B=C[2*k*6+10]/100,q=L[6*k+1],Z=L[6*k+2],Q=L[6*k+3],ce=L[6*k+4],oe=Q-q,ae=ce-Z,Se=Math.hypot(oe,ae);x.push({pos:[q+.5*oe,Z+.5*ae,j],normal:[ae/Se,-oe/Se,0],width:Se,height:V,depth:B,points:[q,Z,Q,ce]})}return x}(w.lights))),A){const b=[];for(const E of A)b.push(Ub(e.json.nodes[E],e,i));p.children=b}return p}function CE(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Im(r.vertices,r.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:s}}function PE(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const h of i){if(!Array.isArray(h)||h.length!==2)continue;const g=h[0],w=h[1];typeof g=="number"&&typeof w=="number"&&s.push(new he(g,w))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let u=0;for(let h=0;h<s.length;h++){const g=s[h],w=s[(h+1)%s.length],A=s[(h+2)%s.length];u+=(g.x-w.x)*(A.y-w.y)-(A.x-w.x)*(g.y-w.y)}u>0&&s.reverse();const a=fd(s.flatMap(h=>[h.x,h.y]),[]);return a.length===0?null:{vertices:s,indices:a}}function RE(r,e){const i=[],s=[];let u=0;const a=[];for(const h of r){u=i.length;const g=h.vertexArray.float32,w=h.indexArray.uint16;for(let A=0;A<h.vertexArray.length;A++)a[0]=g[3*A+0],a[1]=g[3*A+1],a[2]=g[3*A+2],ye.vec3.transformMat4(a,a,e),i.push(new he(a[0],a[1]));for(let A=0;A<3*h.indexArray.length;A++)s.push(w[A]+u)}if(s.length%3!=0)return null;for(let h=0;h<s.length;h+=3){const g=i[s[h+0]],w=i[s[h+1]],A=i[s[h+2]];(g.x-w.x)*(A.y-w.y)-(A.x-w.x)*(g.y-w.y)>0&&([s[h+1],s[h+2]]=[s[h+2],s[h+1]])}return{vertices:i,indices:s}}function Vb(r){const e=function(w,A){const p=[],b=WebGL2RenderingContext;if(w.json.textures)for(const E of w.json.textures){const x={magFilter:b.LINEAR,minFilter:b.NEAREST,wrapS:b.REPEAT,wrapT:b.REPEAT};E.sampler!==void 0&&Object.assign(x,w.json.samplers[E.sampler]),p.push({image:A[E.source],sampler:x,uploaded:!1})}return p}(r,r.images),i=function(w,A){const p=[];for(const b of w.json.meshes){const E=[];for(const x of b.primitives)E.push(IE(x,w,A));p.push(E)}return p}(r,e),{scenes:s,scene:u,nodes:a}=r.json,h=s?s[u||0].nodes:a,g=[];for(const w of h)g.push(Ub(a[w],r,i));return function(w,A,p){const b={},E=new Set;for(let x=0;x<w.length;x++){const T=p[A[x]];if(!T.extras)continue;const C=T.extras["mapbox:footprint:version"],L=T.extras["mapbox:footprint:id"];(C||L)&&E.add(x),C==="1.0.0"&&L&&(b[L]=x)}for(let x=0;x<w.length;x++){if(E.has(x))continue;const T=w[x],C=p[A[x]];if(!C.extras)continue;let L=null;T.id in b&&(L=RE(w[b[T.id]].meshes,T.matrix)),L||(L=PE(C)),L&&(T.footprint=CE(L))}if(E.size>0){const x=Array.from(E.values()).sort((T,C)=>T-C);for(let T=x.length-1;T>=0;T--)w.splice(x[T],1)}}(g,h,r.json.nodes),g}function DE(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,s=r.aabb.min[1]-1,u=Rd/(r.aabb.max[0]-i+2),a=Rd/(r.aabb.max[1]-s+2);for(let h=0;h<e.length;h+=3){const g=e[h+2],w=(e[h+0]-i)*u|0,A=(e[h+1]-s)*a|0;g>r.heightmap[A*Rd+w]&&(r.heightmap[A*Rd+w]=g)}}function LE(r,e){const i={};i.indexArray=new qn,i.indexArray.reserve(4*r.length),i.vertexArray=new Qa,i.vertexArray.reserve(10*r.length),i.colorArray=new Os,i.vertexArray.reserve(10*r.length);let s=0;for(const h of r){const g=Math.min(10,Math.max(4,1.3*h.height))*e,w=[-h.normal[1],h.normal[0],0],A=Math.min(.29,.1*h.width/h.depth),p=h.width-2*h.depth*e*(A+.01),b=ye.vec3.scaleAndAdd([],h.pos,w,p/2),E=ye.vec3.scaleAndAdd([],h.pos,w,-p/2),x=[b[0],b[1],b[2]+h.height],T=[E[0],E[1],E[2]+h.height],C=ye.vec3.scaleAndAdd([],h.normal,w,A);ye.vec3.scale(C,C,g);const L=ye.vec3.scaleAndAdd([],h.normal,w,-A);ye.vec3.scale(L,L,g),ye.vec3.add(C,b,C),ye.vec3.add(L,E,L),b[2]+=.1,E[2]+=.1,i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]);const k=p/g/2;i.colorArray.emplaceBack(-k-A,-1,k,.8),i.colorArray.emplaceBack(k+A,-1,k,.8),i.colorArray.emplaceBack(-k,0,k,1.3),i.colorArray.emplaceBack(k,0,k,1.3),i.colorArray.emplaceBack(k+A,-.8,k,.7),i.colorArray.emplaceBack(k+A,-.8,k,.7),i.colorArray.emplaceBack(0,0,k,1.3),i.colorArray.emplaceBack(0,0,k,1.3),i.colorArray.emplaceBack(k+A,-1.2,k,.8),i.colorArray.emplaceBack(k+A,-1.2,k,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const u={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=_n.white,u.pbrMetallicRoughness=a,i.material=u,i.aabb=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class jb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Gb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Cl(wt,16,0),this.featureIndexArray=new lp,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,u,a,h=0,g=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,a,h);const A=this.grid;for(let p=0;p<i.length;p++){const b=i[p],E=[1/0,1/0,-1/0,-1/0];for(let x=0;x<b.length;x++){const T=b[x];E[0]=Math.min(E[0],T.x),E[1]=Math.min(E[1],T.y),E[2]=Math.max(E[2],T.x),E[3]=Math.max(E[3],T.y)}g!==0&&(E[0]-=g,E[1]-=g,E[2]+=g,E[3]+=g),E[0]<wt&&E[1]<wt&&E[2]>=0&&E[3]>=0&&A.insert(w,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vh.VectorTile(new Cp(this.rawTileData)).layers,this.sourceLayerCoder=new jb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s){this.loadVTLayers(),this.serializedLayersCache.clear();const u=Eu(e.filter),a=e.tileResult,h=e.transform,g=a.bufferedTilespaceBounds,w=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(E,x,T,C)=>Mn(a.bufferedTilespaceGeometry,E,x,T,C));w.sort(zE);let A=null;h.elevation&&w.length>0&&(A=Bp.create(h.elevation,this.tileID));const p={};let b;for(let E=0;E<w.length;E++){const x=w[E];if(x===b)continue;b=x;const T=this.featureIndexArray.get(x);let C=null;if(this.is3DTile){const L=this.bucketLayerIDs[0][0],k=i[L];if(k.type!=="model")continue;const{queryFeature:V,intersectionZ:j}=k.queryIntersectsMatchingFeature(a,T.featureIndex,u,h);V&&this.appendToResult(p,L,T.featureIndex,V,j)}else this.loadMatchingFeature(p,T,u,e.layers,e.availableImages,i,s,(L,k,V,j=0)=>(C||(C=ke(L,this.tileID.canonical,e.tileTransform)),k.queryIntersectsFeature(a,L,V,C,this.z,e.transform,e.pixelPosMatrix,A,j)))}return p}loadMatchingFeature(e,i,s,u,a,h,g,w){const{featureIndex:A,bucketIndex:p,sourceLayerIndex:b,layoutVertexArrayOffset:E}=i,x=this.bucketLayerIDs[p];if(u.length&&!function(k,V){for(let j=0;j<k.length;j++)if(V.indexOf(k[j])>=0)return!0;return!1}(u,x))return;const T=this.sourceLayerCoder.decode(b),C=this.vtLayers[T].feature(A);if(s.needGeometry){const k=rt(C,!0);if(!s.filter(new Kn(this.tileID.overscaledZ),k,this.tileID.canonical))return}else if(!s.filter(new Kn(this.tileID.overscaledZ),C))return;const L=this.getId(C,T);for(let k=0;k<x.length;k++){const V=x[k];if(u.length&&u.indexOf(V)<0)continue;const j=h[V];if(!j)continue;let B={};L!==void 0&&g&&(B=g.getState(j.sourceLayer||"_geojsonTileLayer",L));const q=!w||w(C,j,B,E);if(!q)continue;const Z=new n_(C,this.z,this.x,this.y,L);let Q=this.serializedLayersCache.get(V);Q||(Q=j.serialize(),Q.id=V,this.serializedLayersCache.set(V,Q)),Z.layer=$i({},Q),Z.tile=this.tileID.canonical,Z.layer.paint=qb(Q.paint,j.paint,C,B,a),Z.layer.layout=qb(Q.layout,j.layout,C,B,a),this.appendToResult(e,V,A,Z,q)}}appendToResult(e,i,s,u,a){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:s,feature:u,intersectionZ:a})}lookupSymbolFeatures(e,i,s,u,a,h,g){const w={};this.loadVTLayers();const A=Eu(u);for(const p of e)this.loadMatchingFeature(w,{bucketIndex:i,sourceLayerIndex:s,featureIndex:p,layoutVertexArrayOffset:0},A,a,h,g);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),a=this.vtFeatures[u];if(a[i])return a[i];const h=this.vtLayers[u].feature(i);return a[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(s=e.properties[u]),typeof s=="boolean"&&(s=Number(s))}return s}}function qb(r,e,i,s,u){return bo(r,(a,h)=>{const g=e instanceof Pl?e.get(h):null;return g&&g.evaluate?g.evaluate(i,s,u):g})}function zE(r,e){return e-r}Vt(Gb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const $b=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $x{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const a=$b[15&s];if(!a)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new $x(g,h,a,e)}constructor(e,i=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const a=$b.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-g%8)%8;if(a<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+g+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Hx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:h,nodeSize:g}=this,w=[0,a.length-1,0],A=[];for(;w.length;){const p=w.pop()||0,b=w.pop()||0,E=w.pop()||0;if(b-E<=g){for(let L=E;L<=b;L++){const k=h[2*L],V=h[2*L+1];k>=e&&k<=s&&V>=i&&V<=u&&A.push(a[L])}continue}const x=E+b>>1,T=h[2*x],C=h[2*x+1];T>=e&&T<=s&&C>=i&&C<=u&&A.push(a[x]),(p===0?e<=T:i<=C)&&(w.push(E),w.push(x-1),w.push(1-p)),(p===0?s>=T:u>=C)&&(w.push(x+1),w.push(b),w.push(1-p))}return A}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:a,nodeSize:h}=this,g=[0,u.length-1,0],w=[],A=s*s;for(;g.length;){const p=g.pop()||0,b=g.pop()||0,E=g.pop()||0;if(b-E<=h){for(let L=E;L<=b;L++)Wb(a[2*L],a[2*L+1],e,i)<=A&&w.push(u[L]);continue}const x=E+b>>1,T=a[2*x],C=a[2*x+1];Wb(T,C,e,i)<=A&&w.push(u[x]),(p===0?e-s<=T:i-s<=C)&&(g.push(E),g.push(x-1),g.push(1-p)),(p===0?e+s>=T:i+s>=C)&&(g.push(x+1),g.push(b),g.push(1-p))}return w}}function Hx(r,e,i,s,u,a){if(u-s<=i)return;const h=s+u>>1;Hb(r,e,h,s,u,a),Hx(r,e,i,s,h-1,1-a),Hx(r,e,i,h+1,u,1-a)}function Hb(r,e,i,s,u,a){for(;u>s;){if(u-s>600){const A=u-s+1,p=i-s+1,b=Math.log(A),E=.5*Math.exp(2*b/3),x=.5*Math.sqrt(b*E*(A-E)/A)*(p-A/2<0?-1:1);Hb(r,e,i,Math.max(s,Math.floor(i-p*E/A+x)),Math.min(u,Math.floor(i+(A-p)*E/A+x)),a)}const h=e[2*i+a];let g=s,w=u;for(f_(r,e,s,i),e[2*u+a]>h&&f_(r,e,s,u);g<w;){for(f_(r,e,g,w),g++,w--;e[2*g+a]<h;)g++;for(;e[2*w+a]>h;)w--}e[2*s+a]===h?f_(r,e,s,w):(w++,f_(r,e,w,u)),w<=i&&(s=w+1),i<=w&&(u=w-1)}}function f_(r,e,i,s){Wx(r,i,s),Wx(e,2*i,2*s),Wx(e,2*i+1,2*s+1)}function Wx(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function Wb(r,e,i,s){const u=r-i,a=e-s;return u*u+a*a}o.$=Yf,o.A=class extends by{},o.B=pl,o.C=ic,o.D=Su,o.E=tc,o.F=Nf,o.G=Ml,o.H=Bf,o.I=Ym,o.J=as,o.K=Rl,o.L=Il,o.M=dc,o.N=Gn,o.O=xl,o.P=he,o.Q=$a,o.R=nh,o.S=co,o.T=Ix,o.U=ah,o.V=by,o.W=Dl,o.X=Uf,o.Y=Za,o.Z=function(r){const e=r.value;let i=[];if(!e)return i;const s=pl(e);return s!=="string"?(i=i.concat([new by(r.key,e,`string expected, "${s}" found`)]),i):(rb(e,!0)||(i=i.concat([new by(r.key,e,`invalid url "${e}"`)])),i)},o._=Ve,o.a=function(r){return pe.API_CDN_URL_REGEX.test(r)},o.a$=Ja,o.a0=Bn,o.a1=ht,o.a2=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Do(r.expression.evaluate(e))}interpolate(r,e,i){return{x:hi(r.x,e.x,i),y:hi(r.y,e.y,i),z:hi(r.z,e.z,i),azimuthal:hi(r.azimuthal,e.azimuthal,i),polar:hi(r.polar,e.polar,i)}}},o.a3=Kn,o.a4=yu,o.a5=Ce,o.a6=ye,o.a7=xi,o.a8=Pl,o.a9=Dc,o.aA=Vi,o.aB=$1,o.aC=K1,o.aD=q1,o.aE=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){const u=document.createElement("source");Uo(r[s])||(i.crossOrigin="Anonymous"),u.src=r[s],i.appendChild(u)}return{cancel:()=>{}}},o.aF=_y,o.aG=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>Nb(e,0,r))},o.aH=Vb,o.aI=class{constructor(r,e,i,s){this.id=r,this.position=e!=null?new R(e[0],e[1]):new R(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(ye.mat4.multiply(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const s=gn.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(s)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=ye.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,s,u,a,h=!1){cb(this.matrix,this,r.transform,this.position,e,i,s,u,a,h)}upload(r){if(!this.uploaded){for(const e of this.nodes)Lx(e,r);for(const e of this.nodes)wy(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)zx(r)}},o.aJ=jr,o.aK=function(r){return r.indexOf(Ll)>=0},o.aL=Pd,o.aM=te,o.aN=re,o.aO=gc,o.aP=qn,o.aQ=Dr,o.aR=zu,o.aS=py,o.aT=function(){Zo.isLoading()||Zo.isLoaded()||Xf()!=="deferred"||wu()},o.aU=Eu,o.aV=rt,o.aW=n_,o.aX=Zc,o.aY=jm,o.aZ=vp,o.a_=ke,o.aa=hi,o.ab=wt,o.ac=Jc,o.ad=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,s]){const u=Do([1,i,s]);return{x:u.x,y:u.y,z:u.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:hi(r.x,e.x,i),y:hi(r.y,e.y,i),z:hi(r.z,e.z,i)}}},o.ae=function(r,e,i=0,s=!0){const u=new he(i,i),a=r.sub(u),h=e.add(u),g=[a,new he(h.x,a.y),h,new he(a.x,h.y)];return s&&g.push(a.clone()),g},o.af=function(r,e){const i=[];for(let s=0;s<r.length;s++){const u=Di(s-1,-1,r.length-1),a=Di(s+1,-1,r.length-1),h=r[s],g=r[a],w=r[u].sub(h).unit(),A=g.sub(h).unit(),p=A.angleWithSep(w.x,w.y),b=w.add(A).unit().mult(-1*e/Math.sin(p/2));i.push(h.add(b))}return i},o.ag=fy,o.ah=Mn,o.ai=function(r,e,i=0){return ye.vec3.fromValues(((e.x-i)*r.scale-r.x)*wt,(e.y*r.scale-r.y)*wt,le(e.z,e.y))},o.aj=dr,o.ak=Og,o.al=function(r){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const a of r)e=Math.min(e,a.x),i=Math.min(i,a.y),s=Math.max(s,a.x),u=Math.max(u,a.y);return{min:new he(e,i),max:new he(s,u)}},o.am=W,o.an=Ui,o.ao=Ee,o.ap=vt,o.aq=to,o.ar=function(r,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in r&&(i[u]=r[u])}return i},o.as=F,o.at=K,o.au=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,s){const u=this.entries[r]=this.entries[r]||{callbacks:[]};if(u.result){const[a,h]=u.result;return this.scheduler?this.scheduler.add(()=>{s(a,h)},e):s(a,h),()=>{}}return u.callbacks.push(s),u.cancel||(u.cancel=i((a,h)=>{u.result=[a,h];for(const g of u.callbacks)this.scheduler?this.scheduler.add(()=>{g(a,h)},e):g(a,h);setTimeout(()=>delete this.entries[r],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(a=>a!==s),u.callbacks.length||(u.cancel(),delete this.entries[r]))}}},o.av=Ph,o.aw=function(r,e,i){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const a=hl(r.request,(h,g,w,A)=>{h?u(h):g&&u(null,{vectorTile:i?void 0:new Vh.VectorTile(new Cp(g)),rawData:g,cacheControl:w,expires:A})});return()=>{a.cancel(),u()}},e)},o.ax=function(r){_r++,_r>yi&&(r.getActor().send("enforceCacheSizeLimit",Ti),_r=0)},o.ay=gt,o.az=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},o.b=function(r){return pe.API_FONTS_REGEX.test(r)},o.b$=Fo,o.b0=Lu,o.b1=aa,o.b2=rr,o.b3=fd,o.b4=Ex,o.b5=function(r,e){const i=Dc(e.zoom);if(i===0)return il(r);const s=fp(r),u=xm(s),a=W(s.getWest())*e.worldSize,h=W(s.getEast())*e.worldSize,g=K(s.getNorth())*e.worldSize,w=K(s.getSouth())*e.worldSize,A=[a,g,0],p=[h,g,0],b=[a,w,0],E=[h,w,0],x=ye.mat4.invert([],e.globeMatrix);return ye.vec3.transformMat4(A,A,x),ye.vec3.transformMat4(p,p,x),ye.vec3.transformMat4(b,b,x),ye.vec3.transformMat4(E,E,x),u[0]=Vl(u[0],b,i),u[1]=Vl(u[1],E,i),u[2]=Vl(u[2],p,i),u[3]=Vl(u[3],A,i),gn.fromPoints(u)},o.b6=pp,o.b7=cd,o.b8=Vl,o.b9=Mu,o.bA=_n,o.bB=Di,o.bC=pt,o.bD=Jl,o.bE=Y,o.bF=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},o.bG=tl,o.bH=Bs,o.bI=Mc,o.bJ=Er,o.bK=Bl,o.bL=R,o.bM=Fn,o.bN=Xi,o.bO=fs,o.bP=Q1,o.bQ=kr,o.bR=$_,o.bS=function(r,e,i,s,u,a,h,g,w){if(w.name==="globe")return $_(r,e,new kr(i,s,u),!1);const A=Pd({z:i,x:s,y:u},w);return new gn([(a+A.x/A.scale)*e,e*(A.y/A.scale),h],[(a+A.x2/A.scale)*e,e*(A.y2/A.scale),g])},o.bT=function(r,e,i){let s=0;for(let u=0;u<2;++u)r[u]>0&&(s+=(r[u]-0)*(r[u]-0)),e[u]<0&&(s+=(0-e[u])*(0-e[u]));return s},o.bU=fe,o.bV=l,o.bW=function(r){const e=ye.mat4.identity(new Float64Array(16));ye.mat4.multiply(e,r.pixelMatrix,r.globeMatrix);const i=[0,f,0],s=[0,_,0];return ye.vec3.transformMat4(i,i,e),ye.vec3.transformMat4(s,s,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!wm(r,new R(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!wm(r,new R(r.center.lat,-90))]},o.bX=function(r,e){const{scale:i}=r.tileTransform,s=i*wt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return ye.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.bY=xy,o.bZ=J1,o.b_=function(r){const e=J1(r,!0);return ye.mat2.invert([],[e[0],e[1],e[4],e[5]])},o.ba=$r,o.bb=Nx,o.bc=Cp,o.bd=hl,o.be=function(r){const e=[];for(const i in r)e.push(r[i]);return e},o.bf=function(r,e){const i=[];for(const s in r)s in e||i.push(s);return i},o.bg=Hi,o.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bi=ct,o.bj=function(r,e){const{x:i,y:s}=r.point,u=Z_(i,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ye.mat4.multiply(u,u,vm(il(e)))},o.bk=qh,o.bl=Gs,o.bm=Ip,o.bn=function(r,e,i,s,u){const a=5*e+2;r.float32[a+0]=i,r.float32[a+1]=s,r.float32[a+2]=u},o.bo=ca,o.bp=ny,o.bq=ot,o.br=Ar,o.bs=jl,o.bt=nb,o.bu=km,o.bv=yd,o.bw=Qm,o.bx=ly,o.by=Ad,o.bz=$x,o.c=we,o.c$=Rn,o.c0=function(r){const{x:e,y:i}=r.point,{lng:s,lat:u}=r._center;return Z_(e,i,r.worldSize,s,u)},o.c1=Xt,o.c2=cn,o.c3=Bh,o.c4=function(r){const e=Math.round((r+45+360)%360/90)%4;return Zt[e]},o.c5=45,o.c6=X,o.c7=Bu,o.c8=function(r,e,i){const s=Math.sqrt(r*r+e*e+i*i),u=s>0?Math.acos(i/s)*xt:0;let a=r!==0||e!==0?Math.atan2(-e,-r)*xt+90:0;return a<0&&(a+=360),[s,a,u]},o.c9=Te,o.cA=function(r){const e=fe-5;r=vt(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(pt(r))),3);return Math.round(i*(c.length-1))},o.cB=function(r,e,i,s){const u=e.getNorth(),a=e.getSouth(),h=e.getWest(),g=e.getEast(),w=1<<r.z,A=g-h,p=u-a,b=A/n,E=-p/c[i],x=[0,b,0,E,0,0,u,h,0];if(r.z>0){const T=180/s;ye.mat3.multiply(x,x,[T/A+1,0,0,0,T/p+1,0,-.5*T/b,.5*T/E,1])}return x[2]=w,x[5]=r.x,x[8]=r.y,x},o.cC=il,o.cD=function(r,e,i){const s=ye.mat4.identity(new Float64Array(16)),u=(e/(1<<r)-.5)*Math.PI*2;return ye.mat4.rotateY(s,i.globeMatrix,u),Float32Array.from(s)},o.cE=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(r.x),a=Math.floor((r.x-u)*s),h=Math.floor(r.y*s),g=this.findDEMTileFor(new Vi(i,u,i,a,h));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const u=s.getSource().maxzoom,a=1<<u,h=Math.floor(r.x),g=r.x-h,w=new Vi(u,h,u,Math.floor(g*a),Math.floor(r.y*a)),A=this.findDEMTileFor(w);if(!A||!A.dem)return e;const p=A.dem,b=1<<A.tileID.canonical.z,E=(g*b-A.tileID.canonical.x)*p.dim,x=(r.y*b-A.tileID.canonical.y)*p.dim,T=Math.floor(E),C=Math.floor(x);return(i?this.exaggeration():1)*hi(hi(p.get(T,C),p.get(T,C+1),x-C),hi(p.get(T+1,C),p.get(T+1,C+1),x-C),E-T)}getAtTileOffset(r,e,i){const s=1<<r.canonical.z;return this.getAtPointOrZero(new Ce(r.wrap+(r.canonical.x+e/wt)/s,(r.canonical.y+i/wt)/s))}getAtTileOffsetFunc(r,e,i,s){return u=>{const a=this.getAtTileOffset(r,u.x,u.y),h=s.upVector(r.canonical,u.x,u.y),g=s.upVectorScale(r.canonical,e,i).metersToTile;return ye.vec3.scale(h,h,a*g),h}}getForTilePoints(r,e,i,s){if(this.isUsingMockSource())return!1;const u=Bp.create(this,r,s);return!!u&&(e.forEach(a=>{a[2]=this.exaggeration()*u.getElevationAt(a[0],a[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<r.canonical.z-s.canonical.z;let a=r.canonical.x/u-s.canonical.x,h=r.canonical.y/u-s.canonical.y,g=0;for(let w=0;w<r.canonical.z-s.canonical.z&&!i.leaves[g];w++){a*=2,h*=2;const A=2*Math.floor(h)+Math.floor(a);g=i.childOffsets[g]+A,a%=1,h%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const u of r){const a=this.getMinMaxForTile(u.tileID);a&&(i=Math.min(i,a.min),s=Math.max(s,a.max),e=!0)}return e?{min:i,max:s}:null}},o.cF=og,o.cG=Pc,o.cH=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},o.cI=W_,o.cJ=ie,o.cK=J,o.cL=256,o.cM=function(r,e){const i=[0,0,0],s=pp(il(e.canonical));return ye.vec3.transformMat4(i,i,s),ye.vec3.transformMat4(i,i,r),i},o.cN=r=>({u_camera_to_center_distance:new Er(r),u_extrude_scale:new Nl(r),u_device_pixel_ratio:new Er(r),u_matrix:new tl(r),u_inv_rot_matrix:new tl(r),u_merc_center:new Bs(r),u_tile_id:new Mc(r),u_zoom_transition:new Er(r),u_up_dir:new Mc(r),u_emissive_strength:new Er(r)}),o.cO=r=>({u_matrix:new tl(r),u_pixels_to_tile_units:new Nl(r),u_device_pixel_ratio:new Er(r),u_units_to_pixels:new Bs(r),u_dash_image:new Bl(r),u_gradient_image:new Bl(r),u_image_height:new Er(r),u_texsize:new Bs(r),u_tile_units_to_pixels:new Er(r),u_alpha_discard_threshold:new Er(r),u_trim_offset:new Bs(r),u_trim_fade_range:new Bs(r),u_trim_color:new Bu(r),u_emissive_strength:new Er(r),u_zbias_factor:new Er(r),u_tile_to_meter:new Er(r)}),o.cP=r=>({u_matrix:new tl(r),u_texsize:new Bs(r),u_pixels_to_tile_units:new Nl(r),u_device_pixel_ratio:new Er(r),u_image:new Bl(r),u_units_to_pixels:new Bs(r),u_tile_units_to_pixels:new Er(r),u_alpha_discard_threshold:new Er(r),u_trim_offset:new Bs(r),u_emissive_strength:new Er(r),u_zbias_factor:new Er(r),u_tile_to_meter:new Er(r)}),o.cQ=vc,o.cR=nx,o.cS=rx,o.cT=K_,o.cU=(r,e,i,s,u,a)=>{const h=r.transform,g=h.projection.name==="globe";let w;if(a.paint.get("circle-pitch-alignment")==="map")if(g){const p=W_(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;w=Float32Array.from([p,0,0,p])}else w=h.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(h.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Lt.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:g0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(g){A.u_inv_rot_matrix=s,A.u_merc_center=u,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Dc(h.zoom);const p=u[0]*wt,b=u[1]*wt;A.u_up_dir=h.projection.upVector(new kr(0,0,0),p,b)}return A},o.cV=Fg,o.cW=(r,e,i,s,u,a)=>{const h=r.transform,g=h.pitch<15?uo(.07,.7,vt((14-h.zoom)/5,0,1)):.07;return{u_matrix:kg(r,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:Ko(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:g,u_tile_to_meter:Te(e.tileID.canonical,0)}},o.cX=(r,e,i,s,u,a,h)=>{const g=r.transform,w=g.calculatePixelsToTileUnitsMatrix(e),A=g.pitch<15?uo(.07,.7,vt((14-g.zoom)/5,0,1)):.07;return{u_matrix:kg(r,e,i,s),u_pixels_to_tile_units:w,u_device_pixel_ratio:a,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:Bg(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ko(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:Te(e.tileID.canonical,0)}},o.cY=mr,o.cZ=hd,o.c_=Cg,o.ca=gn,o.cb=Do,o.cc=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},o.cd=function(r){return r({pluginStatus:ao,pluginURL:zo}),Eh.on("pluginStateChange",r),r},o.ce=Np,o.cf=Ey,o.cg=Wh,o.ch=Km,o.ci=mf,o.cj=mc,o.ck=fi,o.cl=ho,o.cm=er,o.cn=function(r){const e=r.indexOf(Ll);return e>=0?r.slice(0,e):r},o.co=function(r){const e=r.indexOf(Ll);return e>=0?r.slice(e+1):""},o.cp=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.cq=function(r,e,i,s){return r.type==="custom"?new zS(r,e):new HS[r.type](r,e,i,s)},o.cr=ws,o.cs=Eh,o.ct=ul,o.cu=Ic,o.cv=class extends Xo{constructor(r){super(r),this.current=_m}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.cw=$t,o.cx=function(r,e,i){const s=Dc(i.zoom),u=r.style.map._antialias,a=e.options.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return s===0&&!u&&!a},o.cy=function(r){const e=r.pixelsPerMeter,i=e/Y(1,r.center.lat),s=ye.mat4.identity(new Float64Array(16));return ye.mat4.translate(s,s,[r.point.x,r.point.y,0]),ye.mat4.scale(s,s,[i,i,e]),Float32Array.from(s)},o.cz=fp,o.d=function(r){return pe.API_TILEJSON_REGEX.test(r)},o.d$=ue,o.d0=Ap,o.d1=Oc,o.d2=450,o.d3=7,o.d4=LS,o.d5=on,o.d6=Fs,o.d7=256,o.d8=vm,o.d9=Qa,o.dA=X_,o.dB=function(r){const e=[0,0,0],i=ye.mat4.identity(new Float64Array(16));return ye.mat4.multiply(i,r.pixelMatrix,r.globeMatrix),ye.vec3.transformMat4(e,e,i),new he(e[0],e[1])},o.dC=function(r,e,i=!1){if(ao===bu||ao===Ds||ao===mo)throw new Error("setRTLTextPlugin cannot be called multiple times.");zo=Lt.resolveURL(r),ao=bu,Sh=e,ta(),i||wu()},o.dD=Xf,o.dE=function(){Ey().acquire(Ux)},o.dF=function(){const r=c_;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Ux),c_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dG=l_,o.dH=function(r){const e=mn();if(!e)return;const i=e.delete(wi);r&&i.catch(r).then(()=>r())},o.dI=a_,o.dJ=Db,o.dK=function(r){Vx=Lt.resolveURL(r),jp||(jp=new Np(Ey(),new tc)),jp.broadcast("setDracoUrl",Vx)},o.dL=Lb,o.dM=function(r){Vp=Lt.resolveURL(r),jp||(jp=new Np(Ey(),new tc)),jp.broadcast("setMeshoptUrl",Vp)},o.dN=Vt,o.dO=Lc,o.dP=La,o.dQ=jb,o.dR=Gb,o.dS=Dg,o.dT=bo,o.dU=Lp,o.dV=function(r,e,i,s,u,a,h,g,w,A,p=1,b){r.createArrays(),r.tilePixelRatio=wt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const E=r.layers[0].layout,x=r.layers[0]._unevaluatedLayout._values,T={};if(T.scaleFactor=p,T.textSizeScaleRange=E.get("text-size-scale-range"),T.iconSizeScaleRange=E.get("icon-size-scale-range"),T.textScaleFactor=vt(T.scaleFactor,T.textSizeScaleRange[0],T.textSizeScaleRange[1]),T.iconScaleFactor=vt(T.scaleFactor,T.iconSizeScaleRange[0],T.iconSizeScaleRange[1]),r.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:j}=r.textSizeData;T.compositeTextSizes=[x["text-size"].possiblyEvaluate(new Kn(V),g),x["text-size"].possiblyEvaluate(new Kn(j),g)]}if(r.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:j}=r.iconSizeData;T.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new Kn(V),g),x["icon-size"].possiblyEvaluate(new Kn(j),g)]}T.layoutTextSize=x["text-size"].possiblyEvaluate(new Kn(w+1),g),T.layoutIconSize=x["icon-size"].possiblyEvaluate(new Kn(w+1),g),T.textMaxSize=x["text-size"].possiblyEvaluate(new Kn(18),g);const C=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",L=E.get("text-size");let k=!1;for(const V of r.features)if(V.icon&&V.icon.nameSecondary){k=!0;break}for(const V of r.features){const j=E.get("text-font").evaluate(V,{},g).join(","),B=L.evaluate(V,{},g)*T.textScaleFactor,q=T.layoutTextSize.evaluate(V,{},g)*T.textScaleFactor,Z=(T.layoutIconSize.evaluate(V,{},g),{horizontal:{},vertical:void 0}),Q=V.text;let ce,oe=[0,0];if(Q){const se=Q.toString(),be=E.get("text-letter-spacing").evaluate(V,{},g)*Ar,Me=E.get("text-line-height").evaluate(V,{},g)*Ar,Ie=Th(se)?be:0,Le=E.get("text-anchor").evaluate(V,{},g),Ue=E.get("text-variable-anchor");if(!Ue){const Xe=E.get("text-radial-offset").evaluate(V,{},g);oe=Xe?ly(Le,[Xe*Ar,Jm]):E.get("text-offset").evaluate(V,{},g).map(Bt=>Bt*Ar)}let je=C?"center":E.get("text-justify").evaluate(V,{},g);const Fe=E.get("symbol-placement")==="point",tt=Fe?E.get("text-max-width").evaluate(V,{},g)*Ar:1/0,dt=Xe=>{r.allowVerticalPlacement&&Wf(se)&&(Z.vertical=Zm(Q,e,i,u,j,tt,Me,Le,Xe,Ie,oe,Gs.vertical,!0,q,B))};if(!C&&Ue){const Xe=je==="auto"?Ue.map(Et=>Qm(Et)):[je];let Bt=!1;for(let Et=0;Et<Xe.length;Et++){const yt=Xe[Et];if(!Z.horizontal[yt])if(Bt)Z.horizontal[yt]=Z.horizontal[0];else{const ut=Zm(Q,e,i,u,j,tt,Me,"center",yt,Ie,oe,Gs.horizontal,!1,q,B);ut&&(Z.horizontal[yt]=ut,Bt=ut.positionedLines.length===1)}}dt("left")}else{if(je==="auto"&&(je=Qm(Le)),Fe||E.get("text-writing-mode").indexOf("horizontal")>=0||!Wf(se)){const Xe=Zm(Q,e,i,u,j,tt,Me,Le,je,Ie,oe,Gs.horizontal,!1,q,B);Xe&&(Z.horizontal[je]=Xe)}dt(Fe?"left":je)}}let ae=!1;if(V.icon&&V.icon.namePrimary){const se=s[V.icon.namePrimary];se&&(ce=Jg(u[V.icon.namePrimary],V.icon.nameSecondary?u[V.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(V,{},g),E.get("icon-anchor").evaluate(V,{},g)),ae=se.sdf,r.sdfIcons===void 0?r.sdfIcons=se.sdf:r.sdfIcons!==se.sdf&&ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==r.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Se=uy(Z.horizontal)||Z.vertical;r.iconsInText||(r.iconsInText=!!Se&&Se.iconsInText),(Se||ce)&&yx(r,V,Z,ce,s,T,q,0,oe,ae,h,g,A,b,k)}a&&r.generateCollisionDebugBuffers(w,r.collisionBoxArray,T.textScaleFactor)},o.dW=Vh,o.dX=Sy,o.dY=De,o.dZ=bg,o.d_=Hg,o.da=Oo,o.db=Pu,o.dc=function(r,e,i,s,u){return vt((r-e)/(i-e)*(u-s)+s,s,u)},o.dd=Al,o.de=de,o.df=class{constructor(r,e,i,s){this.context=r,this.format=s,this.size=i,this.texture=r.gl.createTexture();const[u,a,h]=this.size,{gl:g}=r;g.bindTexture(g.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,u,a,h,0,Ax(this.format),Mx(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},o.dg=Rx,o.dh=[1,1,1],o.di=Bp,o.dj=Fp,o.dk=el,o.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new he(1/0,1/0),max:new he(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Tg(new he(0,0),new he(wt,wt),r),s=[];if(e&&!Lm(i,this._globalClipBounds))return s;for(const u of this._activeRegions){if(u.hiddenByOverlap||!Lm(i,u))continue;const a=Om(u.min,u.max,r);s.push({min:a.min,max:a.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return s}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(s).buckets[e.layer];u&&u.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),s=r.getClipMask(),u=r.getClipScope();for(const a of e){if(!a.footprint)continue;const h=Tg(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:s,clipScope:u})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Sp(e.min,i.min)||Sp(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,u){const a=(h,g)=>h+g;return s.length-u.length||s.reduce(a,"").localeCompare(u.reduce(a,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];r=i.priority!==s.priority||!wg(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!ct(i.clipScope,s.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Tp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const u=s[i].priority;for(;i<s.length&&s[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let u=i;const a=i;for(;u!==s;){const h=this._activeRegions[u];h.hiddenByOverlap=!1;for(let g=0;g<a;g++){const w=this._activeRegions[g];if(!w.hiddenByOverlap&&h.order===Tp&&Lm(h,w)&&(h.hiddenByOverlap=nl(h.footprint,h.tileId,w.footprint,w.tileId),h.hiddenByOverlap))break}++u}i=s,s=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},o.dm=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Ja,s=new qn,u=[],a=r+1+2,h=e[0]+1,g=e[0]+1+(1+e.length),w=(A,p,b)=>{let E=A===a-1?A-2:A===0?A:A-1;return E+=b?24575:0,[E,p]};for(let A=0;A<a;++A)i.emplaceBack(...w(A,0,!0));for(let A=0;A<h;++A)for(let p=0;p<a;++p)i.emplaceBack(...w(p,A,(p===0||p===a-1)&&!0));for(let A=0;A<e.length;++A){const p=e[A];for(let b=0;b<a;++b)i.emplaceBack(...w(b,p,!0))}for(let A=0;A<e.length;++A){const p=s.length,b=e[A]+1+2,E=new qn;for(let C=0;C<b-1;C++){const L=C===b-2,k=L?a*(g-e.length+A-C):a;for(let V=0;V<a-1;V++){const j=C*a+V;C===0||L||V===0||V===a-2?(E.emplaceBack(j+1,j,j+k),E.emplaceBack(j+k,j+k+1,j+1)):(s.emplaceBack(j+1,j,j+k),s.emplaceBack(j+k,j+k+1,j+1))}}const x=rr.simpleSegment(0,p,i.length,s.length-p);for(let C=0;C<E.uint16.length;C+=3)s.emplaceBack(E.uint16[C],E.uint16[C+1],E.uint16[C+2]);const T=rr.simpleSegment(0,p,i.length,s.length-p);u.push({withoutSkirts:x,withSkirts:T})}return{vertices:i,indices:s,segments:u}}_createGrid(r){const e=this._fillGridMeshWithLods(n,c);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,aa.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new qn;for(let h=0;h<=n;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Oo,s=new Oo,u=new Oo,a=new Oo;this._poleSegments=[];for(let h=0,g=0;h<Bh;h++){const w=360/(1<<h);i.emplaceBack(0,-to,0,.5,0),s.emplaceBack(0,-to,0,.5,1),u.emplaceBack(0,-to,0,.5,.5),a.emplaceBack(0,-to,0,.5,.5);for(let A=0;A<=n;A++){let p=A/n,b=0;const E=hi(0,w,p),[x,T,C]=y(Y_,_0,E,to);i.emplaceBack(x,T,C,p,b),s.emplaceBack(x,T,C,p,1-b);const L=pt(E);p=.5+.5*Math.sin(L),b=.5+.5*Math.cos(L),u.emplaceBack(x,T,C,p,b),a.emplaceBack(x,T,C,p,1-b)}this._poleSegments.push(rr.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,$n,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,$n,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(u,$n,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(a,$n,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},o.dn=Tp,o.dp=Nt,o.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.dr=Mi,o.ds=ge,o.dt=M,o.du=function([r,e,i]){const s=Math.hypot(r,e,i),u=Math.atan2(r,i),a=.5*Math.PI-Math.acos(-e/s);return new R(Xt(u),Xt(a))},o.dv=Px,o.dw=P,o.dx=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(Xc==null){const s=i.navigator?i.navigator.userAgent:null;Xc=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Xc}(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dy=function(r,e){Ti=r,yi=e},o.dz=wm,o.e=pe,o.e0=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==Ob){const i=new Uint32Array(r,0,7),[,,s,u,a,h]=i;e=i.byteLength+u+a+h+a,(s!==r.byteLength||e>=r.byteLength)&&ji("Invalid b3dm header information.")}return Nb(r,e)},o.e1=function(r,e){const i=Vb(r);for(const s of i){for(const u of s.meshes)DE(u);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(LE(s.lights,e)))}return i},o.e2=Ty,o.e3=mb,o.e4=Zo,o.e5=function(r){jn(),rn!=null&&rn.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-r;s++)e.delete(i[s])})})},o.f=function(r){return r.indexOf("mapbox:")===0},o.g=function(r,e){return ul($i(r,{method:"GET"}),e)},o.h=Pe,o.i=function(r){return pe.API_STYLE_REGEX.test(r)&&!we(r)},o.j=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.l=$i,o.m=no,o.n=function(r,e){return ul($i(r,{type:"json"}),e)},o.o=jo,o.p=function(r,e){return ul($i(r,{method:"POST"}),e)},o.q=Lt,o.r=Po,o.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Ys,o.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},o.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},o.w=ji,o.x=Xs,o.y=2,o.z=ry}),$(["./shared"],function(o){function ue(Ze){const J=Ze?Ze.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function Re(Ze){if(typeof Ze=="number"||typeof Ze=="boolean"||typeof Ze=="string"||Ze==null)return JSON.stringify(Ze);if(Array.isArray(Ze)){let ie="[";for(const pe of Ze)ie+=`${Re(pe)},`;return`${ie}]`}let J="{";for(const ie of Object.keys(Ze).sort())J+=`${ie}:${Re(Ze[ie])},`;return`${J}}`}function xe(Ze){let J="";for(const ie of o.bh)J+=`/${Re(Ze[ie])}`;return J}class Oe{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,ie){this._layerConfigs={},this._layers={},this.update(J,[],ie)}update(J,ie,pe){this._options=pe;for(const we of J)this._layerConfigs[we.id]=we,(this._layers[we.id]=o.cq(we,this.scope,null,this._options)).compileFilter(pe),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of ie)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const Pe=function(we,ze){const He={};for(let We=0;We<we.length;We++){const Je=ze&&ze[we[We].id]||xe(we[We]);ze&&(ze[we[We].id]=Je);let Qe=He[Je];Qe||(Qe=He[Je]=[]),Qe.push(we[We])}const Be=[];for(const We in He)Be.push(He[We]);return Be}(o.be(this._layerConfigs),this.keyCache);for(const we of Pe){const ze=we.map(gt=>this._layers[gt.id]),He=ze[0];if(He.visibility==="none")continue;const Be=He.source||"";let We=this.familiesBySource[Be];We||(We=this.familiesBySource[Be]={});const Je=He.sourceLayer||"_geojsonTileLayer";let Qe=We[Je];Qe||(Qe=We[Je]=[]),Qe.push(ze)}}}const Ke=1*o.dP;class st{constructor(J){const ie={},pe=[];for(const He in J){const Be=J[He],We=ie[He]={};for(const Je in Be.glyphs){const Qe=Be.glyphs[+Je];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const gt=Qe.metrics.localGlyph?Ke:1,Lt={x:0,y:0,w:Qe.bitmap.width+2*gt,h:Qe.bitmap.height+2*gt};pe.push(Lt),We[Je]=Lt}}const{w:Pe,h:we}=o.z(pe),ze=new o.dO({width:Pe||1,height:we||1});for(const He in J){const Be=J[He];for(const We in Be.glyphs){const Je=Be.glyphs[+We];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const Qe=ie[He][We],gt=Je.metrics.localGlyph?Ke:1;o.dO.copy(Je.bitmap,ze,{x:0,y:0},{x:Qe.x+gt,y:Qe.y+gt},Je.bitmap)}}this.image=ze,this.positions=ie}}o.dN(st,"GlyphAtlas");class Rt{constructor(J){this.tileID=new o.aA(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=o.aL(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor}parse(J,ie,pe,Pe,we){this.status="parsing",this.data=J,this.collisionBoxArray=new o.aR;const ze=new o.dQ(Object.keys(J.layers).sort()),He=new o.dR(this.tileID,this.promoteId);He.bucketLayerIDs=[];const Be={},We=new o.dS(256,256),Je={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:We,availableImages:pe,brightness:this.brightness},Qe=ie.familiesBySource[this.source];for(const yi in Qe){const pn=J.layers[yi];if(!pn)continue;let rn=!1,Li=!1,mn=!1;for(const no of Qe[yi])no[0].type==="symbol"?rn=!0:Li=!0,no[0].is3D()&&no[0].type!=="model"&&(mn=!0);if(this.extraShadowCaster&&!mn||this.isSymbolTile===!0&&!rn||this.isSymbolTile===!1&&!Li)continue;pn.version===1&&o.w(`Vector tile source "${this.source}" layer "${yi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const jn=ze.encode(yi),_r=[];for(let no=0,wr=0;no<pn.length;no++){const ro=pn.feature(no),pa=He.getId(ro,yi);if(this.localizableLayerIds&&this.localizableLayerIds.has(yi)){const Ts=ro.properties?ro.properties.worldview:null;if(this.worldview&&typeof Ts=="string")if(Ts==="all")ro.properties.$localized=!0;else{if(!Ts.split(",").includes(this.worldview))continue;ro.properties.$localized=!0,ro.properties.worldview=this.worldview}}_r.push({feature:ro,id:pa,index:wr,sourceLayerIndex:jn}),wr++}for(const no of Qe[yi]){const wr=no[0];(!this.extraShadowCaster||wr.is3D()&&wr.type!=="model")&&(this.isSymbolTile!==void 0&&wr.type==="symbol"!==this.isSymbolTile||wr.minzoom&&this.zoom<Math.floor(wr.minzoom)||wr.maxzoom&&this.zoom>=wr.maxzoom||wr.visibility!=="none"&&(It(no,this.zoom,Je.brightness,pe),(Be[wr.id]=wr.createBucket({index:He.bucketLayerIDs.length,layers:no,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(_r,Je,this.tileID.canonical,this.tileTransform),He.bucketLayerIDs.push(no.map(ro=>o.av(ro.id,ro.scope)))))}}let gt,Lt,Ht,fi;We.trim();const wi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ti=()=>{if(gt)return this.status="done",we(gt);if(this.extraShadowCaster)this.status="done",we(null,{buckets:o.be(Be).filter(yi=>!yi.isEmpty()),featureIndex:He,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Je.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Lt&&Ht&&fi){const yi=new st(Lt),pn=new o.dU(Ht,fi,this.lut);for(const rn in Be){const Li=Be[rn];Li instanceof o.aS?(It(Li.layers,this.zoom,Je.brightness,pe),o.dV(Li,Lt,yi.positions,Ht,pn.iconPositions,this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):Li.hasPattern&&(Li instanceof o.aY||Li instanceof o.aZ||Li instanceof o.d0)&&(It(Li.layers,this.zoom,Je.brightness,pe),Li.addFeatures(Je,this.tileID.canonical,pn.patternPositions,pe,this.tileTransform,this.brightness))}this.status="done",we(null,{buckets:o.be(Be).filter(rn=>!rn.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yi.image,lineAtlas:We,imageAtlas:pn,brightness:Je.brightness})}};if(!this.extraShadowCaster){const yi=o.dT(Je.glyphDependencies,Li=>Object.keys(Li).map(Number));Object.keys(yi).length?Pe.send("getGlyphs",{uid:this.uid,stacks:yi,scope:this.scope},(Li,mn)=>{gt||(gt=Li,Lt=mn,Ti())},void 0,!1,wi):Lt={};const pn=Object.keys(Je.iconDependencies);pn.length?Pe.send("getImages",{icons:pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Li,mn)=>{gt||(gt=Li,Ht=mn,Ti())},void 0,!1,wi):Ht={};const rn=Object.keys(Je.patternDependencies);rn.length?Pe.send("getImages",{icons:rn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Li,mn)=>{gt||(gt=Li,fi=mn,Ti())},void 0,!1,wi):fi={}}Ti()}}function It(Ze,J,ie,pe){const Pe=new o.a3(J,{brightness:ie});for(const we of Ze)we.recalculate(Pe,pe)}class ri extends o.E{constructor(J,ie,pe,Pe,we,ze){super(),this.actor=J,this.layerIndex=ie,this.availableImages=pe,this.loadVectorData=we||o.aw,this.loading={},this.loaded={},this.deduped=new o.au(J.scheduler),this.isSpriteLoaded=Pe,this.scheduler=J.scheduler,this.brightness=ze}loadTile(J,ie){const pe=J.uid,Pe=J&&J.request,we=Pe&&Pe.collectResourceTiming,ze=this.loading[pe]=new Rt(J);ze.abort=this.loadVectorData(J,(He,Be)=>{const We=!this.loading[pe];if(delete this.loading[pe],We||He||!Be)return ze.status="done",We||(this.loaded[pe]=ze),ie(He);const Je=Be.rawData,Qe={};Be.expires&&(Qe.expires=Be.expires),Be.cacheControl&&(Qe.cacheControl=Be.cacheControl),ze.vectorTile=Be.vectorTile||new o.dW.VectorTile(new o.bc(Je));const gt=()=>{ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor,(Lt,Ht)=>{if(Lt||!Ht)return ie(Lt);const fi={};if(we){const wi=ue(Pe);wi.length>0&&(fi.resourceTiming=JSON.parse(JSON.stringify(wi)))}ie(null,o.l({rawTileData:Je.slice(0)},Ht,Qe,fi))})};this.isSpriteLoaded?gt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(gt,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):gt()}),this.loaded=this.loaded||{},this.loaded[pe]=ze})}reloadTile(J,ie){const pe=this.loaded,Pe=J.uid;if(pe&&pe[Pe]){const we=pe[Pe];we.scaleFactor=J.scaleFactor,we.showCollisionBoxes=J.showCollisionBoxes,we.projection=J.projection,we.brightness=J.brightness,we.tileTransform=o.aL(J.tileID.canonical,J.projection),we.extraShadowCaster=J.extraShadowCaster,we.lut=J.lut;const ze=(He,Be)=>{const We=we.reloadCallback;We&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,We)),ie(He,Be)};we.status==="parsing"?we.reloadCallback=ze:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,ze):ze())}else ie(null,void 0)}abortTile(J,ie){const pe=J.uid,Pe=this.loading[pe];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[pe]),ie()}removeTile(J,ie){const pe=this.loaded,Pe=J.uid;pe&&pe[Pe]&&delete pe[Pe],ie()}}class ft{loadTile(J,ie){const{uid:pe,encoding:Pe,rawImageData:we,padding:ze}=J,He=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,ze):we;ie(null,new o.dX(pe,He,Pe,ze<1))}getImageData(J,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const pe=this.offscreenCanvasContext.getImageData(-ie,-ie,J.width+2*ie,J.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}o.bb.setPbf(o.bc);class Dt{decodeRasterArray({task:J,buffer:ie},pe){o.bb.performDecoding(ie,J).then(Pe=>{pe(null,Pe)},Pe=>{pe(Pe)})}}const Yt=o.dW.VectorTileFeature.prototype.toGeoJSON;class At{constructor(J){this._feature=J,this.extent=o.ab,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ie of this._feature.geometry)J.push([new o.P(ie[0],ie[1])]);return J}{const J=[];for(const ie of this._feature.geometry){const pe=[];for(const Pe of ie)pe.push(new o.P(Pe[0],Pe[1]));J.push(pe)}return J}}toGeoJSON(J,ie,pe){return Yt.call(this,J,ie,pe)}}class Ri{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.ab,this.length=J.length,this._features=J}feature(J){return new At(this._features[J])}}const Sn=64/4096,Ut=128;class cr{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],ie){for(const pe of J){const Pe=pe.id;if(Pe==null)continue;let we=this.features.get(Pe);we&&this.updateCache(we,ie),pe.geometry?(we=li(pe),this.updateCache(we,ie),this.features.set(Pe,we)):this.features.delete(Pe),this.updateCache(we,ie)}}updateCache(J,ie){for(const{canonical:pe,uid:Pe}of Object.values(ie)){const{z:we,x:ze,y:He}=pe;Xr(J,Math.pow(2,we),ze,He)&&delete ie[Pe]}}getTile(J,ie,pe){const Pe=Math.pow(2,J),we=[];for(const ze of this.features.values())Xr(ze,Pe,ie,pe)&&we.push(bs(ze,Pe,ie,pe));return{features:we}}getFeatures(){return[...this.features.values()]}}function Xr({minX:Ze,minY:J,maxX:ie,maxY:pe},Pe,we,ze){return Ze<(we+1+Sn)/Pe&&J<(ze+1+Sn)/Pe&&ie>(we-Sn)/Pe&&pe>(ze-Sn)/Pe}function li(Ze){const{id:J,geometry:ie,properties:pe}=Ze;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Pe,coordinates:we}=ie,ze={id:J,type:1,geometry:[],tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},He=ze.geometry;if(Pe==="Point")ui(we,He,ze);else if(Pe==="MultiPoint")for(const Be of we)ui(Be,He,ze);else if(Pe==="LineString")ze.type=2,vo(we,He,ze);else if(Pe==="MultiLineString")ze.type=2,Yr(we,He,ze);else if(Pe==="Polygon")ze.type=3,Yr(we,He,ze,!0);else{if(Pe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ze.type=3;for(const Be of we)Yr(Be,He,ze,!0)}return ze}function ui([Ze,J],ie,pe){const Pe=o.am(Ze);let we=o.at(J);we=we<0?0:we>1?1:we,ie.push(Pe,we),pe.minX=Math.min(pe.minX,Pe),pe.minY=Math.min(pe.minY,we),pe.maxX=Math.max(pe.maxX,Pe),pe.maxY=Math.max(pe.maxY,we)}function vo(Ze,J,ie,pe=!1,Pe=!1){const we=[];for(const ze of Ze)ui(ze,we,ie);J.push(we),pe&&function(ze,He){let Be=0;for(let We=0,Je=ze.length,Qe=Je-2;We<Je;Qe=We,We+=2)Be+=(ze[We]-ze[Qe])*(ze[We+1]+ze[Qe+1]);if(Be>0===He)for(let We=0,Je=ze.length;We<Je/2;We+=2){const Qe=ze[We],gt=ze[We+1];ze[We]=ze[Je-2-We],ze[We+1]=ze[Je-1-We],ze[Je-2-We]=Qe,ze[Je-1-We]=gt}}(we,Pe)}function Yr(Ze,J,ie,pe=!1){for(let Pe=0;Pe<Ze.length;Pe++)vo(Ze[Pe],J,ie,pe,Pe===0)}function bs(Ze,J,ie,pe){const{id:Pe,type:we,geometry:ze,tags:He}=Ze,Be=[];if(we===1)(function(We,Je,Qe,gt,Lt){for(let Ht=0;Ht<We.length;Ht+=2){const fi=Math.round(o.ab*(We[Ht+0]*Je-Qe)),wi=Math.round(o.ab*(We[Ht+1]*Je-gt));Lt.push([fi,wi])}})(ze,J,ie,pe,Be);else for(const We of ze)Ei(We,J,ie,pe,Be);return{id:Pe,type:we,geometry:Be,tags:He}}function Ei(Ze,J,ie,pe,Pe){const we=-Ut,ze=o.ab+Ut;let He;for(let Be=0;Be<Ze.length-2;Be+=2){let We=Math.round(o.ab*(Ze[Be+0]*J-ie)),Je=Math.round(o.ab*(Ze[Be+1]*J-pe)),Qe=Math.round(o.ab*(Ze[Be+2]*J-ie)),gt=Math.round(o.ab*(Ze[Be+3]*J-pe));const Lt=Qe-We,Ht=gt-Je;We<we&&Qe<we||(We<we?(Je+=Math.round(Ht*((we-We)/Lt)),We=we):Qe<we&&(gt=Je+Math.round(Ht*((we-We)/Lt)),Qe=we),Je<we&&gt<we||(Je<we?(We+=Math.round(Lt*((we-Je)/Ht)),Je=we):gt<we&&(Qe=We+Math.round(Lt*((we-Je)/Ht)),gt=we),We>=ze&&Qe>=ze||(We>=ze?(Je+=Math.round(Ht*((ze-We)/Lt)),We=ze):Qe>=ze&&(gt=Je+Math.round(Ht*((ze-We)/Lt)),Qe=ze),Je>=ze&&gt>=ze||(Je>=ze?(We+=Math.round(Lt*((ze-Je)/Ht)),Je=ze):gt>=ze&&(Qe=We+Math.round(Lt*((ze-Je)/Ht)),gt=ze),He&&We===He[He.length-1][0]&&Je===He[He.length-1][1]||(He=[[We,Je]],Pe.push(He)),He.push([Qe,gt])))))}}var zn,tn,nn,_i={exports:{}},Kr=function(){if(nn)return _i.exports;nn=1;var Ze=o.d_(),J=function(){if(tn)return zn;tn=1;var Je=o.dY(),Qe=o.dZ().VectorTileFeature;function gt(Ht,fi){this.options=fi||{},this.features=Ht,this.length=Ht.length}function Lt(Ht,fi){this.id=typeof Ht.id=="number"?Ht.id:void 0,this.type=Ht.type,this.rawGeometry=Ht.type===1?[Ht.geometry]:Ht.geometry,this.properties=Ht.tags,this.extent=fi||4096}return zn=gt,gt.prototype.feature=function(Ht){return new Lt(this.features[Ht],this.options.extent)},Lt.prototype.loadGeometry=function(){var Ht=this.rawGeometry;this.geometry=[];for(var fi=0;fi<Ht.length;fi++){for(var wi=Ht[fi],Ti=[],yi=0;yi<wi.length;yi++)Ti.push(new Je(wi[yi][0],wi[yi][1]));this.geometry.push(Ti)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ht=this.geometry,fi=1/0,wi=-1/0,Ti=1/0,yi=-1/0,pn=0;pn<Ht.length;pn++)for(var rn=Ht[pn],Li=0;Li<rn.length;Li++){var mn=rn[Li];fi=Math.min(fi,mn.x),wi=Math.max(wi,mn.x),Ti=Math.min(Ti,mn.y),yi=Math.max(yi,mn.y)}return[fi,Ti,wi,yi]},Lt.prototype.toGeoJSON=Qe.prototype.toGeoJSON,zn}();function ie(Je){var Qe=new Ze;return function(gt,Lt){for(var Ht in gt.layers)Lt.writeMessage(3,pe,gt.layers[Ht])}(Je,Qe),Qe.finish()}function pe(Je,Qe){var gt;Qe.writeVarintField(15,Je.version||1),Qe.writeStringField(1,Je.name||""),Qe.writeVarintField(5,Je.extent||4096);var Lt={keys:[],values:[],keycache:{},valuecache:{}};for(gt=0;gt<Je.length;gt++)Lt.feature=Je.feature(gt),Qe.writeMessage(2,Pe,Lt);var Ht=Lt.keys;for(gt=0;gt<Ht.length;gt++)Qe.writeStringField(3,Ht[gt]);var fi=Lt.values;for(gt=0;gt<fi.length;gt++)Qe.writeMessage(4,We,fi[gt])}function Pe(Je,Qe){var gt=Je.feature;gt.id!==void 0&&Qe.writeVarintField(1,gt.id),Qe.writeMessage(2,we,Je),Qe.writeVarintField(3,gt.type),Qe.writeMessage(4,Be,gt)}function we(Je,Qe){var gt=Je.feature,Lt=Je.keys,Ht=Je.values,fi=Je.keycache,wi=Je.valuecache;for(var Ti in gt.properties){var yi=gt.properties[Ti],pn=fi[Ti];if(yi!==null){pn===void 0&&(Lt.push(Ti),fi[Ti]=pn=Lt.length-1),Qe.writeVarint(pn);var rn=typeof yi;rn!=="string"&&rn!=="boolean"&&rn!=="number"&&(yi=JSON.stringify(yi));var Li=rn+":"+yi,mn=wi[Li];mn===void 0&&(Ht.push(yi),wi[Li]=mn=Ht.length-1),Qe.writeVarint(mn)}}}function ze(Je,Qe){return(Qe<<3)+(7&Je)}function He(Je){return Je<<1^Je>>31}function Be(Je,Qe){for(var gt=Je.loadGeometry(),Lt=Je.type,Ht=0,fi=0,wi=gt.length,Ti=0;Ti<wi;Ti++){var yi=gt[Ti],pn=1;Lt===1&&(pn=yi.length),Qe.writeVarint(ze(1,pn));for(var rn=Lt===3?yi.length-1:yi.length,Li=0;Li<rn;Li++){Li===1&&Lt!==1&&Qe.writeVarint(ze(2,rn-1));var mn=yi[Li].x-Ht,jn=yi[Li].y-fi;Qe.writeVarint(He(mn)),Qe.writeVarint(He(jn)),Ht+=mn,fi+=jn}Lt===3&&Qe.writeVarint(ze(7,1))}}function We(Je,Qe){var gt=typeof Je;gt==="string"?Qe.writeStringField(1,Je):gt==="boolean"?Qe.writeBooleanField(7,Je):gt==="number"&&(Je%1!=0?Qe.writeDoubleField(3,Je):Je<0?Qe.writeSVarintField(6,Je):Qe.writeVarintField(5,Je))}return _i.exports=ie,_i.exports.fromVectorTileJs=ie,_i.exports.fromGeojsonVt=function(Je,Qe){Qe=Qe||{};var gt={};for(var Lt in Je)gt[Lt]=new J(Je[Lt].features,Qe),gt[Lt].name=Lt,gt[Lt].version=Qe.version,gt[Lt].extent=Qe.extent;return ie({layers:gt})},_i.exports.GeoJSONWrapper=J,_i.exports}(),ur=o.d$(Kr);const Pr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ze=>Ze},gi=Math.fround||(ts=new Float32Array(1),Ze=>(ts[0]=+Ze,ts[0]));var ts;const Rr=3,Qn=5,Mt=6;class si{constructor(J){this.options=Object.assign(Object.create(Pr),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:ie,minZoom:pe,maxZoom:Pe}=this.options;ie&&console.time("total time");const we=`prepare ${J.length} points`;ie&&console.time(we),this.points=J;const ze=[];for(let Be=0;Be<J.length;Be++){const We=J[Be];if(!We.geometry)continue;const[Je,Qe]=We.geometry.coordinates,gt=gi(sn(Je)),Lt=gi(Cn(Qe));ze.push(gt,Lt,1/0,Be,-1,1),this.options.reduce&&ze.push(0)}let He=this.trees[Pe+1]=this._createTree(ze);ie&&console.timeEnd(we);for(let Be=Pe;Be>=pe;Be--){const We=+Date.now();He=this.trees[Be]=this._createTree(this._cluster(He,Be)),ie&&console.log("z%d: %d clusters in %dms",Be,He.numItems,+Date.now()-We)}return ie&&console.timeEnd("total time"),this}getClusters(J,ie){let pe=((J[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,J[1]));let we=J[2]===180?180:((J[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)pe=-180,we=180;else if(pe>we){const Qe=this.getClusters([pe,Pe,180,ze],ie),gt=this.getClusters([-180,Pe,we,ze],ie);return Qe.concat(gt)}const He=this.trees[this._limitZoom(ie)],Be=He.range(sn(pe),Cn(ze),sn(we),Cn(Pe)),We=He.data,Je=[];for(const Qe of Be){const gt=this.stride*Qe;Je.push(We[gt+Qn]>1?ii(We,gt,this.clusterProps):this.points[We[gt+Rr]])}return Je}getChildren(J){const ie=this._getOriginId(J),pe=this._getOriginZoom(J),Pe="No cluster with the specified id.",we=this.trees[pe];if(!we)throw new Error(Pe);const ze=we.data;if(ie*this.stride>=ze.length)throw new Error(Pe);const He=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),Be=we.within(ze[ie*this.stride],ze[ie*this.stride+1],He),We=[];for(const Je of Be){const Qe=Je*this.stride;ze[Qe+4]===J&&We.push(ze[Qe+Qn]>1?ii(ze,Qe,this.clusterProps):this.points[ze[Qe+Rr]])}if(We.length===0)throw new Error(Pe);return We}getLeaves(J,ie,pe){const Pe=[];return this._appendLeaves(Pe,J,ie=ie||10,pe=pe||0,0),Pe}getTile(J,ie,pe){const Pe=this.trees[this._limitZoom(J)],we=Math.pow(2,J),{extent:ze,radius:He}=this.options,Be=He/ze,We=(pe-Be)/we,Je=(pe+1+Be)/we,Qe={features:[]};return this._addTileFeatures(Pe.range((ie-Be)/we,We,(ie+1+Be)/we,Je),Pe.data,ie,pe,we,Qe),ie===0&&this._addTileFeatures(Pe.range(1-Be/we,We,1,Je),Pe.data,we,pe,we,Qe),ie===we-1&&this._addTileFeatures(Pe.range(0,We,Be/we,Je),Pe.data,-1,pe,we,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(J){let ie=this._getOriginZoom(J)-1;for(;ie<=this.options.maxZoom;){const pe=this.getChildren(J);if(ie++,pe.length!==1)break;J=pe[0].properties.cluster_id}return ie}_appendLeaves(J,ie,pe,Pe,we){const ze=this.getChildren(ie);for(const He of ze){const Be=He.properties;if(Be&&Be.cluster?we+Be.point_count<=Pe?we+=Be.point_count:we=this._appendLeaves(J,Be.cluster_id,pe,Pe,we):we<Pe?we++:J.push(He),J.length===pe)break}return we}_createTree(J){const ie=new o.bz(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<J.length;pe+=this.stride)ie.add(J[pe],J[pe+1]);return ie.finish(),ie.data=J,ie}_addTileFeatures(J,ie,pe,Pe,we,ze){for(const He of J){const Be=He*this.stride,We=ie[Be+Qn]>1;let Je,Qe,gt;if(We)Je=ye(ie,Be,this.clusterProps),Qe=ie[Be],gt=ie[Be+1];else{const fi=this.points[ie[Be+Rr]];Je=fi.properties;const[wi,Ti]=fi.geometry.coordinates;Qe=sn(wi),gt=Cn(Ti)}const Lt={type:1,geometry:[[Math.round(this.options.extent*(Qe*we-pe)),Math.round(this.options.extent*(gt*we-Pe))]],tags:Je};let Ht;Ht=We||this.options.generateId?ie[Be+Rr]:this.points[ie[Be+Rr]].id,Ht!==void 0&&(Lt.id=Ht),ze.features.push(Lt)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,ie){const{radius:pe,extent:Pe,reduce:we,minPoints:ze}=this.options,He=pe/(Pe*Math.pow(2,ie)),Be=J.data,We=[],Je=this.stride;for(let Qe=0;Qe<Be.length;Qe+=Je){if(Be[Qe+2]<=ie)continue;Be[Qe+2]=ie;const gt=Be[Qe],Lt=Be[Qe+1],Ht=J.within(Be[Qe],Be[Qe+1],He),fi=Be[Qe+Qn];let wi=fi;for(const Ti of Ht){const yi=Ti*Je;Be[yi+2]>ie&&(wi+=Be[yi+Qn])}if(wi>fi&&wi>=ze){let Ti,yi=gt*fi,pn=Lt*fi,rn=-1;const Li=(Qe/Je<<5)+(ie+1)+this.points.length;for(const mn of Ht){const jn=mn*Je;if(Be[jn+2]<=ie)continue;Be[jn+2]=ie;const _r=Be[jn+Qn];yi+=Be[jn]*_r,pn+=Be[jn+1]*_r,Be[jn+4]=Li,we&&(Ti||(Ti=this._map(Be,Qe,!0),rn=this.clusterProps.length,this.clusterProps.push(Ti)),we(Ti,this._map(Be,jn)))}Be[Qe+4]=Li,We.push(yi/wi,pn/wi,1/0,Li,-1,wi),we&&We.push(rn)}else{for(let Ti=0;Ti<Je;Ti++)We.push(Be[Qe+Ti]);if(wi>1)for(const Ti of Ht){const yi=Ti*Je;if(!(Be[yi+2]<=ie)){Be[yi+2]=ie;for(let pn=0;pn<Je;pn++)We.push(Be[yi+pn])}}}}return We}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ie,pe){if(J[ie+Qn]>1){const ze=this.clusterProps[J[ie+Mt]];return pe?Object.assign({},ze):ze}const Pe=this.points[J[ie+Rr]].properties,we=this.options.map(Pe);return pe&&we===Pe?Object.assign({},we):we}}function ii(Ze,J,ie){return{type:"Feature",id:Ze[J+Rr],properties:ye(Ze,J,ie),geometry:{type:"Point",coordinates:[(pe=Ze[J],360*(pe-.5)),De(Ze[J+1])]}};var pe}function ye(Ze,J,ie){const pe=Ze[J+Qn],Pe=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,we=Ze[J+Mt],ze=we===-1?{}:Object.assign({},ie[we]);return Object.assign(ze,{cluster:!0,cluster_id:Ze[J+Rr],point_count:pe,point_count_abbreviated:Pe})}function sn(Ze){return Ze/360+.5}function Cn(Ze){const J=Math.sin(Ze*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function De(Ze){const J=(180-360*Ze)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function he(Ze,J,ie,pe){let Pe=pe;const we=J+(ie-J>>1);let ze,He=ie-J;const Be=Ze[J],We=Ze[J+1],Je=Ze[ie],Qe=Ze[ie+1];for(let gt=J+3;gt<ie;gt+=3){const Lt=ct(Ze[gt],Ze[gt+1],Be,We,Je,Qe);if(Lt>Pe)ze=gt,Pe=Lt;else if(Lt===Pe){const Ht=Math.abs(gt-we);Ht<He&&(ze=gt,He=Ht)}}Pe>pe&&(ze-J>3&&he(Ze,J,ze,pe),Ze[ze+2]=Pe,ie-ze>3&&he(Ze,ze,ie,pe))}function ct(Ze,J,ie,pe,Pe,we){let ze=Pe-ie,He=we-pe;if(ze!==0||He!==0){const Be=((Ze-ie)*ze+(J-pe)*He)/(ze*ze+He*He);Be>1?(ie=Pe,pe=we):Be>0&&(ie+=ze*Be,pe+=He*Be)}return ze=Ze-ie,He=J-pe,ze*ze+He*He}function Ct(Ze,J,ie,pe){const Pe={id:Ze??null,type:J,geometry:ie,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")xt(Pe,ie);else if(J==="Polygon")xt(Pe,ie[0]);else if(J==="MultiLineString")for(const we of ie)xt(Pe,we);else if(J==="MultiPolygon")for(const we of ie)xt(Pe,we[0]);return Pe}function xt(Ze,J){for(let ie=0;ie<J.length;ie+=3)Ze.minX=Math.min(Ze.minX,J[ie]),Ze.minY=Math.min(Ze.minY,J[ie+1]),Ze.maxX=Math.max(Ze.maxX,J[ie]),Ze.maxY=Math.max(Ze.maxY,J[ie+1])}function pt(Ze,J,ie,pe){if(!J.geometry)return;const Pe=J.geometry.coordinates;if(Pe&&Pe.length===0)return;const we=J.geometry.type,ze=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let He=[],Be=J.id;if(ie.promoteId?Be=J.properties[ie.promoteId]:ie.generateId&&(Be=pe||0),we==="Point")Xt(Pe,He);else if(we==="MultiPoint")for(const We of Pe)Xt(We,He);else if(we==="LineString")Zt(Pe,He,ze,!1);else if(we==="MultiLineString"){if(ie.lineMetrics){for(const We of Pe)He=[],Zt(We,He,ze,!1),Ze.push(Ct(Be,"LineString",He,J.properties));return}$t(Pe,He,ze,!1)}else if(we==="Polygon")$t(Pe,He,ze,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const We of J.geometry.geometries)pt(Ze,{id:Be,geometry:We,properties:J.properties},ie,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of Pe){const Je=[];$t(We,Je,ze,!0),He.push(Je)}}Ze.push(Ct(Be,we,He,J.properties))}function Xt(Ze,J){J.push(Nt(Ze[0]),Mi(Ze[1]),0)}function Zt(Ze,J,ie,pe){let Pe,we,ze=0;for(let Be=0;Be<Ze.length;Be++){const We=Nt(Ze[Be][0]),Je=Mi(Ze[Be][1]);J.push(We,Je,0),Be>0&&(ze+=pe?(Pe*Je-We*we)/2:Math.sqrt(Math.pow(We-Pe,2)+Math.pow(Je-we,2))),Pe=We,we=Je}const He=J.length-3;J[2]=1,he(J,0,He,ie),J[He+2]=1,J.size=Math.abs(ze),J.start=0,J.end=J.size}function $t(Ze,J,ie,pe){for(let Pe=0;Pe<Ze.length;Pe++){const we=[];Zt(Ze[Pe],we,ie,pe),J.push(we)}}function Nt(Ze){return Ze/360+.5}function Mi(Ze){const J=Math.sin(Ze*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function vt(Ze,J,ie,pe,Pe,we,ze,He){if(pe/=J,we>=(ie/=J)&&ze<pe)return Ze;if(ze<ie||we>=pe)return null;const Be=[];for(const We of Ze){const Je=We.geometry;let Qe=We.type;const gt=Pe===0?We.minX:We.minY,Lt=Pe===0?We.maxX:We.maxY;if(gt>=ie&&Lt<pe){Be.push(We);continue}if(Lt<ie||gt>=pe)continue;let Ht=[];if(Qe==="Point"||Qe==="MultiPoint")xi(Je,Ht,ie,pe,Pe);else if(Qe==="LineString")Di(Je,Ht,ie,pe,Pe,!1,He.lineMetrics);else if(Qe==="MultiLineString")$i(Je,Ht,ie,pe,Pe,!1);else if(Qe==="Polygon")$i(Je,Ht,ie,pe,Pe,!0);else if(Qe==="MultiPolygon")for(const fi of Je){const wi=[];$i(fi,wi,ie,pe,Pe,!0),wi.length&&Ht.push(wi)}if(Ht.length){if(He.lineMetrics&&Qe==="LineString"){for(const fi of Ht)Be.push(Ct(We.id,Qe,fi,We.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Ht.length===1?(Qe="LineString",Ht=Ht[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Ht.length===3?"Point":"MultiPoint"),Be.push(Ct(We.id,Qe,Ht,We.tags))}}return Be.length?Be:null}function xi(Ze,J,ie,pe,Pe){for(let we=0;we<Ze.length;we+=3){const ze=Ze[we+Pe];ze>=ie&&ze<=pe&&Yi(J,Ze[we],Ze[we+1],Ze[we+2])}}function Di(Ze,J,ie,pe,Pe,we,ze){let He=Hi(Ze);const Be=Pe===0?Dr:mr;let We,Je,Qe=Ze.start;for(let wi=0;wi<Ze.length-3;wi+=3){const Ti=Ze[wi],yi=Ze[wi+1],pn=Ze[wi+2],rn=Ze[wi+3],Li=Ze[wi+4],mn=Pe===0?Ti:yi,jn=Pe===0?rn:Li;let _r=!1;ze&&(We=Math.sqrt(Math.pow(Ti-rn,2)+Math.pow(yi-Li,2))),mn<ie?jn>ie&&(Je=Be(He,Ti,yi,rn,Li,ie),ze&&(He.start=Qe+We*Je)):mn>pe?jn<pe&&(Je=Be(He,Ti,yi,rn,Li,pe),ze&&(He.start=Qe+We*Je)):Yi(He,Ti,yi,pn),jn<ie&&mn>=ie&&(Je=Be(He,Ti,yi,rn,Li,ie),_r=!0),jn>pe&&mn<=pe&&(Je=Be(He,Ti,yi,rn,Li,pe),_r=!0),!we&&_r&&(ze&&(He.end=Qe+We*Je),J.push(He),He=Hi(Ze)),ze&&(Qe+=We)}let gt=Ze.length-3;const Lt=Ze[gt],Ht=Ze[gt+1],fi=Pe===0?Lt:Ht;fi>=ie&&fi<=pe&&Yi(He,Lt,Ht,Ze[gt+2]),gt=He.length-3,we&&gt>=3&&(He[gt]!==He[0]||He[gt+1]!==He[1])&&Yi(He,He[0],He[1],He[2]),He.length&&J.push(He)}function Hi(Ze){const J=[];return J.size=Ze.size,J.start=Ze.start,J.end=Ze.end,J}function $i(Ze,J,ie,pe,Pe,we){for(const ze of Ze)Di(ze,J,ie,pe,Pe,we,!1)}function Yi(Ze,J,ie,pe){Ze.push(J,ie,pe)}function Dr(Ze,J,ie,pe,Pe,we){const ze=(we-J)/(pe-J);return Yi(Ze,we,ie+(Pe-ie)*ze,1),ze}function mr(Ze,J,ie,pe,Pe,we){const ze=(we-ie)/(Pe-ie);return Yi(Ze,J+(pe-J)*ze,we,1),ze}function jr(Ze,J){const ie=[];for(let pe=0;pe<Ze.length;pe++){const Pe=Ze[pe],we=Pe.type;let ze;if(we==="Point"||we==="MultiPoint"||we==="LineString")ze=hr(Pe.geometry,J);else if(we==="MultiLineString"||we==="Polygon"){ze=[];for(const He of Pe.geometry)ze.push(hr(He,J))}else if(we==="MultiPolygon"){ze=[];for(const He of Pe.geometry){const Be=[];for(const We of He)Be.push(hr(We,J));ze.push(Be)}}ie.push(Ct(Pe.id,we,ze,Pe.tags))}return ie}function hr(Ze,J){const ie=[];ie.size=Ze.size,Ze.start!==void 0&&(ie.start=Ze.start,ie.end=Ze.end);for(let pe=0;pe<Ze.length;pe+=3)ie.push(Ze[pe]+J,Ze[pe+1],Ze[pe+2]);return ie}function bo(Ze,J){if(Ze.transformed)return Ze;const ie=1<<Ze.z,pe=Ze.x,Pe=Ze.y;for(const we of Ze.features){const ze=we.geometry,He=we.type;if(we.geometry=[],He===1)for(let Be=0;Be<ze.length;Be+=2)we.geometry.push(ws(ze[Be],ze[Be+1],J,ie,pe,Pe));else for(let Be=0;Be<ze.length;Be++){const We=[];for(let Je=0;Je<ze[Be].length;Je+=2)We.push(ws(ze[Be][Je],ze[Be][Je+1],J,ie,pe,Pe));we.geometry.push(We)}}return Ze.transformed=!0,Ze}function ws(Ze,J,ie,pe,Pe,we){return[Math.round(ie*(Ze*pe-Pe)),Math.round(ie*(J*pe-we))]}function er(Ze,J,ie,pe,Pe){const we=J===Pe.maxZoom?0:Pe.tolerance/((1<<J)*Pe.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:Ze.length,source:null,x:ie,y:pe,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const He of Ze)io(ze,He,we,Pe);return ze}function io(Ze,J,ie,pe){const Pe=J.geometry,we=J.type,ze=[];if(Ze.minX=Math.min(Ze.minX,J.minX),Ze.minY=Math.min(Ze.minY,J.minY),Ze.maxX=Math.max(Ze.maxX,J.maxX),Ze.maxY=Math.max(Ze.maxY,J.maxY),we==="Point"||we==="MultiPoint")for(let He=0;He<Pe.length;He+=3)ze.push(Pe[He],Pe[He+1]),Ze.numPoints++,Ze.numSimplified++;else if(we==="LineString")ji(ze,Pe,Ze,ie,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let He=0;He<Pe.length;He++)ji(ze,Pe[He],Ze,ie,we==="Polygon",He===0);else if(we==="MultiPolygon")for(let He=0;He<Pe.length;He++){const Be=Pe[He];for(let We=0;We<Be.length;We++)ji(ze,Be[We],Ze,ie,!0,We===0)}if(ze.length){let He=J.tags||null;if(we==="LineString"&&pe.lineMetrics){He={};for(const We in J.tags)He[We]=J.tags[We];He.mapbox_clip_start=Pe.start/Pe.size,He.mapbox_clip_end=Pe.end/Pe.size}const Be={geometry:ze,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:He};J.id!==null&&(Be.id=J.id),Ze.features.push(Be)}}function ji(Ze,J,ie,pe,Pe,we){const ze=pe*pe;if(pe>0&&J.size<(Pe?ze:pe))return void(ie.numPoints+=J.length/3);const He=[];for(let Be=0;Be<J.length;Be+=3)(pe===0||J[Be+2]>ze)&&(ie.numSimplified++,He.push(J[Be],J[Be+1])),ie.numPoints++;Pe&&function(Be,We){let Je=0;for(let Qe=0,gt=Be.length,Lt=gt-2;Qe<gt;Lt=Qe,Qe+=2)Je+=(Be[Qe]-Be[Lt])*(Be[Qe+1]+Be[Lt+1]);if(Je>0===We)for(let Qe=0,gt=Be.length;Qe<gt/2;Qe+=2){const Lt=Be[Qe],Ht=Be[Qe+1];Be[Qe]=Be[gt-2-Qe],Be[Qe+1]=Be[gt-1-Qe],Be[gt-2-Qe]=Lt,Be[gt-1-Qe]=Ht}}(He,we),Ze.push(He)}const Zs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class th{constructor(J,ie){const pe=(ie=this.options=function(we,ze){for(const He in ze)we[He]=ze[He];return we}(Object.create(Zs),ie)).debug;if(pe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(we,ze){const He=[];if(we.type==="FeatureCollection")for(let Be=0;Be<we.features.length;Be++)pt(He,we.features[Be],ze,Be);else pt(He,we.type==="Feature"?we:{geometry:we},ze);return He}(J,ie);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(we,ze){const He=ze.buffer/ze.extent;let Be=we;const We=vt(we,1,-1-He,He,0,-1,2,ze),Je=vt(we,1,1-He,2+He,0,-1,2,ze);return(We||Je)&&(Be=vt(we,1,-He,1+He,0,-1,2,ze)||[],We&&(Be=jr(We,1).concat(Be)),Je&&(Be=Be.concat(jr(Je,-1)))),Be}(Pe,ie),Pe.length&&this.splitTile(Pe,0,0,0),pe&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,ie,pe,Pe,we,ze,He){const Be=[J,ie,pe,Pe],We=this.options,Je=We.debug;for(;Be.length;){Pe=Be.pop(),pe=Be.pop(),ie=Be.pop(),J=Be.pop();const Qe=1<<ie,gt=Do(ie,pe,Pe);let Lt=this.tiles[gt];if(!Lt&&(Je>1&&console.time("creation"),Lt=this.tiles[gt]=er(J,ie,pe,Pe,We),this.tileCoords.push({z:ie,x:pe,y:Pe}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,pe,Pe,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));const _r=`z${ie}`;this.stats[_r]=(this.stats[_r]||0)+1,this.total++}if(Lt.source=J,we==null){if(ie===We.indexMaxZoom||Lt.numPoints<=We.indexMaxPoints)continue}else{if(ie===We.maxZoom||ie===we)continue;if(we!=null){const _r=we-ie;if(pe!==ze>>_r||Pe!==He>>_r)continue}}if(Lt.source=null,J.length===0)continue;Je>1&&console.time("clipping");const Ht=.5*We.buffer/We.extent,fi=.5-Ht,wi=.5+Ht,Ti=1+Ht;let yi=null,pn=null,rn=null,Li=null,mn=vt(J,Qe,pe-Ht,pe+wi,0,Lt.minX,Lt.maxX,We),jn=vt(J,Qe,pe+fi,pe+Ti,0,Lt.minX,Lt.maxX,We);J=null,mn&&(yi=vt(mn,Qe,Pe-Ht,Pe+wi,1,Lt.minY,Lt.maxY,We),pn=vt(mn,Qe,Pe+fi,Pe+Ti,1,Lt.minY,Lt.maxY,We),mn=null),jn&&(rn=vt(jn,Qe,Pe-Ht,Pe+wi,1,Lt.minY,Lt.maxY,We),Li=vt(jn,Qe,Pe+fi,Pe+Ti,1,Lt.minY,Lt.maxY,We),jn=null),Je>1&&console.timeEnd("clipping"),Be.push(yi||[],ie+1,2*pe,2*Pe),Be.push(pn||[],ie+1,2*pe,2*Pe+1),Be.push(rn||[],ie+1,2*pe+1,2*Pe),Be.push(Li||[],ie+1,2*pe+1,2*Pe+1)}}getTile(J,ie,pe){J=+J,ie=+ie,pe=+pe;const Pe=this.options,{extent:we,debug:ze}=Pe;if(J<0||J>24)return null;const He=1<<J,Be=Do(J,ie=ie+He&He-1,pe);if(this.tiles[Be])return bo(this.tiles[Be],we);ze>1&&console.log("drilling down to z%d-%d-%d",J,ie,pe);let We,Je=J,Qe=ie,gt=pe;for(;!We&&Je>0;)Je--,Qe>>=1,gt>>=1,We=this.tiles[Do(Je,Qe,gt)];return We&&We.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",Je,Qe,gt),console.time("drilling down")),this.splitTile(We.source,Je,Qe,gt,J,ie,pe),ze>1&&console.timeEnd("drilling down"),this.tiles[Be]?bo(this.tiles[Be],we):null):null}}function Do(Ze,J,ie){return 32*((1<<Ze)*ie+J)+Ze}function Ua(Ze,J){const ie=Ze.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const pe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!pe)return void J(null,null);const Pe=new Ri(pe.features);let we=ur(Pe);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),J(null,{vectorTile:Pe,rawData:we.buffer})}class Zc extends ri{constructor(J,ie,pe,Pe,we,ze){super(J,ie,pe,Pe,Ua,ze),we&&(this.loadGeoJSON=we),this._dynamicIndex=new cr}loadData(J,ie){const pe=J&&J.request,Pe=pe&&pe.collectResourceTiming;this.loadGeoJSON(J,(we,ze)=>{if(we||!ze)return ie(we);if(typeof ze!="object")return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const Be=o.M(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(We=>`${We.key}: ${We.message}`).join(", "));ze.features=ze.features.filter(We=>Be.value.evaluate({zoom:0},We))}J.dynamic?(ze.type==="Feature"&&(ze={type:"FeatureCollection",features:[ze]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ze.features,this.loaded),J.cluster&&(ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new si(function({superclusterOptions:Be,clusterProperties:We}){if(!We||!Be)return Be;const Je={},Qe={},gt={accumulated:null,zoom:0},Lt={properties:null},Ht=Object.keys(We);for(const fi of Ht){const[wi,Ti]=We[fi],yi=o.M(Ti),pn=o.M(typeof wi=="string"?[wi,["accumulated"],["get",fi]]:wi);Je[fi]=yi.value,Qe[fi]=pn.value}return Be.map=fi=>{Lt.properties=fi;const wi={};for(const Ti of Ht)wi[Ti]=Je[Ti].evaluate(gt,Lt);return wi},Be.reduce=(fi,wi)=>{Lt.properties=wi;for(const Ti of Ht)gt.accumulated=fi[Ti],fi[Ti]=Qe[Ti].evaluate(gt,Lt)},Be}(J)).load(ze.features):J.dynamic?this._dynamicIndex:function(Be,We){return new th(Be,We)}(ze,J.geojsonVtOptions)}catch(Be){return ie(Be)}const He={};if(Pe){const Be=ue(pe);Be&&(He.resourceTiming={},He.resourceTiming[J.source]=JSON.parse(JSON.stringify(Be)))}ie(null,He)}})}reloadTile(J,ie){const pe=this.loaded;return pe&&pe[J.uid]?J.partial?ie(null,void 0):super.reloadTile(J,ie):this.loadTile(J,ie)}loadGeoJSON(J,ie){if(J.request)o.n(J.request,ie);else{if(typeof J.data!="string")return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(J.data))}catch{return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(pe){ie(pe)}}getClusterChildren(J,ie){try{ie(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(pe){ie(pe)}}getClusterLeaves(J,ie){try{ie(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(pe){ie(pe)}}}class Xc{constructor(J,ie){this.tileID=new o.aA(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=ie}parse(J,ie,pe,Pe){this.status="parsing";const we=new o.aA(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),ze=[],He=ie.familiesBySource[pe.source],Be=new o.dR(we,pe.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,o.e0(J).then(We=>{if(!We)return Pe(new Error("Could not parse tile"));const Je=o.e1(We,1/o.c9(pe.tileID.canonical)),Qe=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,gt=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),Lt=new o.a3(this.zoom,{brightness:this.brightness});for(const Ht in He)for(const fi of He[Ht]){const wi=fi[0];Be.bucketLayerIDs.push(fi.map(yi=>o.av(yi.id,yi.scope))),wi.recalculate(Lt,[]);const Ti=new o.e2(fi,Je,we,Qe,gt,this.brightness,Be);Qe||(Ti.needsUpload=!0),ze.push(Ti),Ti.evaluate(wi)}this.status="done",Pe(null,{buckets:ze,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(We=>Pe(new Error(We.message)))}}class Jl{constructor(J,ie,pe,Pe,we,ze){this.actor=J,this.layerIndex=ie,this.availableImages=pe,this.brightness=ze,this.loading={},this.loaded={}}loadTile(J,ie){const pe=J.uid,Pe=this.loading[pe]=new Xc(J,this.brightness);o.bd(J.request,(we,ze)=>{const He=!this.loading[pe];return delete this.loading[pe],He||we?(Pe.status="done",He||(this.loaded[pe]=Pe),ie(we)):ze&&ze.byteLength!==0?void Pe.parse(ze,this.layerIndex,J,(Be,We)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[pe]=Pe,Be||!We?ie(Be):ie(null,We)}):(Pe.status="done",this.loaded[pe]=Pe,ie())})}reloadTile(J,ie){const pe=this.loaded,Pe=J.uid;if(pe&&pe[Pe]){const we=pe[Pe];we.projection=J.projection,we.brightness=J.brightness;const ze=(He,Be)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(J,ie)),ie(He,Be)};we.status==="parsing"?we.reloadCallback=ze:we.status==="done"&&this.loadTile(J,ie)}}abortTile(J,ie){const pe=J.uid;this.loading[pe]&&delete this.loading[pe],ie()}removeTile(J,ie){const pe=this.loaded,Pe=J.uid;pe&&pe[Pe]&&delete pe[Pe],ie()}}class Yc{constructor(J){this.self=J,this.actor=new o.e3(J,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bM({name:"mercator"}),this.workerSourceTypes={vector:ri,geojson:Zc,"batched-model":Jl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,pe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=pe},this.self.registerRTLTextPlugin=ie=>{if(o.e4.isParsed())throw new Error("RTL text plugin already registered.");o.e4.applyArabicShaping=ie.applyArabicShaping,o.e4.processBidirectionalText=ie.processBidirectionalText,o.e4.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(J,ie,pe){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],delete this.rasterArrayWorkerSource,pe()}checkIfReady(J,ie,pe){pe()}setReferrer(J,ie){this.referrer=ie}spriteLoaded(J,{scope:ie,isLoaded:pe}){if(this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),this.isSpriteLoaded[J][ie]=pe,this.workerSources[J]&&this.workerSources[J][ie])for(const Pe in this.workerSources[J][ie]){const we=this.workerSources[J][ie][Pe];for(const ze in we){const He=we[ze];He instanceof ri&&(He.isSpriteLoaded=pe,He.fire(new o.x("isSpriteLoaded")))}}}setImages(J,{scope:ie,images:pe},Pe){if(this.availableImages[J]||(this.availableImages[J]={}),this.availableImages[J][ie]=pe,this.workerSources[J]&&this.workerSources[J][ie]){for(const we in this.workerSources[J][ie]){const ze=this.workerSources[J][ie][we];for(const He in ze)ze[He].availableImages=pe}Pe()}else Pe()}setProjection(J,ie){this.projections[J]=o.bM(ie)}setBrightness(J,ie,pe){this.brightness=ie,pe()}setLayers(J,ie,pe){this.getLayerIndex(J,ie.scope).replace(ie.layers,ie.options),pe()}updateLayers(J,ie,pe){this.getLayerIndex(J,ie.scope).update(ie.layers,ie.removedIds,ie.options),pe()}loadTile(J,ie,pe){ie.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ie.type,ie.source,ie.scope).loadTile(ie,pe)}loadDEMTile(J,ie,pe){this.getDEMWorkerSource(J,ie.source,ie.scope).loadTile(ie,pe)}decodeRasterArray(J,ie,pe){this.getRasterArrayWorkerSource().decodeRasterArray(ie,pe)}reloadTile(J,ie,pe){ie.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ie.type,ie.source,ie.scope).reloadTile(ie,pe)}abortTile(J,ie,pe){this.getWorkerSource(J,ie.type,ie.source,ie.scope).abortTile(ie,pe)}removeTile(J,ie,pe){this.getWorkerSource(J,ie.type,ie.source,ie.scope).removeTile(ie,pe)}removeSource(J,ie,pe){if(!(this.workerSources[J]&&this.workerSources[J][ie.scope]&&this.workerSources[J][ie.scope][ie.type]&&this.workerSources[J][ie.scope][ie.type][ie.source]))return;const Pe=this.workerSources[J][ie.scope][ie.type][ie.source];delete this.workerSources[J][ie.scope][ie.type][ie.source],Pe.removeSource!==void 0?Pe.removeSource(ie,pe):pe()}loadWorkerSource(J,ie,pe){try{this.self.importScripts(ie.url),pe()}catch(Pe){pe(Pe.toString())}}syncRTLPluginState(J,ie,pe){try{o.e4.setState(ie);const Pe=o.e4.getPluginURL();if(o.e4.isLoaded()&&!o.e4.isParsed()&&Pe!=null){this.self.importScripts(Pe);const we=o.e4.isParsed();pe(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Pe}`),we)}}catch(Pe){pe(Pe.toString())}}setDracoUrl(J,ie){this.dracoUrl=ie}getAvailableImages(J,ie){this.availableImages[J]||(this.availableImages[J]={});let pe=this.availableImages[J][ie];return pe||(pe=[]),pe}getLayerIndex(J,ie){this.layerIndexes[J]||(this.layerIndexes[J]={});let pe=this.layerIndexes[J][ie];return pe||(pe=this.layerIndexes[J][ie]=new Oe,pe.scope=ie),pe}getWorkerSource(J,ie,pe,Pe){return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Pe]||(this.workerSources[J][Pe]={}),this.workerSources[J][Pe][ie]||(this.workerSources[J][Pe][ie]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),this.workerSources[J][Pe][ie][pe]||(this.workerSources[J][Pe][ie][pe]=new this.workerSourceTypes[ie]({send:(we,ze,He,Be,We,Je)=>{this.actor.send(we,ze,He,J,We,Je)},scheduler:this.actor.scheduler},this.getLayerIndex(J,Pe),this.getAvailableImages(J,Pe),this.isSpriteLoaded[J][Pe],void 0,this.brightness)),this.workerSources[J][Pe][ie][pe]}getDEMWorkerSource(J,ie,pe){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][pe]||(this.demWorkerSources[J][pe]={}),this.demWorkerSources[J][pe][ie]||(this.demWorkerSources[J][pe][ie]=new ft),this.demWorkerSources[J][pe][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Dt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(J,ie){o.e5(ie)}getWorkerPerformanceMetrics(J,ie,pe){pe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yc(self)),Yc}),$(["./shared"],function(o){var ue="3.8.0";const Re={create:"create",load:"load",fullLoad:"fullLoad"},xe={mark(l){performance.mark(l)},measure(l,t,n){performance.measure(l,t,n)}};function Oe(l){const t=l.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Ke,st={},Rt=function(){if(Ke)return st;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,M=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(M);try{y=new Worker(P),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(P),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var M=y.getImageData(0,0,1,1);return M&&M.width===_.width}()?(n[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(n[f]=function(_){var y,M=function(P){var D=document.createElement("canvas"),R=Object.create(l.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=P,D.getContext("webgl2",R)}(_);if(!M)return!1;try{y=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!y||M.isContextLost())&&(M.shaderSource(y,"void main() {}"),M.compileShader(y),M.getShaderParameter(y,M.COMPILE_STATUS)===!0)}(f)),n[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}Ke=1,st.supported=l,st.notSupportedReason=t;var n={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},st}();function It(l,t,n){const c=document.createElement(l);return t!=null&&(c.className=t),n&&n.appendChild(c),c}function ri(l,t,n){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const f of Object.keys(t))c.setAttributeNS(null,f,String(t[f]));return n&&n.appendChild(c),c}const ft=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Dt=ft&&ft.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Yt;function At(){ft&&Dt&&(Yt=ft[Dt],ft[Dt]="none")}function Ri(){ft&&Dt&&(ft[Dt]=Yt)}function Sn(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Sn,!0)}function Ut(){window.addEventListener("click",Sn,!0),window.setTimeout(()=>{window.removeEventListener("click",Sn,!0)},0)}function cr(l,t){const n=l.getBoundingClientRect();return ui(l,n,t)}function Xr(l,t){const n=l.getBoundingClientRect(),c=[];for(let f=0;f<t.length;f++)c.push(ui(l,n,t[f]));return c}function li(l){return window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function ui(l,t,n){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new o.P((n.clientX-t.left)*c,(n.clientY-t.top)*c)}const vo="01",Yr="NO_ACCESS_TOKEN";class bs{constructor(t,n,c){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let c=0;c<10;c++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vo,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!o.f(t))return t;const c=zn(t);return c.params.push(`sdk=js-${ue}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!o.f(t))return t;const c=zn(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeModelURL(t,n){if(!o.f(t))return t;const c=zn(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeSourceURL(t,n,c,f){if(!o.f(t))return t;const _=zn(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),c&&_.params.push(`language=${c}`),f&&_.params.push(`worldview=${f}`),this._makeAPIURL(_,this._customAccessToken||n)}normalizeSpriteURL(t,n,c,f){const _=zn(t);return o.f(t)?(_.path=`/styles/v1${_.path}/sprite${n}${c}`,this._makeAPIURL(_,this._customAccessToken||f)):(_.path+=`${n}${c}`,tn(_))}normalizeTileURL(t,n,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.f(t))return t;const f=zn(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||c&&f.authority!=="raster"&&c===512?"@2x":""}${o.m.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${o.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${o.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${o.e.TILE_URL_VERSION}${f.path}`);const _=this._customAccessToken||function(y){for(const M of y){const P=M.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(f.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,_)}canonicalizeTileURL(t,n){const c=zn(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let f="mapbox://";c.path.match(/^\/raster\/v1\//)?f+=`raster/${c.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${c.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${c.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let _=c.params;return n&&(_=_.filter(y=>!y.match(/^access_token=/))),_.length&&(f+=`?${_.join("&")}`),f}canonicalizeTileset(t,n){const c=!!n&&o.f(n),f=[];for(const _ of t.tiles||[])o.h(_)?f.push(this.canonicalizeTileURL(_,c)):f.push(_);return f}_makeAPIURL(t,n){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=zn(o.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return tn(t);if(n=n||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),tn(t)}}const Ei=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zn(l){const t=l.match(Ei);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function tn(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const nn="mapbox.eventData";function _i(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.j(t[1]))}catch{return null}}class Kr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=_i(o.e.ACCESS_TOKEN);let c="";return c=n&&n.u?o.k(n.u):o.e.ACCESS_TOKEN||"",t?`${nn}.${t}:${c}`:`${nn}:${c}`}fetchEventData(){const t=o.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const f=localStorage.getItem(n);f&&(this.eventData=JSON.parse(f));const _=localStorage.getItem(c);_&&(this.anonId=_)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const t=o.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.anonId;if(t&&f)try{localStorage.setItem(c,f),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,c,f){if(!o.e.EVENTS_URL)return;const _=zn(o.e.EVENTS_URL);_.params.push(`access_token=${f||o.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},M=n?o.l(y,n):y,P={url:tn(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=o.p(P,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(f)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const ur=new class extends Kr{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(n=>o.f(n)||o.h(n))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=_i(o.e.ACCESS_TOKEN),n=t?t.u:o.e.ACCESS_TOKEN;let c=n!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),y=new Date(f),M=(f-this.eventData.lastSuccess)/864e5;c=c||M>=1||M<-1||_.getDate()!==y.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ue,skuId:vo,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=n)},l):this.processRequests()}},Pr=ur.postTurnstileEvent.bind(ur),gi=new class extends Kr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,n,c){this.skuToken=t,this.errorCb=c,o.e.EVENTS_URL&&(n||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(Yr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ue,skuId:vo,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},ts=gi.postMapLoadEvent.bind(gi),Rr=new class extends Kr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=o.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:n,style:c,importedStyles:f}=t;if(!o.e.EVENTS_URL||!l&&!o.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(n),y={mapInstanceId:_,eventId:this.getEventId(_),style:c};f.length&&(y.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:y},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},l)}},Qn=Rr.postStyleLoadEvent.bind(Rr),Mt=new class extends Kr{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),c=function(f){const _=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),M=function(G){const X={};if(G){for(const W in G)if(W!=="other")for(const K of G[W]){const Y=`${W}ResolveRangeMin`,te=`${W}ResolveRangeMax`,re=`${W}RequestCount`,le=`${W}RequestCachedCount`;X[Y]=Math.min(X[Y]||1/0,K.startTime),X[te]=Math.max(X[te]||-1/0,K.responseEnd);const fe=me=>{X[me]===void 0&&(X[me]=0),++X[me]};K.transferSize!==void 0&&K.transferSize===0&&fe(le),fe(re)}}return X}(function(G,X){const W={};if(G)for(const K of G){const Y=X(K);W[Y]===void 0&&(W[Y]=[]),W[Y].push(K)}return W}(_,Oe)),P=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=D?D.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},N=(G,X,W)=>{W!=null&&G.push({name:X,value:W.toString()})};for(const G in M)N(F.counters,G,M[G]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(N(F.counters,"interactionRangeMin",f.interactionRange[0]),N(F.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const G of Object.keys(Re)){const X=Re[G],W=y.find(K=>K.name===X);W&&N(F.counters,X,W.startTime)}return N(F.counters,"visibilityHidden",f.visibilityHidden),N(F.attributes,"style",function(G){if(G)for(const X of G){const W=X.name.split("?")[0];if(o.i(W)){const K=W.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(_)),N(F.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),N(F.attributes,"fogEnabled",f.fogEnabled?"true":"false"),N(F.attributes,"projection",f.projection),N(F.attributes,"zoom",f.zoom),N(F.metadata,"devicePixelRatio",P),N(F.metadata,"connectionEffectiveType",R),N(F.metadata,"navigatorUserAgent",navigator.userAgent),N(F.metadata,"screenWidth",window.screen.width),N(F.metadata,"screenHeight",window.screen.height),N(F.metadata,"windowWidth",window.innerWidth),N(F.metadata,"windowHeight",window.innerHeight),N(F.metadata,"mapWidth",f.width/P),N(F.metadata,"mapHeight",f.height/P),N(F.metadata,"webglRenderer",f.renderer),N(F.metadata,"webglVendor",f.vendor),N(F.metadata,"sdkVersion",ue),N(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(n);for(const f of c.metadata);for(const f of c.counters);for(const f of c.attributes);this.postEvent(t,c,()=>{},l)}},si=Mt.postPerformanceEvent.bind(Mt),ii=new class extends Kr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,n,c){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const f=zn(o.e.API_URL+o.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||o.e.ACCESS_TOKEN||""}`);const _={url:tn(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(_,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(l,t,n,c){this.skuToken=t,this.errorCb=c,o.e.SESSION_PATH&&o.e.API_URL&&(n||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(Yr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},ye=ii.getSessionAPI.bind(ii),sn=new Set;function Cn(l,t){t?sn.add(l):sn.delete(l)}class De{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function he(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class ct extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new o.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,n,f);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,c){this._validate(t,c)&&(this.images[n][t]=c)}_validate(t,n){let c=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new o.t(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new o.t(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(n.content,n)||(this.fire(new o.t(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,n){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||n<f[1])return!1;c=f[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n,c){c.version=this.images[n][t].version+1,this.images[n][t]=c,this.updatedImages[n][t]=!0}removeImage(t,n){const c=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,c){let f=!0;const _=!!this.loaded[n];if(!_)for(const y of t)this.images[n][y]||(f=!1);_||f?this._notify(t,n,c):this.requestors.push({ids:t,scope:n,callback:c})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,c){const f={};for(const _ of t){this.images[n][_]||this.fire(new o.x("styleimagemissing",{id:_}));const y=this.images[n][_];y?f[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(t){const{width:n,height:c}=this.atlasImage[t];return{width:n,height:c}}getPattern(t,n,c){const f=this.patterns[n][t],_=this.getImage(t,n);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2*o.y,h:_.data.height+2*o.y,x:0,y:0},M=new o.I(y,_,o.y);this.patterns[n][t]={bin:y,position:M}}return this._updatePatternAtlas(n,c),this.patterns[n][t].position}bind(t,n){const c=t.gl;let f=this.atlasTexture[n];f?this.dirty&&(f.update(this.atlasImage[n]),this.dirty=!1):(f=new o.T(t,this.atlasImage[n],c.RGBA8),this.atlasTexture[n]=f),f.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const c=[];for(const M in this.patterns[t])c.push(this.patterns[t][M].bin);const{w:f,h:_}=o.z(c),y=this.atlasImage[t];y.resize({width:f||1,height:_||1});for(const M in this.patterns[t]){const{bin:P,position:D}=this.patterns[t][M];let R=D.padding;const F=P.x+R,N=P.y+R,G=this.images[t][M].data,X=G.width,W=G.height;R=R>1?R-1:R,o.r.copy(G,y,{x:0,y:0},{x:F,y:N},{width:X,height:W},n),o.r.copy(G,y,{x:0,y:W-R},{x:F,y:N-R},{width:X,height:R},n),o.r.copy(G,y,{x:0,y:0},{x:F,y:N+W},{width:X,height:R},n),o.r.copy(G,y,{x:X-R,y:0},{x:F-R,y:N},{width:R,height:W},n),o.r.copy(G,y,{x:0,y:0},{x:F+X,y:N},{width:R,height:W},n),o.r.copy(G,y,{x:X-R,y:W-R},{x:F-R,y:N-R},{width:R,height:R},n),o.r.copy(G,y,{x:0,y:W-R},{x:F+X,y:N-R},{width:R,height:R},n),o.r.copy(G,y,{x:0,y:0},{x:F+X,y:N+W},{width:R,height:R},n),o.r.copy(G,y,{x:X-R,y:0},{x:F-R,y:N+W},{width:R,height:R},n)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const c of t){if(this.callbackDispatchedThisFrame[n][c])continue;this.callbackDispatchedThisFrame[n][c]=!0;const f=this.images[n][c];he(f)&&this.updateImage(c,n,f)}}}function Ct(l){const t=l.key,n=l.value,c=l.valueSpec||{},f=l.objectElementValidators||{},_=l.style,y=l.styleSpec;let M=[];const P=o.B(n);if(P!=="object")return[new o.V(t,n,`object expected, ${P} found`)];for(const D in n){const R=D.split(".")[0];let F;f[R]?F=f[R]:c[R]?F=ji:f["*"]?F=f["*"]:c["*"]&&(F=ji),F?M=M.concat(F({key:(t&&`${t}.`)+D,value:n[D],valueSpec:c[R]||c["*"],style:_,styleSpec:y,object:n,objectKey:D},n)):M.push(new o.A(t,n[D],`unknown property "${D}"`))}for(const D in c)f[D]||c[D].required&&c[D].default===void 0&&n[D]===void 0&&M.push(new o.V(t,n,`missing required property "${D}"`));return M}function xt(l){const t=l.value,n=l.valueSpec,c=l.style,f=l.styleSpec,_=l.key,y=l.arrayElementValidator||ji;if(o.B(t)!=="array")return[new o.V(_,t,`array expected, ${o.B(t)} found`)];if(n.length&&t.length!==n.length)return[new o.V(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new o.V(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let M={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};f.$version<7&&(M.function=n.function),o.B(n.value)==="object"&&(M=n.value);let P=[];for(let D=0;D<t.length;D++)P=P.concat(y({array:t,arrayIndex:D,value:t[D],valueSpec:M,style:c,styleSpec:f,key:`${_}[${D}]`},!0));return P}function pt(l){const t=l.key,n=l.value,c=l.valueSpec;let f=o.B(n);if(f==="number"&&n!=n&&(f="NaN"),f!=="number")return[new o.V(t,n,`number expected, ${f} found`)];if("minimum"in c){let _=c.minimum;if(o.B(c.minimum)==="array"&&(_=c.minimum[l.arrayIndex]),n<_)return[new o.V(t,n,`${n} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if(o.B(c.maximum)==="array"&&(_=c.maximum[l.arrayIndex]),n>_)return[new o.V(t,n,`${n} is greater than the maximum value ${_}`)]}return[]}function Xt(l){const t=l.valueSpec,n=o.D(l.value.type);let c,f,_,y={};const M=n!=="categorical"&&l.value.property===void 0,P=!M,D=o.B(l.value.stops)==="array"&&o.B(l.value.stops[0])==="array"&&o.B(l.value.stops[0][0])==="object",R=Ct({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(G){if(n==="identity")return[new o.V(G.key,G.value,'identity function may not have a "stops" property')];let X=[];const W=G.value;return X=X.concat(xt({key:G.key,value:W,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:F})),o.B(W)==="array"&&W.length===0&&X.push(new o.V(G.key,W,"array must have at least one stop")),X},default:function(G){return ji({key:G.key,value:G.value,valueSpec:t,style:G.style,styleSpec:G.styleSpec})}}});return n==="identity"&&M&&R.push(new o.V(l.key,l.value,'missing required property "property"')),n==="identity"||l.value.stops||R.push(new o.V(l.key,l.value,'missing required property "stops"')),n==="exponential"&&l.valueSpec.expression&&!o.F(l.valueSpec)&&R.push(new o.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(P&&!o.G(l.valueSpec)?R.push(new o.V(l.key,l.value,"property functions not supported")):M&&!o.H(l.valueSpec)&&R.push(new o.V(l.key,l.value,"zoom functions not supported"))),n!=="categorical"&&!D||l.value.property!==void 0||R.push(new o.V(l.key,l.value,'"property" property is required')),R;function F(G){let X=[];const W=G.value,K=G.key;if(o.B(W)!=="array")return[new o.V(K,W,`array expected, ${o.B(W)} found`)];if(W.length!==2)return[new o.V(K,W,`array length 2 expected, length ${W.length} found`)];if(D){if(o.B(W[0])!=="object")return[new o.V(K,W,`object expected, ${o.B(W[0])} found`)];if(W[0].zoom===void 0)return[new o.V(K,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new o.V(K,W,"object stop key must have value")];const Y=o.D(W[0].zoom);if(typeof Y!="number")return[new o.V(K,W[0].zoom,"stop zoom values must be numbers")];if(_&&_>Y)return[new o.V(K,W[0].zoom,"stop zoom values must appear in ascending order")];Y!==_&&(_=Y,f=void 0,y={}),X=X.concat(Ct({key:`${K}[0]`,value:W[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:pt,value:N}}))}else X=X.concat(N({key:`${K}[0]`,value:W[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},W));return o.J(o.K(W[1]))?X.concat([new o.V(`${K}[1]`,W[1],"expressions are not allowed in function stops.")]):X.concat(ji({key:`${K}[1]`,value:W[1],valueSpec:t,style:G.style,styleSpec:G.styleSpec}))}function N(G,X){const W=o.B(G.value),K=o.D(G.value),Y=G.value!==null?G.value:X;if(c){if(W!==c)return[new o.V(G.key,Y,`${W} stop domain type must match previous stop domain type ${c}`)]}else c=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof K!="number"&&typeof K!="string"&&typeof K!="boolean")return[new o.V(G.key,Y,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&n!=="categorical"){let te=`number expected, ${W} found`;return o.G(t)&&n===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(G.key,Y,te)]}return n!=="categorical"||W!=="number"||typeof K=="number"&&isFinite(K)&&Math.floor(K)===K?n!=="categorical"&&W==="number"&&typeof K=="number"&&typeof f=="number"&&f!==void 0&&K<f?[new o.V(G.key,Y,"stop domain values must appear in ascending order")]:(f=K,n==="categorical"&&K in y?[new o.V(G.key,Y,"stop domain values must be unique")]:(y[K]=!0,[])):[new o.V(G.key,Y,`integer expected, found ${String(K)}`)]}}function Zt(l){const t=(l.expressionContext==="property"?o.L:o.M)(o.K(l.value),l.valueSpec);if(t.result==="error")return t.value.map(c=>new o.V(`${l.key}${c.key}`,l.value,c.message));const n=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!n.outputDefined())return[new o.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!o.N(n))return[new o.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return $t(n,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!o.O(n,["zoom","feature-state"]))return[new o.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!o.Q(n))return[new o.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $t(l,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)n.delete(f);if(n.size===0)return[];const c=[];return l instanceof o.S&&n.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(f=>{c.push(...$t(f,t))}),c)}function Nt(l){const t=l.key,n=l.value,c=l.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(o.D(n))===-1&&f.push(new o.V(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(o.D(n))===-1&&f.push(new o.V(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function Mi(l){return o.W(o.K(l.value))?Zt(o.C({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):vt(l)}function vt(l){const t=l.value,n=l.key;if(o.B(t)!=="array")return[new o.V(n,t,`array expected, ${o.B(t)} found`)];const c=l.styleSpec;let f,_=[];if(t.length<1)return[new o.V(n,t,"filter array must have at least 1 element")];switch(_=_.concat(Nt({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator,style:l.style,styleSpec:l.styleSpec})),o.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.D(t[1])==="$type"&&_.push(new o.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new o.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=o.B(t[1]),f!=="string"&&_.push(new o.V(`${n}[1]`,t[1],`string expected, ${f} found`)));for(let y=2;y<t.length;y++)f=o.B(t[y]),o.D(t[1])==="$type"?_=_.concat(Nt({key:`${n}[${y}]`,value:t[y],valueSpec:c.geometry_type,style:l.style,styleSpec:l.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&_.push(new o.V(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)_=_.concat(vt({key:`${n}[${y}]`,value:t[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":f=o.B(t[1]),t.length!==2?_.push(new o.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&_.push(new o.V(`${n}[1]`,t[1],`string expected, ${f} found`))}return _}function xi(l,t){const n=l.key,c=l.style,f=l.layer,_=l.styleSpec,y=l.value,M=l.objectKey,P=_[`${t}_${l.layerType}`];if(!P)return[];const D=M.match(/^(.*)-transition$/);if(t==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return ji({key:n,value:y,valueSpec:_.transition,style:c,styleSpec:_});const R=l.valueSpec||P[M];if(!R)return[new o.A(n,y,`unknown property "${M}"`)];let F;if(o.B(y)==="string"&&o.G(R)&&!R.tokens&&(F=/^{([^}]+)}$/.exec(y))){const G=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new o.V(n,y,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const N=[];if(l.layerType==="symbol")M!=="text-field"||!c||c.glyphs||c.imports||N.push(new o.V(n,y,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&o.X(o.K(y))&&o.D(y.type)==="identity"&&N.push(new o.V(n,y,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&o.G(R)&&(o.Y(R)||o.H(R))){const G=o.L(o.K(y),R),X=G.value.expression||G.value._styleExpression.expression;X&&!o.O(X,["measure-light"])&&(M==="model-emissive-strength"&&o.Q(X)&&o.N(X)||N.push(new o.V(n,y,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(ji({key:l.key,value:y,valueSpec:R,style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:M}))}function Di(l){return xi(l,"paint")}function Hi(l){return xi(l,"layout")}function $i(l){let t=[];const n=l.value,c=l.key,f=l.style,_=l.styleSpec;n.type||n.ref||t.push(new o.V(c,n,'either "type" or "ref" is required'));let y=o.D(n.type);const M=o.D(n.ref);if(n.id){const P=o.D(n.id);for(let D=0;D<l.arrayIndex;D++){const R=f.layers[D];o.D(R.id)===P&&t.push(new o.V(c,n.id,`duplicate layer id "${n.id}", previously used at line ${R.id.__line__}`))}}if("ref"in n){let P;["type","source","source-layer","filter","layout"].forEach(D=>{D in n&&t.push(new o.V(c,n[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{o.D(D.id)===M&&(P=D)}),P?P.ref?t.push(new o.V(c,n.ref,"ref cannot reference another ref layer")):y=o.D(P.type):typeof M=="string"&&t.push(new o.V(c,n.ref,`ref layer "${M}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(n.source){const P=f.sources&&f.sources[n.source],D=P&&o.D(P.type);P?D==="vector"&&y==="raster"?t.push(new o.V(c,n.source,`layer "${n.id}" requires a raster source`)):D==="raster"&&y!=="raster"?t.push(new o.V(c,n.source,`layer "${n.id}" requires a vector source`)):D!=="vector"||n["source-layer"]?D==="raster-dem"&&y!=="hillshade"?t.push(new o.V(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(y)?y!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||D==="geojson"&&P.lineMetrics?y==="raster-particle"&&D!=="raster-array"&&t.push(new o.V(c,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new o.V(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new o.V(c,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new o.V(c,n.source,`source "${n.source}" not found`))}else t.push(new o.V(c,n,'missing required property "source"'));return t=t.concat(Ct({key:c,value:n,valueSpec:_.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${c}.type`,value:n.type,valueSpec:_.layer.type,style:l.style,styleSpec:l.styleSpec,object:n,objectKey:"type"}),filter:P=>Mi(o.C({layerType:y},P)),layout:P=>Ct({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":D=>Hi(o.C({layerType:y},D))}}),paint:P=>Ct({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":D=>Di(o.C({layerType:y,layer:n},D))}})}})),t}function Yi(l){const t=l.value,n=l.key,c=o.B(t);return c!=="string"?[new o.V(n,t,`string expected, ${c} found`)]:[]}const Dr={promoteId:function({key:l,value:t}){if(o.B(t)==="string")return Yi({key:l,value:t});{const n=[];for(const c in t)n.push(...Yi({key:`${l}.${c}`,value:t[c]}));return n}}};function mr(l){const t=l.value,n=l.key,c=l.styleSpec,f=l.style;if(!t.type)return[new o.V(n,t,'"type" is required')];const _=o.D(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||y.push(new o.A(n,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(Ct({key:n,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:Dr})),y;case"geojson":if(y=Ct({key:n,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Dr}),t.cluster)for(const M in t.clusterProperties){const[P,D]=t.clusterProperties[M],R=typeof P=="string"?[P,["accumulated"],["get",M]]:P;y.push(...Zt({key:`${n}.${M}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Zt({key:`${n}.${M}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return y;case"video":return Ct({key:n,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Ct({key:n,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new o.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nt({key:`${n}.type`,value:t.type,valueSpec:{values:jr(c)},style:f,styleSpec:c})}}function jr(l){return l.source.reduce((t,n)=>{const c=l[n];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function hr(l){const t=l.value,n=l.styleSpec,c=n.light,f=l.style;let _=[];const y=o.B(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new o.V("light",t,`object expected, ${y} found`)]),_;for(const M in t){const P=M.match(/^(.*)-transition$/);_=_.concat(P&&c[P[1]]&&c[P[1]].transition?ji({key:M,value:t[M],valueSpec:n.transition,style:f,styleSpec:n}):c[M]?ji({key:M,value:t[M],valueSpec:c[M],style:f,styleSpec:n}):[new o.V(M,t[M],`unknown property "${M}"`)])}return _}function bo(l){const t=l.value;let n=[];if(!t)return n;const c=o.B(t);if(c!=="object")return n=n.concat([new o.V("light-3d",t,`object expected, ${c} found`)]),n;const f=l.styleSpec,_=f["light-3d"],y=l.key,M=l.style,P=l.style.lights;for(const F of["type","id"])if(!(F in t))return n=n.concat([new o.V("light-3d",t,`missing property ${F} on light`)]),n;if(t.type&&P)for(let F=0;F<l.arrayIndex;F++){const N=o.D(t.type),G=P[F];o.D(G.type)===N&&n.push(new o.V(y,t.id,`duplicate light type "${t.type}", previously defined at line ${G.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in f))return n=n.concat([new o.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const R=f[D];for(const F in t)if(F==="properties"){const N=t[F],G=o.B(N);if(G!=="object")return n=n.concat([new o.V("properties",N,`object expected, ${G} found`)]),n;for(const X in N)n=n.concat(R[X]?ji({key:X,value:N[X],valueSpec:R[X],style:M,styleSpec:f}):[new o.A(l.key,N[X],`unknown property "${X}"`)])}else{const N=F.match(/^(.*)-transition$/);n=n.concat(N&&_[N[1]]&&_[N[1]].transition?ji({key:F,value:t[F],valueSpec:f.transition,style:M,styleSpec:f}):_[F]?ji({key:F,value:t[F],valueSpec:_[F],style:M,styleSpec:f}):[new o.A(F,t[F],`unknown property "${F}"`)])}return n}function ws(l){const t=l.value,n=l.key,c=l.style,f=l.styleSpec,_=f.terrain;let y=[];const M=o.B(t);if(t===void 0||M==="null")return y;if(M!=="object")return y=y.concat([new o.V("terrain",t,`object expected, ${M} found`)]),y;for(const P in t){const D=P.match(/^(.*)-transition$/);y=y.concat(D&&_[D[1]]&&_[D[1]].transition?ji({key:P,value:t[P],valueSpec:f.transition,style:c,styleSpec:f}):_[P]?ji({key:P,value:t[P],valueSpec:_[P],style:c,styleSpec:f}):[new o.A(P,t[P],`unknown property "${P}"`)])}if(t.source){const P=c.sources&&c.sources[t.source],D=P&&o.D(P.type);P?D!=="raster-dem"&&y.push(new o.V(n,t.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new o.V(n,t.source,`source "${t.source}" not found`))}else y.push(new o.V(n,t,'terrain is missing required property "source"'));return y}function er(l){const t=l.value,n=l.style,c=l.styleSpec,f=c.fog;let _=[];const y=o.B(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new o.V("fog",t,`object expected, ${y} found`)]),_;for(const M in t){const P=M.match(/^(.*)-transition$/);_=_.concat(P&&f[P[1]]&&f[P[1]].transition?ji({key:M,value:t[M],valueSpec:c.transition,style:n,styleSpec:c}):f[M]?ji({key:M,value:t[M],valueSpec:f[M],style:n,styleSpec:c}):[new o.A(M,t[M],`unknown property "${M}"`)])}return _}const io={"*":()=>[],array:xt,boolean:function(l){const t=l.value,n=l.key,c=o.B(t);return c!=="boolean"?[new o.V(n,t,`boolean expected, ${c} found`)]:[]},number:pt,color:function(l){const t=l.key,n=l.value,c=o.B(n);return c!=="string"?[new o.V(t,n,`color expected, ${c} found`)]:o.U.parseCSSColor(n)===null?[new o.V(t,n,`color expected, "${n}" found`)]:[]},enum:Nt,filter:Mi,function:Xt,layer:$i,object:Ct,source:mr,model:o.Z,light:hr,"light-3d":bo,terrain:ws,fog:er,string:Yi,formatted:function(l){return Yi(l).length===0?[]:Zt(l)},resolvedImage:function(l){return Yi(l).length===0?[]:Zt(l)},projection:function(l){const t=l.value,n=l.styleSpec,c=n.projection,f=l.style;let _=[];const y=o.B(t);if(y==="object")for(const M in t)_=_.concat(ji({key:M,value:t[M],valueSpec:c[M],style:f,styleSpec:n}));else y!=="string"&&(_=_.concat([new o.V("projection",t,`object or string expected, ${y} found`)]));return _},import:function(l){const{value:t,styleSpec:n}=l,{data:c,...f}=t;Object.defineProperty(f,"__line__",{value:t.__line__,enumerable:!1});let _=Ct(o.C({},l,{value:f,valueSpec:n.import}));return o.D(f.id)===""&&_.push(new o.V(`${l.key}.id`,f,"import id can't be an empty string")),c&&(_=_.concat(th(c,n,{key:`${l.key}.data`}))),_}};function ji(l,t=!1){const n=l.value,c=l.valueSpec,f=l.styleSpec;if(c.expression&&o.X(o.D(n)))return Xt(l);if(c.expression&&o.J(o.K(n)))return Zt(l);if(c.type&&io[c.type]){const _=io[c.type](l);return t===!0&&_.length>0&&o.B(l.value)==="array"?Zt(l):_}return Ct(o.C({},l,{valueSpec:c.type?f[c.type]:c}))}function Zs(l){const t=l.value,n=l.key,c=Yi(l);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new o.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new o.V(n,t,'"glyphs" url must include a "{range}" token'))),c}function th(l,t=o._,n={}){return ji({key:n.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:Zs,"*":()=>[]}})}function Do(l,t=o._){return we(th(l,t))}const Ua=l=>we(mr(l)),Zc=l=>we(hr(l)),Xc=l=>we(bo(l)),Jl=l=>we(ws(l)),Yc=l=>we(er(l)),Ze=l=>we($i(l)),J=l=>we(Mi(l)),ie=l=>we(Di(l)),pe=l=>we(Hi(l)),Pe=l=>we(o.Z(l));function we(l){return l.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function ze(l,t){let n=!1;if(t&&t.length)for(const c of t)c instanceof o.A?o.w(c.message):(l.fire(new o.t(new Error(c.message))),n=!0);return n}let He;class Be extends o.E{constructor(t,n="flat"){super(),this._transitionable=new o.$(He||(He=new o.a0({anchor:new o.a1(o._.light.anchor),position:new o.a2(o._.light.position),color:new o.a1(o._.light.color),intensity:new o.a1(o._.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,c={}){this._validate(Zc,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&ze(this,t.call(Do,o.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}let We=class extends o.E{constructor(l,t,n,c){super(),this.scope=n,this._transitionable=new o.$(new o.a0({source:new o.a1(o._.terrain.source),exaggeration:new o.a1(o._.terrain.exaggeration)}),n,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new o.a3(l)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let n=-1,c=-1,f=1;for(const _ of t.zoomStops)f=t.evaluate(new o.a3(_)),f>.01?(n=_,c=-1):c=_;return f<.01&&n>0&&c>n?[n,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof o.a4}};const Je=45,Qe=65,gt=.05;function Lt(l,t,n,c){const f=o.a7(Je,Qe,n),[_,y]=Ht(l,c);let M=1-Math.min(1,Math.exp((t-_)/(y-_)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*f*l.alpha}function Ht(l,t){const n=.5/Math.tan(.5*t);return[l.range[0]+n,l.range[1]+n]}function fi(l,t,n,c,f){const _=o.a6.vec3.transformMat4([],[t,n,c],f.mercatorFogMatrix);return Lt(l,o.a6.vec3.length(_),f.pitch,f._fov)}function wi(l,t,n,c,f,_,y){const M=[[n,c,0],[f,c,0],[f,_,0],[n,_,0]];let P=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const R of M){const F=o.a6.vec3.transformMat4([],R,t),N=o.a6.vec3.length(F);P=Math.min(P,N),D=Math.max(D,N)}return[Lt(l,P,y.pitch,y._fov),Lt(l,D,y.pitch,y._fov)]}class Ti extends o.E{constructor(t,n,c,f){super();const _=new o.a0({range:new o.a1(o._.fog.range),color:new o.a1(o._.fog.color),"high-color":new o.a1(o._.fog["high-color"]),"space-color":new o.a1(o._.fog["space-color"]),"horizon-blend":new o.a1(o._.fog["horizon-blend"]),"star-intensity":new o.a1(o._.fog["star-intensity"]),"vertical-range":new o.a1(o._.fog["vertical-range"])});this._transitionable=new o.$(_,c,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new o.a8(_),this.scope=c}get state(){const t=this._transform,n=t.projection.name==="globe",c=o.a9(t.zoom),f=this.properties.get("range"),_=[.5,3];return{range:n?[o.aa(_[0],f[0],c),o.aa(_[1],f[1],c)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,c={}){if(this._validate(Yc,t,c))return;const f=o.l({},t);for(const _ of Object.keys(o._.fog))f[_]===void 0&&(f[_]=o._.fog[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.a7(Je,Qe,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(c,f,_){const y=o.a5.fromLngLat(f),M=_.elevation?_.elevation.getAtPointOrZero(y):0;return fi(c,y.x,y.y,M,_)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return wi(this.state,n,0,0,o.ab,o.ab,this._transform)}getOpacityForBounds(t,n,c,f,_){return this._transform.projection.supportsFog?wi(this.state,t,n,c,f,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ht(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const c of n){const f=t.points[c];let _;if(f[2]>=0)_=f;else{const y=t.points[c-4];_=o.ac(y,f,y[2]/(y[2]-f[2]))}if(fi(this.state,_[0],_[1],0,this._transform)>=gt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&ze(this,t.call(Do,o.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}class yi extends o.E{constructor(t,n,c,f){super(),this.scope=c,this._options=t,this.properties=new o.a8(n),this._transitionable=new o.$(n,c,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let pn,rn;class Li{constructor(t,n,c,f){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,n){let c,f;if(t instanceof o.P||typeof t[0]=="number"){const _=o.P.convert(t);c=[_],f=n.isPointAboveHorizon(_)}else{const _=o.P.convert(t[0]),y=o.P.convert(t[1]);c=[_,y],f=o.ae(_,y).every(M=>n.isPointAboveHorizon(M))}return new Li(c,n.getCameraPoint(),f,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],f=o.ae(n,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<c.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?f[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(f[3]=this.cameraPoint)),o.af(f,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],f=o.ae(n,c,t),_=this.cameraPoint.clone();switch(3*((_.y>n.y)+(_.y>c.y))+((_.x>n.x)+(_.x>c.x))){case 0:f[0]=_,f[4]=_.clone();break;case 1:f.splice(1,0,_);break;case 2:f[1]=_;break;case 3:f.splice(4,0,_);break;case 5:f.splice(2,0,_);break;case 6:f[3]=_;break;case 7:f.splice(3,0,_);break;case 8:f[2]=_}return f}containsTile(t,n,c,f=0){const _=t.queryPadding/n._pixelsPerMercatorPixel+1,y=c?this._bufferedCameraMercator(_,n):this._bufferedScreenMercator(_,n);let M=t.tileID.wrap+(y.unwrapped?f:0);const P=y.polygon.map(K=>o.ag(t.tileTransform,K,M));if(!o.ah(P,0,0,o.ab,o.ab))return;M=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const D=this.screenGeometryMercator.polygon.map(K=>o.ai(t.tileTransform,K,M)),R=D.map(K=>new o.P(K[0],K[1])),F=n.getFreeCameraOptions().position||new o.a5(0,0,0),N=o.ai(t.tileTransform,F,M),G=D.map(K=>{const Y=o.a6.vec3.sub(K,K,N);return o.a6.vec3.normalize(Y,Y),new o.aj(N,Y)}),X=o.ak(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:G,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(W=o.al(P),W.min.x=o.ap(W.min.x,0,o.ab),W.min.y=o.ap(W.min.y,0,o.ab),W.max.x=o.ap(W.max.x,0,o.ab),W.max.y=o.ap(W.max.y,0,o.ab),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var W}_bufferedScreenMercator(t,n){const c=_r(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let f;return f=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(_=>n.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[c]=f,f}}_bufferedCameraMercator(t,n){const c=_r(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let f;return f=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(_=>n.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[c]=f,f}}_projectAndResample(t,n){const c=function(_,y){const M=o.a6.mat4.multiply([],y.pixelMatrix,y.globeMatrix),P=[0,-o.aq,0,1],D=[0,o.aq,0,1],R=[0,0,0,1];o.a6.vec4.transformMat4(P,P,M),o.a6.vec4.transformMat4(D,D,M),o.a6.vec4.transformMat4(R,R,M);const F=new o.P(P[0]/P[3],P[1]/P[3]),N=new o.P(D[0]/D[3],D[1]/D[3]),G=o.an(_,F)&&P[3]<R[3],X=o.an(_,N)&&D[3]<R[3];if(!G&&!X)return null;const W=function(de,ge,Te){for(let Ce=1;Ce<de.length;Ce++){const Ae=jn(ge.pointCoordinate3D(de[Ce-1]).x),Ee=jn(ge.pointCoordinate3D(de[Ce]).x);if(Te<0){if(Ae<Ee)return{idx:Ce,t:-Ae/(Ee-1-Ae)}}else if(Ee<Ae)return{idx:Ce,t:(1-Ae)/(Ee+1-Ae)}}return null}(_,y,G?-1:1);if(!W)return null;const{idx:K,t:Y}=W;let te=K>1?mn(_.slice(0,K),y):[],re=K<_.length?mn(_.slice(K),y):[];te=te.map(de=>new o.P(jn(de.x),de.y)),re=re.map(de=>new o.P(jn(de.x),de.y));const le=[...te];le.length===0&&le.push(re[re.length-1]);const fe=o.aa(le[le.length-1].y,(re.length===0?te[0]:re[0]).y,Y);let me;return me=G?[new o.P(0,fe),new o.P(0,0),new o.P(1,0),new o.P(1,fe)]:[new o.P(1,fe),new o.P(1,1),new o.P(0,1),new o.P(0,fe)],le.push(...me),re.length===0?le.push(te[0]):le.push(...re),{polygon:le.map(de=>new o.a5(de.x,de.y)),unwrapped:!1}}(t,n);if(c)return c;const f=function(_,y){let M=!1,P=-1/0,D=0;for(let F=0;F<_.length-1;F++)_[F].x>P&&(P=_[F].x,D=F);for(let F=0;F<_.length-1;F++){const N=(D+F)%(_.length-1),G=_[N],X=_[N+1];Math.abs(G.x-X.x)>.5&&(G.x<X.x?(G.x+=1,N===0&&(_[_.length-1].x+=1)):(X.x+=1,N+1===_.length-1&&(_[0].x+=1)),M=!0)}const R=o.am(y.center.lng);return M&&R<Math.abs(R-1)&&_.forEach(F=>{F.x-=1}),{polygon:_,unwrapped:M}}(mn(t,n).map(_=>new o.P(jn(_.x),_.y)),n);return{polygon:f.polygon.map(_=>new o.a5(_.x,_.y)),unwrapped:f.unwrapped}}}function mn(l,t){return o.ao(l,n=>{const c=t.pointCoordinate3D(n);n.x=c.x,n.y=c.y},1/256)}function jn(l){return l<0?1+l%1:l%1}function _r(l){return 100*l|0}function no(l,t,n,c,f){const _=function(M,P){if(M)return f(M);if(P){if(l.url&&P.tiles&&l.tiles&&delete l.tiles,P.variants){if(!Array.isArray(P.variants))return f(new Error("variants must be an array"));for(const R of P.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return f(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){P=o.l(P,R);break}}}const D=o.ar(o.l({},P,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,l.url),f(null,D)}},y=function(M,P,D){if(!M)return null;if(!P&&!D)return M;D=D||M.worldview_default;const R=Object.values(M.language||{});if(R.length===0)return null;const F=Object.values(M.worldview||{});if(F.length===0)return null;const N=R.every(X=>X===P),G=F.every(X=>X===D);return N&&G?M:P in(M.language_options||{})||D in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(l.data,n,c);return y?o.q.frame(()=>_(null,y)):l.url?o.n(t.transformRequest(t.normalizeSourceURL(l.url,null,n,c),o.R.Source),_):o.q.frame(()=>{const{data:M,...P}=l;_(null,P)})}class wr{constructor(t,n,c){this.bounds=o.as.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),c=Math.floor(o.am(this.bounds.getWest())*n),f=Math.floor(o.at(this.bounds.getNorth())*n),_=Math.ceil(o.am(this.bounds.getEast())*n),y=Math.ceil(o.at(this.bounds.getSouth())*n);return t.x>=c&&t.x<_&&t.y>=f&&t.y<y}}class ro extends o.E{constructor(t,n,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.ar(n,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new o.au}load(t){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=no(this._options,this.map._requestManager,n,c,(f,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,f)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.t(f));else if(_){if(o.l(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const y of _.vector_layers)this.vectorLayerIds.push(y.id),_.worldview&&_.worldview[y.source]&&this.localizableLayerIds.add(y.id)}_.bounds&&(this.tileBounds=new wr(_.bounds,this.minzoom,this.maxzoom)),Pr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}t&&t(f)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(t,n){const c=t.tileID.canonical.url(this.tiles,this.scheme),f=this.map._requestManager.normalizeTileURL(c),_=this.map._requestManager.transformRequest(f,o.R.Tile),y=this.map.style?this.map.style.getLut(this.scope):null,M=y?{image:y.image.clone()}:null,P={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&o.f(c)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",P,D.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",P,D.bind(this),void 0,!0);else{const R=o.aw.call({deduped:this._deduped},P,(F,N)=>{F||!N?D.call(this,F):(P.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},t.actor&&t.actor.send("loadTile",P,D.bind(this),void 0,!0))},!0);t.request={cancel:R}}function D(R,F){return delete t.request,t.aborted?n(null):R&&R.status!==404?n(R):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),o.ax(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends o.E{constructor(t,n,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},n),o.l(this,o.ar(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._tileJSONRequest=no(this._options,this.map._requestManager,null,null,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.t(n)):c&&(o.l(this,c),c.raster_layers&&(this.rasterLayers=c.raster_layers,this.rasterLayerIds=this.rasterLayers.map(f=>f.id)),c.bounds&&(this.tileBounds=new wr(c.bounds,this.minzoom,this.maxzoom)),Pr(c.tiles),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const c=o.q.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=o.o(this.map._requestManager.transformRequest(f,o.R.Tile),(_,y,M,P)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):_?(t.state="errored",n(_)):y?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:P}),t.setTexture(y,this.map.painter),t.state="loaded",o.ax(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ts extends pa{constructor(t,n,c,f){super(t,n,c,f),this.type="raster-array",this.maxzoom=22,this._options=o.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);n&&n.enabled&&c&&n._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,o.R.Tile);t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(_,y,M,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(_)return _.code===20?void 0:(t.state="errored",n(_));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:P}),t.state="empty",n(null)})}unloadTile(t,n){const c=t.texture;c&&c instanceof o.T?(t.destroy(!0),this.map.painter.saveTileTexture(c)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,c){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,c,(f,_)=>{if(f)return t.state="errored",this.fire(new o.t(f)),void this.triggerRepaint(t);_&&(t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:_})=>_===t),c=n&&n.fields,f=c&&c.bands&&c.bands;return f?f[0]:0}getTextureDescriptor(t,n,c){if(!t)return;const f=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let _=null;n instanceof o.aB?_=n.paint.get("raster-array-band"):n instanceof o.aC&&(_=n.paint.get("raster-particle-array-band"));const y=_||this.getInitialBand(f);if(y!=null)if(t.textureDescriptor){if(!t.updateNeeded(f,y)||c)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,f,y)}}const Kc={vector:ro,raster:pa,"raster-dem":class extends pa{constructor(l,t,n,c){super(l,t,n,c),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(f,_){f&&(l.state="errored",t(f)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=o.o(this.map._requestManager.transformRequest(n,o.R.Tile),(function(f,_,y,M){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(_){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:M});const P=ImageBitmap&&_ instanceof ImageBitmap&&o.ay(),D=1-(_.width-o.az(_.width))/2;D<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const R=P?_:o.q.getImageData(_,D),F={uid:l.uid,coord:l.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:D};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",F,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,n=Math.pow(2,t.z),c=(t.x-1+n)%n,f=t.x===0?l.wrap-1:l.wrap,_=(t.x+1+n)%n,y=t.x+1===n?l.wrap+1:l.wrap,M={};return M[new o.aA(l.overscaledZ,f,t.z,c,t.y).key]={backfilled:!1},M[new o.aA(l.overscaledZ,y,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(M[new o.aA(l.overscaledZ,f,t.z,c,t.y-1).key]={backfilled:!1},M[new o.aA(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},M[new o.aA(l.overscaledZ,y,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<n&&(M[new o.aA(l.overscaledZ,f,t.z,c,t.y+1).key]={backfilled:!1},M[new o.aA(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},M[new o.aA(l.overscaledZ,y,t.z,_,t.y+1).key]={backfilled:!1}),M}},"raster-array":Ts,geojson:class extends o.E{constructor(l,t,n,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(c),this._data=t.data,this._options=o.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const f=o.ab/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:o.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new o.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new o.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of l.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,n,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:n},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.x("dataloading",{dataType:"source"})),this._loaded=!1;const t=o.l({append:l},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(o.q.resolveURL(n),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new o.t(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new o.x("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,t){const n=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,f=c?{image:c.image.clone()}:null,_=this._partialReload,y={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:_};l.request=this.actor.send(n,y,(M,P)=>_&&!P?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):M?t(M):(l.loadVectorData(P,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aD{constructor(l,t,n,c){super(l,t,n,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aE(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new o.t(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new o.t(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aD,model:class extends o.E{constructor(l,t,n,c){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const n=this._options.models[t],c=o.aG(this.map._requestManager.transformRequest(n.uri,o.R.Model).url).then(f=>{if(!f)return;const _=o.aH(f),y=new o.aI(t,n.position,n.orientation,_);y.computeBoundsAndApplyParent(),this.models.push(y)}).catch(f=>{this.fire(new o.t(new Error(`Could not load model ${t} from ${n.uri}: ${f.message}`)))});l.push(c)}return Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new o.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(l,t,n,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}load(l){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=no(this._options,this.map._requestManager,t,n,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new o.t(c))):f&&(o.l(this,f),f.bounds&&(this.tileBounds=new wr(f.bounds,this.minzoom,this.maxzoom)),Pr(f.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(n,o.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const _=Object.values(l.buckets);for(const y of _)y.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,f.bind(this),void 0,!0);function f(_,y){return l.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&y&&l.setExpiryData(y),l.loadModelData(y,this.map.painter),l.state="loaded",void t(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aD{constructor(l,t,n,c){super(l,t,n,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(_=>typeof _!="number"))||this.fire(new o.t(new o.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.t(new o.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.t(new o.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.t(new o.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.t(new o.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof o.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.E{constructor(l,t,n,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:n,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:n,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:n,y:c,z:f}=l.tileID.canonical,_=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:n,y:c,z:f},{signal:_.signal})).then((function(y){return delete l.request,l.aborted?(l.state="unloaded",t(null)):y===void 0?(l.state="errored",t(null)):y===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(y)?(this.loadTileData(l,y),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(y=>{y.code!==20&&(l.state="errored",t(y))}),l.request.cancel=()=>_.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof o.T?(l.destroy(!0),l.texture&&l.texture instanceof o.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:n,y:c,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:n,y:c,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=o.av(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}}},ih=function(l,t,n,c){const f=new Kc[t.type](l,t,n,c);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return o.aJ(["load","abort","unload","serialize","prepare"],f),f};function nh(l,t){const n=o.a6.mat4.identity([]);return o.a6.mat4.scale(n,n,[.5*l.width,.5*-l.height,1]),o.a6.mat4.translate(n,n,[1,-1,0]),o.a6.mat4.multiply(n,n,l.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function pf(l,t,n,c,f,_,y,M,P=!1){const D=l.tilesIn(n,M,P);D.sort(ul);const R=[];for(const N of D)R.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,l._state,N,c,f,_,y,nh(l.transform,N.tile.tileID),P)});const F=function(N){const G={},X={};for(const W of N){const K=W.queryResults,Y=W.wrappedTileID,te=X[Y]=X[Y]||{};for(const re in K){const le=K[re],fe=te[re]=te[re]||{},me=G[re]=G[re]||[];for(const de of le)fe[de.featureIndex]||(fe[de.featureIndex]=!0,me.push(de))}}return G}(R);for(const N in F)F[N].forEach(G=>{const X=G.feature,W=X.layer;W&&W.type!=="background"&&W.type!=="sky"&&W.type!=="slot"&&(o.aK(N)||(X.source=W.source,W["source-layer"]&&(X.sourceLayer=W["source-layer"])),X.state=X.id!==void 0?l.getFeatureState(W["source-layer"],X.id):{})});return F}function mf(l,t){const n=l.getRenderableIds().map(_=>l.getTileByID(_)),c=[],f={};for(let _=0;_<n.length;_++){const y=n[_],M=y.tileID.canonical.key;f[M]||(f[M]=!0,y.querySourceFeatures(c,t))}return c}function ul(l,t){const n=l.tileID,c=t.tileID;return n.overscaledZ-c.overscaledZ||n.canonical.y-c.canonical.y||n.wrap-c.wrap||n.canonical.x-c.canonical.x}function hl(l,t){const n={};if(!t)return n;for(const c of l){const f=c.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(f.length!==0){c.layers=f,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(_=>f.filter(y=>y.id===_)[0]));for(const _ of f)n[_.fqid]=c}}return n}const Uo=32,Vo=33,Ss=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,n=0,c=0,f=0,_=0,y=0,M=0;for(1&t?f=_=y=Uo:n=c=M=Uo;(t>>=1)>1;){const D=n+f>>1,R=c+_>>1;1&t?(f=n,_=c,n=y,c=M):(n=f,c=_,f=y,_=M),y=D,M=R}const P=4*l;Ss[P+0]=n,Ss[P+1]=c,Ss[P+2]=f,Ss[P+3]=_}const wo=new Uint16Array(2178),jo=new Uint8Array(1089),Ql=new Uint16Array(1089);function _f(l){return l===0?-.03125:l===32?.03125:0}const rh={type:2,extent:o.ab,loadGeometry:()=>[[new o.P(0,0),new o.P(o.ab+1,0),new o.P(o.ab+1,o.ab+1),new o.P(0,o.ab+1),new o.P(0,0)]]};class Es{constructor(t,n,c,f,_){this.tileID=t,this.uid=o.aQ(),this.uses=0,this.tileSize=n,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<o.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=hl(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof o.aS){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof o.aS&&_.hasRTLText){this.hasRTLText=!0,o.aT();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f],y=n.style.getOwnLayer(f);if(!y)continue;const M=y.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,M)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.aR}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets={...this.buckets,...hl(t.buckets,n.style)},t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(t)}const n=t.gl,c=this.imageAtlas;if(c&&!c.uploaded){const f=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new o.T(t,c.image,n.RGBA8,{useMipmap:f}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=n.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this._lastUpdatedBrightness=f,this.updateBuckets(n)))}queryRenderedFeatures(t,n,c,f,_,y,M,P,D){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:P,transform:M,filter:f,layers:_,availableImages:y,tileTransform:this.tileTransform},t,n):{}}querySourceFeatures(t,n){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),_=n?n.sourceLayer:"",y=f._geojsonTileLayer||f[_];if(!y)return;const M=o.aU(n&&n.filter),{z:P,x:D,y:R}=this.tileID.canonical,F={z:P,x:D,y:R};for(let N=0;N<y.length;N++){const G=y.feature(N);if(M.needGeometry){const K=o.aV(G,!0);if(!M.filter(new o.a3(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!M.filter(new o.a3(this.tileID.overscaledZ),G))continue;const X=c.getId(G,_),W=new o.aW(G,P,D,R,X);W.tile=F,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const c=o.aX(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(n)if(this.expirationTime<n)f=!0;else{const _=this.expirationTime-n;_?this.expirationTime=c+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),c=t.style.listImages(),f=t.style.getBrightness();for(const _ in this.buckets){if(!t.style.hasLayer(_))continue;const y=this.buckets[_],M=y.layers[0],P=M.sourceLayer||"_geojsonTileLayer",D=n[P],R=t.style.getSourceCache(M.source,M.scope);let F={};R&&(F=R._state.getState(P,void 0)),y.update(F,D,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},f),(y instanceof o.aY||y instanceof o.aZ)&&t._terrain&&t._terrain.enabled&&R&&y.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(R.id,this.tileID);const N=t&&t.style&&t.style.getOwnLayer(_);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.q.now()+t}setTexture(t,n){const c=n.context,f=c.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(c,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,n){const c={};for(const f of n)c[f]=!0;this.dependencies[t]=c}hasDependency(t,n){for(const c of t){const f=this.dependencies[c];if(f){for(const _ of n)if(f[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const c=o.a_(rh,this.tileID.canonical,this.tileTransform)[0],f=new o.a$,_=new o.b0;for(let y=0;y<c.length;y++){const{x:M,y:P}=c[y];f.emplaceBack(M,P),_.emplaceBack(y)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(f,o.b1.members),this._tileDebugSegments=o.b2.simpleSegment(0,0,f.length,_.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const c=o.a_(rh,this.tileID.canonical,this.tileTransform)[0];let f,_;if(this.isRaster){const y=function(M,P){const D=o.aL(M,P),R=Math.pow(2,M.z);for(let K=0;K<Vo;K++)for(let Y=0;Y<Vo;Y++){const te=o.aM((M.x+(Y+_f(Y))/Uo)/R),re=o.aN((M.y+(K+_f(K))/Uo)/R),le=P.project(te,re),fe=K*Vo+Y;wo[2*fe+0]=Math.round((le.x*D.scale-D.x)*o.ab),wo[2*fe+1]=Math.round((le.y*D.scale-D.y)*o.ab)}jo.fill(0),Ql.fill(0);for(let K=2045;K>=0;K--){const Y=4*K,te=Ss[Y+0],re=Ss[Y+1],le=Ss[Y+2],fe=Ss[Y+3],me=te+le>>1,de=re+fe>>1,ge=me+de-re,Te=de+te-me,Ce=re*Vo+te,Ae=fe*Vo+le,Ee=de*Vo+me,Ge=Math.hypot((wo[2*Ce+0]+wo[2*Ae+0])/2-wo[2*Ee+0],(wo[2*Ce+1]+wo[2*Ae+1])/2-wo[2*Ee+1])>=16;jo[Ee]=jo[Ee]||(Ge?1:0),K<1022&&(jo[Ee]=jo[Ee]||jo[(re+Te>>1)*Vo+(te+ge>>1)]||jo[(fe+Te>>1)*Vo+(le+ge>>1)])}const F=new o.aO,N=new o.aP;let G=0;function X(K,Y){const te=Y*Vo+K;return Ql[te]===0&&(F.emplaceBack(wo[2*te+0],wo[2*te+1],K*o.ab/Uo,Y*o.ab/Uo),Ql[te]=++G),Ql[te]-1}function W(K,Y,te,re,le,fe){const me=K+te>>1,de=Y+re>>1;if(Math.abs(K-le)+Math.abs(Y-fe)>1&&jo[de*Vo+me])W(le,fe,K,Y,me,de),W(te,re,le,fe,me,de);else{const ge=X(K,Y),Te=X(te,re),Ce=X(le,fe);N.emplaceBack(ge,Te,Ce)}}return W(0,0,Uo,Uo,Uo,0),W(Uo,Uo,0,0,0,Uo),{vertices:F,indices:N}}(this.tileID.canonical,n);f=y.vertices,_=y.indices}else{f=new o.aO,_=new o.aP;for(const{x:M,y:P}of c)f.emplaceBack(M,P,0,0);const y=o.b3(f.int16,void 0,4);for(let M=0;M<y.length;M+=3)_.emplaceBack(y[M],y[M+1],y[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,o.b4.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=o.b2.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugBuffers(t,n){const c=n.projection;if(!c||c.name!=="globe"||n.freezeTileCoverage)return;const f=this.tileID.canonical,_=o.b5(f,n),y=o.b6(_),M=o.a9(n.zoom);let P;M>0&&(P=o.a6.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,n,y,P,M),this._makeGlobeTileDebugTextBuffer(t,f,n,y,P,M)}_globePoint(t,n,c,f,_,y,M){let P=o.b7(t,n,c);if(y){const D=1<<c.z,R=o.am(f.center.lng),F=o.at(f.center.lat),N=(c.x+.5)/D-R;let G=0;N>.5?G=-1:N<-.5&&(G=1);let X=(t/o.ab+c.x)/D+G,W=(n/o.ab+c.y)/D;X=(X-R)*f._pixelsPerMercatorPixel+R,W=(W-F)*f._pixelsPerMercatorPixel+F;const K=[X*f.worldSize,W*f.worldSize,0];o.a6.vec3.transformMat4(K,K,y),P=o.b8(P,K,M)}return o.a6.vec3.transformMat4(P,P,_)}_makeGlobeTileDebugBorderBuffer(t,n,c,f,_,y){const M=new o.a$,P=new o.b0,D=new o.b9,R=(N,G,X,W,K)=>{const Y=(X-N)/(K-1),te=(W-G)/(K-1),re=M.length;for(let le=0;le<K;le++){const fe=N+le*Y,me=G+le*te;M.emplaceBack(fe,me);const de=this._globePoint(fe,me,n,c,f,_,y);D.emplaceBack(de[0],de[1],de[2]),P.emplaceBack(re+le)}},F=o.ab;R(0,0,F,0,16),R(F,0,F,F,16),R(F,F,0,F,16),R(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(P),this._tileDebugBuffer=t.createVertexBuffer(M,o.b1.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,o.ba.members),this._tileDebugSegments=o.b2.simpleSegment(0,0,M.length,P.length)}_makeGlobeTileDebugTextBuffer(t,n,c,f,_,y){const M=o.ab/4,P=new o.a$,D=new o.aP,R=new o.b9,F=25;D.reserve(32),P.reserve(F),R.reserve(F);const N=(G,X)=>F*G+X;for(let G=0;G<F;G++){const X=G*M;for(let W=0;W<F;W++){const K=W*M;P.emplaceBack(K,X);const Y=this._globePoint(K,X,n,c,f,_,y);R.emplaceBack(Y[0],Y[1],Y[2])}}for(let G=0;G<4;G++)for(let X=0;X<4;X++){const W=N(G,X),K=N(G,X+1),Y=N(G+1,X),te=N(G+1,X+1);D.emplaceBack(W,K,Y),D.emplaceBack(Y,K,te)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(P,o.b1.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(R,o.ba.members),this._tileDebugTextSegments=o.b2.simpleSegment(0,0,F,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bb.setPbf(o.bc);class ec extends Es{constructor(t,n,c,f,_){super(t,n,c,f,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,n){const c=n.context,f=c.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t,{premultiply:!1}):this.texture=new o.T(c,t,f.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const c=this._mrt=new o.bb(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bd(f,(_,y,M,P)=>{if(_)n(_);else try{const D=c.getHeaderLength(y);if(D>t)return void(this.request=this.fetchHeader(D,n));c.parseHeader(y),this._isHeaderLoaded=!0;let R=0;for(const F of Object.values(c.layers))R=Math.max(R,F.dataIndex[F.dataIndex.length-1].last_byte);y.byteLength>=R&&(this.entireBuffer=y),n(null,this.entireBuffer||y,M,P)}catch(D){n(D)}}),this.request}fetchBand(t,n,c){const f=this._mrt;if(!this._isHeaderLoaded||!f)return void c(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void c(new Error("Can't fetch tile band without an actor"));let y;const M=(F,N)=>{y.complete(F,N),F?c(F):(this.updateTextureDescriptor(t,n),c(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(F,N)=>{if(F)return c(F);const G=_.send("decodeRasterArray",{buffer:N,task:y},M,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),y.cancel()})},D=f.getLayer(t);if(!D)return void c(new Error(`Unknown sourceLayer "${t}"`));if(D.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const R=D.getDataRange([n]);if(y=f.createDecodingTask(R),!y||y.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),N=o.bd(F,P);this._fetchQueue.push(()=>{N.cancel(),y.cancel()})}else c(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const c=this._mrt.getLayer(t);if(!c||!c.hasBand(n)||!c.hasDataForBand(n))return;const{bytes:f,tileSize:_,buffer:y,offset:M,scale:P}=c.getBandView(n),D=_+2*y,R={data:f,width:D,height:D},F=this.texture;F&&F instanceof o.T&&F.update(R,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:R,buffer:y,offset:M,tileSize:_,format:c.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class Wd{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const _={value:n,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const c=t.wrapped().key,f=n===void 0?0:this.data[c].indexOf(n),_=this.data[c][f];return this.data[c].splice(f,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||n.push(f);for(const c of n)this.remove(c.value.tileID,c)}}class Zd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,c){const f=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},o.l(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==f&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const _ in this.state[t][f])c[_]||(this.deletedStates[t][f][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][_]===null&&delete this.deletedStates[t][f][_]}removeFeatureState(t,n,c){if(this.deletedStates[t]===null)return;const f=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&n!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,n){const c=this.state[t]||{},f=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(n!==void 0){const M=String(n),P=o.l({},c[M],f[M]);if(_){const D=_[n];if(D===null)return{};for(const R in D)delete P[R]}return P}const y=o.l({},c,f);if(_)for(const M in _)delete y[M];return y}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),o.l(this.state[f][y],this.stateChanges[f][y]),_[y]=this.state[f][y];c[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const y in this.state[f])_[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(const M of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][M];_[y]=this.state[f][y]}c[f]=c[f]||{},o.l(c[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].refreshFeatureState(n)}}class ho extends o.E{constructor(t,n,c){super(),this.id=t,this._onlySymbols=c,n.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Wd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Zd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const c=this._tiles[n];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.be(this._tiles).map(t=>t.tileID).sort(Xs).map(t=>t.key)}getRenderableIds(t,n){const c=[];for(const f in this._tiles)this._isIdRenderable(+f,t,n)&&c.push(this._tiles[f]);return t?c.sort((f,_)=>{const y=f.tileID,M=_.tileID,P=new o.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),D=new o.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-M.overscaledZ||D.y-P.y||D.x-P.x}).map(f=>f.tileID.key):c.map(f=>f.tileID).sort(Xs).map(f=>f.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=n),this._loadTile(c,this._tileLoaded.bind(this,c,t,n)))}_tileLoaded(t,n,c,f){if(f)if(t.state="errored",f.status!==404)this._source.fire(new o.t(f,{tile:t}));else{if(this._source.fire(new o.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=o.q.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new o.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let f=0;f<n.length;f++){const _=n[f];if(t.neighboringTiles&&t.neighboringTiles[_]){const y=this.getTileByID(_);c(t,y),c(y,t)}}function c(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=_.tileID.canonical.x-f.tileID.canonical.x;const M=_.tileID.canonical.y-f.tileID.canonical.y,P=Math.pow(2,f.tileID.canonical.z),D=_.tileID.key;y===0&&M===0||Math.abs(M)>1||(Math.abs(y)>1&&(Math.abs(y+P)===1?y+=P:Math.abs(y-P)===1&&(y-=P)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,y,M),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,c,f){for(const _ in this._tiles){let y=this._tiles[_];if(f[_]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>c)continue;let M=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(M=D)}let P=M;for(;P.overscaledZ>n;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]){f[M.key]=M;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=n?c:null}for(let c=t.overscaledZ-1;c>=n;c--){const f=t.scaledTo(c),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const c=Math.ceil(t.width/n)+1,f=Math.ceil(t.height/n)+1,_=Math.floor(c*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(M)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const c={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),c[_.tileID.key]=_}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,n,c,f){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let y,M=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const F=P.attenuationRange()[0],N=Math.floor(F)-Math.log2(P.getDemUpscale());M>N&&(M=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)y=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new o.aA(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,y=F.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(y.push(new o.aA(1,0,1,0,0)),y.push(new o.aA(1,0,1,1,0)),y.push(new o.aA(1,0,1,0,1)),y.push(new o.aA(1,0,1,1,1)))}else if(y=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);y=y.filter(N=>F(N))}}else y=[];if(y.length>0&&this.castsShadows&&f&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ys(this._source.type)){const F=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),N=Math.min(F,this._source.maxzoom);if(_){const G=t.extendTileCover(y,N);for(const X of G)y.push(X)}else{const G=t.extendTileCover(y,N,f);for(const X of G)this._shadowCasterTiles[X.key]=!0,y.push(X)}}const D=this._updateRetainedTiles(y);if(Ys(this._source.type)&&y.length!==0){const F={},N={},G=Object.keys(D);for(const W of G){const K=D[W],Y=this._tiles[W];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=o.q.now())continue;const te=this.findLoadedParent(K,Math.max(K.overscaledZ-ho.maxOverzooming,this._source.minzoom));te&&(this._addTile(te.tileID),F[te.tileID.key]=te.tileID),N[W]=K}const X=y[y.length-1].overscaledZ;for(const W in this._tiles){const K=this._tiles[W];if(D[W]||!K.hasData())continue;let Y=K.tileID;for(;Y.overscaledZ>X;){Y=Y.scaledTo(Y.overscaledZ-1);const te=this._tiles[Y.key];if(te&&te.hasData()&&N[Y.key]){D[W]=K.tileID;break}}}for(const W in F)D[W]||(this._coveredTiles[W]=!0,D[W]=F[W])}for(const F in D)this._tiles[F].clearFadeHold();const R=o.bf(this._tiles,D);for(const F of R){const N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const c={},f=t.reduce((D,R)=>Math.min(D,R.overscaledZ),1/0),_=t[0].overscaledZ,y=Math.max(_-ho.maxOverzooming,this._source.minzoom),M=Math.max(_+ho.maxUnderzooming,this._source.minzoom),P={};for(const D of t){const R=this._addTile(D);n[D.key]=D,R.hasData()||f<this._source.maxzoom&&(P[D.key]=D)}this._retainLoadedChildren(P,f,M,n);for(const D of t){let R=this._tiles[D.key];if(R.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const N=D.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){n[N.key]=N;continue}}else{const N=D.children(this._source.maxzoom);if(n[N[0].key]&&n[N[1].key]&&n[N[2].key]&&n[N[3].key])continue}let F=R.wasRequested();for(let N=D.overscaledZ-1;N>=y;--N){const G=D.scaledTo(N);if(c[G.key]||(c[G.key]=!0,R=this.getTile(G),!R&&F&&(R=this._addTile(G)),R&&(n[G.key]=G,F=R.wasRequested(),R.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}n.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;f=_}for(const _ of n)this._loadedParentTiles[_]=c}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const c=!!n;if(!c){const f=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new ec(t,_,this.transform.tileZoom,f,this._isRaster):new Es(t,_,this.transform.tileZoom,f,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,c||this._source.fire(new o.x("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=n.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,c){const f=[],_=this.transform;if(!_)return f;const y=_.projection.name==="globe",M=o.am(_.center.lng);for(const P in this._tiles){const D=this._tiles[P];if(c&&D.clearQueryDebugViz(),D.holdingForFade())continue;let R;if(y){const F=D.tileID.canonical;if(F.z===0){const N=[Math.abs(o.ap(M,...fl(F,-1))-M),Math.abs(o.ap(M,...fl(F,1))-M)];R=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(o.ap(M,...fl(F,-1))-M),Math.abs(o.ap(M,...fl(F,0))-M),Math.abs(o.ap(M,...fl(F,1))-M)];R=[N.indexOf(Math.min(...N))-1]}}else R=[0];for(const F of R){const N=t.containsTile(D,_,n,F);N&&f.push(N)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const c=this.getRenderableIds(t,n).map(_=>this._tiles[_].tileID),f=this.transform.projection.name==="globe";for(const _ of c)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=f?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return c}sortCoordinatesByDistance(t){const n=t.slice(),c=this.transform._camera.position,f=this.transform._camera.forward(),_={};for(const y of n){const M=1/(1<<y.canonical.z);_[y.key]=((y.canonical.x+.5)*M+y.wrap-c[0])*f[0]+((y.canonical.y+.5)*M-c[1])*f[1]-c[2]*f[2]}return n.sort((y,M)=>_[y.key]-_[M.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Ys(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(t,n,c){this._state.updateState(t=t||"_geojsonTileLayer",n,c)}removeFeatureState(t,n,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,c)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,c){const f=this._tiles[t];f&&f.setDependencies(n,c)}reloadTilesForDependencies(t,n){for(const c in this._tiles)this._tiles[c].hasDependency(t,n)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(t,n))};return void this._source.on("data",P)}const c=new Map,f=Array.isArray(t)?t:[t],_=this.map.painter.terrain,y=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const P of f){const D=P.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of D)c.set(R.key,R);this.usedForTerrain&&P.updateElevation(!1)}const M=Array.from(c.values());o.bg(M,(P,D)=>{const R=new Es(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,F=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),D(F,R)})},n)}}function Xs(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function Ys(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function fl(l,t){const n=1<<l.z;return[l.x/n+t,(l.x+1)/n+t]}ho.maxOverzooming=10,ho.maxUnderzooming=3;class oh{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const c in this.style._mergedLayers){const f=this.style._mergedLayers[c];if(f.type==="fill-extrusion")this.layers.push({layer:f,visible:t,visibilityChanged:n});else if(f.type==="model"){const _=this.style.getLayerSource(f);_&&_.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const c=n.layer;let f=!1;c.type==="fill-extrusion"?f=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="model"&&(f=!c.isHidden(t)&&c.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!f&&n.visible,n.visible=f}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const f of this.layers){const _=f.layer,y=this.style.getLayerSourceCache(_);let M=1;_.type==="fill-extrusion"&&(M=f.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let P=y?y.getTile(n):null;if(!P&&y&&n.canonical.z>y.getSource().minzoom){let D=n.scaledTo(Math.min(y.getSource().maxzoom,n.overscaledZ-1));for(;D.overscaledZ>=y.getSource().minzoom&&(P=y.getTile(D),!P&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(_):null,tileID:P?P.tileID:n,verticalScale:M})}t.hasAnyZOffset=!1;let c=!1;for(let f=0;f<t.symbolInstances.length;f++){const _=t.symbolInstances.get(f),y=_.zOffset,M=this._getHeightAtTileOffset(n,_.tileAnchorX,_.tileAnchorY);_.zOffset=M!==Number.NEGATIVE_INFINITY?M:y,c||y===_.zOffset||(c=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,c,f){let _=n,y=c;if(t.canonical.z!==f.canonical.z){const M=f.canonical,P=1/(1<<t.canonical.z-M.z);_=(n+t.canonical.x*o.ab)*P-M.x*o.ab|0,y=(c+t.canonical.y*o.ab)*P-M.y*o.ab|0}return{tileX:_,tileY:y}}_getHeightAtTileOffset(t,n,c){let f,_;for(let y=0;y<this.layers.length;++y){if(this.layers[y].layer.type!=="fill-extrusion")continue;const{bucket:M,tileID:P,verticalScale:D}=this.currentBuildingBuckets[y];if(!M)continue;const{tileX:R,tileY:F}=this._mapCoordToOverlappingTile(t,n,c,P),N=M.getHeightAtTileCoord(R,F);N&&N.height!==void 0&&(N.hidden?f=N.height:_=Math.max(N.height*D,_||0))}if(_!==void 0)return _;for(let y=0;y<this.layers.length;++y){const M=this.layers[y];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:P,tileID:D}=this.currentBuildingBuckets[y];if(!P)continue;const{tileX:R,tileY:F}=this._mapCoordToOverlappingTile(t,n,c,D),N=P.getHeightAtTileCoord(R,F);if(N&&!N.hidden)return N.height===void 0&&f!==void 0?Math.min(N.maxHeight,f)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function tc(l,t){const n={};for(const c in l)c!=="ref"&&(n[c]=l[c]);return o.bh.forEach(c=>{c in t&&(n[c]=t[c])}),n}function sh(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=tc(l[n],t[l[n].ref]));return l}const Ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ah(l,t,n){n.push({command:Ki.addSource,args:[l,t[l]]})}function _n(l,t,n){t.push({command:Ki.removeSource,args:[l]}),n[l]=!0}function lm(l,t,n,c){_n(l,n,c),ah(l,t,n)}function hi(l,t,n){let c;for(c in l[n])if(l[n].hasOwnProperty(c)&&c!=="data"&&!o.bi(l[n][c],t[n][c]))return!1;for(c in t[n])if(t[n].hasOwnProperty(c)&&c!=="data"&&!o.bi(l[n][c],t[n][c]))return!1;return!0}function Jc(l,t,n,c,f,_){let y;for(y in t=t||{},l=l||{})l.hasOwnProperty(y)&&(o.bi(l[y],t[y])||n.push({command:_,args:[c,y,t[y],f]}));for(y in t)t.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(o.bi(l[y],t[y])||n.push({command:_,args:[c,y,t[y],f]}))}function Va(l){return l.id}function ic(l,t){return l[t.id]=t,l}class As{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ap(t,0,1);let n=1,c=this._distances[n];const f=t*this.paddedLength+this.padding;for(;c<f&&n<this._distances.length;)c=this._distances[++n];const _=n-1,y=this._distances[_],M=c-y,P=M>0?(f-y)/M:0;return this.points[_].mult(1-P).add(this.points[n].mult(P))}}class lh{constructor(t,n,c){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(n/c);for(let y=0;y<this.xCellCount*this.yCellCount;y++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,c,f,_){this._forEachCell(n,c,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(t,n,c,f){this._forEachCell(n-f,c-f,n+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,n,c,f,_,y){this.boxCells[_].push(y)}_insertCircleCell(t,n,c,f,_,y){this.circleCells[_].push(y)}_query(t,n,c,f,_,y){if(c<0||t>this.width||f<0||n>this.height)return!_&&[];const M=[];if(t<=0&&n<=0&&this.width<=c&&this.height<=f){if(_)return!0;for(let P=0;P<this.boxKeys.length;P++)M.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const D=this.circles[3*P],R=this.circles[3*P+1],F=this.circles[3*P+2];M.push({key:this.circleKeys[P],x1:D-F,y1:R-F,x2:D+F,y2:R+F})}return y?M.filter(y):M}return this._forEachCell(t,n,c,f,this._queryCell,M,{hitTest:_,seenUids:{box:{},circle:{}}},y),_?M.length>0:M}_queryCircle(t,n,c,f,_){const y=t-c,M=t+c,P=n-c,D=n+c;if(M<0||y>this.width||D<0||P>this.height)return!f&&[];const R=[];return this._forEachCell(y,P,M,D,this._queryCellCircle,R,{hitTest:f,circle:{x:t,y:n,radius:c},seenUids:{box:{},circle:{}}},_),f?R.length>0:R}query(t,n,c,f,_){return this._query(t,n,c,f,!1,_)}hitTest(t,n,c,f,_){return this._query(t,n,c,f,!0,_)}hitTestCircle(t,n,c,f){return this._queryCircle(t,n,c,!0,f)}_queryCell(t,n,c,f,_,y,M,P){const D=M.seenUids,R=this.boxCells[_];if(R!==null){const N=this.bboxes;for(const G of R)if(!D.box[G]){D.box[G]=!0;const X=4*G;if(t<=N[X+2]&&n<=N[X+3]&&c>=N[X+0]&&f>=N[X+1]&&(!P||P(this.boxKeys[G]))){if(M.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[G],x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]})}}}const F=this.circleCells[_];if(F!==null){const N=this.circles;for(const G of F)if(!D.circle[G]){D.circle[G]=!0;const X=3*G;if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],t,n,c,f)&&(!P||P(this.circleKeys[G]))){if(M.hitTest)return y.push(!0),!0;{const W=N[X],K=N[X+1],Y=N[X+2];y.push({key:this.circleKeys[G],x1:W-Y,y1:K-Y,x2:W+Y,y2:K+Y})}}}}}_queryCellCircle(t,n,c,f,_,y,M,P){const D=M.circle,R=M.seenUids,F=this.boxCells[_];if(F!==null){const G=this.bboxes;for(const X of F)if(!R.box[X]){R.box[X]=!0;const W=4*X;if(this._circleAndRectCollide(D.x,D.y,D.radius,G[W+0],G[W+1],G[W+2],G[W+3])&&(!P||P(this.boxKeys[X])))return y.push(!0),!0}}const N=this.circleCells[_];if(N!==null){const G=this.circles;for(const X of N)if(!R.circle[X]){R.circle[X]=!0;const W=3*X;if(this._circlesCollide(G[W],G[W+1],G[W+2],D.x,D.y,D.radius)&&(!P||P(this.circleKeys[X])))return y.push(!0),!0}}}_forEachCell(t,n,c,f,_,y,M,P){const D=this._convertToXCellCoord(t),R=this._convertToYCellCoord(n),F=this._convertToXCellCoord(c),N=this._convertToYCellCoord(f);for(let G=D;G<=F;G++)for(let X=R;X<=N;X++)if(_.call(this,t,n,c,f,this.xCellCount*X+G,y,M,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,c,f,_,y){const M=f-t,P=_-n,D=c+y;return D*D>M*M+P*P}_circleAndRectCollide(t,n,c,f,_,y,M){const P=(y-f)/2,D=Math.abs(t-(f+P));if(D>P+c)return!1;const R=(M-_)/2,F=Math.abs(n-(_+R));if(F>R+c)return!1;if(D<=P||F<=R)return!0;const N=D-P,G=F-R;return N*N+G*G<=c*c}}const Ms={unknown:0,flipRequired:1,flipNotRequired:2},Gt=Math.tan(85*Math.PI/180);function Wi(l,t,n,c,f,_,y){const M=o.a6.mat4.create();if(n)if(_.name==="globe"){const P=o.bj(f,t);o.a6.mat4.multiply(M,M,P)}else{const P=o.a6.mat2.invert([],y);M[0]=P[0],M[1]=P[1],M[4]=P[2],M[5]=P[3],c||o.a6.mat4.rotateZ(M,M,f.angle)}else o.a6.mat4.multiply(M,f.labelPlaneMatrix,l);return M}function Zi(l,t,n,c,f,_,y){const M=Wi(l,t,n,c,f,_,y);return _.name==="globe"&&n||(M[2]=M[6]=M[10]=M[14]=0),M}function Lo(l,t,n,c,f,_,y){if(n){if(_.name==="globe"){const M=Wi(l,t,n,c,f,_,y);return o.a6.mat4.invert(M,M),o.a6.mat4.multiply(M,l,M),M}{const M=o.a6.mat4.clone(l),P=o.a6.mat4.identity([]);return P[0]=y[0],P[1]=y[1],P[4]=y[2],P[5]=y[3],o.a6.mat4.multiply(M,M,P),c||o.a6.mat4.rotateZ(M,M,-f.angle),M}}return f.glCoordMatrix}function fo(l,t,n,c){const f=[l,t,n,1];n?o.a6.vec4.transformMat4(f,f,c):ch(f,f,c);const _=f[3];return f[0]/=_,f[1]/=_,f[2]/=_,f}function Ji(l,t){return Math.min(.5+l/t*.5,1.5)}function tr(l,t){const n=l[0]/l[3],c=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&c>=-t[1]&&c<=t[1]}function Hn(l,t,n,c,f,_,y,M,P,D){const R=n.transform,F=c?l.textSizeData:l.iconSizeData,N=o.bk(F,n.transform.zoom),G=R.projection.name==="globe",X=[256/n.width*2+1,256/n.height*2+1],W=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;W.clear();let K=null;G&&(K=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const Y=l.lineVertexArray,te=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,re=n.transform.width/n.transform.height;let le,fe=!1;for(let me=0;me<te.length;me++){const de=te.get(me),{numGlyphs:ge,writingMode:Te}=de;if(Te!==o.bl.vertical||fe||le===o.bl.horizontal||(fe=!0),le=Te,(de.hidden||Te===o.bl.vertical)&&!fe){Is(ge,W);continue}fe=!1;const Ce=new o.P(de.tileAnchorX,de.tileAnchorY);let{x:Ae,y:Ee,z:Ge}=R.projection.projectTilePoint(Ce.x,Ce.y,D.canonical);if(P){const[ot,St,Wt]=P(Ce);Ae+=ot,Ee+=St,Ge+=Wt}const Ye=[Ae,Ee,Ge,1];if(o.a6.vec4.transformMat4(Ye,Ye,t),!tr(Ye,X)){Is(ge,W);continue}const at=Ye[3],_t=Ji(n.transform.getCameraToCenterDistance(R.projection),at),bt=o.bm(F,N,de),ke=y?bt/_t:bt*_t,rt=fo(Ae,Ee,Ge,f);if(rt[3]<=0){Is(ge,W);continue}let $e={};const nt=y?null:P,lt=fr(de,ke,!1,M,t,f,_,l.glyphOffsetArray,Y,W,K,rt,Ce,$e,re,nt,R.projection,D,y);fe=lt.useVertical,nt&&lt.needsFlipping&&($e={}),(lt.notEnoughRoom||fe||lt.needsFlipping&&fr(de,ke,!0,M,t,f,_,l.glyphOffsetArray,Y,W,K,rt,Ce,$e,re,nt,R.projection,D,y).notEnoughRoom)&&Is(ge,W)}c?(l.text.dynamicLayoutVertexBuffer.updateData(W),K&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(K)):(l.icon.dynamicLayoutVertexBuffer.updateData(W),K&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(K))}function nc(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W){const{lineStartIndex:K,glyphStartIndex:Y,segment:te}=M,re=Y+M.numGlyphs,le=K+M.lineLength,fe=t.getoffsetX(Y),me=t.getoffsetX(re-1),de=oc(l*fe,n,c,f,_,y,te,K,le,P,D,R,F,N,!0,G,X,W);if(!de)return null;const ge=oc(l*me,n,c,f,_,y,te,K,le,P,D,R,F,N,!0,G,X,W);return ge?{first:de,last:ge}:null}function To(l,t,n,c){return l===o.bl.horizontal&&Math.abs(c)>Math.abs(n)?{useVertical:!0}:l===o.bl.vertical?c>0?{needsFlipping:!0}:null:t!==Ms.unknown&&function(f,_){return f===0||Math.abs(_/f)>Gt}(n,c)?t===Ms.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function fr(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y,te){const re=t/24,le=l.lineOffsetX*re,fe=l.lineOffsetY*re,{lineStartIndex:me,glyphStartIndex:de,numGlyphs:ge,segment:Te,writingMode:Ce,flipState:Ae}=l,Ee=me+l.lineLength,Ge=Ye=>{if(R){const[ke,rt,$e]=Ye.up,nt=D.length;o.bn(R,nt+0,ke,rt,$e),o.bn(R,nt+1,ke,rt,$e),o.bn(R,nt+2,ke,rt,$e),o.bn(R,nt+3,ke,rt,$e)}const[at,_t,bt]=Ye.point;o.bo(D,at,_t,bt,Ye.angle)};if(ge>1){const Ye=nc(re,M,le,fe,n,F,N,l,P,_,G,W,!1,K,Y,te);if(!Ye)return{notEnoughRoom:!0};if(c&&!n){let[at,_t,bt]=Ye.first.point,[ke,rt,$e]=Ye.last.point;[at,_t]=fo(at,_t,bt,y),[ke,rt]=fo(ke,rt,$e,y);const nt=To(Ce,Ae,(ke-at)*X,rt-_t);if(l.flipState=nt&&nt.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,nt)return nt}Ge(Ye.first);for(let at=de+1;at<de+ge-1;at++){const _t=oc(re*M.getoffsetX(at),le,fe,n,F,N,Te,me,Ee,P,_,G,W,!1,!1,K,Y,te);if(!_t)return D.length-=4*(at-de),{notEnoughRoom:!0};Ge(_t)}Ge(Ye.last)}else{if(c&&!n){const at=fo(N.x,N.y,0,f),_t=me+Te+1,bt=new o.P(P.getx(_t),P.gety(_t)),ke=fo(bt.x,bt.y,0,f),rt=ke[3]>0?ke:rc(N,bt,at,1,f,void 0,K,Y.canonical),$e=To(Ce,Ae,(rt[0]-at[0])*X,rt[1]-at[1]);if(l.flipState=$e&&$e.needsFlipping?Ms.flipRequired:Ms.flipNotRequired,$e)return $e}const Ye=oc(re*M.getoffsetX(de),le,fe,n,F,N,Te,me,Ee,P,_,G,W,!1,!1,K,Y,te);if(!Ye)return{notEnoughRoom:!0};Ge(Ye)}return{}}function Xd(l,t,n,c,f){const{x:_,y,z:M}=c.projectTilePoint(l.x,l.y,t);if(!f)return fo(_,y,M,n);const[P,D,R]=f(l);return fo(_+P,y+D,M+R,n)}function rc(l,t,n,c,f,_,y,M){const P=Xd(l.sub(t)._unit()._add(l),M,f,y,_);return o.a6.vec3.sub(P,n,P),o.a6.vec3.normalize(P,P),o.a6.vec3.scaleAndAdd(P,n,P,c)}function oc(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y){const te=c?l-t:l+t;let re=te>0?1:-1,le=0;c&&(re*=-1,le=Math.PI),re<0&&(le+=Math.PI);let fe=M+y+(re>0?0:1)|0,me=f,de=f,ge=0,Te=0;const Ce=Math.abs(te),Ae=[],Ee=[];let Ge=_,Ye=Ge;const at=()=>rc(Ye,Ge,de,Ce-ge+1,R,N,W,K.canonical);for(;ge+Te<=Ce;){if(fe+=re,fe<M||fe>=P)return null;if(de=me,Ye=Ge,Ae.push(de),G&&Ee.push(Ye),Ge=new o.P(D.getx(fe),D.gety(fe)),me=F[fe],!me){const St=Xd(Ge,K.canonical,R,W,N);me=St[3]>0?F[fe]=St:at()}ge+=Te,Te=o.a6.vec3.distance(de,me)}X&&N&&(F[fe]&&(me=at(),Te=o.a6.vec3.distance(de,me)),F[fe]=me);const _t=(Ce-ge)/Te,bt=Ge.sub(Ye)._mult(_t)._add(Ye),ke=o.a6.vec3.sub([],me,de),rt=o.a6.vec3.scaleAndAdd([],de,ke,_t);let $e=[0,0,1],nt=ke[0],lt=ke[1];if(Y&&($e=W.upVector(K.canonical,bt.x,bt.y),$e[0]!==0||$e[1]!==0||$e[2]!==1)){const St=[$e[2],0,-$e[0]],Wt=o.a6.vec3.cross([],$e,St);o.a6.vec3.normalize(St,St),o.a6.vec3.normalize(Wt,Wt),nt=o.a6.vec3.dot(ke,St),lt=o.a6.vec3.dot(ke,Wt)}if(n){const St=o.a6.vec3.cross([],$e,ke);o.a6.vec3.normalize(St,St),o.a6.vec3.scaleAndAdd(rt,rt,St,n*re)}const ot=le+Math.atan2(lt,nt);return Ae.push(rt),G&&Ee.push(bt),{point:rt,angle:ot,path:Ae,tilePath:Ee,up:$e}}function Is(l,t){const n=t.length,c=n+4*l;t.resize(c),t.float32.fill(-1/0,4*n,4*c)}function ch(l,t,n){const c=t[0],f=t[1];return l[0]=n[0]*c+n[4]*f+n[12],l[1]=n[1]*c+n[5]*f+n[13],l[3]=n[3]*c+n[7]*f+n[15],l}const Yn=100;class oo{constructor(t,n,c=new lh(t.width+200,t.height+200,25),f=new lh(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Yn,this.screenBottomBoundary=t.height+Yn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,c,f,_,y,M,P){let D=c.projectedAnchorX,R=c.projectedAnchorY,F=c.projectedAnchorZ;const N=c.elevation,G=c.tileID,X=t.getProjection();if(N&&G){const[me,de,ge]=X.upVector(G.canonical,c.tileAnchorX,c.tileAnchorY),Te=X.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=me*N*Te,R+=de*N*Te,F+=ge*N*Te}const W=this.projectAndGetPerspectiveRatio(M,D,R,F,c.tileID,X.name==="globe"||!!N||this.transform.pitch>0,X),K=y*W.perspectiveRatio,Y=(c.x1*n+f.x-c.padding)*K+W.point.x,te=(c.y1*n+f.y-c.padding)*K+W.point.y,re=(c.x2*n+f.x+c.padding)*K+W.point.x,le=(c.y2*n+f.y+c.padding)*K+W.point.y,fe=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(Y,te,re,le)||!_&&this.grid.hitTest(Y,te,re,le,P)||fe?{box:[],offscreen:!1,occluded:W.occluded}:{box:[Y,te,re,le],offscreen:this.isOffscreen(Y,te,re,le),occluded:!1}}placeCollisionCircles(t,n,c,f,_,y,M,P,D,R,F,N,G,X,W){const K=[],Y=this.transform.elevation,te=t.getProjection(),re=Y?Y.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,te):null,le=new o.P(c.tileAnchorX,c.tileAnchorY);let{x:fe,y:me,z:de}=te.projectTilePoint(le.x,le.y,W.canonical);if(re){const[bt,ke,rt]=re(le);fe+=bt,me+=ke,de+=rt}const ge=te.name==="globe",Te=this.projectAndGetPerspectiveRatio(M,fe,me,de,W,ge||!!Y||this.transform.pitch>0,te),{perspectiveRatio:Ce}=Te,Ae=(F?y/Ce:y*Ce)/o.br,Ee=fo(fe,me,de,P),Ge=Te.signedDistanceFromCamera>0?nc(Ae,_,c.lineOffsetX*Ae,c.lineOffsetY*Ae,!1,Ee,le,c,f,P,{},Y&&!F?re:null,F&&!!Y,te,W,F):null;let Ye=!1,at=!1,_t=!0;if(Ge&&!Te.occluded){const bt=.5*G*Ce+X,ke=new o.P(-100,-100),rt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new As,{first:nt,last:lt}=Ge,ot=nt.path.length;let St=[];for(let kt=ot-1;kt>=1;kt--)St.push(nt.path[kt]);for(let kt=1;kt<lt.path.length;kt++)St.push(lt.path[kt]);const Wt=2.5*bt;D&&(St=St.map(([kt,Kt,zt],ai)=>(re&&!ge&&(zt=re(ai<ot-1?nt.tilePath[ot-1-ai]:lt.tilePath[ai-ot+2])[2]),fo(kt,Kt,zt,D))),St.some(kt=>kt[3]<=0)&&(St=[]));let ti=[];if(St.length>0){let kt=1/0,Kt=-1/0,zt=1/0,ai=-1/0;for(const Si of St)kt=Math.min(kt,Si[0]),zt=Math.min(zt,Si[1]),Kt=Math.max(Kt,Si[0]),ai=Math.max(ai,Si[1]);Kt>=ke.x&&kt<=rt.x&&ai>=ke.y&&zt<=rt.y&&(ti=[St.map(Si=>new o.P(Si[0],Si[1]))],(kt<ke.x||Kt>rt.x||zt<ke.y||ai>rt.y)&&(ti=o.bp(ti,ke.x,ke.y,rt.x,rt.y)))}for(const kt of ti){$e.reset(kt,.25*bt);let Kt=0;Kt=$e.length<=.5*bt?1:Math.ceil($e.paddedLength/Wt)+1;for(let zt=0;zt<Kt;zt++){const ai=zt/Math.max(Kt-1,1),Si=$e.lerp(ai),Ui=Si.x+Yn,Mn=Si.y+Yn;K.push(Ui,Mn,bt,0);const en=Ui-bt,kn=Mn-bt,ln=Ui+bt,In=Mn+bt;if(_t=_t&&this.isOffscreen(en,kn,ln,In),at=at||this.isInsideGrid(en,kn,ln,In),!n&&this.grid.hitTestCircle(Ui,Mn,bt,N)&&(Ye=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ye,occluded:!1}}}}return{circles:!R&&Ye||!at?[]:K,offscreen:_t,collisionDetected:Ye,occluded:Te.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let c=1/0,f=1/0,_=-1/0,y=-1/0;for(const R of t){const F=new o.P(R.x+Yn,R.y+Yn);c=Math.min(c,F.x),f=Math.min(f,F.y),_=Math.max(_,F.x),y=Math.max(y,F.y),n.push(F)}const M=this.grid.query(c,f,_,y).concat(this.ignoredGrid.query(c,f,_,y)),P={},D={};for(const R of M){const F=R.key;if(P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]={}),P[F.bucketInstanceId][F.featureIndex])continue;const N=[new o.P(R.x1,R.y1),new o.P(R.x2,R.y1),new o.P(R.x2,R.y2),new o.P(R.x1,R.y2)];o.bq(n,N)&&(P[F.bucketInstanceId][F.featureIndex]=!0,D[F.bucketInstanceId]===void 0&&(D[F.bucketInstanceId]=[]),D[F.bucketInstanceId].push(F.featureIndex))}return D}insertCollisionBox(t,n,c,f,_){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,c,f,_){const y=n?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:f,collisionGroupID:_};for(let P=0;P<t.length;P+=4)y.insertCircle(M,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,n,c,f,_,y,M){const P=[n,c,f,1];let D=!1;f||this.transform.pitch>0?(o.a6.vec4.transformMat4(P,P,t),this.fogState&&_&&M.name!=="globe"&&(D=function(N,G,X,W,K,Y){const te=Y.calculateFogTileMatrix(K),re=[G,X,W];return o.a6.vec3.transformMat4(re,re,te),Lt(N,o.a6.vec3.length(re),Y.pitch,Y._fov)}(this.fogState,n,c,f,_.toUnwrapped(),this.transform)>.9)):ch(P,P,t);const R=P[3];return{point:new o.P((P[0]/R+1)/2*this.transform.width+Yn,(-P[1]/R+1)/2*this.transform.height+Yn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/R*.5,1.5),signedDistanceFromCamera:R,occluded:y&&P[2]>R||D}}isOffscreen(t,n,c,f){return c<Yn||t>=this.screenRightBoundary||f<Yn||n>this.screenBottomBoundary}isInsideGrid(t,n,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=o.a6.mat4.identity([]);return o.a6.mat4.translate(t,t,[-100,-100,0]),t}}function Lr(l,t,n){const c=t.createTileMatrix(l,l.worldSize,n.toUnwrapped());return o.a6.mat4.multiply(new Float32Array(16),l.projMatrix,c)}function gf(l,t,n){if(t.projection.name===n.projection.name)return l.projMatrix;const c=n.clone();return c.setProjection(t.projection),Lr(c,t.getProjection(),l)}function Ks(l,t,n){return t.name===n.projection.name?l.projMatrix:Lr(n,t,l)}class On{constructor(t,n,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class po{constructor(t,n,c,f,_,y=!1){this.text=new On(t?t.text:null,n,c,_),this.icon=new On(t?t.icon:null,n,f,_),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class is{constructor(t,n,c,f=!1){this.text=t,this.icon=n,this.skipFade=c,this.clipped=f}}class zr{constructor(){this.invProjMatrix=o.a6.mat4.create(),this.viewportMatrix=o.a6.mat4.create(),this.circles=[]}}class uh{constructor(t,n,c,f,_){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=_}}class ns{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:c=>c.collisionGroupID===n}}return this.collisionGroups[t]}}function dl(l,t,n,c,f){const{horizontalAlign:_,verticalAlign:y}=o.by(l),M=-(_-.5)*t,P=-(y-.5)*n,D=o.bx(l,c);return new o.P(M+D[0]*f,P+D[1]*f)}function Jr(l,t,n,c,f){const _=new o.P(l,t);return n&&_._rotate(c?f:-f),_}class pl{constructor(t,n,c,f,_,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new oo(this.transform,_),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new ns(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,c,f,_=1){const y=c.getBucket(n),M=c.latestFeatureIndex;if(!y||!M||n.fqid!==y.layerIds[0])return;const P=y.layers[0].layout,D=y.layers[0].paint,R=c.collisionBoxArray,F=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),N=c.tileSize/o.ab,G=c.tileID.toUnwrapped();this.transform.setProjection(y.projection);const X=(W=c.tileID,K=y.getProjection(),Y=this.transform,K.name===this.projection?Y.calculateProjMatrix(W.toUnwrapped()):Lr(Y,K,W));var W,K,Y;const te=P.get("text-pitch-alignment")==="map",re=P.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const le=n.dynamicFilter(),fe=n.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(c),de=Zi(X,c.tileID.canonical,te,re,this.transform,y.getProjection(),me);let ge=null;if(te){const at=Lo(X,c.tileID.canonical,te,re,this.transform,y.getProjection(),me);ge=o.a6.mat4.multiply([],this.transform.labelPlaneMatrix,at)}let Te=null;le&&c.latestFeatureIndex&&(Te={unwrappedTileID:G,dynamicFilter:le,dynamicFilterNeedsFeature:fe}),this.retainedQueryData[y.bucketInstanceId]=new uh(y.bucketInstanceId,M,y.sourceLayerIndex,y.index,c.tileID);const Ce=y.layers[0].layout.get("text-size-scale-range"),Ae=o.ap(_,Ce[0],Ce[1]),Ee=y.layers[0].layout.get("icon-size-scale-range"),Ge=o.ap(_,Ee[0],Ee[1]),Ye={bucket:y,layout:P,paint:D,posMatrix:X,textLabelPlaneMatrix:de,labelToScreenMatrix:ge,clippingData:Te,scale:F,textPixelRatio:N,holdingForFade:c.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.bk(y.textSizeData,this.transform.zoom,Ae),partiallyEvaluatedIconSize:o.bk(y.iconSizeData,this.transform.zoom,Ge),collisionGroup:this.collisionGroups.get(y.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(f)for(const at of y.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:bt,symbolInstanceEnd:ke}=at;t.push({sortKey:_t,symbolInstanceStart:bt,symbolInstanceEnd:ke,parameters:Ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y,te){const{textOffset0:re,textOffset1:le,crossTileID:fe}=N,me=[re,le],de=dl(t,c,f,me,_),ge=this.collisionIndex.placeCollisionBox(X,_,n,Jr(de.x,de.y,y,M,this.transform.angle),F,P,D,R.predicate);if(K){const Te=X.getSymbolInstanceIconSize(te,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,Te,K,Jr(de.x,de.y,y,M,this.transform.angle),F,P,D,R.predicate).box.length===0)return}if(ge.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(Te=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:me,width:c,height:f,anchor:t,textScale:_,prevAnchor:Te},this.markUsedJustification(X,t,N,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,N),this.placedOrientations[fe]=W),{shift:de,placedGlyphBoxes:ge}}}placeLayerBucketPart(t,n,c,f,_=1){const{bucket:y,layout:M,paint:P,posMatrix:D,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:N,textPixelRatio:G,holdingForFade:X,collisionBoxArray:W,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:Y,collisionGroup:te,latestFeatureIndex:re}=t.parameters,le=M.get("text-optional"),fe=M.get("icon-optional"),me=M.get("text-allow-overlap"),de=M.get("icon-allow-overlap"),ge=M.get("text-rotation-alignment")==="map",Te=M.get("text-pitch-alignment")==="map",Ce=M.get("symbol-z-elevate"),Ae=P.get("symbol-z-offset"),Ee=M.get("symbol-elevation-reference")==="sea",Ge=M.get("text-size-scale-range"),Ye=M.get("icon-size-scale-range"),at=o.ap(_,Ge[0],Ge[1]),_t=o.ap(_,Ye[0],Ye[1]);this.transform.setProjection(y.projection);let bt=me&&(de||!y.hasIconData()||fe),ke=de&&(me||!y.hasTextData()||le);const rt=!Ae.isConstant();!y.collisionArrays&&W&&y.deserializeCollisionBoxes(W),c&&f&&y.updateCollisionDebugBuffers(this.transform.zoom,W,at,_t);const $e=(nt,lt,ot)=>{const{crossTileID:St,numVerticalGlyphVertices:Wt}=nt;let ti=null;if(N&&N.dynamicFilterNeedsFeature||rt){const Xi=this.retainedQueryData[y.bucketInstanceId];ti=re.loadFeature({featureIndex:nt.featureIndex,bucketIndex:Xi.bucketIndex,sourceLayerIndex:Xi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ti,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.P(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[St]=new is(!1,!1,!1,!0),void n.add(St);const kt=Ae.evaluate(ti,{});if(n.has(St))return;if(X)return void(this.placements[St]=new is(!1,!1,!1));let Kt=!1,zt=!1,ai=!0,Si=!1,Ui=!1,Mn=null,en={box:null,offscreen:null,occluded:null},kn={box:null,offscreen:null,occluded:null},ln=null,In=null,Fi=null,An=0,bn=0,hn=0;ot.textFeatureIndex?An=ot.textFeatureIndex:nt.useRuntimeCollisionCircles&&(An=nt.featureIndex),ot.verticalTextFeatureIndex&&(bn=ot.verticalTextFeatureIndex);const Un=Xi=>{Xi.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const Vi=this.transform.elevation;Xi.elevation=Ee?kt:kt+(Vi?Vi.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0),Xi.elevation+=nt.zOffset},gr=ot.textBox;if(gr){Un(gr);const Xi=cn=>{let Rn=o.bl.horizontal;if(y.allowVerticalPlacement&&!cn&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[St];or&&(this.placedOrientations[St]=or,Rn=or,this.markUsedOrientation(y,Rn,nt))}return Rn},Vi=(cn,Rn)=>{if(y.allowVerticalPlacement&&Wt>0&&ot.verticalTextBox){for(const or of y.writingModes)if(or===o.bl.vertical?(en=Rn(),kn=en):en=cn(),en&&en.box&&en.box.length)break}else en=cn()};if(M.get("text-variable-anchor")){let cn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[St]){const $n=this.prevPlacement.variableOffsets[St];cn.indexOf($n.anchor)>0&&(cn=cn.filter($r=>$r!==$n.anchor),cn.unshift($n.anchor))}const Rn=($n,$r,aa)=>{const dr=y.getSymbolInstanceTextSize(K,nt,this.transform.zoom,lt),Fo=($n.x2-$n.x1)*dr+2*$n.padding,hs=($n.y2-$n.y1)*dr+2*$n.padding,Ns=nt.hasIconTextFit&&!de?$r:null;Ns&&Un(Ns);let Co={box:[],offscreen:!1,occluded:!1};const Ra=me?2*cn.length:cn.length;for(let fs=0;fs<Ra;++fs){const gn=this.attemptAnchorPlacement(cn[fs%cn.length],$n,Fo,hs,dr,ge,Te,G,D,te,fs>=cn.length,nt,lt,y,aa,Ns,K,Y);if(gn&&(Co=gn.placedGlyphBoxes,Co&&Co.box&&Co.box.length)){Kt=!0,Mn=gn.shift;break}}return Co};Vi(()=>Rn(gr,ot.iconBox,o.bl.horizontal),()=>{const $n=ot.verticalTextBox;return $n&&Un($n),y.allowVerticalPlacement&&!(en&&en.box&&en.box.length)&&Wt>0&&$n?Rn($n,ot.verticalIconBox,o.bl.vertical):{box:null,offscreen:null,occluded:null}}),en&&(Kt=en.box,ai=en.offscreen,Si=en.occluded);const or=Xi(!(!en||!en.box));if(!Kt&&this.prevPlacement){const $n=this.prevPlacement.variableOffsets[St];$n&&(this.variableOffsets[St]=$n,this.markUsedJustification(y,$n.anchor,nt,or))}}else{const cn=(Rn,or)=>{const $n=y.getSymbolInstanceTextSize(K,nt,this.transform.zoom,lt,_),$r=this.collisionIndex.placeCollisionBox(y,$n,Rn,new o.P(0,0),me,G,D,te.predicate);return $r&&$r.box&&$r.box.length&&(this.markUsedOrientation(y,or,nt),this.placedOrientations[St]=or),$r};Vi(()=>cn(gr,o.bl.horizontal),()=>{const Rn=ot.verticalTextBox;return y.allowVerticalPlacement&&Wt>0&&Rn?(Un(Rn),cn(Rn,o.bl.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(!!(en&&en.box&&en.box.length))}}if(ln=en,Kt=ln&&ln.box&&ln.box.length>0,ai=ln&&ln.offscreen,Si=ln&&ln.occluded,nt.useRuntimeCollisionCircles){const Xi=y.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),Vi=o.bm(y.textSizeData,K,Xi),cn=M.get("text-padding");In=this.collisionIndex.placeCollisionCircles(y,me,Xi,y.lineVertexArray,y.glyphOffsetArray,Vi,D,R,F,c,Te,te.predicate,nt.collisionCircleDiameter*Vi/o.br,cn,this.retainedQueryData[y.bucketInstanceId].tileID),Kt=me||In.circles.length>0&&!In.collisionDetected,ai=ai&&In.offscreen,Si=In.occluded}if(ot.iconFeatureIndex&&(hn=ot.iconFeatureIndex),ot.iconBox){const Xi=Vi=>{Un(Vi);const cn=nt.hasIconTextFit&&Mn?Jr(Mn.x,Mn.y,ge,Te,this.transform.angle):new o.P(0,0),Rn=y.getSymbolInstanceIconSize(Y,this.transform.zoom,nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Rn,Vi,cn,de,G,D,te.predicate)};kn&&kn.box&&kn.box.length&&ot.verticalIconBox?(Fi=Xi(ot.verticalIconBox),zt=Fi.box.length>0):(Fi=Xi(ot.iconBox),zt=Fi.box.length>0),ai=ai&&Fi.offscreen,Ui=Fi.occluded}const ko=le||nt.numHorizontalGlyphVertices===0&&Wt===0,us=fe||nt.numIconVertices===0;if(ko||us?us?ko||(zt=zt&&Kt):Kt=zt&&Kt:zt=Kt=zt&&Kt,Kt&&ln&&ln.box&&this.collisionIndex.insertCollisionBox(ln.box,M.get("text-ignore-placement"),y.bucketInstanceId,kn&&kn.box&&bn?bn:An,te.ID),zt&&Fi&&this.collisionIndex.insertCollisionBox(Fi.box,M.get("icon-ignore-placement"),y.bucketInstanceId,hn,te.ID),In&&(Kt&&this.collisionIndex.insertCollisionCircles(In.circles,M.get("text-ignore-placement"),y.bucketInstanceId,An,te.ID),c)){const Xi=y.bucketInstanceId;let Vi=this.collisionCircleArrays[Xi];Vi===void 0&&(Vi=this.collisionCircleArrays[Xi]=new zr);for(let cn=0;cn<In.circles.length;cn+=4)Vi.circles.push(In.circles[cn+0]),Vi.circles.push(In.circles[cn+1]),Vi.circles.push(In.circles[cn+2]),Vi.circles.push(In.collisionDetected?1:0)}const kr=y.projection.name!=="globe";bt=bt&&(kr||!Si),ke=ke&&(kr||!Ui),this.placements[St]=new is(Kt||bt,zt||ke,ai||y.justReloaded),n.add(St)};if(Ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,this.retainedQueryData[y.bucketInstanceId].tileID),y.updateZOffset()),y.sortFeaturesByY){const nt=y.getSortedSymbolIndexes(this.transform.angle);for(let lt=nt.length-1;lt>=0;--lt){const ot=nt[lt];$e(y.symbolInstances.get(ot),ot,y.collisionArrays[ot])}y.hasAnyZOffset&&o.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const nt=y.getSortedIndexesByZOffset();for(let lt=0;lt<nt.length;++lt){const ot=nt[lt];$e(y.symbolInstances.get(ot),ot,y.collisionArrays[ot])}}else for(let nt=t.symbolInstanceStart;nt<t.symbolInstanceEnd;nt++)$e(y.symbolInstances.get(nt),nt,y.collisionArrays[nt]);if(c&&y.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[y.bucketInstanceId];o.a6.mat4.invert(nt.invProjMatrix,D),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,n,c,f){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P,crossTileID:D}=c,R=o.bw(n),F=f===o.bl.vertical?P:R==="left"?_:R==="center"?y:R==="right"?M:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=F>=0&&_!==F?0:D),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:D),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=F>=0&&M!==F?0:D),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=F>=0&&P!==F?0:D)}markUsedOrientation(t,n,c){const f=n===o.bl.horizontal||n===o.bl.horizontalOnly?n:0,_=n===o.bl.vertical?n:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:D}=c,R=t.text.placedSymbolArray;y>=0&&(R.get(y).placedOrientation=f),M>=0&&(R.get(M).placedOrientation=f),P>=0&&(R.get(P).placedOrientation=f),D>=0&&(R.get(D).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let c=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const f=n?n.symbolFadeChange(t):1,_=n?n.opacities:{},y=n?n.variableOffsets:{},M=n?n.placedOrientations:{};for(const P in this.placements){const D=this.placements[P],R=_[P];R?(this.opacities[P]=new po(R,f,D.text,D.icon,null,D.clipped),c=c||D.text!==R.text.placed||D.icon!==R.icon.placed):(this.opacities[P]=new po(null,f,D.text,D.icon,D.skipFade,D.clipped),c=c||D.text||D.icon)}for(const P in _){const D=_[P];if(!this.opacities[P]){const R=new po(D,f,!1,!1);R.isHidden()||(this.opacities[P]=R,c=c||D.text.placed||D.icon.placed)}}for(const P in y)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=y[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,c,f){const _=new Set;for(const y of n){const M=y.getBucket(t);M&&y.latestFeatureIndex&&t.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,_,y,y.collisionBoxArray,c,f,y.tileID,t.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,y.tileID),M.updateZOffset()))}}updateBucketOpacities(t,n,c,f,_,y,M,P){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,R=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),N=new po(null,0,!1,!1,!0),G=D.get("text-allow-overlap"),X=D.get("icon-allow-overlap"),W=D.get("text-variable-anchor"),K=D.get("text-rotation-alignment")==="map",Y=D.get("text-pitch-alignment")==="map",te=R.get("symbol-z-offset"),re=D.get("symbol-elevation-reference")==="sea",le=!te.isConstant(),fe=new po(null,0,G&&(X||!t.hasIconData()||D.get("icon-optional")),X&&(G||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const me=(ge,Te,Ce)=>{for(let Ae=0;Ae<Te/4;Ae++)ge.opacityVertexArray.emplaceBack(Ce)};let de=0;y&&t.updateReplacement(M,y);for(let ge=0;ge<t.symbolInstances.length;ge++){const Te=t.symbolInstances.get(ge),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Ae,crossTileID:Ee,numIconVertices:Ge,tileAnchorX:Ye,tileAnchorY:at}=Te;let _t=null;const bt=this.retainedQueryData[t.bucketInstanceId];le&&Te&&bt&&(_t=c.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:bt.bucketIndex,sourceLayerIndex:bt.sourceLayerIndex,layoutVertexArrayOffset:0}));const ke=te.evaluate(_t,{}),rt=n.has(Ee);let $e=this.opacities[Ee];rt?$e=N:$e||($e=fe,this.opacities[Ee]=$e),n.add(Ee);const nt=Ce>0||Ae>0,lt=Ge>0,ot=this.placedOrientations[Ee],St=ot===o.bl.vertical,Wt=ot===o.bl.horizontal||ot===o.bl.horizontalOnly;!nt&&!lt||$e.isHidden()||de++;let ti=!1;if((nt||lt)&&y)for(const kt of t.activeReplacements){if(o.bs(kt,_,o.bt.Symbol,P)||kt.min.x>Ye||Ye>kt.max.x||kt.min.y>at||at>kt.max.y)continue;const Kt=o.bu(Ye,at,M.canonical,kt.footprintTileId.canonical);if(ti=o.bv(Kt,kt.footprint),ti)break}if(nt){const kt=ti?sc:ja($e.text);me(t.text,Ce,St?sc:kt),me(t.text,Ae,Wt?sc:kt);const Kt=$e.text.isHidden(),{leftJustifiedTextSymbolIndex:zt,centerJustifiedTextSymbolIndex:ai,rightJustifiedTextSymbolIndex:Si,verticalPlacedTextSymbolIndex:Ui}=Te,Mn=t.text.placedSymbolArray,en=Kt||St?1:0;zt>=0&&(Mn.get(zt).hidden=en),ai>=0&&(Mn.get(ai).hidden=en),Si>=0&&(Mn.get(Si).hidden=en),Ui>=0&&(Mn.get(Ui).hidden=Kt||Wt?1:0);const kn=this.variableOffsets[Ee];kn&&this.markUsedJustification(t,kn.anchor,Te,ot);const ln=this.placedOrientations[Ee];ln&&(this.markUsedJustification(t,"left",Te,ln),this.markUsedOrientation(t,ln,Te))}if(lt){const kt=ti?sc:ja($e.icon),{placedIconSymbolIndex:Kt,verticalPlacedIconSymbolIndex:zt}=Te,ai=t.icon.placedSymbolArray,Si=$e.icon.isHidden()?1:0;Kt>=0&&(me(t.icon,Ge,St?sc:kt),ai.get(Kt).hidden=Si),zt>=0&&(me(t.icon,Te.numVerticalIconVertices,Wt?sc:kt),ai.get(zt).hidden=Si)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const kt=t.collisionArrays[ge];if(kt){let Kt=new o.P(0,0),zt=!0;if(kt.textBox||kt.verticalTextBox){if(W){const Si=this.variableOffsets[Ee];Si?(Kt=dl(Si.anchor,Si.width,Si.height,Si.textOffset,Si.textScale),K&&Kt._rotate(Y?this.transform.angle:-this.transform.angle)):zt=!1}F&&(zt=!$e.clipped),kt.textBox&&So(t.textCollisionBox.collisionVertexArray,$e.text.placed,!zt||St,ke,re,Kt.x,Kt.y),kt.verticalTextBox&&So(t.textCollisionBox.collisionVertexArray,$e.text.placed,!zt||Wt,ke,re,Kt.x,Kt.y)}const ai=zt&&!!(!Wt&&kt.verticalIconBox);kt.iconBox&&So(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,ai,ke,re,Te.hasIconTextFit?Kt.x:0,Te.hasIconTextFit?Kt.y:0),kt.verticalIconBox&&So(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,!ai,ke,re,Te.hasIconTextFit?Kt.x:0,Te.hasIconTextFit?Kt.y:0)}}}if(t.fullyClipped=de===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ge.invProjMatrix,t.placementViewportMatrix=ge.viewportMatrix,t.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const c=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function So(l,t,n,c,f,_,y){l.emplaceBack(t?1:0,n?1:0,_||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,n?1:0,_||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,n?1:0,_||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,n?1:0,_||0,y||0,c,f?1:0)}const ma=Math.pow(2,25),Yd=Math.pow(2,24),_a=Math.pow(2,17),co=Math.pow(2,16),yf=Math.pow(2,9),ir=Math.pow(2,8),ga=Math.pow(2,1);function ja(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*ma+t*Yd+n*_a+t*co+n*yf+t*ir+n*ga+t}const sc=0;class xf{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,c,f,_,y){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(M,f,t[this._currentTileIndex],this._sortAcrossTiles,y),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((P,D)=>P.sortKey-D.sortKey));this._currentPartIndex<M.length;){const P=M[this._currentPartIndex];if(n.placeLayerBucketPart(P,this._seenCrossTileIDs,c,P.symbolInstanceStart===0,y),this._currentPartIndex++,_())return!0}return!1}}class Qc{constructor(t,n,c,f,_,y,M,P,D){this.placement=new pl(t,_,y,M,P,D),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,n,c,f,_){const y=o.q.now(),M=()=>{const P=o.q.now()-y;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=n[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){const R=P,F=R.layout.get("symbol-z-elevate"),N=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=R.layout.get("symbol-z-order"),X=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&N),W=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),K=X&&W,Y=this._inProgressLayer=this._inProgressLayer||new xf(R),te=o.av(P.source,P.scope);if(Y.continuePlacement(F||K?f[te]:c[te],this.placement,this._showCollisionBoxes,P,M,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ml=512/o.ab/2;class cm{constructor(t,n,c){this.tileID=t,this.bucketInstanceId=c,this.index=new o.bz(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=t.canonical.x*o.ab,_=t.canonical.y*o.ab;for(let y=0;y<n.length;y++){const{key:M,crossTileID:P,tileAnchorX:D,tileAnchorY:R}=n.get(y),F=Math.floor((f+D)*ml),N=Math.floor((_+R)*ml);this.index.add(F,N),this.keys.push(M),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,n,c){const f=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),_=ml/Math.pow(2,n.canonical.z-this.tileID.canonical.z),y=n.canonical.x*o.ab,M=n.canonical.y*o.ab;for(let P=0;P<t.length;P++){const D=t.get(P);if(D.crossTileID)continue;const{key:R,tileAnchorX:F,tileAnchorY:N}=D,G=Math.floor((y+F)*_),X=Math.floor((M+N)*_),W=this.index.range(G-f,X-f,G+f,X+f);for(const K of W){const Y=this.crossTileIDs[K];if(this.keys[K]===R&&!c.has(Y)){c.add(Y),D.crossTileID=Y;break}}}}}class _l{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const c in this.indexes){const f=this.indexes[c],_={};for(const y in f){const M=f[y];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+n),_[M.tileID.key]=M}this.indexes[c]=_}this.lng=t}addBucket(t,n,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<n.symbolInstances.length;_++)n.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const f=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const y=this.indexes[_];if(Number(_)>t.overscaledZ)for(const M in y){const P=y[M];P.tileID.isChildOf(t)&&P.findMatches(n.symbolInstances,t,f)}else{const M=y[t.scaledTo(Number(_)).key];M&&M.findMatches(n.symbolInstances,t,f)}}for(let _=0;_<n.symbolInstances.length;_++){const y=n.symbolInstances.get(_);y.crossTileID||(y.crossTileID=c.generate(),f.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new cm(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const c of n.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let n=!1;for(const c in this.indexes){const f=this.indexes[c];for(const _ in f)t[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[_]),delete f[_],n=!0)}return n}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new _l,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,c,f){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new eu);let y=!1;const M={};f.name!=="globe"&&_.handleWrapJump(c);for(const P of n){const D=P.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(P.tileID,D,this.crossTileIDs)&&(y=!0),M[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(M)&&(y=!0),y}pruneUnusedLayers(t){const n={};t.forEach(c=>{n[c]=!0});for(const c in this.layerIndexes)n[c]||delete this.layerIndexes[c]}}const Go=771;class Oi{constructor(t,n,c,f){this.blendFunction=t,this.blendColor=n,this.mask=c,this.blendEquation=f}}Oi.Replace=[1,0,1,0],Oi.disabled=new Oi(Oi.Replace,o.bA.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,o.bA.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,Go,1,Go],o.bA.transparent,[!0,!0,!0,!0]),Oi.alphaBlendedNonPremultiplied=new Oi([770,Go,770,Go],o.bA.transparent,[!0,!0,!0,!0]),Oi.multiply=new Oi([774,0,774,0],o.bA.transparent,[!0,!0,!0,!0]);class oi{constructor(t,n,c){this.func=t,this.mask=n,this.range=c}}oi.ReadOnly=!1,oi.ReadWrite=!0,oi.disabled=new oi(519,oi.ReadOnly,[0,1]);const tu=7680;class vi{constructor(t,n,c,f,_,y){this.test=t,this.ref=n,this.mask=c,this.fail=f,this.depthFail=_,this.pass=y}}vi.disabled=new vi({func:519,mask:0},0,0,tu,tu,tu);const hh=1029,iu=2305;class di{constructor(t,n,c){this.enable=t,this.mode=n,this.frontFace=c}}function nu(l,t){const n=o.bD(l,3);o.a6.mat4.fromQuat(l,t),o.bF(l,3,n)}function fh(l,t){const n=o.a6.quat.identity([]);return o.a6.quat.rotateZ(n,n,-t),o.a6.quat.rotateX(n,n,-l),n}function dh(l,t){const n=[l[0],l[1],0],c=[t[0],t[1],0];if(o.a6.vec3.length(n)>=1e-15){const y=o.a6.vec3.normalize([],n);o.a6.vec3.scale(c,y,o.a6.vec3.dot(c,y)),t[0]=c[0],t[1]=c[1]}const f=o.a6.vec3.cross([],t,l);if(o.a6.vec3.len(f)<1e-15)return null;const _=Math.atan2(-f[1],f[0]);return fh(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}di.disabled=new di(!1,hh,iu),di.backCCW=new di(!0,hh,iu),di.backCW=new di(!0,hh,2304),di.frontCW=new di(!0,1028,2304),di.frontCCW=new di(!0,1028,iu);class Gr{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof o.a5?t:new o.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=o.bB(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const c=this.position,f=this._elevation?this._elevation.getAtPointOrZero(o.a5.fromLngLat(t)):0,_=o.a5.fromLngLat(t,f),y=[_.x-c.x,_.y-c.y,_.z-c.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=dh(y,n)}setPitchBearing(t,n){this.orientation=fh(o.bC(t),o.bC(-n))}}class xa{constructor(t,n){this._transform=o.a6.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new o.a5(t[0],t[1],t[2])}get position(){const t=o.bD(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&o.bF(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.a6.quat.identity([]),t&&nu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=fh(t,n),nu(this._transform,this._orientation)}forward(){const t=o.bD(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.bD(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.bD(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const c=new Float64Array(16);return o.a6.mat4.invert(c,this.getWorldToCamera(t,n)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,c){const f=this.position;o.a6.vec3.scale(f,f,-t);const _=new Float64Array(16);return o.a6.mat4.fromScaling(_,[c,c,c]),o.a6.mat4.translate(_,_,f),_[10]*=n,_}getWorldToCamera(t,n){const c=new Float64Array(16),f=new Float64Array(4),_=this.position;return o.a6.quat.conjugate(f,this._orientation),o.a6.vec3.scale(_,_,-t),o.a6.mat4.fromQuat(c,f),o.a6.mat4.translate(c,c,_),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=n,c[9]*=n,c[10]*=n,c[11]*=n,c}getCameraToClipPerspective(t,n,c,f){const _=new Float64Array(16);return o.a6.mat4.perspective(_,t,n,c,f),_}getCameraToClipOrthographic(t,n,c,f,_,y){const M=new Float64Array(16);return o.a6.mat4.ortho(M,t,n,c,f,_,y),M}getDistanceToElevation(t,n=!1){const c=t===0?0:o.bE(t,n?o.aN(this.position[1]):this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new xa([...this.position],[...this.orientation])}}const Or={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ru{constructor(t=0,n=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=c,this.right=f}interpolate(t,n,c){return n.top!=null&&t.top!=null&&(this.top=o.aa(t.top,n.top,c)),n.bottom!=null&&t.bottom!=null&&(this.bottom=o.aa(t.bottom,n.bottom,c)),n.left!=null&&t.left!=null&&(this.left=o.aa(t.left,n.left,c)),n.right!=null&&t.right!=null&&(this.right=o.aa(t.right,n.right,c)),this}getCenter(t,n){const c=o.ap((this.left+t-this.right)/2,0,t),f=o.ap((this.top+n-this.bottom)/2,0,n);return new o.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ru(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const gl=(l,t,n)=>(1-n)*l+n*t,ac=l=>l*l*l*l*l;class ph{constructor(t,n,c,f,_,y,M){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=c??0,this._maxPitch=f??60,this.setProjection(y),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new o.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ru,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new xa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new ph(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return o.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=o.bM(this.projectionOptions);const c=this.getProjection(),f=!o.bi(n,c);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bM({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bB(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=o.a6.mat2.create(),o.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=o.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.bC(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let f=0,_=0;for(let y=0;y<n.length;y++){const M=new o.P(n[y][0]*this.width,c+n[y][1]*(this.height-c)),P=t.pointCoordinate(M);if(!P)continue;const D=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);f+=P[3]*D,_+=D}return _===0?NaN:f/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*n,f=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),y=Math.max(f-c,_);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const f=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,c));return o.ap(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!o.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];o.a6.vec3.exactEquals(c,this._camera.position)||(this._setCameraPosition(c),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Gr;return n.position=new o.a5(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!o.a6.quat.length(t))return!1;o.a6.quat.normalize(t,t);const n=o.a6.vec3.transformQuat([],[0,0,-1],t),c=o.a6.vec3.transformQuat([],[0,-1,0],t);if(c[2]<0)return!1;const f=dh(n,c);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=o.ap(t[2],f/c,f/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,c){this._unmodified=!1,this._edgeInsets.interpolate(t,n,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new o.bN(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new o.P(0,0)),f=this.pointCoordinate(new o.P(this.width,0)),_=this.pointCoordinate(new o.P(this.width,this.height)),y=this.pointCoordinate(new o.P(0,this.height)),M=Math.floor(Math.min(c.x,f.x,_.x,y.x)),P=Math.floor(Math.max(c.x,f.x,_.x,y.x)),D=1;for(let R=M-D;R<=P+D;R++)R!==0&&n.push(new o.bN(R,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,c){let f=[];const _=c!==void 0,y=!_;if(y&&this.zoom<n||_&&c[0]===0&&c[1]===0)return f;const M=new Set,P=(R,F,N,G,X)=>{const W=o.c2(F,R,N,G,X);M.has(W)||(f.push(new o.aA(R,F,N,G,X)),M.add(W))};for(let R=0;R<t.length;R++){const F=t[R];if(y&&F.canonical.z!==n)continue;const N=F.canonical,G=F.overscaledZ,X=F.wrap,W=1<<N.z,K=N.x+1<W,Y=N.x>0,te=N.y+1<W,re=N.y>0,le=F.wrap-(Y?0:1),fe=F.wrap+(K?0:1),me=Y?N.x-1:W-1,de=K?N.x+1:0;if(_)c[0]<0?(P(G,fe,N.z,de,N.y),c[1]<0&&te&&(P(G,X,N.z,N.x,N.y+1),P(G,fe,N.z,de,N.y+1)),c[1]>0&&re&&(P(G,X,N.z,N.x,N.y-1),P(G,fe,N.z,de,N.y-1))):c[0]>0?(P(G,le,N.z,me,N.y),c[1]<0&&te&&(P(G,X,N.z,N.x,N.y+1),P(G,le,N.z,me,N.y+1)),c[1]>0&&re&&(P(G,X,N.z,N.x,N.y-1),P(G,le,N.z,me,N.y-1))):c[1]<0&&te?P(G,X,N.z,N.x,N.y+1):re&&P(G,X,N.z,N.x,N.y-1);else{const ge=F.visibleQuadrants;1&ge&&(P(G,le,N.z,me,N.y),re&&(P(G,X,N.z,N.x,N.y-1),P(G,le,N.z,me,N.y-1))),2&ge&&(P(G,fe,N.z,de,N.y),re&&(P(G,X,N.z,N.x,N.y-1),P(G,fe,N.z,de,N.y-1))),4&ge&&(P(G,le,N.z,me,N.y),te&&(P(G,X,N.z,N.x,N.y+1),P(G,le,N.z,me,N.y+1))),8&ge&&(P(G,fe,N.z,de,N.y),te&&(P(G,X,N.z,N.x,N.y+1),P(G,fe,N.z,de,N.y+1)))}}const D=[];for(const R of f)f.some(F=>R.isChildOf(F))||D.push(R);if(f=D.filter(R=>!t.some(F=>!!(R.overscaledZ<n&&F.isChildOf(R))||R.equals(F)||R.isChildOf(F))),y){const R=1<<n,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[R*F.x,R*F.y],G=4,X=G*G;f=f.filter(W=>{const K=W.canonical.x+.5-N[0],Y=W.canonical.y+.5-N[1];return K*K+Y*Y<X})}return f}coveringTiles(t){let n=this.coveringZoomLevel(t);const c=n,f=this.elevation&&this.elevation.exaggeration(),_=f&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const M=this.locationCoordinate(this.center),P=this.center.lat,D=1<<n,R=[D*M.x,D*M.y,0],F=this.projection.name==="globe",N=!F,G=o.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,N),X=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=D*o.bE(1,this.center.lat),K=this._camera.position[2]/o.bE(1,this.center.lat),Y=[D*X.x,D*X.y,K*(N?1:W)],te=F||f,re=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),le=this.isLODDisabled(!0)?n:0;let fe;if(this._elevation&&t.isTerrainDEM)fe=1e4*this._elevation.exaggeration();else if(this._elevation){const ke=this._elevation.getMinMaxForVisibleTiles();fe=ke?ke.max:this._centerAltitude}else fe=this._centerAltitude;const me=t.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?o.bP(this):1,ge=ke=>{const $e=new o.a5(ke.x+25e-6,ke.y,ke.z),nt=new o.a5(ke.x,ke.y+25e-6,ke.z),lt=ke.toLngLat(),ot=$e.toLngLat(),St=nt.toLngLat(),Wt=this.locationCoordinate(lt),ti=this.locationCoordinate(ot),kt=this.locationCoordinate(St),Kt=Math.hypot(ti.x-Wt.x,ti.y-Wt.y),zt=Math.hypot(kt.x-Wt.x,kt.y-Wt.y);return Math.sqrt(Kt*zt)*de/25e-6},Te=ke=>{const rt=fe,$e=me;return{aabb:o.bS(this,D,0,0,0,ke,$e,rt,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:rt,wrap:ke,fullyVisible:!1}},Ce=[];let Ae=[];const Ee=n,Ge=t.reparseOverscaled?c:n,Ye=(K-this._centerAltitude)*W,at=ke=>{if(!this._elevation||!ke.tileID||!y)return;const rt=this._elevation.getMinMaxForTile(ke.tileID),$e=ke.aabb;rt?($e.min[2]=rt.min,$e.max[2]=rt.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(ke.shouldSplit=bt(ke),ke.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},_t=(ke,rt)=>{if(.707*rt<ke)return 1;const $e=rt/ke;return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)},bt=ke=>{if(ke.zoom<le)return!0;if(ke.zoom===Ee)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const rt=ke.aabb.distanceX(Y),$e=ke.aabb.distanceY(Y);let nt=Ye,lt=1;if(F){nt=ke.aabb.distanceZ(Y);const zt=Math.pow(2,ke.zoom),ai=o.aN((ke.y+1)/zt),Si=o.aN(ke.y/zt),Ui=Math.min(Math.max(P,ai),Si),Mn=o.c6(Ui)/o.c6(P);if(lt=Ui===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mn/this._mercatorScaleRatio),this.zoom<=o.c3&&ke.zoom===Ee-1&&Mn>=.9)return!0}else if(_&&(nt=ke.aabb.distanceZ(Y)*W),this.projection.isReprojectedInTileSpace&&c<=5){const zt=Math.pow(2,ke.zoom),ai=ge(new o.a5((ke.x+.5)/zt,(ke.y+.5)/zt));lt=ai>.85?1:ai}if(!y){const zt=Math.sqrt(rt*rt+$e*$e+nt*nt);let ai=(1<<Ee-ke.zoom)*re*lt;return ai*=_t(Math.max(nt,Ye),zt),zt<ai}let ot=Number.MAX_VALUE,St=0;const Wt=ke.aabb.getCorners(),ti=[];for(const zt of Wt){o.a6.vec3.sub(ti,zt,Y),F||(_?ti[2]*=W:ti[2]=Ye);const ai=o.a6.vec3.dot(ti,this._camera.forward());ai<ot&&(ot=ai,St=Math.abs(ti[2]))}let kt=(1<<Ee-ke.zoom)*re*lt;if(kt*=_t(Math.max(St,Ye),ot),ot<kt)return!0;const Kt=ke.aabb.closestPoint(R);return Kt[0]===R[0]&&Kt[1]===R[1]};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Ce.push(Te(-ke)),Ce.push(Te(ke));for(Ce.push(Te(0));Ce.length>0;){const ke=Ce.pop(),rt=ke.x,$e=ke.y;let nt=ke.fullyVisible;const lt=()=>this.projection.name==="globe"&&(ke.y===0||ke.y===(1<<ke.zoom)-1);if(!nt){let ot=te?ke.aabb.intersects(G):ke.aabb.intersectsFlat(G);if(ot===0&&lt()){const St=new o.bQ(ke.zoom,rt,$e);ot=o.bR(this,D,St,!0).intersects(G)}if(ot===0)continue;nt=ot===2}if(ke.zoom!==Ee&&bt(ke))for(let ot=0;ot<4;ot++){const St=(rt<<1)+ot%2,Wt=($e<<1)+(ot>>1),ti={aabb:y?ke.aabb.quadrant(ot):o.bS(this,D,ke.zoom+1,St,Wt,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:St,y:Wt,wrap:ke.wrap,fullyVisible:nt,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};_&&!F&&(ti.tileID=new o.aA(ke.zoom+1===Ee?Ge:ke.zoom+1,ke.wrap,ke.zoom+1,St,Wt),at(ti)),Ce.push(ti)}else{const ot=ke.zoom===Ee?Ge:ke.zoom;if(t.minzoom&&t.minzoom>ot)continue;let St=0;if(!nt){let Kt=te?ke.aabb.intersectsPrecise(G):ke.aabb.intersectsPreciseFlat(G);if(Kt===0&&lt()){const zt=new o.bQ(ke.zoom,rt,$e);Kt=o.bR(this,D,zt,!0).intersectsPrecise(G)}if(Kt===0)continue;if(t.calculateQuadrantVisibility)if(G.containsPoint(ke.aabb.center))St=15;else for(let zt=0;zt<4;zt++)ke.aabb.quadrant(zt).intersects(G)!==0&&(St|=1<<zt)}const Wt=R[0]-(.5+rt+(ke.wrap<<ke.zoom))*(1<<n-ke.zoom),ti=R[1]-.5-$e,kt=ke.tileID?ke.tileID:new o.aA(ot,ke.wrap,ke.zoom,rt,$e);t.calculateQuadrantVisibility&&(kt.visibleQuadrants=St),Ae.push({tileID:kt,distanceSq:Wt*Wt+ti*ti})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,rt=this.horizonLineFromTop();Ae=Ae.filter($e=>{const nt=[0,0,0,1],lt=[o.ab,o.ab,0,1],ot=this.calculateFogTileMatrix($e.tileID.toUnwrapped());o.a6.vec4.transformMat4(nt,nt,ot),o.a6.vec4.transformMat4(lt,lt,ot);const St=o.a6.vec4.min([],nt,lt),Wt=o.a6.vec4.max([],nt,lt),ti=o.bT(St,Wt);if(ti===0)return!0;let kt=!1;const Kt=this._elevation;if(Kt&&ti>ke&&rt!==0){const zt=this.calculateProjMatrix($e.tileID.toUnwrapped());let ai;t.isTerrainDEM||(ai=Kt.getMinMaxForTile($e.tileID)),ai||(ai={min:me,max:fe});const Si=o.c4(this.rotation),Ui=[Si[0]*o.ab,Si[1]*o.ab,ai.max];o.a6.vec3.transformMat4(Ui,Ui,zt),kt=(1-Ui[1])*this.height*.5<rt}return ti<ke||kt})}return Ae.sort((ke,rt)=>ke.distanceSq-rt.distanceSq).map(ke=>ke.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=o.ap(t.lat,-o.bU,o.bU),c=this.projection.project(t.lng,n);return new o.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let c,f;const _=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;c=(n.x-_.x)/M,f=(n.y-_.y)/M}else{const M=this.pointCoordinate(n),P=this.pointCoordinate(_);c=M.x-P.x,f=M.y-P.y}const y=this.locationCoordinate(t);this.setLocation(new o.a5(y.x-c,y.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const c=n?o.bE(n,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new o.a5(f.x,f.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const c=n??this._centerAltitude,f=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),o.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse);const y=_[3];o.a6.vec4.scale(f,f,1/f[3]),o.a6.vec4.scale(_,_,1/y);const M=f[2],P=_[2];return{p0:f,p1:_,t:M===P?0:(c-M)/(P-M)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return o.a6.vec4.transformMat4(n,n,this.pixelMatrixInverse),o.a6.vec4.transformMat4(c,c,this.pixelMatrixInverse),o.a6.vec4.scale(n,n,1/n[3]),o.a6.vec4.scale(c,c,1/c[3]),n[2]=o.bE(n[2],this._center.lat)*this.worldSize,c[2]=o.bE(c[2],this._center.lat)*this.worldSize,o.a6.vec4.scale(n,n,1/this.worldSize),o.a6.vec4.scale(c,c,1/this.worldSize),new o.aj([n[0],n[1],n[2]],o.a6.vec3.normalize([],o.a6.vec3.sub([],c,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:c,t:f}=t,_=o.bE(n[2],this._center.lat),y=o.bE(c[2],this._center.lat);return new o.a5(o.aa(n[0],c[0],f)/this.worldSize,o.aa(n[1],c[1],f)/this.worldSize,o.aa(_,y,f))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new o.a5(n[0],n[1],n[2]);let c=0,f=this.horizonLineFromTop();if(t.y>f)return this.pointCoordinate(t);const _=.02*f,y=t.clone();for(let M=0;M<10&&f-c>_;M++){y.y=o.aa(c,f,.66);const P=this.projection.pointCoordinate3D(this,y.x,y.y);P?(f=y.y,n=P):c=y.y}return n?new o.a5(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.bV)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const c=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return o.a6.vec4.transformMat4(f,f,this.pixelMatrix),f[3]>0?new o.P(f[0]/f[3],f[1]/f[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.P(n,t)),y=this.pointLocation3D(new o.P(f,t)),M=this.pointLocation3D(new o.P(f,c)),P=this.pointLocation3D(new o.P(n,c));let D=Math.min(_.lng,y.lng,M.lng,P.lng),R=Math.max(_.lng,y.lng,M.lng,P.lng),F=Math.min(_.lat,y.lat,M.lat,P.lat),N=Math.max(_.lat,y.lat,M.lat,P.lat);const G=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,W=(K,Y,te,re,le)=>{const fe=(K+te)/2,me=(Y+re)/2,de=new o.P(fe,me),{lng:ge,lat:Te}=this.pointLocation3D(de),Ce=Math.max(0,D-ge,F-Te,ge-R,Te-N);D=Math.min(D,ge),R=Math.max(R,ge),F=Math.min(F,Te),N=Math.max(N,Te),(le<X||Ce>G)&&(W(K,Y,fe,me,le+1),W(fe,me,te,re,le+1))};if(W(n,t,f,t,1),W(f,t,f,c,1),W(f,c,n,c,1),W(n,c,n,t,1),this.projection.name==="globe"){const[K,Y]=o.bW(this);K?(N=90,R=180,D=-180):Y&&(F=-90,R=180,D=-180)}return new o.as(new o.bL(D,F),new o.bL(R,N))}_getBoundsRectangular(t,n){const{top:c,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,M=new o.P(f,c),P=new o.P(y,c),D=new o.P(y,_),R=new o.P(f,_);let F=this.pointCoordinate(M,t),N=this.pointCoordinate(P,t);const G=this.pointCoordinate(D,n),X=this.pointCoordinate(R,n),W=(K,Y)=>(Y.y-K.y)/(Y.x-K.x);return F.y>1&&N.y>=0?F=new o.a5((1-X.y)/W(X,F)+X.x,1):F.y<0&&N.y<=1&&(F=new o.a5(-X.y/W(X,F)+X.x,0)),N.y>1&&F.y>=0?N=new o.a5((1-G.y)/W(G,N)+G.x,1):N.y<0&&F.y<=1&&(N=new o.a5(-G.y/W(G,N)+G.x,0)),new o.as().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((c,f)=>{if(f.dem){const _=f.dem.tree;c.min=Math.min(c.min,_.minimums[0]),c.max=Math.max(c.max,_.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.bU,this.maxLat=o.bU,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.am(this.minLng)*this.tileSize,this.worldMaxX=o.am(this.maxLng)*this.tileSize,this.worldMinY=o.at(this.maxLat)*this.tileSize,this.worldMaxY=o.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,c=this._distanceTileDataCache;if(c[n])return c[n];const f=t.canonical,_=1/this.height,y=this.cameraWorldSize,M=y/this.zoomScale(f.z),P=(f.x+Math.pow(2,f.z)*t.wrap)*M,D=f.y*M,R=this.point;R.x*=y/this.worldSize,R.y*=y/this.worldSize;const F=this.angle,N=Math.sin(-F),G=-Math.cos(-F);return c[n]={bearing:[N,G],center:[(R.x-P)*_,(R.y-D)*_],scale:M/o.ab*_},c[n]}calculateFogTileMatrix(t){const n=t.key,c=this._fogTileMatrixCache;if(c[n])return c[n];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.a6.mat4.multiply(f,this.worldToFogMatrix,f),c[n]=new Float32Array(f),c[n]}calculateProjMatrix(t,n=!1,c=!1){const f=t.key;let _;if(_=c?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,_[f])return _[f];const y=this.calculatePosMatrix(t,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,o.a6.mat4.multiply(y,M,y),_[f]=new Float32Array(y),_[f]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[n])return c[n];const f=o.bX(t,this);return c[n]=f,c[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=o.a6.mat4.fromScaling([],[t,t,t]);return o.a6.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=o.bE(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(n),f=this._camera.forward(),_=o.bE(1,this._center.lat);c[2]/=_,f[2]/=_,o.a6.vec3.normalize(f,f);const y=t.raycast(c,f,t.exaggeration());if(y){const M=o.a6.vec3.scaleAndAdd([],c,f,y),P=new o.a5(M[0],M[1],o.bE(M[2],o.aN(M[1]))),D=(P.z+o.a6.vec3.length([P.x-c[0],P.y-c[1],P.z-c[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,c=o.bE(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=n.getAtPointOrZero(new o.a5(...f)),y=this.pixelsPerMeter/this.worldSize*_,M=this._minimumHeightOverTerrain(),P=f[2]-y;if(P<=M)if(P<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),R=[f[0],f[1],D.z-f[2]],F=o.a6.vec3.length(R);R[2]-=(M-P)/this._pixelsPerMercatorPixel;const N=o.a6.vec3.length(R);if(N===0)return;o.a6.vec3.scale(R,R,F/N*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],D.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const N=this.center;return N.lat=o.ap(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(N.lng=o.ap(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:f}=this.point;let _=0,y=c,M=f;const P=this.width/2,D=this.height/2,R=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(f-D<R&&(M=R+D),f+D>F&&(M=F-D),F-R<this.height&&(_=Math.max(_,this.height/(F-R)),M=(F+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,X=this.worldSize/2-(N+G)/2;y=(c+X+this.worldSize)%this.worldSize-X,y-P<N&&(y=N+P),y+P>G&&(y=G-P),G-N<this.width&&(_=Math.max(_,this.width/(G-N)),y=(G+N)/2)}y===c&&M===f||(this.center=this.unproject(new o.P(y,M))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bE(1,this.center.lat)/o.bE(1,o.c5));const f=o.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,y=this._camera.getWorldToCamera(this.worldSize,_);let M;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=Te*this.aspect,Ae=-Ce,Ee=-Te;Ce-=t.x,Ae-=t.x,Te+=t.y,Ee+=t.y,M=this._camera.getCameraToClipOrthographic(Ae,Ce,Ee,Te,this._nearZ,this._farZ),((Ge,Ye,at,_t)=>{for(let bt=0;bt<16;bt++)Ge[bt]=gl(Ye[bt],at[bt],_t)})(M,M,P,ac(this.pitch>=15?1:this.pitch/15))}else M=P;const D=o.a6.mat4.mul([],P,y);let R=o.a6.mat4.mul([],M,y);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Ce=o.a6.mat4.identity([]);o.a6.mat4.translate(Ce,Ce,[Te.x*this.worldSize,Te.y*this.worldSize,0]),o.a6.mat4.multiply(Ce,Ce,o.bZ(this)),o.a6.mat4.translate(Ce,Ce,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),o.a6.mat4.multiply(R,R,Ce),o.a6.mat4.multiply(D,D,Ce),this.inverseAdjustmentMatrix=o.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.mat4.scale([],R,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=R,this.invProjMatrix=o.a6.mat4.invert(new Float64Array(16),this.projMatrix),n){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-t.x/this.width,Te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.a6.mat4.mul([],Te,y)}else this.expandedFarZProjMatrix=this.projMatrix;const F=o.a6.mat4.invert([],M);this.frustumCorners=o.b$.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const N=new Float32Array(16);o.a6.mat4.identity(N),o.a6.mat4.scale(N,N,[1,-1,1]),o.a6.mat4.rotateX(N,N,this._pitch),o.a6.mat4.rotateZ(N,N,this.angle);const G=o.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.mat4.clone(G);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-t.x/this.width,G[9]=2*(t.y+X)/this.height,this.skyboxMatrix=o.a6.mat4.multiply(N,G,N);const W=this.point,K=W.x,Y=W.y,te=this.width%2/2,re=this.height%2/2,le=Math.cos(this.angle),fe=Math.sin(this.angle),me=K-Math.round(K)+le*te+fe*re,de=Y-Math.round(Y)+le*re+fe*te,ge=new Float64Array(R);if(o.a6.mat4.translate(ge,ge,[me>.5?me-1:me,de>.5?de-1:de,0]),this.alignedProjMatrix=ge,R=o.a6.mat4.create(),o.a6.mat4.scale(R,R,[this.width/2,-this.height/2,1]),o.a6.mat4.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=o.a6.mat4.create(),o.a6.mat4.scale(R,R,[1,-1,1]),o.a6.mat4.translate(R,R,[-1,-1,0]),o.a6.mat4.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=o.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},R=o.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.c0(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.a6.vec3.transformMat4(Te,Te,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,c=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,n];o.a6.vec3.scale(_,_,f),o.a6.vec3.scale(c,c,-1),o.a6.vec3.multiply(c,c,_);const y=o.a6.mat4.create();o.a6.mat4.translate(y,y,c),o.a6.mat4.scale(y,y,_),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,f)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),f=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-c[0]*_,f.y/this.worldSize-c[1]*_,t/this.worldSize*this._centerAltitude-c[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],f=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(_=Math.min((n-c)/f,1)),this._camera.position=o.a6.vec3.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:c,bearing:f}=this._camera.getPitchBearing(),_=o.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bC(this._maxPitch)),M=Math.max((t[2]-_)/Math.cos(c),y),P=this._zoomFromMercatorZ(M);o.a6.vec3.scaleAndAdd(t,t,n,M),this._pitch=o.ap(c,o.bC(this.minPitch),o.bC(this.maxPitch)),this.angle=o.bB(f,-Math.PI,Math.PI),this._setZoom(o.ap(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,c=o.bV,f=0,_=1/0;for(;c-n>1e-6&&c>n;){const y=n+.5*(c-n),M=this.tileSize*Math.pow(2,y),P=this.getCameraToCenterDistance(this.projection,y,M),D=this.scaleZoom(P/(t*this.tileSize)),R=Math.abs(y-D);R<_&&(_=R,f=y),y<D?n=y:c=y}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const c=Math.min(t.x,n.x),f=Math.max(t.x,n.x),_=Math.min(t.y,n.y),y=Math.max(t.y,n.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new o.P(c,_),new o.P(f,y),new o.P(c,y),new o.P(f,_)],P=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const R of M){const F=this.pointRayIntersection(R);if(F.t<0)return!0;const N=this.rayIntersectionCoordinate(F);if(N.x<P||N.y<0||N.x>D||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,n){const c=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,t)),f=this._zoomFromMercatorZ(c)+n;return c-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,c,f],_){const y=[n,c,f,1];o.a6.vec4.transformMat4(y,y,_);const M=y[3]=Math.max(y[3],1e-6);return y[0]/=M,y[1]/=M,y[2]/=M,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,c=this.worldSize){const f=o.bY(t,n,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,c,f);let y=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(y=gl(1,y,ac(this.pitch>=15?1:this.pitch/15))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return o.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const va=(l,t)=>{if(t>0&&l.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=l.transform,c=Math.max(Math.abs(n._zoom-(l.minCutoffZoom-1)),1),f=n.isLODDisabled(!1)?o.a7(60,45,n.pitch):o.a7(30,15,n.pitch),_=n._farZ-n._nearZ,y=t*n.height,M=((1-(P=f))*n.cameraToCenterDistance+P*(n._farZ+y))*c;var P;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(M-n._nearZ)/_,(M-y-n._nearZ)/_]}}},nr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class vf{constructor(t,n){this.aabb=t,this.lastCascade=n}}class wt{add(t,n){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],n.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],n.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],n.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],n.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],n.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],n.max[2])):this.receivers[t.key]=new vf(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,c){const f=o.ca.fromPoints(t.points);let _=0;for(const y in this.receivers){const M=this.receivers[y];if(!M||!f.intersectsAabb(M.aabb))continue;M.aabb.min=f.closestPoint(M.aabb.min),M.aabb.max=f.closestPoint(M.aabb.max);const P=M.aabb.getCorners();for(let D=0;D<c.length;D++){let R=!0;for(const F of P){const N=[F[0]*n,F[1]*n,F[2]];if(o.a6.vec3.transformMat4(N,N,c[D].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){R=!1;break}}if(M.lastCascade=D,_=Math.max(_,D),R)break}}return _+1}}class Kd{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new wt,this._depthMode=new oi(t.context.gl.LEQUAL,oi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(nr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(nr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(nr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const f=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||f<=0||(this._shadowLayerCount=c.style.order.reduce((X,W)=>{const K=c.style._mergedLayers[W];return X+(K.hasShadowPass()&&!K.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=c.context,y=nr.shadowMapResolution,M=nr.shadowMapResolution;if(this._cascades.length===0||nr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<nr.cascadeCount;++X){const W=c._shadowMapDebug,K=_.gl,Y=_.createFramebuffer(y,M,W,"texture"),te=new o.T(_,{width:y,height:M,data:null},K.DEPTH_COMPONENT16);if(Y.depthAttachment.set(te.texture),W){const re=new o.T(_,{width:y,height:M,data:null},K.RGBA8);Y.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:Y,texture:te,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bO,scale:0})}}this.shadowDirection=cc(n);let P=0;if(t.elevation){const X=t.elevation,W=[1e4,-1e4];X.visibleDemTiles.filter(K=>K.dem).forEach(K=>{const Y=K.dem.tree;W[0]=Math.min(W[0],Y.minimums[0]),W[1]=Math.max(W[1],Y.maximums[0])}),W[0]!==1e4&&(P=(W[1]-W[0])*X.exaggeration())}const D=1.5*t.cameraToCenterDistance,R=3*D,F=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const W=this._cascades[X];let K=t.height/50,Y=1;nr.cascadeCount===1?Y=R:X===0?Y=D:(K=D,Y=R);const[te,re]=Cs(t,this.shadowDirection,K,Y,nr.shadowMapResolution,P);W.scale=t.scale,W.matrix=te,W.boundingSphereRadius=re,o.a6.mat4.invert(F,W.matrix),W.frustum=o.bO.fromInvProjectionMatrix(F,1,0,!0),W.far=Y}const N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/nr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=nr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Or.ShadowMap0,this._uniformValues.u_shadowmap_1=Or.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=c.transform.elevation;for(const X of this._groundShadowTiles){let W={min:0,max:0};if(G){const K=G.getMinMaxForTile(X);K&&(W=K)}this.addShadowReceiver(X.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const c=this.painter,f=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),f.viewport.set([0,0,nr.shadowMapResolution,nr.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){c.currentShadowCascade=_,f.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),f.clear({color:o.bA.white,depth:1});for(const y of t.order){const M=t._mergedLayers[y];if(!M.hasShadowPass()||M.isHidden(c.transform.zoom))continue;const P=t.getLayerSourceCache(M),D=P?n[P.id]:void 0;(M.type==="model"||D&&D.length)&&c.renderLayer(c,P,M,D)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,c=t.context,f=n.directionalLight,_=n.ambientLight;if(!f||!_)return;const y=[],M=va(t,t.longestCutoffRange);M.shouldRenderCutoff&&y.push("RENDER_CUTOFF"),y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&y.push("NORMAL_OFFSET");const P=ou(n,f,_),D=new oi(c.gl.LEQUAL,oi.ReadOnly,t.depthRangeFor3D);for(const R of this._groundShadowTiles){const F=R.toUnwrapped(),N=t.isTileAffectedByFog(R),G=t.getOrCreateProgram("groundShadow",{defines:y,overrideFog:N});this.setupShadows(F,G),t.uploadCommonUniforms(c,G,F,null,M);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:P};G.draw(t,c.gl.TRIANGLES,D,vi.disabled,Oi.multiply,di.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Oi.unblended:Oi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,c=n.calculatePosMatrix(t,n.worldSize);return o.a6.mat4.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return o.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,c,f=0){if(!this.enabled)return;const _=this.painter.transform,y=this.painter.context,M=y.gl,P=this._uniformValues,D=new Float64Array(16),R=_.calculatePosMatrix(t,_.worldSize);for(let F=0;F<this._cascades.length;F++)o.a6.mat4.multiply(D,this._cascades[F].matrix,R),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),y.activeTexture.set(M.TEXTURE0+Or.ShadowMap0+F),this._cascades[F].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!c,this.useNormalOffset){const F=o.c9(t.canonical),N=2/_.tileSize*o.ab/nr.shadowMapResolution,G=N*this._cascades[0].boundingSphereRadius,X=N*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(c==="vector-tile"?1:3)/Math.pow(2,f-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));P.u_shadow_normal_offset=[F,G*W,X*W],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(y,P)}setupShadowsFromMatrix(t,n,c=!1){if(!this.enabled)return;const f=this.painter.context,_=f.gl,y=this._uniformValues,M=new Float64Array(16);for(let P=0;P<nr.cascadeCount;P++)o.a6.mat4.multiply(M,this._cascades[P].matrix,t),y[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),f.activeTexture.set(_.TEXTURE0+Or.ShadowMap0+P),this._cascades[P].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);if(this.useNormalOffset=c,c){const P=nr.normalOffset;y.u_shadow_normal_offset=[1,P,P],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(f,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,c,f){if(f[2]>=0)return{};const _=function(P,D,R){const F=R/(1<<P.canonical.z);return new o.ca([P.canonical.x*F+P.wrap*R,P.canonical.y*F+P.wrap*R,0],[(P.canonical.x+1)*F+P.wrap*R,(P.canonical.y+1)*F+P.wrap*R,D])}(t,n,c).getCorners(),y=n/-f[2];f[0]<0?(o.a6.vec3.add(_[0],_[0],[f[0]*y,0,0]),o.a6.vec3.add(_[3],_[3],[f[0]*y,0,0])):f[0]>0&&(o.a6.vec3.add(_[1],_[1],[f[0]*y,0,0]),o.a6.vec3.add(_[2],_[2],[f[0]*y,0,0])),f[1]<0?(o.a6.vec3.add(_[0],_[0],[0,f[1]*y,0]),o.a6.vec3.add(_[1],_[1],[0,f[1]*y,0])):f[1]>0&&(o.a6.vec3.add(_[2],_[2],[0,f[1]*y,0]),o.a6.vec3.add(_[3],_[3],[0,f[1]*y,0]));const M={};return M.vertices=_,M.planes=[lc(_[1],_[0],_[4]),lc(_[2],_[1],_[5]),lc(_[3],_[2],_[6]),lc(_[0],_[3],_[7])],M}addShadowReceiver(t,n,c){this._receivers.add(t,o.ca.fromTileIdAndHeight(t,n,c))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function lc(l,t,n){const c=o.a6.vec3.sub([],n,t),f=o.a6.vec3.sub([],l,t),_=o.a6.vec3.cross([],c,f),y=o.a6.vec3.length(_);return y===0?[0,0,1,0]:(o.a6.vec3.scale(_,_,1/y),[_[0],_[1],_[2],-o.a6.vec3.dot(_,t)])}function cc(l){const t=l.properties.get("direction"),n=o.c8(t.x,t.y,t.z);n[2]=o.ap(n[2],0,75);const c=o.cb([n[0],n[1],n[2]]);return o.a6.vec3.fromValues(c.x,c.y,c.z)}function ou(l,t,n){const c=t.properties.get("color"),f=t.properties.get("intensity"),_=t.properties.get("direction"),y=[_.x,_.y,_.z],M=n.properties.get("color"),P=n.properties.get("intensity"),D=Math.max(o.a6.vec3.dot([0,0,1],y),0),R=[0,0,0];o.a6.vec3.scale(R,M.toRenderColor(l.getLut(t.scope)).toArray01Linear().slice(0,3),P);const F=[0,0,0];return o.a6.vec3.scale(F,c.toRenderColor(l.getLut(n.scope)).toArray01Linear().slice(0,3),D*f),o.cc([R[0]>0?R[0]/(R[0]+F[0]):0,R[1]>0?R[1]/(R[1]+F[1]):0,R[2]>0?R[2]/(R[2]+F[2]):0])}function Cs(l,t,n,c,f,_){const y=l.zoom,M=l.scale,P=l.worldSize,D=1/P,R=l.aspect,F=Math.sqrt(1+R*R)*Math.tan(.5*l.fovX),N=F*F,G=c-n,X=c+n;let W,K;N>G/X?(W=c,K=c*F):(W=.5*X*(1+N),K=.5*Math.sqrt(G*G+2*(c*c+n*n)*N+X*X*N*N));const Y=l.projection.pixelsPerMeter(l.center.lat,P),te=l._camera.getCameraToWorldMercator(),re=[0,0,-W*D];o.a6.vec3.transformMat4(re,re,te);let le=K*D;const fe=l._edgeInsets;if(!(fe.left===0&&fe.top===0&&fe.right===0&&fe.bottom===0||fe.left===fe.right&&fe.top===fe.bottom)){const nt=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?Y:1),lt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,n,c);lt[8]=2*-l.centerOffset.x/l.width,lt[9]=2*l.centerOffset.y/l.height;const ot=new Float64Array(16);o.a6.mat4.mul(ot,lt,nt);const St=new Float64Array(16);o.a6.mat4.invert(St,ot);const Wt=o.bO.fromInvProjectionMatrix(St,P,y,!0);for(const ti of Wt.points){const kt=((me=ti)[0]/=M,me[1]/=M,me[2]=o.bE(me[2],l._center.lat),me);le=Math.max(le,o.a6.vec3.len(o.a6.vec3.subtract([],re,kt)))}}var me;le*=f/(f-1);const de=Math.acos(t[2]),ge=Math.atan2(-t[0],-t[1]),Te=new xa;Te.position=re,Te.setPitchBearing(de,ge);const Ce=Te.getWorldToCamera(P,Y),Ae=le*P,Ee=Math.min(l._mercatorZfromZoom(17)*P*-2,-2*Ae),Ge=Te.getCameraToClipOrthographic(-Ae,Ae,-Ae,Ae,Ee,(Ae+_*Y)/t[2]),Ye=new Float64Array(16);o.a6.mat4.multiply(Ye,Ge,Ce);const at=o.a6.vec3.fromValues(Math.floor(1e6*re[0])/1e6*P,Math.floor(1e6*re[1])/1e6*P,0),_t=.5*f,bt=[0,0,0];o.a6.vec3.transformMat4(bt,at,Ye),o.a6.vec3.scale(bt,bt,_t);const ke=[Math.floor(bt[0]),Math.floor(bt[1]),Math.floor(bt[2])],rt=[0,0,0];o.a6.vec3.sub(rt,bt,ke),o.a6.vec3.scale(rt,rt,-1/_t);const $e=new Float64Array(16);return o.a6.mat4.identity($e),o.a6.mat4.translate($e,$e,rt),o.a6.mat4.multiply(Ye,$e,Ye),[Ye,Ae]}class rs extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,n){return o.aG(this.requestManager.transformRequest(n,o.R.Model).url).then(c=>{if(!c)return;const f=o.aH(c),_=new o.aI(t,void 0,void 0,f);return _.computeBoundsAndApplyParent(),_}).catch(c=>{if(c&&c.status===404)return null;this.fire(new o.t(new Error(`Could not load model ${t} from ${n}: ${c.message}`)))})}load(t,n){this.models[n]||(this.models[n]={});const c=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+c.length;const f=[];for(const _ of c)f.push(this.loadModel(_,t[_]));Promise.allSettled(f).then(_=>{for(let y=0;y<_.length;y++){const{status:M,value:P}=_[y];M==="fulfilled"&&P&&(this.models[n][c[y]]={model:P,numReferences:1})}this.numModelsLoading[n]-=c.length,this.fire(new o.x("data",{dataType:"style"}))}).catch(_=>{this.fire(new o.t(new Error(`Could not load models: ${_.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,c){this.models[c]||(this.models[c]={}),this.hasModel(t,c)&&this.models[c][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(n)},c)}addModels(t,n){this.models[n]||(this.models[n]={});const c={};for(const f in t)this.models[n][f]={},c[f]=this.requestManager.normalizeModelURL(t[f]);this.load(c,n)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={});const c={};for(const f of t)this.hasModel(f,n)?this.models[n][f].numReferences++:c[f]=this.requestManager.normalizeModelURL(f);this.load(c,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const c=this.models[n][t].model;delete this.models[n][t],c.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const c in this.models[n])this.models[n][c].model&&this.models[n][c].model.upload(t.context)}}const bf=new o.a0({data:new o.a1(o._.colorTheme.data)}),qo=(l,t)=>ze(l,t&&t.filter(n=>n.identifier!=="source.canvas")),mh=o.ar(Ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ps=o.ar(Ki,["setCenter","setZoom","setBearing","setPitch"]),os={version:8,layers:[],sources:{}},wf={duration:300,delay:0};class $o extends o.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=o.l({},wf),this._buildingIndex=new oh(this),this.crossTileSymbolIndex=new ya,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new De,this.dispatcher=n.dispatcher?n.dispatcher:new o.ce(o.cf(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new ct,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new o.cg(t._requestManager,n.localFontFamily?o.ch.all:n.localIdeographFontFamily?o.ch.ideographs:o.ch.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new rs(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",o.ci());const c=this;this._rtlTextPluginCallback=$o.registerForPluginStateChange(f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(_,y)=>{if(o.cj(_),y&&y.every(M=>M))for(const M in c._sourceCaches){const P=c._sourceCaches[M],D=P.getSource().type;D!=="vector"&&D!=="geojson"||P.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const _=this.getOwnSource(f.sourceId);if(_&&_.vectorLayerIds)for(const y in this._layers){const M=this._layers[y];M.source===_.id&&this._validateLayer(M)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.f(t))return t;const n=o.ck(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${o.cl(JSON.stringify(t))}`}_diffStyle(t,n,c){this.globalId=this._getGlobalId(t);const f=(_,y)=>{try{y(null,this.setState(_,c))}catch(M){y(M,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(_,o.R.Style);o.n(y,(M,P)=>{M?this.fire(new o.t(M)):P&&f(P,n)})}else typeof t=="object"&&f(t,n)}loadURL(t,n={}){this.fire(new o.x("dataloading",{dataType:"style"}));const c=typeof n.validate=="boolean"?n.validate:!o.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const f=this.importsCache.get(t);if(f)return this._load(f,c);const _=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.n(_,(y,M)=>{if(this._request=null,y)this.fire(new o.t(y));else if(M)return this.importsCache.set(t,M),this._load(M,c)})}loadJSON(t,n={}){this.fire(new o.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new o.x("dataloading",{dataType:"style"})),this._load(os,!1)}_loadImports(t,n,c){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const _ of t){const y=this._createFragmentStyle(_),M=new Promise(R=>{y.once("style.import.load",R),y.once("error",R)}).then(()=>this.mergeAll());if(f.push(M),this.resolvedImports.has(_.url)){y.loadEmpty();continue}const P=_.data||this.importsCache.get(_.url);P?(y.loadJSON(P,{validate:n}),this._isInternalStyle(P)&&(y.globalId=null)):_.url?y.loadURL(_.url,{validate:n}):y.loadEmpty();const D={style:y,id:_.id,config:_.config};if(c){const R=this.fragments.findIndex(({id:F})=>F===c);this.fragments=this.fragments.slice(0,R).concat(D).concat(this.fragments.slice(R))}else this.fragments.push(D)}return Promise.allSettled(f)}getImportGlobalIds(t=this,n=new Set){for(const c of t.fragments)c.style.globalId&&n.add(c.style.globalId),this.getImportGlobalIds(c.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?o.av(t.id,this.scope):t.id;let c;const f=this._initialConfig&&this._initialConfig[n];(t.config||f)&&(c=o.l({},t.config,f));const _=new $o(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const c=t.schema;if(this._isInternalStyle(t)){const y=o.l({},os,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,n)}if(this.updateConfig(this._config,c),n&&qo(this,Do(t)))return;this._loaded=!0,this.stylesheet=o.cm(t);const f=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const y=sh(this.stylesheet.layers);if(this._order=y.map(D=>D.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new Be(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const D of y){const R=o.cq(D,this.scope,this._styleColorTheme.lut,this.options);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const F=this.getOwnLayerSourceCache(R),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&R.canCastShadows()&&N&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.x("data",{dataType:"style"}));const P=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new o.x(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.x(P?"style.load":"style.import.load")))},_=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=_,_){const y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{f()}).catch(M=>{o.w(`Couldn't load color theme from the stylesheet: ${M}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,c,f,_,y,M,P;const D={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(R=>{if(R.stylesheet){if(R.light!=null&&(t=R.light),R.stylesheet.lights)for(const F of R.stylesheet.lights)F.type==="ambient"&&R.ambientLight!=null&&(n=R.ambientLight),F.type==="directional"&&R.directionalLight!=null&&(c=R.directionalLight);f=this._prioritizeTerrain(f,R.terrain,R.stylesheet.terrain),R.stylesheet.fog&&R.fog!=null&&(_=R.fog),R.stylesheet.camera!=null&&(P=R.stylesheet.camera),R.stylesheet.projection!=null&&(y=R.stylesheet.projection),R.stylesheet.transition!=null&&(M=R.stylesheet.transition),D[R.scope]=R._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=c,this.fog=_,this._styleColorThemeForScope=D,f===null?delete this.terrain:this.terrain=f,this.camera=P||{"camera-projection":"perspective"},this.projection=y||{name:"mercator"},this.transition=o.l({},wf,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=c=>{for(const f of c.fragments)n(f.style);t(c)};n(this)}_prioritizeTerrain(t,n,c){const f=t&&t.drapeRenderMode===0;return c===null?n&&n.drapeRenderMode===0?n:f?t:null:n!=null&&(!t||f||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},c={};this.forEachFragmentStyle(f=>{for(const _ in f._sourceCaches){const y=o.av(_,f.scope);t[y]=f._sourceCaches[_]}for(const _ in f._otherSourceCaches){const y=o.av(_,f.scope);n[y]=f._otherSourceCaches[_]}for(const _ in f._symbolSourceCaches){const y=o.av(_,f.scope);c[y]=f._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},n=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(_=>{for(const M of _._order){const P=_._layers[M];if(P.type==="slot"){const D=o.cn(M);if(t[D])continue;t[D]=[]}P.slot&&t[P.slot]?t[P.slot].push(P):n.push(P)}const{featuresets:y}=_.stylesheet||{};if(y)for(const M in y){const{selectors:P}=y[M];for(const D of P){const R=_._layers[D.layer],F=this._mergedLayerSelectors.get(R.fqid)||[];let N;if(D.properties)for(const G in D.properties){const X=o.M(D.properties[G]);X.result==="success"&&(N=N||{},N[G]=X.value)}F.push({featuresetId:M,featureNamespace:D.featureNamespace,properties:N}),this._mergedLayerSelectors.set(R.fqid,F)}}}),this._mergedOrder=[];const f=(_=[])=>{for(const y of _)if(y.type==="slot"){const M=o.cn(y.id);t[M]&&f(t[M]),this._mergedSlots.push(M)}else{const M=o.av(y.id,y.scope);this._mergedOrder.push(M),c[M]=y,y.is3D()&&(this._has3DLayers=!0),y.type==="circle"&&(this._hasCircleLayers=!0),y.type==="symbol"&&(this._hasSymbolLayers=!0),y.type==="clip"&&(this._clipLayerPresent=!0)}};f(n),this._mergedOrder.sort((_,y)=>{const M=c[_],P=c[y];return M.hasInitialOcclusionOpacityProperties?P.is3D()?1:0:M.is3D()&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=o.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,c,f){const _=o.l({},c);for(const M of Object.keys(o._.colorTheme))_[M]===void 0&&(_[M]=o._.colorTheme[M].default);const y=new o.$(bf,n,new Map(f));return y.setTransitionOrValue(_,f),y.untransitioned().possiblyEvaluate(new o.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,f)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let y=t;y.startsWith(_)||(y=_+y);const M="mapbox-reserved-lut",P=new Image;P.src=y,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void c();this._styleColorTheme.lutLoading=!1;const{width:D,height:R,data:F}=o.q.getImageData(P);if(R>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==R*R)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new o.r({width:D,height:R},F),pixelRatio:1,sdf:!1,version:0});const N=this.imageManager.getImage(M,this.scope);N?(this._styleColorTheme.lut={image:N.data,data:t},c()):f(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,c,f){let _,y,M;const P=o.q.devicePixelRatio>1?"@2x":"";let D=o.n(c.transformRequest(c.normalizeSpriteURL(n,P,".json"),o.R.SpriteJSON),(N,G)=>{D=null,M||(M=N,_=G,F())}),R=o.o(c.transformRequest(c.normalizeSpriteURL(n,P,".png"),o.R.SpriteImage),(N,G)=>{R=null,M||(M=N,y=G,F())});function F(){if(M)f(M);else if(_&&y){const N=o.q.getImageData(y),G={};for(const X in _){const{width:W,height:K,x:Y,y:te,sdf:re,pixelRatio:le,stretchX:fe,stretchY:me,content:de}=_[X],ge=new o.r({width:W,height:K});o.r.copy(N,ge,{x:Y,y:te},{x:0,y:0},{width:W,height:K},null),G[X]={data:ge,pixelRatio:le,sdf:re,stretchX:fe,stretchY:me,content:de}}f(null,G)}}return{cancel(){D&&(D.cancel(),D=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,(n,c)=>{if(this._spriteRequest=null,n)this.fire(new o.t(n));else if(c)for(const f in c)this.imageManager.addImage(f,this.scope,c[f]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.x("data",{dataType:"style"}))})}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const c=t.sourceLayer;c&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.t(new Error(`Source layer "${c}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const c=this.fragments[n];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const c=this._sourceCaches[n].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const n=[];for(const c of t){const f=this._layers[c];f&&f.type!=="custom"&&n.push(f.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new o.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new o.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const c=this.map.painter;if(c)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){const _=t.getProgramIds();if(_)for(const y of _){const M=t.getDefaultProgramParams(y,n.zoom,this._styleColorTheme.lut);M&&(c.style=this,this.fog&&(c._fogVisible=!0,M.overrideFog=!0,c.getOrCreateProgram(y,M)),c._fogVisible=!1,M.overrideFog=!1,c.getOrCreateProgram(y,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,c.getOrCreateProgram(y,M)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const c=this._changes.isDirty();let f=!1;if(this._changes.isDirty()){const y=this._changes.getLayerUpdatesByScope();for(const M in y){const{updatedIds:P,removedIds:D}=y[M];(P||D)&&(this._updateWorkerLayers(M,P,D),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const _={};for(const y in this._mergedSourceCaches){const M=this._mergedSourceCaches[y];_[y]=M.used,M.used=!1,M.tileCoverLift=0}for(const y of this._mergedOrder){const M=this._mergedLayers[y];if(M.recalculate(t,this._availableImages),!M.isHidden(t.zoom)){const P=this.getLayerSourceCache(M);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,t)}):this.precompilePrograms(M,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();for(const y in _){const M=this._mergedSourceCaches[y];_[y]!==M.used&&M.getSource().fire(new o.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new o.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,c){const f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:n?f._serializeLayers(n):[],scope:t,removedIds:c||[],options:f.options})}setState(t,n){if(this._checkLoaded(),qo(this,Do(t)))return!1;(t=o.cm(t)).layers=sh(t.layers);const c=function(y,M){if(!y)return[{command:Ki.setStyle,args:[M]}];let P=[];try{if(!o.bi(y.version,M.version))return[{command:Ki.setStyle,args:[M]}];if(o.bi(y.center,M.center)||P.push({command:Ki.setCenter,args:[M.center]}),o.bi(y.zoom,M.zoom)||P.push({command:Ki.setZoom,args:[M.zoom]}),o.bi(y.bearing,M.bearing)||P.push({command:Ki.setBearing,args:[M.bearing]}),o.bi(y.pitch,M.pitch)||P.push({command:Ki.setPitch,args:[M.pitch]}),o.bi(y.sprite,M.sprite)||P.push({command:Ki.setSprite,args:[M.sprite]}),o.bi(y.glyphs,M.glyphs)||P.push({command:Ki.setGlyphs,args:[M.glyphs]}),o.bi(y.imports,M.imports)||function(G=[],X=[],W){X=X||[];const K=(G=G||[]).map(Va),Y=X.map(Va),te=G.reduce(ic,{}),re=X.reduce(ic,{}),le=K.slice();let fe,me,de,ge;for(fe=0,me=0;fe<K.length;fe++)de=K[fe],re.hasOwnProperty(de)?me++:(W.push({command:Ki.removeImport,args:[de]}),le.splice(le.indexOf(de,me),1));for(fe=0,me=0;fe<Y.length;fe++)de=Y[Y.length-1-fe],le[le.length-1-fe]!==de&&(te.hasOwnProperty(de)?(W.push({command:Ki.removeImport,args:[de]}),le.splice(le.lastIndexOf(de,le.length-me),1)):me++,ge=le[le.length-fe],W.push({command:Ki.addImport,args:[re[de],ge]}),le.splice(le.length-fe,0,de));for(const Te of X){const Ce=te[Te.id];Ce&&!o.bi(Ce,Te)&&W.push({command:Ki.updateImport,args:[Te.id,Te]})}}(y.imports,M.imports,P),o.bi(y.transition,M.transition)||P.push({command:Ki.setTransition,args:[M.transition]}),o.bi(y.light,M.light)||P.push({command:Ki.setLight,args:[M.light]}),o.bi(y.fog,M.fog)||P.push({command:Ki.setFog,args:[M.fog]}),o.bi(y.projection,M.projection)||P.push({command:Ki.setProjection,args:[M.projection]}),o.bi(y.lights,M.lights)||P.push({command:Ki.setLights,args:[M.lights]}),o.bi(y.camera,M.camera)||P.push({command:Ki.setCamera,args:[M.camera]}),!o.bi(y["color-theme"],M["color-theme"]))return[{command:Ki.setStyle,args:[M]}];const D={},R=[];(function(G,X,W,K){let Y;for(Y in X=X||{},G=G||{})G.hasOwnProperty(Y)&&(X.hasOwnProperty(Y)||_n(Y,W,K));for(Y in X){if(!X.hasOwnProperty(Y))continue;const te=X[Y];G.hasOwnProperty(Y)?o.bi(G[Y],te)||(G[Y].type==="geojson"&&te.type==="geojson"&&hi(G,X,Y)?W.push({command:Ki.setGeoJSONSourceData,args:[Y,te.data]}):lm(Y,X,W,K)):ah(Y,X,W)}})(y.sources,M.sources,R,D);const F=[];y.layers&&y.layers.forEach(G=>{G.source&&D[G.source]?P.push({command:Ki.removeLayer,args:[G.id]}):F.push(G)});let N=y.terrain;N&&D[N.source]&&(P.push({command:Ki.setTerrain,args:[void 0]}),N=void 0),P=P.concat(R),o.bi(N,M.terrain)||P.push({command:Ki.setTerrain,args:[M.terrain]}),function(G,X,W){X=X||[];const K=(G=G||[]).map(Va),Y=X.map(Va),te=G.reduce(ic,{}),re=X.reduce(ic,{}),le=K.slice(),fe=Object.create(null);let me,de,ge,Te,Ce,Ae,Ee;for(me=0,de=0;me<K.length;me++)ge=K[me],re.hasOwnProperty(ge)?de++:(W.push({command:Ki.removeLayer,args:[ge]}),le.splice(le.indexOf(ge,de),1));for(me=0,de=0;me<Y.length;me++)ge=Y[Y.length-1-me],le[le.length-1-me]!==ge&&(te.hasOwnProperty(ge)?(W.push({command:Ki.removeLayer,args:[ge]}),le.splice(le.lastIndexOf(ge,le.length-de),1)):de++,Ae=le[le.length-me],W.push({command:Ki.addLayer,args:[re[ge],Ae]}),le.splice(le.length-me,0,ge),fe[ge]=!0);for(me=0;me<Y.length;me++)if(ge=Y[me],Te=te[ge],Ce=re[ge],!fe[ge]&&!o.bi(Te,Ce))if(o.bi(Te.source,Ce.source)&&o.bi(Te["source-layer"],Ce["source-layer"])&&o.bi(Te.type,Ce.type)){for(Ee in Jc(Te.layout,Ce.layout,W,ge,null,Ki.setLayoutProperty),Jc(Te.paint,Ce.paint,W,ge,null,Ki.setPaintProperty),o.bi(Te.slot,Ce.slot)||W.push({command:Ki.setSlot,args:[ge,Ce.slot]}),o.bi(Te.filter,Ce.filter)||W.push({command:Ki.setFilter,args:[ge,Ce.filter]}),o.bi(Te.minzoom,Ce.minzoom)&&o.bi(Te.maxzoom,Ce.maxzoom)||W.push({command:Ki.setLayerZoomRange,args:[ge,Ce.minzoom,Ce.maxzoom]}),Te)Te.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?Jc(Te[Ee],Ce[Ee],W,ge,Ee.slice(6),Ki.setPaintProperty):o.bi(Te[Ee],Ce[Ee])||W.push({command:Ki.setLayerProperty,args:[ge,Ee,Ce[Ee]]}));for(Ee in Ce)Ce.hasOwnProperty(Ee)&&!Te.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?Jc(Te[Ee],Ce[Ee],W,ge,Ee.slice(6),Ki.setPaintProperty):o.bi(Te[Ee],Ce[Ee])||W.push({command:Ki.setLayerProperty,args:[ge,Ee,Ce[Ee]]}))}else W.push({command:Ki.removeLayer,args:[ge]}),Ae=le[le.lastIndexOf(ge)+1],W.push({command:Ki.addLayer,args:[Ce,Ae]})}(F,M.layers,P)}catch(D){console.warn("Unable to compute style diff:",D),P=[{command:Ki.setStyle,args:[M]}]}return P}(this.serialize(),t).filter(y=>!(y.command in Ps));if(c.length===0)return!1;const f=c.filter(y=>!(y.command in mh));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);const _=[];return c.forEach(y=>{_.push(this[y.command].apply(this,y.args))}),n&&Promise.all(_).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new o.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n){this.imageManager.updateImage(t,this.scope,n)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new o.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,c={}){return this._checkLoaded(),this._validate(Pe,`models.${t}`,n,null,c)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new o.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Ua,`sources.${t}`,n,null,c))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const f=ih(t,n,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));const _=y=>{const M=(y?"symbol:":"other:")+f.id,P=o.av(M,this.scope),D=this._sourceCaches[M]=new ho(P,f,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=D,D.onAdd(this.map)};_(!1),n.type!=="vector"&&n.type!=="geojson"||_(!0),f.onAdd&&f.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new o.t(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const c=this.getOwnSourceCaches(t);for(const f of c){const _=o.cn(f.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(f.id),f.fire(new o.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const c=this.getOwnSourceCache(n);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const c=t[n]._tiles;for(const f in c){const _=c[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const f of t){if(this._validate(Xc,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(f),_.updateTransitions(n)}else this.ambientLight=new yi(f,pn||(pn=new o.a0({color:new o.a1(o._.properties_light_ambient.color),intensity:new o.a1(o._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(f),_.updateTransitions(n)}else this.directionalLight=new yi(f,rn||(rn=new o.a0({direction:new o.ad(o._.properties_light_directional.direction),color:new o.a1(o._.properties_light_directional.color),intensity:new o.a1(o._.properties_light_directional.intensity),"cast-shadows":new o.a1(o._.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.a1(o._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=new o.a3(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const c=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),f=t.properties.get("color").toRenderColor(null).toArray01(),_=t.properties.get("intensity"),y=t.properties.get("direction"),M=1-o.c8(y.x,y.y,y.z)[2]/90,P=c(f)*_*M,D=n.properties.get("color").toRenderColor(null).toArray01(),R=n.properties.get("intensity"),F=c(D)*R;return Number(((P+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(o.aK(t)){const n=o.co(t),c=this.fragments.find(({id:_})=>_===n);if(!c)throw new Error(`Style import '${t}' not found`);const f=o.cn(t);return c.style.getFragmentStyle(f)}{const n=this.fragments.find(({id:c})=>c===t);if(!n)throw new Error(`Style import '${t}' not found`);return n.style}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const c=[];for(const f in n.stylesheet.featuresets)c.push({featuresetId:f,importId:n.scope?n.scope:void 0});return c}getFeaturesetLayers(t,n){const c=this.getFragmentStyle(n),f=c.stylesheet.featuresets;if(!f||!f[t])return this.fire(new o.t(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const y of f[t].selectors){const M=c.getOwnLayer(y.layer);M&&_.push(M)}return _}getConfigProperty(t,n){const c=this.getFragmentStyle(t);if(!c)return null;const f=o.av(n,c.scope),_=c.options.get(f),y=_?_.value||_.default:null;return y?y.serialize():null}setConfigProperty(t,n,c){const f=this.getFragmentStyle(t);if(!f)return;const _=f.stylesheet.schema;if(!_||!_[n])return;const y=o.M(c);if(y.result!=="success")return void qo(this,y.value);const M=y.value.expression,P=o.av(n,f.scope),D=f.options.get(P);if(!D)return;let R;const{minValue:F,maxValue:N,stepValue:G,type:X,values:W}=_[n],K=o.M(_[n].default);K.result==="success"&&(R=K.value.expression),R?(this.options.set(P,{...D,value:M,default:R,minValue:F,maxValue:N,stepValue:G,type:X,values:W}),this.updateConfigDependencies(n)):this.fire(new o.t(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const c=n.stylesheet.schema;if(!c)return null;const f={};for(const _ in c){const y=o.av(_,n.scope),M=n.options.get(y),P=M?M.value||M.default:null;f[_]=P?P.serialize():null}return f}setConfig(t,n){const c=this.getFragmentStyle(t);c&&(c.updateConfig(n,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=n,c.updateConfig(c._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const c in n){let f,_;const y=o.M(n[c].default);if(y.result==="success"&&(f=y.value.expression),t&&t[c]!==void 0){const N=o.M(t[c]);N.result==="success"&&(_=N.value.expression)}const{minValue:M,maxValue:P,stepValue:D,type:R,values:F}=n[c];if(f){const N=o.av(c,this.scope);this.options.set(N,{default:f,value:_,minValue:M,maxValue:P,stepValue:D,type:R,values:F})}else this.fire(new o.t(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new o.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const c=this.getLayer(n);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(n=>{if(n._styleColorTheme.colorTheme){const c=n._evaluateColorThemeData(n._styleColorTheme.colorTheme);(!n._styleColorTheme.lut&&c!==""||n._styleColorTheme.lut&&c!==n._styleColorTheme.lut.data)&&n.setColorTheme(n._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,n,c={}){this._checkLoaded();const f=t.id;if(this._layers[f])return void this.fire(new o.t(new Error(`Layer with id "${f}" already exists on this map`)));let _;if(t.type==="custom"){if(qo(this,o.cp(t)))return;_=o.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=o.cm(t),t=o.l(t,{source:f})),this._validate(Ze,`layers.${f}`,t,{arrayIndex:-1},c))return;_=o.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let y=this._order.length;if(n){const R=this._order.indexOf(n);if(R===-1)return void this.fire(new o.t(new Error(`Layer with id "${n}" does not exist on this map.`)));_.slot===this._layers[n].slot?y=R:o.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=_;const M=this.getOwnLayerSourceCache(_),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&_.canCastShadows()&&P&&(M.castsShadows=!0);const D=this._changes.getRemovedLayer(_);if(D&&_.source&&M&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const R=o.av(_.source,_.scope);D.type!==_.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),M.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===n)return;const f=this._order.indexOf(t);this._order.splice(f,1);let _=this._order.length;if(n){const y=this._order.indexOf(n);if(y===-1)return void this.fire(new o.t(new Error(`Layer with id "${n}" does not exist on this map.`)));c.slot===this._layers[n].slot?_=y:o.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const f=this.getOwnLayerSourceCache(n);if(f&&f.castsShadows){let _=!1;for(const y in this._layers)if(this._layers[y].source===n.source&&this._layers[y].canCastShadows()){_=!0;break}f.castsShadows=_}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,c){this._checkLoaded();const f=this._checkLayer(t);f&&(f.minzoom===n&&f.maxzoom===c||(n!=null&&(f.minzoom=n),c!=null&&(f.maxzoom=c),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==n&&(c.slot=n,this._updateLayer(c))}setFilter(t,n,c={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!o.bi(f.filter,n))return n==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(J,`layers.${f.id}.filter`,n,{layerType:f.type},c)||(f.filter=o.cm(n),this._updateLayer(f)))}getFilter(t){const n=this._checkLayer(t);if(n)return o.cm(n.filter)}setLayoutProperty(t,n,c,f={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!o.bi(_.getLayoutProperty(n),c)){if(c!=null&&(!f||f.validate!==!1)&&qo(_,pe.call(Do,{key:`layers.${t}.layout.${n}`,layerType:_.type,objectKey:n,value:c,styleSpec:o._,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(n,c),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,n){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(n)}setPaintProperty(t,n,c,f={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||o.bi(_.getPaintProperty(n),c)||c!=null&&(!f||f.validate!==!1)&&qo(_,ie.call(Do,{key:`layers.${t}.paint.${n}`,layerType:_.type,objectKey:n,value:c,styleSpec:o._})))return;const y=_.setPaintProperty(n,c);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),y&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,n){const c=this._checkLayer(t);if(c)return c.getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const c=t.featureset;if(c){if("featuresetId"in c){const D=this.getFragmentStyle(c.importId),R=D.getFeaturesetLayers(c.featuresetId);for(const{source:F,sourceLayer:N}of R)D.setFeatureState({id:t.id,source:F,sourceLayer:N},n)}else if("layerId"in c){const D=this.getLayer(c.layerId);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},n)}return}const f=t.source,_=t.sourceLayer,y=this._checkSource(f);if(!y)return;const M=y.type;if(M==="geojson"&&_)return void this.fire(new o.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!_)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(f);for(const D of P)D.setFeatureState(_,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const c=t.featureset;if(c){if("featuresetId"in c){const D=this.getFragmentStyle(c.importId),R=D.getFeaturesetLayers(c.featuresetId);for(const{source:F,sourceLayer:N}of R)D.removeFeatureState({id:t.id,source:F,sourceLayer:N},n)}else if("layerId"in c){const D=this.getLayer(c.layerId);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},n)}return}const f=t.source,_=this._checkSource(f);if(!_)return;const y=_.type,M=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!M)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.t(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(f);for(const D of P)D.removeFeatureState(M,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.featureset;if(n){let y;if("featuresetId"in n){const M=this.getFragmentStyle(n.importId),P=M.getFeaturesetLayers(n.featuresetId);for(const{source:D,sourceLayer:R}of P){const F=M.getFeatureState({id:t.id,source:D,sourceLayer:R});if(F&&!y)y=F;else if(!o.bi(y,F))return void this.fire(new o.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t){const M=this.getLayer(n.layerId);y=this.getFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer})}return y}const c=t.source,f=t.sourceLayer,_=this._checkSource(c);if(_){if(_.type!=="vector"||f)return t.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,t.id);this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=o.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),c=o.av(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[c]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=M=>this._mergedLayers[M].is3D(),c=this.order,f={},_=[];for(let M=c.length-1;M>=0;M--){const P=c[M];if(n(P)){f[P]=M;for(const D of t){const R=D[P];if(R)for(const F of R)_.push(F)}}}_.sort((M,P)=>P.intersectionZ-M.intersectionZ);const y=[];for(let M=c.length-1;M>=0;M--){const P=c[M];if(n(P))for(let D=_.length-1;D>=0;D--){const R=_[D].feature;if(R.layer&&f[R.layer.id]<M)break;y.push(R),_.pop()}else for(const D of t){const R=D[P];if(R)for(const F of R)y.push(F.feature)}}return y}queryRenderedFeatures(t,n,c){n&&!Array.isArray(n)&&n.filter&&this._validate(J,"queryRenderedFeatures.filter",n.filter,null,n);let f,_=!1;const y=new Set;if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new o.t(new Error("parameters.layers must be an Array."))),[];f=[];for(const R of n.layers){const F=this._mergedLayers[R];if(!F)return this.fire(new o.t(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];F.is3D()&&(_=!0),y.add(F.source),f.push(R)}}else _=this.has3DLayers();const M=this._queryRenderedFeatures(t,c,{layerIds:f,filter:n.filter,has3DLayers:_,includedSources:y}),P=this._flattenAndSortRenderedFeatures(M),D=[];for(const R of P)o.co(R.layer.id)===this.scope&&D.push(R);return D}queryRenderedFeaturesForInteractions(t,n,c){let f=[];for(const{featureset:P,filter:D,radius:R}of n){let F=!1;const N=[],G=new Set;if("featuresetId"in P){const W=this.getFeaturesetLayers(P.featuresetId,P.importId);if(W.length===0)continue;for(const K of W)K.is3D()&&(F=!0),G.add(K.source),N.push(K.fqid)}else if("layerId"in P){const W=this._mergedLayers[P.layerId];if(!W)return this.fire(new o.t(new Error(`The layer '${P.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];W.is3D()&&(F=!0),G.add(W.source),N.push(P.layerId)}let X=t;if(R)if(t instanceof o.P||typeof t[0]=="number"){const W=o.P.convert(t);X=[[W.x-R,W.y-R],[W.x+R,W.y+R]]}else{const W=o.P.convert(t[0]),K=o.P.convert(t[1]);X=[[W.x-R,W.y-R],[K.x+R,K.y+R]]}f=f.concat(this._queryRenderedFeatures(X,c,{layerIds:N,filter:D,has3DLayers:F,includedSources:G}))}const _=this._flattenAndSortRenderedFeatures(f),y=(P,D,R)=>{const F=P.clone();if(delete F.layer,F.featureset=D,R&&R.featureNamespace&&(F.namespace=R.featureNamespace),R&&R.properties){const N={},G=this.map.transform.zoom;for(const X of Object.keys(R.properties)){const W=R.properties[X].evaluate({zoom:G},P._vectorTileFeature,P.state,P.tile,this._availableImages);W!=null&&(N[X]=W)}F.properties=N}return F},M=[];for(const P of _){const D=P.layer.id,R=o.cn(D),F=o.co(D);for(const{featureset:N}of n){if("layerId"in N&&N.layerId!==D)continue;if("layerId"in N&&N.layerId===D){const X=y(P,N);M.push(X);continue}if("featuresetId"in N&&(N.importId!==F||!this.getFeaturesetLayers(N.featuresetId,N.importId).map(X=>X.id).includes(R)))continue;const G=this._mergedLayerSelectors.get(D)||[];for(const X of G){const W=y(P,N,X);M.push(W)}}}return M}_queryRenderedFeatures(t,n,c){const{layerIds:f,filter:_,has3DLayers:y,includedSources:M}=c,P=[],D=Li.createFromScreenPoints(t,n);for(const R in this._mergedSourceCaches){if(!this._mergedSourceCaches[R].getSource())continue;const F=this._mergedSourceCaches[R].getSource().id;f&&!M.has(F)||P.push(pf(this._mergedSourceCaches[R],this._mergedLayers,D,_,f||[],this._availableImages,n,y,!!this.map._showQueryGeometry))}return this.placement&&P.push(function(R,F,N,G,X,W,K,Y){const te={},re=K.queryRenderedSymbols(N),le=[];for(const fe of Object.keys(re).map(Number))le.push(Y[fe]);le.sort(ul);for(const fe of le){const me=fe.featureIndex.lookupSymbolFeatures(re[fe.bucketInstanceId],fe.bucketIndex,fe.sourceLayerIndex,G,X,W,R);for(const de in me){const ge=te[de]=te[de]||[],Te=me[de];Te.sort((Ce,Ae)=>{const Ee=fe.featureSortOrder;if(Ee){const Ge=Ee.indexOf(Ce.featureIndex);return Ee.indexOf(Ae.featureIndex)-Ge}return Ae.featureIndex-Ce.featureIndex});for(const Ce of Te)ge.push(Ce)}}for(const fe in te)te[fe].forEach(me=>{const de=me.feature,ge=R[fe],Te=F(ge);if(!Te)return;const Ce=Te.getFeatureState(de.layer["source-layer"],de.id);de.state=Ce,o.aK(ge.id)||(de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]))});return te}(this._mergedLayers,this.getLayerSourceCache.bind(this),D.screenGeometry,_,f||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),P}querySourceFeatures(t,n){const c=n&&n.filter;c&&this._validate(J,"querySourceFeatures.filter",c,null,n);let f=[];const _=this.getOwnSourceCaches(t);for(const y of _)f=f.concat(mf(y,n));return f}addSourceType(t,n,c){return $o.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):($o.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,c={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const M in t)if(!o.bi(t[M],f[M])){_=!0;break}if(!_)return;const y=this._getTransitionParameters();this.light.setLight(t,n,c),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const f=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const M="terrain-dem-src";this.addSource(M,c.source),c=o.cm(c),c=o.l(c,{source:M})}const _=o.l({},c),y={};if(this.terrain&&f){_.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(y.style=M.serialize())}if(this._validate(Jl,"terrain",_,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&n!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,n),this.fire(new o.x("data",{dataType:"style"}))}else{const _=this.terrain,y=_.get();for(const M of Object.keys(o._.terrain))!c.hasOwnProperty(M)&&o._.terrain[M].default&&(c[M]=o._.terrain[M].default);for(const M in t)if(!o.bi(t[M],y[M])){_.set(t,this.options),this.stylesheet.terrain=t;const P=this._getTransitionParameters({duration:0});_.updateTransitions(P),this.fire(new o.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new Ti(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!o.bi(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();const n=()=>{for(const f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void n();const c=this._evaluateColorThemeData(t);this._loadColorTheme(c).then(()=>{this.fire(new o.x("colorthemeset")),n()}).catch(f=>{o.w(`Couldn't set color theme: ${f}`)})}_getTransitionParameters(t){return{now:o.q.now(),transition:o.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):n.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const c=this.terrain=new We(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,c,f,_={}){if(_&&_.validate===!1)return!1;const y=o.l({},this.serialize());return qo(this,t.call(Do,o.l({key:n,style:y,value:c,styleSpec:o._},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const c of n)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const c of n)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let n;this.directionalLight&&(n=cc(this.directionalLight));for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,c,f,_,y,M=!1){let P=!1,D=!1;const R={},F={};for(const N of this._mergedOrder){const G=this._mergedLayers[N];if(G.type!=="symbol")continue;const X=o.av(G.source,G.scope);let W=R[X];if(!W){const Y=this.getLayerSourceCache(G);if(!Y)continue;const te=Y.getRenderableIds(!0).map(re=>Y.getTileByID(re));F[X]=te.slice(),W=R[X]=te.sort((re,le)=>le.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(le.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(G,W,n.center.lng,n.projection);P=P||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new o.x("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),n.zoom))&&(this.pauseablePlacement=new Qc(n,this._mergedOrder,M,c,f,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),D=!0),P&&this.pauseablePlacement.placement.setStale()),D||P){this._buildingIndex.onNewFrame(n.zoom);for(let N=0;N<this._mergedOrder.length;N++){const G=this._mergedLayers[this._mergedOrder[N]];if(G.type!=="symbol")continue;const X=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,R[o.av(G.source,G.scope)],N,X?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new o.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return c.push(t),this._loadImports([t],!0);const f=c.findIndex(({id:_})=>_===n);return f===-1&&this.fire(new o.t(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,f).concat(t).concat(c.slice(f)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==c[f].url&&this.setImportUrl(t,n.url),o.bi(n.config,c[f].config)||this.setImportConfig(t,n.config),o.bi(n.data,c[f].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let c=this.stylesheet.imports||[];const f=this.getImportIndex(t);if(f===-1)return this;const _=this.getImportIndex(n);if(_===-1)return this;const y=c[f],M=this.fragments[f];return c=c.filter(({id:P})=>P!==t),this.fragments=this.fragments.filter(({id:P})=>P!==t),this.stylesheet.imports=c.slice(0,_).concat(y).concat(c.slice(_)),this.fragments=this.fragments.slice(0,_).concat(M).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;c[f].url=n;const _=this.fragments[f];return _.style=this._createFragmentStyle(c[f]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];return c===-1?this:n?(this.fragments[c].style.setState(n),this._reloadImports(),this):(delete f[c].data,this.setImportUrl(t,f[c].url))}setImportConfig(t,n){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];if(c===-1)return this;n?f[c].config=n:delete f[c].config;const _=this.fragments[c],y=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=n,_.style.updateConfig(n,y),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(n.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return n===-1&&this.fire(new o.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[n];c&&t.push(c.getSource())}return t}getSource(t,n){const c=this.getSourceCache(t,n);return c&&c.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const c=o.av(t,n);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const n=o.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const c=t[n];c==="reload"?this.reloadSource(n):c==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const c of n){const f=this.getLayer(c);f&&f.updateTransitions(t)}}getImages(t,n,c){this.imageManager.getImages(n.icons,n.scope,c),this._updateTilesForChangedImages();const f=_=>{_&&_.setDependencies(n.tileID.key,n.type,n.icons)};f(this._otherSourceCaches[n.source]),f(this._symbolSourceCaches[n.source])}getGlyphs(t,n,c){this.glyphManager.getGlyphs(n.stacks,n.scope,c)}getResource(t,n,c){return o.ct(n,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new o.t(new Error(`There is no source with ID '${t}'`))),!1):n.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const c=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(c||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}$o.getSourceType=function(l){return Kc[l]},$o.setSourceType=function(l,t){Kc[l]=t},$o.registerForPluginStateChange=o.cd;var Jd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Tf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Sf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,_h="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",yl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,et=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Tt=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,pi=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Qi=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Pn=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Tr=[];qa(Jd,Tr),qa(Sf,Tr),qa(Tf,Tr);const Wn={"_prelude_fog.vertex.glsl":et,"_prelude_terrain.vertex.glsl":yl,"_prelude_shadow.vertex.glsl":Qi,"_prelude_fog.fragment.glsl":Tt,"_prelude_shadow.fragment.glsl":Pn,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":mt,"_prelude_raster_particle.glsl":pi},Ga={};ki("",yl),ki(Tt,et),ki(Pn,Qi),ki(mt,""),ki(pi,"");const su=ki(Tf,Sf),Eo=Jd;var Rs={background:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ki("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ki(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ki(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ki("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ki("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ki(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ki(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ki(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ki("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ki("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ki(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ki(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ki("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ki(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_h),skyboxGradient:ki(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_h),skyboxCapture:ki(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ki(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ki(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ki("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ki("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:ki("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function qa(l,t){const n=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of n)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=c.split(" ");for(const _ of f)t.includes(_)||t.push(_)}}function ki(l,t){const n=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let f=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(D=>{const R=D.split(" ");return R[R.length-1]}),f=[...new Set(f)]);const _={},y=[],M=[];if(l=l.replace(n,(D,R)=>(M.push(R),"")),(t=t.replace(n,(D,R)=>(y.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...Tr];qa(l,P),qa(t,P);for(const D of[...y,...M])Wn[D]||console.error(`Undefined include: ${D}`),Ga[D]||(Ga[D]=[],qa(Wn[D],Ga[D])),P=[...P,...Ga[D]];return{fragmentSource:l=l.replace(c,(D,R,F,N,G)=>(_[G]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${F} ${N} ${G};
#else
uniform ${F} ${N} u_${G};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${F} ${N} ${G} = u_${G};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${F} ${N} ${G};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(D,R,F,N,G)=>{const X=N==="float"?"vec2":N,W=G.match(/color/)?"color":X;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${F} ${N} a_${G};
#endif
`:_[G]?R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${F} ${X} a_${G};
out ${F} ${N} ${G};
#else
uniform ${F} ${N} u_${G};
#endif
`:R==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${F} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);
#else
    ${F} ${N} ${G} = u_${G};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${F} ${N} a_${G};
    out ${F} ${N} ${G};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${F} ${X} a_${G};
#else
uniform ${F} ${N} u_${G};
#endif
`:R==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${F} ${N} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${X} a_${G};
#else
uniform ${F} ${N} u_${G};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${F} ${N} ${G} = a_${G};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${F} ${N} ${G} = a_${G};
#else
    ${F} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${F} ${N} ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);
#else
    ${F} ${N} ${G} = u_${G};
#endif
`}),staticAttributes:f,usedDefines:P,vertexIncludes:y,fragmentIncludes:M}}class ba{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,c,f,_,y,M,P){this.context=t;let D=this.boundPaintVertexBuffers.length!==f.length;for(let F=0;!D&&F<f.length;F++)this.boundPaintVertexBuffers[F]!==f[F]&&(D=!0);let R=this.boundDynamicVertexBuffers.length!==M.length;for(let F=0;!R&&F<M.length;F++)this.boundDynamicVertexBuffers[F]!==M[F]&&(R=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==c||D||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==y)this.freshBind(n,c,f,_,y,M,P);else{t.bindVertexArrayOES.set(this.vao);for(const F of M)F&&(F.bind(),P&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,n,P));_&&_.dynamicDraw&&_.bind()}}freshBind(t,n,c,f,_,y,M){const P=t.numAttributes,D=this.context,R=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=y,n.enableAttributes(R,t),n.bind(),n.setVertexAttribPointers(R,t,_);for(const F of c)F.enableAttributes(R,t),F.bind(),F.setVertexAttribPointers(R,t,_);for(const F of y)F&&(F.enableAttributes(R,t),F.bind(),F.setVertexAttribPointers(R,t,_),M&&F.instanceCount&&F.setVertexAttribDivisor(R,t,M));f&&f.bind(),D.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $a(l,t){const n=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new o.a5(0,c/n).toLngLat().lat,new o.a5(0,(c+1)/n).toLngLat().lat]}function Gn(l,t,n,c,f,_,y){const M=l.context,P=M.gl,D=n.hillshadeFBO;if(!D)return;l.prepareDrawTile();const R=l.isTileAffectedByFog(t),F=l.getOrCreateProgram("hillshade",{overrideFog:R});M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.colorAttachment.get());const N=((K,Y,te,re)=>{const le=te.paint.get("hillshade-shadow-color"),fe=te.paint.get("hillshade-highlight-color"),me=te.paint.get("hillshade-accent-color"),de=te.paint.get("hillshade-emissive-strength");let ge=o.bC(te.paint.get("hillshade-illumination-direction"));if(te.paint.get("hillshade-illumination-anchor")==="viewport")ge-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){const Ce=K.style.directionalLight.properties.get("direction"),Ae=o.c8(Ce.x,Ce.y,Ce.z);ge=o.bC(Ae[1])}const Te=!K.options.moving;return{u_matrix:re||K.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),Te),u_image:0,u_latrange:$a(0,Y.tileID),u_light:[te.paint.get("hillshade-exaggeration"),ge],u_shadow:le.toRenderColor(te.lut),u_highlight:fe.toRenderColor(te.lut),u_emissive_strength:de,u_accent:me.toRenderColor(te.lut)}})(l,n,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(M,F,t.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=l.getTileBoundsBuffers(n);F.draw(l,P.TRIANGLES,f,_,y,di.disabled,N,c.id,G,X,W)}function au(l,t,n){if(!t.needsDEMTextureUpload)return;const c=l.context,f=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(n.stride);const _=n.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new o.T(c,_,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function xl(l,t,n){const c=l.context,f=c.gl;if(!t.dem)return;const _=t.dem;if(c.activeTexture.set(f.TEXTURE1),au(l,t,_),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const y=_.dim;c.activeTexture.set(f.TEXTURE0);let M=t.hillshadeFBO;if(!M){const N=new o.T(c,{width:y,height:y,data:null},f.RGBA8);N.bind(f.LINEAR,f.CLAMP_TO_EDGE),M=t.hillshadeFBO=c.createFramebuffer(y,y,!0,"renderbuffer"),M.colorAttachment.set(N.texture)}c.bindFramebuffer.set(M.framebuffer),c.viewport.set([0,0,y,y]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:D,tileBoundsSegments:R}=l.getMercatorTileBoundsBuffers(),F=[];l.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(l,f.TRIANGLES,oi.disabled,vi.disabled,Oi.unblended,di.disabled,((N,G)=>{const X=G.stride,W=o.a6.mat4.create();return o.a6.mat4.ortho(W,0,o.ab,-o.ab,0,0,1),o.a6.mat4.translate(W,W,[0,-o.ab,0]),{u_matrix:W,u_image:1,u_dimension:[X,X],u_zoom:N.overscaledZ}})(t.tileID,_),n.id,P,D,R),t.needsHillshadePrepare=!1}class vn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ef extends vn{getDefault(){return o.bA.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qd extends vn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Af extends vn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vl extends vn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ss extends vn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class lu extends vn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Mf extends vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class cu extends vn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class bl extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class If extends vn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class gh extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class ep extends vn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class uu extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class wa extends vn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uc extends vn{getDefault(){return o.bA.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Cf extends vn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Pf extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class tp extends vn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class hu extends vn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let yh=class extends vn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class wl extends vn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class fu extends vn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Rf extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ho extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Df extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Sr extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qr extends vn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Lf extends vn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class zf extends vn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class du extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Of extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Tl extends vn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Ha extends Tl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class pu extends Tl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sl extends Tl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Js extends pu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const mu=(l,t,n)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),_u=(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:n,u_zoom_transition:f,u_merc_center:_,u_image0:0,u_frustum_tl:y,u_frustum_tr:M,u_frustum_br:P,u_frustum_bl:D,u_globe_pos:R,u_globe_radius:F,u_viewport:N,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:X});function El(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const hc=new class{constructor(){this.operations={}}newMorphing(l,t,n,c,f){if(l in this.operations){const _=this.operations[l];_.to.tileID.key!==n.tileID.key&&(_.queued=n)}else this.operations[l]={startTime:c,phase:0,duration:f,from:t,to:n,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const n=this.operations[t];for(n.phase=(l-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},ip={0:null,1:"TERRAIN_VERTEX_MORPHING"};function np(l,t,n){if(t===0)return 0;const c=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function kf(l,t){const n=1<<l.z;return!t&&(l.x===0||l.x===n-1)||l.y===0||l.y===n-1}const gu=l=>({u_matrix:l});function Al(l,t,n,c,f){if(f>0){const _=o.q.now(),y=(_-l.timeAdded)/f,M=t?(_-t.timeAdded)/f:-1,P=n.getSource(),D=c.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(l.tileID.overscaledZ-D),F=R&&l.refreshedUponExpiration?1:o.ap(R?y:1-M,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Qs extends ho{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},c=new o.ce(o.cf(),null),f=ih("mock-dem",n,c,t.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class Ff extends ho{constructor(t){const n=ih("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new o.ce(o.cf(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,c){if(t.freezeTileCoverage)return;this.transform=t;const f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,y)=>{if(_[y.key]="",!this._tiles[y.key]){const M=new Es(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom);M.state="loaded",this._tiles[y.key]=M}return _},{});for(const _ in this._tiles)_ in f||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const c=Object.values(n);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _e extends o.aA{constructor(t,n,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=c}}class Wa extends o.cE{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,f,_]=function(P){const D=new o.a$,R=new o.aP,F=131;D.reserve(17161),R.reserve(33800);const N=o.ab/128,G=o.ab+N/2,X=G+N;for(let K=-N;K<X;K+=N)for(let Y=-N;Y<X;Y+=N){const te=Y<0||Y>G||K<0||K>G?24575:0,re=o.ap(Math.round(Y),0,o.ab),le=o.ap(Math.round(K),0,o.ab);D.emplaceBack(re+te,le)}const W=(K,Y)=>{const te=Y*F+K;R.emplaceBack(te+1,te,te+F),R.emplaceBack(te+F,te+F+1,te+1)};for(let K=1;K<129;K++)for(let Y=1;Y<129;Y++)W(Y,K);return[0,129].forEach(K=>{for(let Y=0;Y<130;Y++)W(Y,K),W(K,Y)}),[D,R,32768]}(),y=t.context;this.gridBuffer=y.createVertexBuffer(c,o.b1.members),this.gridIndexBuffer=y.createIndexBuffer(f),this.gridSegments=o.b2.simpleSegment(0,0,c.length,f.length),this.gridNoSkirtSegments=o.b2.simpleSegment(0,0,c.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ff(n.map),this.orthoMatrix=o.a6.mat4.create(),o.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.ab,0,o.ab,0,1);const M=y.gl;this._overlapStencilMode=new vi({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qs(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const f=t.terrain.properties,_=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const M=t.terrain&&t.terrain.scope,P=f.get("source"),D=_?this._mockSourceCache:t.getSourceCache(P,M);if(!D)return void o.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=y?this.calculateExaggeration(n):f.get("exaggeration"),!n.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(n,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),n.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const f=n!=null?c-n:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const _=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(_);let M=_-this._previousZoom;const P=this._previousUpdateTimestamp;let D=_;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(_-D)>.5&&(M=.5*(_-D+M)),M*f<0&&(D+=M)),this._evaluationZoom=D;const R=y.getExaggeration(D),F=R===y.getExaggeration(Math.max(0,D-.1));if(F&&Math.abs(R-this._exaggeration)<.01)return R;let N=Math.min(.1,.00375*(this._updateTimestamp-P));return(F||R<.1||Math.abs(M)<1e-4)&&(N=Math.min(.2,4*N)),o.aa(this._exaggeration,R,N)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(o.a5.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=n.getIds().map(P=>{const D=n.getTileByID(P).tileID;return D.projMatrix=c.calculateProjMatrix(D.toUnwrapped()),D});(function(P,D){const R=D.transform.pointCoordinate(D.transform.getCameraPoint()),F=new o.P(R.x,R.y);P.sort((N,G)=>{if(G.overscaledZ-N.overscaledZ)return G.overscaledZ-N.overscaledZ;const X=new o.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),W=new o.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),K=F.mult(1<<N.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(X)-K.distSqr(W)})})(f,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},f.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const P in y){const D=y[P];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[P],_),D.usedForTerrain))continue;const R=t[P];D.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[n.id]=f.map(P=>new _e(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const D=this.terrainTileForTile[P.key];if(!D)continue;const R=D.tileID.key;R in M||(this._visibleDemTiles.push(D),M[R]=R)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const c=this._findTileCoveringTileID(n,this.sourceCache);c&&(this.terrainTileForTile[n.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const c in this.terrainTileForTile){const f=this.terrainTileForTile[c],_=f.dem;!_||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),au(this.painter,f,_))}}_prepareDemTileUniforms(t,n,c,f){if(!n||n.demTexture==null)return!1;const _=t.tileID.canonical,y=Math.pow(2,n.tileID.canonical.z-_.z),M=f||"";return c[`u_dem_tl${M}`]=[_.x*y%1,_.y*y%1],c[`u_dem_scale${M}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((c,f)=>{if(!f.dem)return c;const _=f.dem.tree.minimums[0];return _>0&&t++,c+_},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const c=this._getLoadedAreaMinimum(),f=new o.cF({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(f,{premultiply:!1}):_=this._emptyDEMTexture=new o.T(t,f,n.R32F,{premultiply:!1}),_}setupElevationDraw(t,n,c){const f=this.painter.context,_=f.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let M=null,P=null,D=1;if(c&&c.morphing&&this._useVertexMorphing){const G=c.morphing.srcDemTile,X=c.morphing.dstDemTile;D=c.morphing.phase,G&&X&&(this._prepareDemTileUniforms(t,G,y,"_prev")&&(P=G),this._prepareDemTileUniforms(t,X,y)&&(M=X))}const R=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let F=null;var N;if(this.enabled?P&&M?(F=M.demTexture,f.activeTexture.set(_.TEXTURE4),P.demTexture.bind(R(P),_.CLAMP_TO_EDGE),y.u_dem_lerp=D):(M=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,M,y)?M.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,f.activeTexture.set(_.TEXTURE2),F&&(y.u_dem_size=(N=F).size[0]===1?1:N.size[0]-2,F.bind(R(M),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,n,y),c&&c.useMeterToDem&&M){const G=(1<<M.tileID.canonical.z)*o.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=G}if(c&&c.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),n.setTerrainUniformValues(f,y),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);n.setGlobeUniformValues(f,G)}}globeUniformValues(t,n,c){const f=t.projection;return{u_tile_tl_up:f.upVector(n,0,0),u_tile_tr_up:f.upVector(n,o.ab,0),u_tile_br_up:f.upVector(n,o.ab,o.ab),u_tile_bl_up:f.upVector(n,0,o.ab),u_tile_up_scale:c?o.cG(1):f.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,_,y,M,P){if(f.transform.projection.name==="globe")(function(D,R,F,N,G){const X=D.context,W=X.gl;let K,Y;const te=D.transform,re=o.cx(D,X,te),le=(Ge,Ye)=>{if(Y===Ye)return;const at=[ip[Ye],"PROJECTION_GLOBE_VIEW"];re&&at.push("CUSTOM_ANTIALIASING");const _t=D.isTileAffectedByFog(Ge);K=D.getOrCreateProgram("globeRaster",{defines:at,overrideFog:_t}),Y=Ye},fe=D.colorModeForRenderPass(),me=new oi(W.LEQUAL,oi.ReadWrite,D.depthRangeFor3D);hc.update(G);const de=o.cy(te),ge=[o.am(te.center.lng),o.at(te.center.lat)],Te=D.globeSharedBuffers,Ce=[te.width*o.q.devicePixelRatio,te.height*o.q.devicePixelRatio],Ae=Float32Array.from(te.globeMatrix),Ee={useDenormalizedUpVectorScale:!0};{const Ge=D.transform,Ye=np(Ge.zoom,R.exaggeration(),R.sourceCache._source.tileSize);Y=-1;const at=W.TRIANGLES;for(const _t of N){const bt=F.getTile(_t),ke=vi.disabled,rt=R.prevTerrainTileForTile[_t.key],$e=R.terrainTileForTile[_t.key];El(rt,$e)&&hc.newMorphing(_t.key,rt,$e,G,250),X.activeTexture.set(W.TEXTURE0),bt.texture&&bt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const nt=hc.getMorphValuesForProxy(_t.key),lt=nt?1:0;nt&&o.C(Ee,{morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:o.cw(nt.phase)}});const ot=o.cz(_t.canonical),St=o.cA(ot.getCenter().lat),Wt=o.cB(_t.canonical,ot,St,Ge.worldSize/Ge._pixelsPerMercatorPixel),ti=o.b6(o.cC(_t.canonical)),kt=_u(Ge.expandedFarZProjMatrix,Ae,de,ti,o.a9(Ge.zoom),ge,Ge.frustumCorners.TL,Ge.frustumCorners.TR,Ge.frustumCorners.BR,Ge.frustumCorners.BL,Ge.globeCenterInViewSpace,Ge.globeRadius,Ce,Ye,Ge._farZ,Wt);if(le(_t,lt),K&&(R.setupElevationDraw(bt,K,Ee),D.uploadCommonUniforms(X,K,_t.toUnwrapped()),Te)){const[Kt,zt,ai]=Te.getGridBuffers(St,Ye!==0);K.draw(D,at,me,ke,fe,di.backCCW,kt,"globe_raster",Kt,zt,ai)}}}if(Te&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const Ge=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ge.push("CUSTOM_ANTIALIASING"),K=D.getOrCreateProgram("globeRaster",{defines:Ge});for(const Ye of N){const{x:at,y:_t,z:bt}=Ye.canonical,ke=_t===0,rt=_t===(1<<bt)-1,[$e,nt,lt,ot]=Te.getPoleBuffers(bt,!1);if(ot&&(ke||rt)){const St=F.getTile(Ye);X.activeTexture.set(W.TEXTURE0),St.texture&&St.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Wt=o.cD(bt,at,te);const ti=o.b6(o.cC(Ye.canonical)),kt=(Kt,zt)=>Kt.draw(D,W.TRIANGLES,me,vi.disabled,fe,di.disabled,_u(te.expandedFarZProjMatrix,Wt,Wt,ti,0,ge,te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.globeCenterInViewSpace,te.globeRadius,Ce,0,te._farZ),"globe_pole_raster",zt,lt,ot);R.setupElevationDraw(St,K,Ee),D.uploadCommonUniforms(X,K,Ye.toUnwrapped()),ke&&D.renderDefaultNorthPole&&kt(K,$e),rt&&D.renderDefaultSouthPole&&(Wt=o.a6.mat4.scale(o.a6.mat4.create(),Wt,[1,-1,1]),kt(K,nt))}}}})(f,_,y,M,P);else{const D=f.context,R=D.gl;let F,N;const G=f.shadowRenderer,X=va(f,f.longestCutoffRange),W=fe=>{if(N===fe)return;const me=[];me.push(ip[fe]),X.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),G&&(me.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&me.push("NORMAL_OFFSET")),F=f.getOrCreateProgram("terrainRaster",{defines:me}),N=fe},K=f.colorModeForRenderPass(),Y=new oi(R.LEQUAL,oi.ReadWrite,f.depthRangeFor3D);hc.update(P);const te=f.transform,re=np(te.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let le=[0,0,0];if(G){const fe=f.style.directionalLight,me=f.style.ambientLight;fe&&me&&(le=ou(f.style,fe,me))}{N=-1;const fe=R.TRIANGLES,[me,de]=[_.gridIndexBuffer,_.gridSegments];for(const ge of M){const Te=y.getTile(ge),Ce=vi.disabled,Ae=_.prevTerrainTileForTile[ge.key],Ee=_.terrainTileForTile[ge.key];El(Ae,Ee)&&hc.newMorphing(ge.key,Ae,Ee,P,250),D.activeTexture.set(R.TEXTURE0),Te.texture&&Te.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const Ge=hc.getMorphValuesForProxy(ge.key),Ye=Ge?1:0;let at;Ge&&(at={morphing:{srcDemTile:Ge.from,dstDemTile:Ge.to,phase:o.cw(Ge.phase)}});const _t=mu(ge.projMatrix,kf(ge.canonical,te.renderWorldCopies)?re/10:re,le);if(W(Ye),!F)continue;_.setupElevationDraw(Te,F,at);const bt=ge.toUnwrapped();G&&G.setupShadows(bt,F),f.uploadCommonUniforms(D,F,bt,null,X),F.draw(f,fe,Y,Ce,K,di.backCCW,_t,"terrain_raster",_.gridBuffer,me,de)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,c=this.painter.context,f=this.proxySourceCache,_=this.proxiedCoords[f.id],y=this._drapedRenderBatches.shift(),M=n.style.order,P=[];let D=0;for(const R of _){const F=f.getTileByID(R.proxyTileKey),N=f.proxyCachedFBO[R.key]?f.proxyCachedFBO[R.key][t]:void 0,G=N!==void 0?f.renderCache[N]:this.pool[D++],X=N!==void 0;if(F.texture=G.tex,X&&!G.dirty){P.push(F.tileID);continue}let W;c.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(c.clear({color:o.bA.transparent,stencil:0}),G.dirty=!1);for(let K=y.start;K<=y.end;++K){const Y=n.style._mergedLayers[M[K]];if(Y.isHidden(n.transform.zoom))continue;const te=n.style.getLayerSourceCache(Y),re=te?this.proxyToSource[R.key][te.id]:[R];if(!re)continue;const le=re;c.viewport.set([0,0,G.fb.width,G.fb.height]),W!==(te?te.id:null)&&(this._setupStencil(G,re,Y,te),W=te?te.id:null),n.renderLayer(n,te,Y,le)}if(this._drapedRenderBatches.length===0)for(const K of this._pendingGroundEffectLayers){const Y=n.style._mergedLayers[M[K]];if(Y.isHidden(n.transform.zoom))continue;const te=n.style.getLayerSourceCache(Y),re=te?this.proxyToSource[R.key][te.id]:[R];if(!re)continue;const le=re;c.viewport.set([0,0,G.fb.width,G.fb.height]),W!==(te?te.id:null)&&(this._setupStencil(G,re,Y,te),W=te?te.id:null),n.renderLayer(n,te,Y,le)}this.renderedToTile?(G.dirty=!0,P.push(F.tileID)):X||--D,D===5&&(D=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let c=-1,f=n;for(let _=0;_<n;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?c=Math.max(c,_):f=Math.min(f,_);return f>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,c){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const y=_.tileID,M=1<<y.overscaledZ,{x:P,y:D}=y.canonical,R=P/M,F=(P+1)/M,N=D/M,G=(D+1)/M;return{minx:R,miny:N,maxx:F,maxy:G,t:_.dem.tree.raycastRoot(R,N,F,G,t,n,c),tile:_}});f.sort((_,y)=>(_.t!==null?_.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE));for(const _ of f){if(_.t==null)return null;const y=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,n,c);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,n=t.gl,c=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const f=new o.T(t,{width:c[0],height:c[1],data:null},n.RGBA8);f.bind(n.LINEAR,n.CLAMP_TO_EDGE);const _=t.createFramebuffer(c[0],c[1],!0,null);return _.colorAttachment.set(f.texture),_.depthAttachment=new Js(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],c=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!c&&n.shouldRedrape():!c&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof ro){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(f);if(_&&!n[_.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof o.a4){n[_.id]=!0;for(const y of this.proxyCoords){const M=this.proxyToSource[y.key][_.id];if(M)for(const P of M)this._clearRenderCacheForTile(_.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof pa){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(f);if(!_||n[_.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const y=f.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const P=this.proxyToSource[M.key][_.id];if(P)for(const D of P){const R=Al(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,y);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){const t=this._style.order,n=t.length;if(n===0)return;const c=[];this._pendingGroundEffectLayers=[];let f,_=0,y=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++_<n;)y=this._style._mergedLayers[t[_]];for(;_<n;++_){const M=this._style._mergedLayers[t[_]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?f===void 0&&(f=_):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),f!==void 0&&(c.push({start:f,end:_-1}),f=void 0)))}if(f!==void 0&&c.push({start:f,end:_-1}),c.length!==0){const M=c[c.length-1];this._pendingGroundEffectLayers.every(P=>P>M.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const y=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let M=0;M<y.length;++M){const P=Object.values(y[M]);n.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,f=this._tilesDirty;for(let y=c.length-1;y>=0;y--){const M=c[y];if(n.getTileByID(M.key),n.proxyCachedFBO[M.key]!==void 0){const P=t[M.key],D=this.proxyToSource[M.key];let R=0;for(const F in D){const N=D[F],G=P[F];if(!G||G.length!==N.length||N.some((X,W)=>X!==G[W]||f[F]&&f[F].hasOwnProperty(X.key))){R=-1;break}++R}for(const F in n.proxyCachedFBO[M.key])n.renderCache[n.proxyCachedFBO[M.key][F]].dirty=R<0||R!==Object.values(P).length}}const _=[...this._drapedRenderBatches];_.sort((y,M)=>M.end-M.start-(y.end-y.start));for(const y of _)for(const M of c){if(n.proxyCachedFBO[M.key])continue;let P=n.renderCachePool.pop();P===void 0&&n.renderCache.length<50&&(P=n.renderCache.length,n.renderCache.push(this._createFBO())),P!==void 0&&(n.proxyCachedFBO[M.key]={},n.proxyCachedFBO[M.key][y.start]=P,n.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,c,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,y=_.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let M;if(c.isTileClipped())M=n.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):vi.disabled}_renderTileClippingMasks(t,n){const c=this.painter,f=this.painter.context,_=f.gl;c._tileClippingMaskIDs={},f.setColorMode(Oi.disabled),f.setDepthMode(oi.disabled);const y=c.getOrCreateProgram("clippingMask");for(const M of t){const P=c._tileClippingMaskIDs[M.key]=--n;y.draw(c,_.TRIANGLES,oi.disabled,new vi({func:_.ALWAYS,mask:0},P,255,_.KEEP,_.KEEP,_.REPLACE),Oi.disabled,di.disabled,gu(M.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const c=[t.x,t.y,1,1];o.a6.vec4.transformMat4(c,c,n.pixelMatrixInverse),o.a6.vec4.scale(c,c,1/c[3]),c[0]/=n.worldSize,c[1]/=n.worldSize;const f=n._camera.position,_=o.bE(1,n.center.lat),y=[f[0],f[1],f[2]/_,0],M=o.a6.vec3.subtract([],c.slice(0,3),y);o.a6.vec3.normalize(M,M);const P=this.raycast(y,M,this._exaggeration);return P!==null&&P?(o.a6.vec3.scaleAndAdd(y,y,M,P),y[3]=y[2],y[2]*=_,y):null}_setupProxiedCoordsForOrtho(t,n,c){if(t.getSource()instanceof o.aD)return this._setupProxiedCoordsForImageSource(t,n,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const f=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let P=0;P<_.length;P++){const D=_[P],R=this._findTileCoveringTileID(D,t);if(R){const F=this._createProxiedId(D,R,c[D.key]&&c[D.key][t.id]);f.push(F),this.proxyToSource[D.key][t.id]=[F]}}let y=!1;const M=new Set;for(let P=0;P<n.length;P++){const D=t.getTile(n[P]);if(!D||!D.hasData())continue;const R=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==D.tileID.canonical.z){const F=this.proxyToSource[R.tileID.key][t.id],N=this._createProxiedId(R.tileID,D,c[R.tileID.key]&&c[R.tileID.key][t.id]);F?F.splice(F.length-1,0,N):this.proxyToSource[R.tileID.key][t.id]=[N];const G=this.proxyToSource[R.tileID.key][t.id];M.has(G)||M.add(G),f.push(N),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const P of M)P.sort((D,R)=>R.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,c){if(!t.getSource().loaded())return;const f=this.proxiedCoords[t.id]=[],_=this.proxyCoords,y=t.getSource(),M=y.tileID;if(!M)return;const P=new o.P(M.x,M.y)._div(1<<M.z),D=y.coordinates.map(o.a5.fromLngLat).reduce((F,N)=>(F.min.x=Math.min(F.min.x,N.x-P.x),F.min.y=Math.min(F.min.y,N.y-P.y),F.max.x=Math.max(F.max.x,N.x-P.x),F.max.y=Math.max(F.max.y,N.y-P.y),F),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(F,N)=>{const G=F.wrap+F.canonical.x/(1<<F.canonical.z),X=F.canonical.y/(1<<F.canonical.z),W=o.ab/(1<<F.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),Y=N.canonical.y/(1<<N.canonical.z);return G+W<K+D.min.x||G>K+D.max.x||X+W<Y+D.min.y||X>Y+D.max.y};for(let F=0;F<_.length;F++){const N=_[F];for(let G=0;G<n.length;G++){const X=t.getTile(n[G]);if(!X||!X.hasData()||R(N,X.tileID))continue;const W=this._createProxiedId(N,X,c[N.key]&&c[N.key][t.id]),K=this.proxyToSource[N.key][t.id];K?K.push(W):this.proxyToSource[N.key][t.id]=[W],f.push(W)}}}_createProxiedId(t,n,c){let f=this.orthoMatrix;if(c){const _=c.find(y=>y.key===n.tileID.key);if(_)return _}if(n.tileID.key!==t.key){const _=t.canonical.z-n.tileID.canonical.z;let y,M,P;f=o.a6.mat4.create();const D=n.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(y=o.ab>>_,M=y*((n.tileID.canonical.x<<_)-t.canonical.x+D),P=y*((n.tileID.canonical.y<<_)-t.canonical.y)):(y=o.ab<<-_,M=o.ab*(n.tileID.canonical.x-(t.canonical.x+D<<-_)),P=o.ab*(n.tileID.canonical.y-(t.canonical.y<<-_))),o.a6.mat4.ortho(f,0,y,0,y,0,1),o.a6.mat4.translate(f,f,[M,P,0])}return new _e(n.tileID,t.key,f)}_findTileCoveringTileID(t,n){let c=n.getTile(t);if(c&&c.hasData())return c;const f=this._findCoveringTileCache[n.id],_=f[t.key];if(c=_?n.getTileByID(_):null,c&&c.hasData()||_===null)return c;let y=c?c.tileID:t,M=y.overscaledZ;const P=n.getSource().minzoom,D=[];if(!_){const F=n.getSource().maxzoom;if(t.canonical.z>=F){const N=t.canonical.z-F;n.getSource().reparseOverscaled?(M=Math.max(t.canonical.z+2,n.transform.tileZoom),y=new o.aA(M,t.wrap,F,t.canonical.x>>N,t.canonical.y>>N)):N!==0&&(M=F,y=new o.aA(M,t.wrap,F,t.canonical.x>>N,t.canonical.y>>N))}y.key!==t.key&&(D.push(y.key),c=n.getTile(y))}const R=F=>{D.forEach(N=>{f[N]=F}),D.length=0};for(M-=1;M>=P&&(!c||!c.hasData());M--){c&&R(c.tileID.key);const F=y.calculateScaledKey(M);if(c=n.getTileByID(F),c&&c.hasData())break;const N=f[F];if(N===null)break;N===void 0?D.push(F):c=n.getTileByID(N)}return R(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[n.key]=!0}}function fc(l,t,n){const c=function(M,P,D){const R=o.a6.vec3.dot(P,M),F=o.a6.vec3.dot(D,[.2126,.7152,.0722]),N=(X,W,K)=>(1-K)*X+K*W,G=N(1-.3*Math.min(F,1),1,Math.min(R+1,1));return N(.92,1,Math.asin(o.ap(P[2],-1,1))/Math.PI+.5)*G}(l,[0,0,1],t),f=[0,0,0];o.a6.vec3.scale(f,n.slice(0,3),c);const _=[0,0,0];o.a6.vec3.scale(_,t.slice(0,3),l[2]);const y=[0,0,0];return o.a6.vec3.add(y,f,_),o.cc(y)}const so=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],En=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ta{static cacheKey(t,n,c,f){let _=`${n}${f?f.cacheKey:""}`;for(const y of c)t.usedDefines.includes(y)&&(_+=`/${y}`);return _}constructor(t,n,c,f,_,y){const M=t.gl;this.program=M.createProgram(),this.configuration=f,this.name=n,this.fixedDefines=[...y];const P=f?f.getBinderAttributes():[],D=(c.staticAttributes||[]).concat(P);let R=f?f.defines():[];R=R.concat(y.map(K=>`#define ${K}`));const F=`#version 300 es
`;let N=F+R.concat("precision mediump float;",Eo,su.fragmentSource).join(`
`);for(const K of c.fragmentIncludes)N+=`
${Wn[K]}`;N+=`
${c.fragmentSource}`;let G=F+R.concat("precision highp float;",Eo,su.vertexSource).join(`
`);for(const K of c.vertexIncludes)G+=`
${Wn[K]}`;G+=`
${c.vertexSource}`;const X=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(X,N),M.compileShader(X),M.attachShader(this.program,X);const W=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(W,G),M.compileShader(W),M.attachShader(this.program,W),this.attributes={},this.numAttributes=D.length;for(let K=0;K<this.numAttributes;K++)if(D[K]){const Y=D[K].startsWith("a_")?D[K]:`a_${D[K]}`;M.bindAttribLocation(this.program,K,Y),this.attributes[Y]=K}M.linkProgram(this.program),M.deleteShader(W),M.deleteShader(X),this.fixedUniforms=_(t),this.binderUniforms=f?f.getUniforms(t):[],(y.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(K=>({u_dem:new o.bK(K),u_dem_prev:new o.bK(K),u_dem_tl:new o.bH(K),u_dem_scale:new o.bJ(K),u_dem_tl_prev:new o.bH(K),u_dem_scale_prev:new o.bJ(K),u_dem_size:new o.bJ(K),u_dem_lerp:new o.bJ(K),u_exaggeration:new o.bJ(K),u_depth:new o.bK(K),u_depth_size_inv:new o.bH(K),u_depth_range_unpack:new o.bH(K),u_occluder_half_size:new o.bJ(K),u_occlusion_depth_offset:new o.bJ(K),u_meter_to_dem:new o.bJ(K),u_label_plane_matrix_inv:new o.bG(K)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new o.bI(K),u_tile_tr_up:new o.bI(K),u_tile_br_up:new o.bI(K),u_tile_bl_up:new o.bI(K),u_tile_up_scale:new o.bJ(K)}))(t)),y.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new o.bG(K),u_fog_range:new o.bH(K),u_fog_color:new o.c7(K),u_fog_horizon_blend:new o.bJ(K),u_fog_vertical_limit:new o.bH(K),u_fog_temporal_offset:new o.bJ(K),u_frustum_tl:new o.bI(K),u_frustum_tr:new o.bI(K),u_frustum_br:new o.bI(K),u_frustum_bl:new o.bI(K),u_globe_pos:new o.bI(K),u_globe_radius:new o.bJ(K),u_globe_transition:new o.bJ(K),u_is_globe:new o.bK(K),u_viewport:new o.bH(K)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new o.c7(K)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new o.bI(K),u_lighting_directional_dir:new o.bI(K),u_lighting_directional_color:new o.bI(K),u_ground_radiance:new o.bI(K)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new o.bG(K),u_light_matrix_1:new o.bG(K),u_fade_range:new o.bH(K),u_shadow_normal_offset:new o.bI(K),u_shadow_intensity:new o.bJ(K),u_shadow_texel_size:new o.bJ(K),u_shadow_map_resolution:new o.bJ(K),u_shadow_direction:new o.bI(K),u_shadow_bias:new o.bI(K),u_shadowmap_0:new o.bK(K),u_shadowmap_1:new o.bK(K)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)c[f]&&c[f].set(this.program,f,n[f])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)c[f]&&c[f].set(this.program,f,n[f])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)c[f].set(this.program,f,n[f])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)c[f].set(this.program,f,n[f])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)c[f].set(this.program,f,n[f])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const f in n)c[f].set(this.program,f,n[f])}_drawDebugWireframe(t,n,c,f,_,y,M,P,D,R){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const N=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!so.includes(this.name))||!(!F.layers3D||!En.includes(this.name))))return;const G=N.gl,X=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,N);if(!X)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const K=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});N.program.set(K.program);const Y=(le,fe,me)=>{if(fe[le]&&me[le])for(const de in fe[le])me[le][de]&&me[le][de].set(me.program,de,fe[le][de].current)};D&&D.setUniforms(K.program,N,K.binderUniforms,M,{zoom:P}),Y("fixedUniforms",this,K),Y("terrainUniforms",this,K),Y("globeUniforms",this,K),Y("fogUniforms",this,K),Y("lightsUniforms",this,K),Y("shadowUniforms",this,K),X.bind(),N.setColorMode(new Oi([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],o.bA.transparent,[!0,!0,!0,!1])),N.setDepthMode(new oi(n.func===G.LESS?G.LEQUAL:n.func,oi.ReadOnly,n.range)),N.setStencilMode(vi.disabled);const te=3*y.primitiveLength*2,re=3*y.primitiveOffset*2*2;R&&R>1?G.drawElementsInstanced(G.LINES,te,G.UNSIGNED_SHORT,re,R):G.drawElements(G.LINES,te,G.UNSIGNED_SHORT,re),_.bind(),N.program.set(this.program),N.setDepthMode(n),N.setStencilMode(c),N.setColorMode(f)}checkUniforms(t,n,c){if(this.fixedDefines.includes(n)){for(const f of Object.keys(c))if(!c[f].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${f} not set but required by ${n} being defined`)}}draw(t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K){const Y=t.context,te=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(c),Y.setStencilMode(f),Y.setColorMode(_),Y.setCullFace(y);for(const fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,M[fe]);X&&X.setUniforms(this.program,Y,this.binderUniforms,N,{zoom:G});const re={[te.POINTS]:1,[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[n];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const le=K&&K>0?1:void 0;for(const fe of F.get()){const me=fe.vaos||(fe.vaos={});(me[P]||(me[P]=new ba)).bind(Y,this,D,X?X.getPaintVertexBuffers():[],R,fe.vertexOffset,W||[],le),K&&K>1?te.drawElementsInstanced(n,fe.primitiveLength*re,te.UNSIGNED_SHORT,fe.primitiveOffset*re*2,K):R?te.drawElements(n,fe.primitiveLength*re,te.UNSIGNED_SHORT,fe.primitiveOffset*re*2):te.drawArrays(n,fe.vertexOffset,fe.vertexLength),n===te.TRIANGLES&&R&&this._drawDebugWireframe(t,c,f,_,R,fe,N,G,X,K)}}}function xh(l,t){const n=Math.pow(2,t.tileID.overscaledZ),c=t.tileSize*Math.pow(2,l.transform.tileZoom)/n,f=c*(t.tileID.canonical.x+t.tileID.wrap*n),_=c*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ak(t,1,l.transform.tileZoom),u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}const Ml={terrain:0,flat:1},Za=o.a6.mat4.create(),Bf=(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y)=>{const te=t.style.light,re=te.properties.get("position"),le=[re.x,re.y,re.z],fe=o.a6.mat3.create();te.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(fe,-t.transform.angle),o.a6.vec3.transformMat3(le,le,fe));const me=te.properties.get("color"),de=t.transform,ge={u_matrix:l,u_lightpos:le,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+n,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Za,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ml[D],u_base_type:Ml[R],u_ao:f,u_edge_radius:_,u_width_scale:y,u_flood_light_color:X,u_vertical_scale:W,u_flood_light_intensity:K,u_ground_shadow_factor:Y};return de.projection.name==="globe"&&(ge.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],ge.u_zoom_transition=F,ge.u_inv_rot_matrix=G,ge.u_merc_center=N,ge.u_up_dir=de.projection.upVector(new o.bQ(0,0,0),N[0]*o.ab,N[1]*o.ab),ge.u_height_lift=P),ge},Nf=(l,t,n,c,f,_)=>({u_matrix:l,u_edge_radius:t,u_width_scale:n,u_vertical_scale:c,u_height_type:Ml[f],u_base_type:Ml[_]}),Uf=(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K)=>{const Y=Bf(l,t,n,c,f,_,y,M,D,R,F,N,G,X,W,K,1,[0,0,0]),te={u_height_factor:-Math.pow(2,M.overscaledZ)/P.tileSize/8};return o.l(Y,xh(t,P),te)},rp=(l,t)=>({u_matrix:l,u_emissive_strength:t}),Vf=(l,t,n,c)=>o.l(rp(l,t),xh(n,c)),Wo=(l,t,n)=>({u_matrix:l,u_world:n,u_emissive_strength:t}),um=(l,t,n,c,f)=>o.l(Vf(l,t,n,c),{u_world:f}),hm=(l,t,n,c)=>{const f=o.ab/n.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(c),u_extrude_scale:[t.pixelsToGLUnits[0]/f,t.pixelsToGLUnits[1]/f]}},jf=(l,t,n=1)=>({u_matrix:l,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),fm=o.a6.mat4.create(),Gf=(l,t,n,c,f,_,y)=>{const M=l.transform,P=M.projection.name==="globe",D=P?o.cI(M.zoom,t.canonical)*M._pixelsPerMercatorPixel:o.ak(n,1,_),R={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:y,u_inv_rot_matrix:fm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){R.u_inv_rot_matrix=c,R.u_merc_center=f,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=o.a9(M.zoom);const F=f[0]*o.ab,N=f[1]*o.ab;R.u_up_dir=M.projection.upVector(new o.bQ(0,0,0),F,N)}return R};function as(l,[t,n,c,f],[_,y]){if(_===y)return[0,0,0,0];const M=255*(l-1)/(l*(y-_));return[t*M,n*M,c*M,f*M]}function dc(l,t,[n,c]){return n===c?0:.5/l+(t-n)*(l-1)/(l*(c-n))}const vh=(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y,te,re,le)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:_,u_scale_parent:D,u_fade_t:R.mix,u_opacity:R.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:o.cJ(F.paint.get("raster-saturation")),u_contrast_factor:o.cK(F.paint.get("raster-contrast")),u_spin_weights:yu(F.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:G,u_zoom_transition:y,u_merc_center:M,u_cutoff_params:P,u_colorization_mix:as(o.cL,W,Y),u_colorization_offset:dc(o.cL,K,Y),u_color_ramp:X,u_texture_offset:[re/(te+2*re),te/(te+2*re)],u_texture_res:[te+2*re,te+2*re],u_emissive_strength:le});function yu(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Il=.05,bh=(l,t,n,c,f,_,y,M,P,D,R,F)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:_,u_scale_parent:D,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:y,u_merc_center:M,u_cutoff_params:P}),ea=(l,t,n,c,f,_,y,M,P,D)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:c,u_color_ramp:_,u_velocity_res:f,u_max_speed:y,u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Il,Il]}),qf=(l,t,n,c,f,_,y,M,P,D)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:c,u_max_speed:f,u_speed_factor:_,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Il,Il]}),$f=o.a6.mat4.create(),ls=(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y,te,re,le,fe)=>{const me=f.transform,de={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(te),u_rotate_symbol:+n,u_aspect_ratio:me.width/me.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:y,u_coord_matrix:M,u_is_text:+D,u_elevation_from_sea:P?1:0,u_pitch_with_map:+c,u_texsize:R,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$f,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$f,u_up_vector:[0,-1,0],u_color_adj_mat:re,u_icon_transition:le||0,u_gamma_scale:c?f.transform.getCameraToCenterDistance(te)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+N,u_scale_factor:fe||1};return te.name==="globe"&&(de.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],de.u_zoom_transition=X,de.u_inv_rot_matrix=K,de.u_merc_center=W,de.u_camera_forward=me._camera.forward(),de.u_ecef_origin=o.cM(me.globeMatrix,G.toUnwrapped()),de.u_tile_matrix=Float32Array.from(me.globeMatrix),de.u_up_vector=Y),de},Cl=(l,t,n,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:n,u_color:c}),xu=(l,t,n,c,f,_,y,M,P)=>o.l(function(D,R,F,N,G,X){const{width:W,height:K}=N.imageManager.getPixelSize(R),Y=Math.pow(2,X.tileID.overscaledZ),te=X.tileSize*Math.pow(2,N.transform.tileZoom)/Y,re=te*(X.tileID.canonical.x+X.tileID.wrap*Y),le=te*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[W,K],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:G?[N.transform.width,-1*N.transform.height]:[1/o.ak(X,1,N.transform.tileZoom),1/o.ak(X,1,N.transform.tileZoom)],u_pixel_coord_upper:[re>>16,le>>16],u_pixel_coord_lower:[65535&re,65535&le]}}(0,_,y,c,M,P),{u_matrix:l,u_emissive_strength:t,u_opacity:n}),Vt=new Float32Array(o.a6.mat4.identity([])),wh=(l,t,n,c,f,_,y,M,P,D,R,F,N,G=[0,0,0],X)=>{const W=f.style.light,K=W.properties.get("position"),Y=[-K.x,-K.y,K.z],te=o.a6.mat3.create();W.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(te,-f.transform.angle),o.a6.vec3.transformMat3(Y,Y,te));const re=R.alphaMode==="MASK",le=W.properties.get("color").toRenderColor(null),fe=N.paint.get("model-ambient-occlusion-intensity"),me=N.paint.get("model-color").constantOr(o.bA.white).toRenderColor(null),de=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:c||Vt,u_lightpos:Y,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_camera_pos:G,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[y.r,y.g,y.b,y.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:P,u_roughnessFactor:D,u_baseColorTexture:Or.BaseColor,u_metallicRoughnessTexture:Or.MetallicRoughness,u_normalTexture:Or.Normal,u_occlusionTexture:Or.Occlusion,u_emissionTexture:Or.Emission,u_lutTexture:Or.LUT,u_color_mix:[me.r,me.g,me.b,de],u_aoIntensity:fe,u_emissive_strength:F,u_occlusionTextureTransform:X||[0,0,0,0]}},Hf=(l,t=Vt,n=Vt)=>({u_matrix:l,u_instance:t,u_node_matrix:n}),Xa={fillExtrusion:l=>({u_matrix:new o.bG(l),u_lightpos:new o.bI(l),u_lightintensity:new o.bJ(l),u_lightcolor:new o.bI(l),u_vertical_gradient:new o.bJ(l),u_opacity:new o.bJ(l),u_edge_radius:new o.bJ(l),u_width_scale:new o.bJ(l),u_ao:new o.bH(l),u_height_type:new o.bK(l),u_base_type:new o.bK(l),u_tile_id:new o.bI(l),u_zoom_transition:new o.bJ(l),u_inv_rot_matrix:new o.bG(l),u_merc_center:new o.bH(l),u_up_dir:new o.bI(l),u_height_lift:new o.bJ(l),u_flood_light_color:new o.bI(l),u_vertical_scale:new o.bJ(l),u_flood_light_intensity:new o.bJ(l),u_ground_shadow_factor:new o.bI(l)}),fillExtrusionDepth:l=>({u_matrix:new o.bG(l),u_edge_radius:new o.bJ(l),u_width_scale:new o.bJ(l),u_vertical_scale:new o.bJ(l),u_height_type:new o.bK(l),u_base_type:new o.bK(l)}),fillExtrusionPattern:l=>({u_matrix:new o.bG(l),u_lightpos:new o.bI(l),u_lightintensity:new o.bJ(l),u_lightcolor:new o.bI(l),u_vertical_gradient:new o.bJ(l),u_height_factor:new o.bJ(l),u_edge_radius:new o.bJ(l),u_width_scale:new o.bJ(l),u_ao:new o.bH(l),u_height_type:new o.bK(l),u_base_type:new o.bK(l),u_tile_id:new o.bI(l),u_zoom_transition:new o.bJ(l),u_inv_rot_matrix:new o.bG(l),u_merc_center:new o.bH(l),u_up_dir:new o.bI(l),u_height_lift:new o.bJ(l),u_image:new o.bK(l),u_texsize:new o.bH(l),u_pixel_coord_upper:new o.bH(l),u_pixel_coord_lower:new o.bH(l),u_tile_units_to_pixels:new o.bJ(l),u_opacity:new o.bJ(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new o.bG(l),u_opacity:new o.bJ(l),u_ao_pass:new o.bJ(l),u_meter_to_tile:new o.bJ(l),u_ao:new o.bH(l),u_flood_light_intensity:new o.bJ(l),u_flood_light_color:new o.bI(l),u_attenuation:new o.bJ(l),u_edge_radius:new o.bJ(l),u_fb:new o.bK(l),u_fb_size:new o.bJ(l),u_dynamic_offset:new o.bJ(l)}),fill:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l)}),fillPattern:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l),u_image:new o.bK(l),u_texsize:new o.bH(l),u_pixel_coord_upper:new o.bH(l),u_pixel_coord_lower:new o.bH(l),u_tile_units_to_pixels:new o.bJ(l)}),fillOutline:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l),u_world:new o.bH(l)}),fillOutlinePattern:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l),u_world:new o.bH(l),u_image:new o.bK(l),u_texsize:new o.bH(l),u_pixel_coord_upper:new o.bH(l),u_pixel_coord_lower:new o.bH(l),u_tile_units_to_pixels:new o.bJ(l)}),circle:o.cN,collisionBox:l=>({u_matrix:new o.bG(l),u_camera_to_center_distance:new o.bJ(l),u_extrude_scale:new o.bH(l)}),collisionCircle:l=>({u_matrix:new o.bG(l),u_inv_matrix:new o.bG(l),u_camera_to_center_distance:new o.bJ(l),u_viewport_size:new o.bH(l)}),debug:l=>({u_color:new o.cu(l),u_matrix:new o.bG(l),u_overlay:new o.bK(l),u_overlay_scale:new o.bJ(l)}),clippingMask:l=>({u_matrix:new o.bG(l)}),heatmap:l=>({u_extrude_scale:new o.bJ(l),u_intensity:new o.bJ(l),u_matrix:new o.bG(l),u_inv_rot_matrix:new o.bG(l),u_merc_center:new o.bH(l),u_tile_id:new o.bI(l),u_zoom_transition:new o.bJ(l),u_up_dir:new o.bI(l)}),heatmapTexture:l=>({u_image:new o.bK(l),u_color_ramp:new o.bK(l),u_opacity:new o.bJ(l)}),hillshade:l=>({u_matrix:new o.bG(l),u_image:new o.bK(l),u_latrange:new o.bH(l),u_light:new o.bH(l),u_shadow:new o.cu(l),u_highlight:new o.cu(l),u_emissive_strength:new o.bJ(l),u_accent:new o.cu(l)}),hillshadePrepare:l=>({u_matrix:new o.bG(l),u_image:new o.bK(l),u_dimension:new o.bH(l),u_zoom:new o.bJ(l)}),line:o.cO,linePattern:o.cP,raster:l=>({u_matrix:new o.bG(l),u_normalize_matrix:new o.bG(l),u_globe_matrix:new o.bG(l),u_merc_matrix:new o.bG(l),u_grid_matrix:new o.cv(l),u_tl_parent:new o.bH(l),u_scale_parent:new o.bJ(l),u_fade_t:new o.bJ(l),u_opacity:new o.bJ(l),u_image0:new o.bK(l),u_image1:new o.bK(l),u_brightness_low:new o.bJ(l),u_brightness_high:new o.bJ(l),u_saturation_factor:new o.bJ(l),u_contrast_factor:new o.bJ(l),u_spin_weights:new o.bI(l),u_perspective_transform:new o.bH(l),u_raster_elevation:new o.bJ(l),u_zoom_transition:new o.bJ(l),u_merc_center:new o.bH(l),u_cutoff_params:new o.c7(l),u_colorization_mix:new o.c7(l),u_colorization_offset:new o.bJ(l),u_color_ramp:new o.bK(l),u_texture_offset:new o.bH(l),u_texture_res:new o.bH(l),u_emissive_strength:new o.bJ(l)}),rasterParticle:l=>({u_matrix:new o.bG(l),u_normalize_matrix:new o.bG(l),u_globe_matrix:new o.bG(l),u_merc_matrix:new o.bG(l),u_grid_matrix:new o.cv(l),u_tl_parent:new o.bH(l),u_scale_parent:new o.bJ(l),u_fade_t:new o.bJ(l),u_opacity:new o.bJ(l),u_image0:new o.bK(l),u_image1:new o.bK(l),u_raster_elevation:new o.bJ(l),u_zoom_transition:new o.bJ(l),u_merc_center:new o.bH(l),u_cutoff_params:new o.c7(l)}),rasterParticleTexture:l=>({u_texture:new o.bK(l),u_opacity:new o.bJ(l)}),rasterParticleDraw:l=>({u_particle_texture:new o.bK(l),u_particle_texture_side_len:new o.bJ(l),u_tile_offset:new o.bH(l),u_velocity:new o.bK(l),u_color_ramp:new o.bK(l),u_velocity_res:new o.bH(l),u_max_speed:new o.bJ(l),u_uv_offset:new o.bH(l),u_data_scale:new o.bH(l),u_data_offset:new o.bJ(l),u_particle_pos_scale:new o.bJ(l),u_particle_pos_offset:new o.bH(l)}),rasterParticleUpdate:l=>({u_particle_texture:new o.bK(l),u_particle_texture_side_len:new o.bJ(l),u_velocity:new o.bK(l),u_velocity_res:new o.bH(l),u_max_speed:new o.bJ(l),u_speed_factor:new o.bJ(l),u_reset_rate:new o.bJ(l),u_rand_seed:new o.bJ(l),u_uv_offset:new o.bH(l),u_data_scale:new o.bH(l),u_data_offset:new o.bJ(l),u_particle_pos_scale:new o.bJ(l),u_particle_pos_offset:new o.bH(l)}),symbol:l=>({u_is_size_zoom_constant:new o.bK(l),u_is_size_feature_constant:new o.bK(l),u_size_t:new o.bJ(l),u_size:new o.bJ(l),u_camera_to_center_distance:new o.bJ(l),u_rotate_symbol:new o.bK(l),u_aspect_ratio:new o.bJ(l),u_fade_change:new o.bJ(l),u_matrix:new o.bG(l),u_label_plane_matrix:new o.bG(l),u_coord_matrix:new o.bG(l),u_is_text:new o.bK(l),u_elevation_from_sea:new o.bK(l),u_pitch_with_map:new o.bK(l),u_texsize:new o.bH(l),u_texsize_icon:new o.bH(l),u_texture:new o.bK(l),u_texture_icon:new o.bK(l),u_gamma_scale:new o.bJ(l),u_device_pixel_ratio:new o.bJ(l),u_tile_id:new o.bI(l),u_zoom_transition:new o.bJ(l),u_inv_rot_matrix:new o.bG(l),u_merc_center:new o.bH(l),u_camera_forward:new o.bI(l),u_tile_matrix:new o.bG(l),u_up_vector:new o.bI(l),u_ecef_origin:new o.bI(l),u_is_halo:new o.bK(l),u_icon_transition:new o.bJ(l),u_color_adj_mat:new o.bG(l),u_scale_factor:new o.bJ(l)}),background:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l),u_opacity:new o.bJ(l),u_color:new o.cu(l)}),backgroundPattern:l=>({u_matrix:new o.bG(l),u_emissive_strength:new o.bJ(l),u_opacity:new o.bJ(l),u_image:new o.bK(l),u_pattern_tl:new o.bH(l),u_pattern_br:new o.bH(l),u_texsize:new o.bH(l),u_pattern_size:new o.bH(l),u_pixel_coord_upper:new o.bH(l),u_pixel_coord_lower:new o.bH(l),u_pattern_units_to_pixels:new o.bH(l)}),terrainRaster:l=>({u_matrix:new o.bG(l),u_image0:new o.bK(l),u_skirt_height:new o.bJ(l),u_ground_shadow_factor:new o.bI(l)}),skybox:l=>({u_matrix:new o.bG(l),u_sun_direction:new o.bI(l),u_cubemap:new o.bK(l),u_opacity:new o.bJ(l),u_temporal_offset:new o.bJ(l)}),skyboxGradient:l=>({u_matrix:new o.bG(l),u_color_ramp:new o.bK(l),u_center_direction:new o.bI(l),u_radius:new o.bJ(l),u_opacity:new o.bJ(l),u_temporal_offset:new o.bJ(l)}),skyboxCapture:l=>({u_matrix_3f:new o.cv(l),u_sun_direction:new o.bI(l),u_sun_intensity:new o.bJ(l),u_color_tint_r:new o.c7(l),u_color_tint_m:new o.c7(l),u_luminance:new o.bJ(l)}),globeRaster:l=>({u_proj_matrix:new o.bG(l),u_globe_matrix:new o.bG(l),u_normalize_matrix:new o.bG(l),u_merc_matrix:new o.bG(l),u_zoom_transition:new o.bJ(l),u_merc_center:new o.bH(l),u_image0:new o.bK(l),u_grid_matrix:new o.cv(l),u_skirt_height:new o.bJ(l),u_far_z_cutoff:new o.bJ(l),u_frustum_tl:new o.bI(l),u_frustum_tr:new o.bI(l),u_frustum_br:new o.bI(l),u_frustum_bl:new o.bI(l),u_globe_pos:new o.bI(l),u_globe_radius:new o.bJ(l),u_viewport:new o.bH(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.bI(l),u_frustum_tr:new o.bI(l),u_frustum_br:new o.bI(l),u_frustum_bl:new o.bI(l),u_horizon:new o.bJ(l),u_transition:new o.bJ(l),u_fadeout_range:new o.bJ(l),u_color:new o.c7(l),u_high_color:new o.c7(l),u_space_color:new o.c7(l),u_temporal_offset:new o.bJ(l),u_horizon_angle:new o.bJ(l)}),model:l=>({u_matrix:new o.bG(l),u_lighting_matrix:new o.bG(l),u_normal_matrix:new o.bG(l),u_node_matrix:new o.bG(l),u_lightpos:new o.bI(l),u_lightintensity:new o.bJ(l),u_lightcolor:new o.bI(l),u_camera_pos:new o.bI(l),u_opacity:new o.bJ(l),u_baseColorFactor:new o.c7(l),u_emissiveFactor:new o.c7(l),u_metallicFactor:new o.bJ(l),u_roughnessFactor:new o.bJ(l),u_baseTextureIsAlpha:new o.bK(l),u_alphaMask:new o.bK(l),u_alphaCutoff:new o.bJ(l),u_baseColorTexture:new o.bK(l),u_metallicRoughnessTexture:new o.bK(l),u_normalTexture:new o.bK(l),u_occlusionTexture:new o.bK(l),u_emissionTexture:new o.bK(l),u_lutTexture:new o.bK(l),u_color_mix:new o.c7(l),u_aoIntensity:new o.bJ(l),u_emissive_strength:new o.bJ(l),u_occlusionTextureTransform:new o.c7(l)}),modelDepth:l=>({u_matrix:new o.bG(l),u_instance:new o.bG(l),u_node_matrix:new o.bG(l)}),groundShadow:l=>({u_matrix:new o.bG(l),u_ground_shadow_factor:new o.bI(l)}),stars:l=>({u_matrix:new o.bG(l),u_up:new o.bI(l),u_right:new o.bI(l),u_intensity_multiplier:new o.bJ(l)}),snowParticle:l=>({u_modelview:new o.bG(l),u_projection:new o.bG(l),u_time:new o.bJ(l),u_cam_pos:new o.bI(l),u_velocityConeAperture:new o.bJ(l),u_velocity:new o.bJ(l),u_horizontalOscillationRadius:new o.bJ(l),u_horizontalOscillationRate:new o.bJ(l),u_boxSize:new o.bJ(l),u_billboardSize:new o.bJ(l),u_simpleShapeParameters:new o.bH(l),u_screenSize:new o.bH(l),u_thinningCenterPos:new o.bH(l),u_thinningShape:new o.bI(l),u_thinningAffectedRatio:new o.bJ(l),u_thinningParticleOffset:new o.bJ(l),u_particleColor:new o.c7(l),u_direction:new o.bI(l)}),rainParticle:l=>({u_modelview:new o.bG(l),u_projection:new o.bG(l),u_time:new o.bJ(l),u_cam_pos:new o.bI(l),u_texScreen:new o.bK(l),u_velocityConeAperture:new o.bJ(l),u_velocity:new o.bJ(l),u_boxSize:new o.bJ(l),u_rainDropletSize:new o.bH(l),u_distortionStrength:new o.bJ(l),u_rainDirection:new o.bI(l),u_color:new o.c7(l),u_screenSize:new o.bH(l),u_thinningCenterPos:new o.bH(l),u_thinningShape:new o.bI(l),u_thinningAffectedRatio:new o.bJ(l),u_thinningParticleOffset:new o.bJ(l),u_shapeDirectionalPower:new o.bJ(l),u_mode:new o.bJ(l)}),occlusion:l=>({u_matrix:new o.bG(l),u_anchorPos:new o.bI(l),u_screenSizePx:new o.bH(l),u_occluderSizePx:new o.bH(l),u_color:new o.c7(l)})};class Ao{constructor(t,n,c,f){this.id=Ao.uniqueIdxCounter,Ao.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||f||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Ao.uniqueIdxCounter,Ao.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ao.uniqueIdxCounter=0;const Qt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wf{constructor(t,n,c,f,_,y){this.length=n.length,this.attributes=c,this.itemSize=n.bytesPerElement,this.dynamicDraw=f,this.instanceCount=y,this.context=t;const M=t.gl;this.buffer=M.createBuffer(),t.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||_||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let c=0;c<this.attributes.length;c++){const f=n.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,n,c){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],y=n.attributes[_.name];y!==void 0&&t.vertexAttribPointer(y,_.components,t[Qt[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,n,c){for(let f=0;f<this.attributes.length;f++){const _=n.attributes[this.attributes[f].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Th{constructor(t,n,c,f,_){this.context=t,this.width=n,this.height=c;const y=this.framebuffer=t.gl.createFramebuffer();f&&(this.colorAttachment=new Ha(t,y)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new pu(t,y):new Sl(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class vu{constructor(t,n){this.gl=t,this.clearColor=new Ef(this),this.clearDepth=new Qd(this),this.clearStencil=new Af(this),this.colorMask=new vl(this),this.depthMask=new ss(this),this.stencilMask=new lu(this),this.stencilFunc=new Mf(this),this.stencilOp=new cu(this),this.stencilTest=new bl(this),this.depthRange=new If(this),this.depthTest=new gh(this),this.depthFunc=new ep(this),this.blend=new uu(this),this.blendFunc=new wa(this),this.blendColor=new uc(this),this.blendEquation=new Cf(this),this.cullFace=new Pf(this),this.cullFaceSide=new tp(this),this.frontFace=new hu(this),this.program=new yh(this),this.activeTexture=new wl(this),this.viewport=new fu(this),this.bindFramebuffer=new Rf(this),this.bindRenderbuffer=new Ho(this),this.bindTexture=new Df(this),this.bindVertexBuffer=new Sr(this),this.bindElementBuffer=new Qr(this),this.bindVertexArrayOES=new Lf(this),this.pixelStoreUnpack=new zf(this),this.pixelStoreUnpackPremultiplyAlpha=new du(this),this.pixelStoreUnpackFlipY=new Of(this),this.options=n?{...n}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,c){return new Ao(this,t,n,c)}createVertexBuffer(t,n,c,f,_){return new Wf(this,t,n,c,f,_)}createRenderbuffer(t,n,c){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,t,n,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,n,c,f){return new Th(this,t,n,c,f)}clear({color:t,depth:n,stencil:c,colorMask:f}){const _=this.gl;let y=0;t&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(f||[!0,!0,!0,!0])),n!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),c!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),_.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bi(t.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Sa;function Zf(l,t,n,c,f,_,y){const M=l.context,P=M.gl,D=l.transform,R=l.getOrCreateProgram("collisionBox"),F=[];let N=0,G=0;for(let le=0;le<c.length;le++){const fe=c[le],me=t.getTile(fe),de=me.getBucket(n);if(!de)continue;const ge=gf(fe,de,D);let Te=ge;f[0]===0&&f[1]===0||(Te=l.translatePosMatrix(ge,me,f,_));const Ce=y?de.textCollisionBox:de.iconCollisionBox,Ae=de.collisionCircleArray;if(Ae.length>0){const Ee=o.a6.mat4.create(),Ge=Te;o.a6.mat4.mul(Ee,de.placementInvProjMatrix,D.glCoordMatrix),o.a6.mat4.mul(Ee,Ee,de.placementViewportMatrix),F.push({circleArray:Ae,circleOffset:G,transform:Ge,invTransform:Ee,projection:de.getProjection()}),N+=Ae.length/4,G=N}Ce&&(l.terrain&&l.terrain.setupElevationDraw(me,R),R.draw(l,P.LINES,oi.disabled,vi.disabled,l.colorModeForRenderPass(),di.disabled,hm(Te,D,me,de.getProjection()),n.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,D.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!y||!F.length)return;const X=l.getOrCreateProgram("collisionCircle"),W=new o.cQ;W.resize(4*N),W._trim();let K=0;for(const le of F)for(let fe=0;fe<le.circleArray.length/4;fe++){const me=4*fe,de=le.circleArray[me+0],ge=le.circleArray[me+1],Te=le.circleArray[me+2],Ce=le.circleArray[me+3];W.emplace(K++,de,ge,Te,Ce,0),W.emplace(K++,de,ge,Te,Ce,1),W.emplace(K++,de,ge,Te,Ce,2),W.emplace(K++,de,ge,Te,Ce,3)}(!Sa||Sa.length<2*N)&&(Sa=function(le){const fe=2*le,me=new o.aP;me.resize(fe),me._trim();for(let de=0;de<fe;de++){const ge=6*de;me.uint16[ge+0]=4*de+0,me.uint16[ge+1]=4*de+1,me.uint16[ge+2]=4*de+2,me.uint16[ge+3]=4*de+2,me.uint16[ge+4]=4*de+3,me.uint16[ge+5]=4*de+0}return me}(N));const Y=M.createIndexBuffer(Sa,!0),te=M.createVertexBuffer(W,o.cR.members,!0);for(const le of F){const fe={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(re=D).getCameraToCenterDistance(le.projection),u_viewport_size:[re.width,re.height]};X.draw(l,P.TRIANGLES,oi.disabled,vi.disabled,l.colorModeForRenderPass(),di.disabled,fe,n.id,te,Y,o.b2.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,D.zoom)}var re;te.destroy(),Y.destroy()}const pc=o.a6.mat4.create();function op(l){const t=l._camera.getWorldToCamera(l.worldSize,1),n=o.a6.mat4.multiply([],t,l.globeMatrix);o.a6.mat4.invert(n,n);const c=[0,0,0],f=[0,1,0,0];return o.a6.vec4.transformMat4(f,f,n),c[0]=f[0],c[1]=f[1],c[2]=f[2],o.a6.vec3.normalize(c,c),c}function Ea({width:l,height:t,anchor:n,textOffset:c,textScale:f},_){const{horizontalAlign:y,verticalAlign:M}=o.by(n),P=-(y-.5)*l,D=-(M-.5)*t,R=o.bx(n,c);return new o.P((P/f+R[0])*_,(D/f+R[1])*_)}function bu(l,t,n,c,f,_,y,M,P,D,R){const F=l.text.placedSymbolArray,N=l.text.dynamicLayoutVertexArray,G=l.icon.dynamicLayoutVertexArray,X={},W=l.getProjection(),K=Ks(M,W,_),Y=_.elevation,te=W.upVectorScale(M.canonical,_.center.lat,_.worldSize).metersToTile;N.clear();for(let re=0;re<F.length;re++){const le=F.get(re),{tileAnchorX:fe,tileAnchorY:me,numGlyphs:de}=le,ge=le.hidden||!le.crossTileID||l.allowVerticalPlacement&&!le.placedOrientation?null:c[le.crossTileID];if(ge){let Te=0,Ce=0,Ae=0;if(Y){const $e=Y?Y.getAtTileOffset(M,fe,me):0,[nt,lt,ot]=W.upVector(M.canonical,fe,me);Te=$e*nt*te,Ce=$e*lt*te,Ae=$e*ot*te}let[Ee,Ge,Ye,at]=fo(le.projectedAnchorX+Te,le.projectedAnchorY+Ce,le.projectedAnchorZ+Ae,n?K:y);const _t=Ji(_.getCameraToCenterDistance(W),at);let bt=f.evaluateSizeForFeature(l.textSizeData,D,le)*_t/o.br;n&&(bt*=l.tilePixelRatio/P);const ke=Ea(ge,bt);n?({x:Ee,y:Ge,z:Ye}=W.projectTilePoint(fe+ke.x,me+ke.y,M.canonical),[Ee,Ge,Ye]=fo(Ee+Te,Ge+Ce,Ye+Ae,y)):(t&&ke._rotate(-_.angle),Ee+=ke.x,Ge+=ke.y,Ye=0);const rt=l.allowVerticalPlacement&&le.placedOrientation===o.bl.vertical?Math.PI/2:0;for(let $e=0;$e<de;$e++)o.bo(N,Ee,Ge,Ye,rt);R&&le.associatedIconIndex>=0&&(X[le.associatedIconIndex]={x:Ee,y:Ge,z:Ye,angle:rt})}else Is(de,N)}if(R){G.clear();const re=l.icon.placedSymbolArray;for(let le=0;le<re.length;le++){const fe=re.get(le),{numGlyphs:me}=fe,de=X[le];if(fe.hidden||!de)Is(me,G);else{const{x:ge,y:Te,z:Ce,angle:Ae}=de;for(let Ee=0;Ee<me;Ee++)o.bo(G,ge,Te,Ce,Ae)}}l.icon.dynamicLayoutVertexBuffer.updateData(G)}l.text.dynamicLayoutVertexBuffer.updateData(N)}function Ds(l,t,n,c,f,_,y={}){const M=n.paint.get("icon-translate"),P=n.paint.get("text-translate"),D=n.paint.get("icon-translate-anchor"),R=n.paint.get("text-translate-anchor"),F=n.layout.get("icon-rotation-alignment"),N=n.layout.get("text-rotation-alignment"),G=n.layout.get("icon-pitch-alignment"),X=n.layout.get("text-pitch-alignment"),W=n.layout.get("icon-keep-upright"),K=n.layout.get("text-keep-upright"),Y=n.paint.get("icon-color-saturation"),te=n.paint.get("icon-color-contrast"),re=n.paint.get("icon-color-brightness-min"),le=n.paint.get("icon-color-brightness-max"),fe=n.layout.get("symbol-elevation-reference")==="sea",me=l.context,de=me.gl,ge=l.transform,Te=F==="map",Ce=N==="map",Ae=G==="map",Ee=X==="map",Ge=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ye=!1;const at=l.depthModeForSublayer(0,oi.ReadOnly),_t=[o.am(ge.center.lng),o.at(ge.center.lat)],bt=n.layout.get("text-variable-anchor"),ke=ge.projection.name==="globe",rt=[],$e=[0,-1,0];for(const nt of c){const lt=t.getTile(nt),ot=lt.getBucket(n);if(!ot||ot.projection.name==="mercator"&&ke||ot.fullyClipped)continue;const St=ot.projection.name==="globe",Wt=St?o.a9(ge.zoom):0,ti=Ks(nt,ot.getProjection(),ge),kt=ge.calculatePixelsToTileUnitsMatrix(lt),Kt=bt&&ot.hasTextData(),zt=ot.hasIconTextFit()&&Kt&&ot.hasIconData(),ai=ot.getProjection().createInversionMatrix(ge,nt.canonical),Si=bn=>{ge.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||l.terrain)&&(bn.push("DEPTH_D24"),bn.push("DEPTH_OCCLUSION"))},Ui=()=>{const bn=Te&&n.layout.get("symbol-placement")!=="point",hn=[];Si(hn);const Un=bn||zt,gr=n.paint.get("icon-image-cross-fade").constantOr(0);l.terrainRenderModeElevated()&&Ae&&hn.push("PITCH_WITH_MAP_TERRAIN"),St&&(hn.push("PROJECTION_GLOBE_VIEW"),Un&&hn.push("PROJECTED_POS_ON_VIEWPORT")),gr>0&&hn.push("ICON_TRANSITION"),ot.icon.zOffsetVertexBuffer&&hn.push("Z_OFFSET"),Y===0&&te===0&&re===0&&le===1||hn.push("COLOR_ADJUSTMENT"),ot.sdfIcons&&hn.push("RENDER_SDF");const ko=ot.icon.programConfigurations.get(n.id),us=l.getOrCreateProgram("symbol",{config:ko,defines:hn}),kr=lt.imageAtlasTexture?lt.imageAtlasTexture.size:[0,0],Xi=ot.iconSizeData,Vi=o.bk(Xi,ge.zoom),cn=Ae||ge.pitch!==0,Rn=Wi(ti,lt.tileID.canonical,Ae,Te,ge,ot.getProjection(),kt),or=Lo(ti,lt.tileID.canonical,Ae,Te,ge,ot.getProjection(),kt),$n=l.translatePosMatrix(or,lt,M,D,!0),$r=l.translatePosMatrix(ti,lt,M,D),aa=Un?pc:Rn,dr=Te&&!Ae&&!bn;let Fo=$e;!ke&&!ge.mercatorFromTransition||Te||(Fo=op(ge));const hs=St?Fo:$e,Ns=n.getColorAdjustmentMatrix(Y,te,re,le),Co=ls(Xi.kind,Vi,dr,Ae,l,$r,aa,$n,fe,!1,kr,[0,0],!0,nt,Wt,_t,ai,hs,ot.getProjection(),Ns,gr),Ra=lt.imageAtlasTexture?lt.imageAtlasTexture:null,fs=n.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear,gn=ot.sdfIcons||l.options.rotating||l.options.zooming||fs||cn?de.LINEAR:de.NEAREST,Pc=ot.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Nu=l.terrain&&Ae&&bn?o.a6.mat4.invert(o.a6.mat4.create(),Rn):pc;if(bn&&ot.icon){const Rc=ge.elevation,ld=Rc?Rc.getAtTileOffsetFunc(nt,ge.center.lat,ge.worldSize,ot.getProjection()):null,Uu=Zi(ti,lt.tileID.canonical,Ae,Te,ge,ot.getProjection(),kt);Hn(ot,ti,l,!1,Uu,or,Ae,W,ld,nt)}return{program:us,buffers:ot.icon,uniformValues:Co,atlasTexture:Ra,atlasTextureIcon:null,atlasInterpolation:gn,atlasInterpolationIcon:null,isSDF:ot.sdfIcons,hasHalo:Pc,tile:lt,labelPlaneMatrixInv:Nu}},Mn=()=>{const bn=Ce&&n.layout.get("symbol-placement")!=="point",hn=[],Un=bn||bt||zt;l.terrainRenderModeElevated()&&Ee&&hn.push("PITCH_WITH_MAP_TERRAIN"),St&&(hn.push("PROJECTION_GLOBE_VIEW"),Un&&hn.push("PROJECTED_POS_ON_VIEWPORT")),ot.text.zOffsetVertexBuffer&&hn.push("Z_OFFSET"),ot.iconsInText&&hn.push("RENDER_TEXT_AND_SYMBOL"),hn.push("RENDER_SDF"),Si(hn);const gr=ot.text.programConfigurations.get(n.id),ko=l.getOrCreateProgram("symbol",{config:gr,defines:hn});let us,kr=[0,0],Xi=null;const Vi=ot.textSizeData;ot.iconsInText&&(kr=lt.imageAtlasTexture?lt.imageAtlasTexture.size:[0,0],Xi=lt.imageAtlasTexture?lt.imageAtlasTexture:null,us=Ee||ge.pitch!==0||l.options.rotating||l.options.zooming||Vi.kind==="composite"||Vi.kind==="camera"?de.LINEAR:de.NEAREST);const cn=lt.glyphAtlasTexture?lt.glyphAtlasTexture.size:[0,0],Rn=n.layout.get("text-size-scale-range"),or=o.ap(l.scaleFactor,Rn[0],Rn[1]),$n=o.bk(Vi,ge.zoom,or),$r=Wi(ti,lt.tileID.canonical,Ee,Ce,ge,ot.getProjection(),kt),aa=Lo(ti,lt.tileID.canonical,Ee,Ce,ge,ot.getProjection(),kt),dr=l.translatePosMatrix(aa,lt,P,R,!0),Fo=l.translatePosMatrix(ti,lt,P,R),hs=Un?pc:$r,Ns=Ce&&!Ee&&!bn;let Co=$e;!ke&&!ge.mercatorFromTransition||Ce||(Co=op(ge));const Ra=ls(Vi.kind,$n,Ns,Ee,l,Fo,hs,dr,fe,!0,cn,kr,!0,nt,Wt,_t,ai,St?Co:$e,ot.getProjection(),null,null,or),fs=lt.glyphAtlasTexture?lt.glyphAtlasTexture:null,gn=de.LINEAR,Pc=n.paint.get("text-halo-width").constantOr(1)!==0,Nu=l.terrain&&Ee&&bn?o.a6.mat4.invert(o.a6.mat4.create(),$r):pc;if(bn&&ot.text){const Rc=ge.elevation,ld=Rc?Rc.getAtTileOffsetFunc(nt,ge.center.lat,ge.worldSize,ot.getProjection()):null,Uu=Zi(ti,lt.tileID.canonical,Ee,Ce,ge,ot.getProjection(),kt);Hn(ot,ti,l,!0,Uu,aa,Ee,K,ld,nt)}return{program:ko,buffers:ot.text,uniformValues:Ra,atlasTexture:fs,atlasTextureIcon:Xi,atlasInterpolation:gn,atlasInterpolationIcon:us,isSDF:!0,hasHalo:Pc,tile:lt,labelPlaneMatrixInv:Nu}},en=ot.icon.segments.get().length,kn=ot.text.segments.get().length,ln=en&&!y.onlyText?Ui():null,In=kn&&!y.onlyIcons?Mn():null,Fi=n.paint.get("icon-opacity").constantOr(1),An=n.paint.get("text-opacity").constantOr(1);if(Ge&&ot.canOverlap){Ye=!0;const bn=Fi&&!y.onlyText?ot.icon.segments.get():[],hn=An&&!y.onlyIcons?ot.text.segments.get():[];for(const Un of bn)rt.push({segments:new o.b2([Un]),sortKey:Un.sortKey,state:ln});for(const Un of hn)rt.push({segments:new o.b2([Un]),sortKey:Un.sortKey,state:In})}else y.onlyText||rt.push({segments:Fi?ot.icon.segments:new o.b2([]),sortKey:0,state:ln}),y.onlyIcons||rt.push({segments:An?ot.text.segments:new o.b2([]),sortKey:0,state:In})}Ye&&rt.sort((nt,lt)=>nt.sortKey-lt.sortKey);for(const nt of rt){const lt=nt.state;if(lt)if(l.terrain?l.terrain.setupElevationDraw(lt.tile,lt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:lt.labelPlaneMatrixInv}):l.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,lt.program),me.activeTexture.set(de.TEXTURE0),lt.atlasTexture&&lt.atlasTexture.bind(lt.atlasInterpolation,de.CLAMP_TO_EDGE,!0),lt.atlasTextureIcon&&(me.activeTexture.set(de.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,de.CLAMP_TO_EDGE,!0)),l.uploadCommonLightUniforms(l.context,lt.program),lt.hasHalo){const ot=lt.uniformValues;ot.u_is_halo=1,mo(lt.buffers,nt.segments,n,l,lt.program,at,f,_,ot,2),ot.u_is_halo=0}else{if(lt.isSDF){const ot=lt.uniformValues;lt.hasHalo&&(ot.u_is_halo=1,mo(lt.buffers,nt.segments,n,l,lt.program,at,f,_,ot,1)),ot.u_is_halo=0}mo(lt.buffers,nt.segments,n,l,lt.program,at,f,_,lt.uniformValues,1)}}}function mo(l,t,n,c,f,_,y,M,P,D){const R=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer];f.draw(c,c.context.gl.TRIANGLES,_,y,M,di.disabled,P,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,c.transform.zoom,l.programConfigurations.get(n.id),R,D)}function Sh(l,t,n,c,f,_,y){const M=l.context.gl,P=n.paint.get("fill-pattern"),D=n.is3D(),R=D?l.stencilModeFor3D():vi.disabled,F=P&&P.constantOr(1);let N,G,X,W,K;y?(G=F&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=M.LINES):(G=F?"fillPattern":"fill",N=M.TRIANGLES);for(const Y of c){const te=t.getTile(Y);if(F&&!te.patternsLoaded())continue;const re=te.getBucket(n);if(!re)continue;l.prepareDrawTile();const le=re.programConfigurations.get(n.id),fe=l.isTileAffectedByFog(Y),me=l.getOrCreateProgram(G,{config:le,overrideFog:fe});F&&(l.context.activeTexture.set(M.TEXTURE0),te.imageAtlasTexture&&te.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),le.updatePaintBuffers());const de=P.constantOr(null);if(de&&te.imageAtlas){const Ce=te.imageAtlas.patternPositions[de.toString()];Ce&&le.setConstantPatternPositions(Ce)}const ge=l.translatePosMatrix(Y.projMatrix,te,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),Te=n.paint.get("fill-emissive-strength");if(y){W=re.indexBuffer2,K=re.segments2;const Ce=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];X=G==="fillOutlinePattern"&&F?um(ge,Te,l,te,Ce):Wo(ge,Te,Ce)}else W=re.indexBuffer,K=re.segments,X=F?Vf(ge,Te,l,te):rp(ge,Te);l.uploadCommonUniforms(l.context,me,Y.toUnwrapped()),me.draw(l,N,f,D?R:l.stencilModeForClipping(Y),_,di.disabled,X,n.id,re.layoutVertexBuffer,W,K,n.paint,l.transform.zoom,le,void 0)}}function ao(l,t,n,c,f,_,y,M){n.resetLayerRenderingStats(l);const P=l.context,D=P.gl,R=l.transform,F=n.paint.get("fill-extrusion-pattern"),N=F.constantOr(1),G=n.paint.get("fill-extrusion-opacity"),X=l.style.enable3dLights(),W=n.paint.get(X&&!N?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),K=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],Y=n.layout.get("fill-extrusion-edge-radius"),te=Y>0&&!n.paint.get("fill-extrusion-rounded-roof"),re=te?0:Y,le=R.projection.name==="globe"?o.c_():0,fe=R.projection.name==="globe",me=fe?o.a9(R.zoom):0,de=[o.am(R.center.lng),o.at(R.center.lat)],ge=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(n.lut).toArray01().slice(0,3),Te=n.paint.get("fill-extrusion-flood-light-intensity"),Ce=n.paint.get("fill-extrusion-vertical-scale"),Ae=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ee=n.paint.get("fill-extrusion-height-alignment"),Ge=n.paint.get("fill-extrusion-base-alignment"),Ye=va(l,n.paint.get("fill-extrusion-cutoff-fade-range")),at=[];let _t;fe&&at.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&at.push("FAUX_AO"),te&&at.push("ZERO_ROOF_RADIUS"),M&&at.push("HAS_CENTROID"),Te>0&&at.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&at.push("RENDER_CUTOFF"),Ae&&at.push("RENDER_WALL_MODE");const bt=l.renderPass==="shadow",ke=l.shadowRenderer,rt=bt&&!!ke;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let $e=[0,0,0];if(ke){const ot=l.style.directionalLight,St=l.style.ambientLight;ot&&St&&($e=ou(l.style,ot,St)),bt||(at.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ke.useNormalOffset&&at.push("NORMAL_OFFSET")),_t=at.concat(["SHADOWS_SINGLE_CASCADE"])}const nt=rt?"fillExtrusionDepth":N?"fillExtrusionPattern":"fillExtrusion",lt=n.getLayerRenderingStats();for(const ot of c){const St=t.getTile(ot),Wt=St.getBucket(n);if(!Wt||Wt.projection.name!==R.projection.name)continue;let ti=!1;ke&&(ti=ke.getMaxCascadeForTile(ot.toUnwrapped())===0);const kt=l.isTileAffectedByFog(ot),Kt=Wt.programConfigurations.get(n.id),zt=l.getOrCreateProgram(nt,{config:Kt,defines:ti?_t:at,overrideFog:kt});if(l.terrain&&l.terrain.setupElevationDraw(St,zt,{useMeterToDem:!0}),!Wt.centroidVertexBuffer){const ln=zt.attributes.a_centroid_pos;ln!==void 0&&D.vertexAttrib2f(ln,0,0)}!bt&&ke&&ke.setupShadows(St.tileID.toUnwrapped(),zt,"vector-tile",St.tileID.overscaledZ),N&&(l.context.activeTexture.set(D.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Kt.updatePaintBuffers());const ai=F.constantOr(null);if(ai&&St.imageAtlas){const ln=St.imageAtlas.patternPositions[ai.toString()];ln&&Kt.setConstantPatternPositions(ln)}const Si=n.paint.get("fill-extrusion-vertical-gradient"),Ui=1/Wt.tileToMeter;let Mn;if(bt&&ke){if(wu(St.tileID,Wt,l))continue;const ln=ke.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());Mn=Nf(ln,re,Ui,Ce,Ee,Ge)}else{const ln=l.translatePosMatrix(ot.expandedProjMatrix,St,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),In=R.projection.createInversionMatrix(R,ot.canonical);Mn=N?Uf(ln,l,Si,G,K,re,Ui,ot,St,le,Ee,Ge,me,de,In,ge,Ce):Bf(ln,l,Si,G,K,re,Ui,ot,le,Ee,Ge,me,de,In,ge,Ce,Te,$e)}l.uploadCommonUniforms(P,zt,ot.toUnwrapped(),null,Ye);let en=Wt.segments;if(R.projection.name==="mercator"&&!bt&&(en=Wt.getVisibleSegments(St.tileID,l.terrain,l.transform.getFrustum(0)),!en.get().length))continue;if(lt)if(bt)for(const ln of en.get())lt.numRenderedVerticesInShadowPass+=ln.primitiveLength;else for(const ln of en.get())lt.numRenderedVerticesInTransparentPass+=ln.primitiveLength;const kn=[];(l.terrain||M)&&kn.push(Wt.centroidVertexBuffer),fe&&kn.push(Wt.layoutVertexExtBuffer),Ae&&kn.push(Wt.wallVertexBuffer),zt.draw(l,P.gl.TRIANGLES,f,_,y,di.backCCW,Mn,n.id,Wt.layoutVertexBuffer,Wt.indexBuffer,en,n.paint,l.transform.zoom,Kt,kn)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function zo(l,t,n,c,f,_,y,M,P,D,R,F,N,G,X,W,K,Y,te){const re=l.context,le=re.gl,fe=l.transform,me=l.transform.zoom,de=[],ge=va(l,n.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(de.push("CLEAR_SUBPASS"),te&&(de.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(le.TEXTURE0),te.bind(le.LINEAR,le.CLAMP_TO_EDGE))):D==="sdf"&&de.push("SDF_SUBPASS"),K&&de.push("HAS_CENTROID"),ge.shouldRenderCutoff&&de.push("RENDER_CUTOFF");const Te=n.layout.get("fill-extrusion-edge-radius"),Ce=(Ae,Ee,Ge,Ye,at)=>{const _t=Ee.programConfigurations.get(n.id),bt=l.isTileAffectedByFog(Ae),ke=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:_t,defines:de,overrideFog:bt}),rt=((nt,lt,ot,St,Wt,ti,kt,Kt,zt,ai,Si)=>({u_matrix:lt,u_opacity:ot,u_ao_pass:St?1:0,u_meter_to_tile:Wt,u_ao:ti,u_flood_light_intensity:kt,u_flood_light_color:Kt,u_attenuation:zt,u_edge_radius:ai,u_fb:0,u_fb_size:Si,u_dynamic_offset:1}))(0,Ye,R,P,at,[F,N*at],G,X,W,me>=17?0:Te*at,te?te.size[0]:0),$e=[];K&&$e.push(Ee.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(re,ke,Ae.toUnwrapped(),null,ge),ke.draw(l,re.gl.TRIANGLES,f,_,y,M,rt,n.id,Ee.vertexBuffer,Ee.indexBuffer,Ge,n.paint,me,_t,$e)};for(const Ae of c){const Ee=t.getTile(Ae),Ge=Ee.getBucket(n);if(!Ge||Ge.projection.name!==fe.projection.name||!Ge.groundEffect||Ge.groundEffect&&!Ge.groundEffect.hasData())continue;const Ye=Ge.groundEffect,at=1/Ge.tileToMeter;{const _t=l.translatePosMatrix(Ae.projMatrix,Ee,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),bt=Ye.getDefaultSegment();Ce(Ae,Ye,bt,_t,at)}if(Y)for(let _t=0;_t<4;_t++){const bt=o.c$[_t](Ae),ke=t.getTile(bt);if(!ke)continue;const rt=ke.getBucket(n);if(!rt||rt.projection.name!==fe.projection.name||!rt.groundEffect||rt.groundEffect&&!rt.groundEffect.hasData())continue;const $e=rt.groundEffect;let nt,lt;_t===0?(nt=[-o.ab,0,0],lt=1):_t===1?(nt=[o.ab,0,0],lt=0):_t===2?(nt=[0,-o.ab,0],lt=3):(nt=[0,o.ab,0],lt=2);const ot=$e.regionSegments[lt];if(!ot)continue;const St=new Float32Array(16);o.a6.mat4.translate(St,Ae.projMatrix,nt),Ce(Ae,$e,ot,l.translatePosMatrix(St,Ee,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),at)}}}function mc(l,t,n,c,f,_,y){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const M=_?_.findDEMTileFor(n):null;if(!(M&&M.dem||y))return;const P=Y=>new o.P(Math.ceil((Y+o.d2)*o.d3),0),D=Y=>{const te=t.getSource().minzoom,re=fe=>{const me=t.getTileByID(fe);if(me&&me.hasData())return me.getBucket(f)},le=[0,-1,1];for(const fe of le){if(Y.overscaledZ+fe<te)continue;const me=re(Y.calculateScaledKey(Y.overscaledZ+fe));if(me)return me}},R=[0,0,0],F=(Y,te)=>(R[0]=Math.min(Y.min.y,te.min.y),R[1]=Math.max(Y.max.y,te.max.y),R[2]=o.ab-te.min.x>Y.max.x?te.min.x-o.ab:Y.max.x,R),N=(Y,te)=>(R[0]=Math.min(Y.min.x,te.min.x),R[1]=Math.max(Y.max.x,te.max.x),R[2]=o.ab-te.min.y>Y.max.y?te.min.y-o.ab:Y.max.y,R),G=[(Y,te)=>F(Y,te),(Y,te)=>F(te,Y),(Y,te)=>N(Y,te),(Y,te)=>N(te,Y)],X=(Y,te,re,le,fe,me,de)=>{if(!_)return 0;const ge=[[me?re:Y,me?Y:re,0],[me?re:te,me?te:re,0]],Te=de<0?o.ab+de:de,Ce=[me?Te:(Y+te)/2,me?(Y+te)/2:Te,0];return re===0&&de<0||re!==0&&de>0?_.getForTilePoints(fe,[Ce],!0,le):ge.push(Ce),_.getForTilePoints(n,ge,!0,M),Math.max(ge[0][2],ge[1][2],Ce[2])/_.exaggeration()};for(let Y=0;Y<4;Y++){const te=c.borderFeatureIndices[Y];if(te.length===0)continue;const re=o.c$[Y](n),le=D(re);if(!(le&&le instanceof o.d0)||c.borderDoneWithNeighborZ[Y]===le.canonical.z)continue;le.centroidVertexArray.length===0&&le.createCentroidsBuffer();const fe=_?_.findDEMTileFor(re):null;if(!(fe&&fe.dem||y))continue;const me=(Y<2?1:5)-Y,de=le.borderDoneWithNeighborZ[me]!==c.canonical.z,ge=le.borderFeatureIndices[me];let Te=0;if(c.canonical.z!==le.canonical.z){for(const Ce of te)c.showCentroid(c.featuresOnBorder[Ce]);if(de)for(const Ce of ge)le.showCentroid(le.featuresOnBorder[Ce]);c.borderDoneWithNeighborZ[Y]=le.canonical.z,le.borderDoneWithNeighborZ[me]=c.canonical.z}for(const Ce of te){const Ae=c.featuresOnBorder[Ce],Ee=c.centroidData[Ae.centroidDataIndex],Ge=Ae.borders[Y];let Ye;for(;Te<ge.length;){Ye=le.featuresOnBorder[ge[Te]];const at=Ye.borders[me];if(at[1]>Ge[0]+3||at[0]>Ge[0]-3)break;le.showCentroid(Ye),Te++}if(Ye&&Te<ge.length){const at=Te;let _t=0;for(;!(Ye.borders[me][0]>Ge[1]-3)&&(_t++,++Te!==ge.length);)Ye=le.featuresOnBorder[ge[Te]];Ye=le.featuresOnBorder[ge[at]];let bt=!1;if(_t>=1){const $e=Ye.borders[me];Math.abs(Ge[0]-$e[0])<3&&Math.abs(Ge[1]-$e[1])<3&&(_t=1,bt=!0,Te=at+1)}else if(_t===0){c.showCentroid(Ae);continue}const ke=le.centroidData[Ye.centroidDataIndex];y&&bt&&(((W=Ee).flags|(K=ke).flags)&o.d1?(W.flags|=o.d1,K.flags|=o.d1):(W.flags&=~o.d1,K.flags&=~o.d1));const rt=Ae.intersectsCount()>1||Ye.intersectsCount()>1;if(_t>1)Te=at,Ee.centroidXY=ke.centroidXY=new o.P(0,0);else if(fe&&fe.dem&&!rt){const $e=G[Y](Ee,ke),nt=Y%2?o.ab-1:0,lt=X($e[0],Math.min(o.ab-1,$e[1]),nt,fe,re,Y<2,$e[2]);Ee.centroidXY=ke.centroidXY=P(lt)}else rt?Ee.centroidXY=ke.centroidXY=new o.P(0,0):(Ee.centroidXY=c.encodeBorderCentroid(Ae),ke.centroidXY=le.encodeBorderCentroid(Ye));c.writeCentroidToBuffer(Ee),le.writeCentroidToBuffer(ke)}else c.showCentroid(Ae)}c.borderDoneWithNeighborZ[Y]=le.canonical.z,le.borderDoneWithNeighborZ[me]=c.canonical.z}var W,K;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const ta=[1,0,0],Eh=[0,1,0],Xf=[0,0,1];function wu(l,t,n){const c=n.transform,f=n.shadowRenderer;if(!f)return!0;const _=l.toUnwrapped(),y=c.tileSize*f._cascades[n.currentShadowCascade].scale;let M=t.maxHeight;if(c.elevation){const W=c.elevation.getMinMaxForTile(l);W&&(M+=W.max)}const P=[...f.shadowDirection];P[2]=-P[2];const D=f.computeSimplifiedTileShadowVolume(_,M,y,P);if(!D)return!1;const R=[ta,Eh,Xf,P,[P[0],0,P[2]],[0,P[1],P[2]]],F=c.projection.name==="globe",N=c.scaleZoom(y),G=o.bO.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,N,!F),X=f.getCurrentCascadeFrustum();return G.intersectsPrecise(D.vertices,D.planes,R)===0||X.intersectsPrecise(D.vertices,D.planes,R)===0}function Zo(l){return[l[0]*o.d4,l[1]*o.d4,l[2]*o.d4,0]}function Kn(l,t,n,c,f,_,y,M,P){const D=c.getSource(),R=n.globeSharedBuffers;if(!R)return;let F,N,G;if(t&&(F=c.getTile(t)),D instanceof o.aD?(N=D.texture,G=o.cD(0,0,n.transform)):F&&t&&(N=F.texture,G=o.cD(t.canonical.z,t.canonical.x,n.transform)),!N||!G)return;l||(G=o.a6.mat4.scale(o.a6.mat4.create(),G,[1,-1,1]));const X=n.context,W=X.gl,K=f.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,Y=n.colorModeForDrapableLayerRenderPass(_),te=y.defines;te.push("GLOBE_POLES");const re=new oi(W.LEQUAL,oi.ReadWrite,n.depthRangeFor3D),le=Float32Array.from(n.transform.expandedFarZProjMatrix),fe=Float32Array.from(o.b6(o.cC(new o.bQ(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),X.activeTexture.set(W.TEXTURE0),N.bind(K,W.CLAMP_TO_EDGE),X.activeTexture.set(W.TEXTURE1),N.bind(K,W.CLAMP_TO_EDGE),N.useMipmap&&X.extTextureFilterAnisotropic&&n.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[me,de,ge,Te]=t?R.getPoleBuffers(t.canonical.z,!1):R.getPoleBuffers(0,!0),Ce=f.paint.get("raster-elevation");let Ae;l?(Ae=me,n.renderDefaultNorthPole=Ce!==0):(Ae=de,n.renderDefaultSouthPole=Ce!==0);const Ee=Zo(y.mix),Ge=((at,_t,bt,ke,rt,$e,nt,lt,ot,St,Wt,ti,kt)=>vh(at,_t,bt,new Float32Array(16),new Float32Array(9),[0,0],ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},$e,[0,0],lt,2,St,Wt,ti,1,0,kt))(le,fe,G,o.a9(n.transform.zoom),0,f,0,Ce,0,Ee,y.offset,y.range,_),Ye=n.getOrCreateProgram("raster",{defines:te});n.uploadCommonUniforms(X,Ye,null),Ye.draw(n,W.TRIANGLES,re,P,Y,M,Ge,f.id,Ae,ge,Te)}function qr(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),c=n-t,f=.2*l.height,_=t+f;return[t,n,(_-f-t)/c,(_-t)/c]}function Tu(l,t,n,c){if(l)return t instanceof Ts&&l instanceof ec?t.getTextureDescriptor(l,n,!0):{texture:l.texture,mix:Zo(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Yf=o.d5([{name:"a_index",type:"Int16",components:1}]);class Ls{constructor(t,n,c,f){const _={width:c[0],height:c[1],data:null},y=t.gl;this.targetColorTexture=new o.T(t,_,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,_,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,f),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,f=n.width*n.height;this.particleTexture0=new o.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1});const _=new o.d6;_.reserve(f);for(let y=0;y<f;y++)_.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(_,Yf.members,!0),this.particleSegment=o.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ah(l,t,n){if(!l)return null;const c=t.getTextureDescriptor(l,n,!0);if(!c)return null;let{texture:f,mix:_,offset:y,tileSize:M,buffer:P,format:D}=c;if(!f||!D)return null;let R=!1;return D==="uint32"&&(R=!0,_[3]=0,_=as(o.d7,_,[0,n.paint.get("raster-particle-max-speed")]),y=dc(o.d7,y,[0,n.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[P/(M+2*P),M/(M+2*P)],tileSize:M,scalarData:R,scale:_,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Mh(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),c=n-t,f=.2*l.height,_=t+f;return[t,n,(_-f-t)/c,(_-t)/c]}const cs=new o.bA(1,0,0,1),Pl=new o.bA(0,1,0,1),ht=new o.bA(0,0,1,1),ei=new o.bA(1,0,1,1),_c=new o.bA(0,1,1,1);function Bn(l,t,n,c,f,_,y){const M=l.context,P=l.transform,D=M.gl,R=P.projection.name==="globe",F=R?["PROJECTION_GLOBE_VIEW"]:[];let N=o.a6.mat4.clone(n.projMatrix);if(R&&o.a9(P.zoom)>0){const Ee=o.b5(n.canonical,P),Ge=o.d8(Ee);N=o.a6.mat4.multiply(new Float32Array(16),P.globeMatrix,Ge),o.a6.mat4.multiply(N,P.projMatrix,N)}const G=o.a6.mat4.create();G[12]+=2*f/(o.q.devicePixelRatio*P.width),G[13]+=2*_/(o.q.devicePixelRatio*P.height),o.a6.mat4.multiply(N,G,N);const X=l.getOrCreateProgram("debug",{defines:F}),W=t.getTileByID(n.key);l.terrain&&l.terrain.setupElevationDraw(W,X);const K=oi.disabled,Y=vi.disabled,te=l.colorModeForRenderPass(),re="$debug";M.activeTexture.set(D.TEXTURE0),l.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),R?W._makeGlobeTileDebugBuffers(l.context,P):W._makeDebugTileBoundsBuffers(l.context,P.projection);const le=W._tileDebugBuffer||l.debugBuffer,fe=W._tileDebugIndexBuffer||l.debugIndexBuffer,me=W._tileDebugSegments||l.debugSegments;if(X.draw(l,D.LINE_STRIP,K,Y,te,di.disabled,jf(N,c),re,le,fe,me,null,null,null,[W._globeTileDebugBorderBuffer]),y){const Ee=W.latestRawTileData,Ge=Math.floor((Ee&&Ee.byteLength||0)/1024);let Ye=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Ye+=` => ${n.overscaledZ}`),Ye+=` ${W.state}`,Ye+=` ${Ge}kb`,function(at,_t){at.initDebugOverlayCanvas();const bt=at.debugOverlayCanvas,ke=at.context.gl,rt=at.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,bt.width,bt.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(_t,5,5),rt.strokeText(_t,5,5),at.debugOverlayTexture.update(bt),at.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(l,Ye)}const de=t.getTile(n).tileSize,ge=512/Math.min(de,512)*(n.overscaledZ/P.zoom)*.5,Te=W._tileDebugTextBuffer||l.debugBuffer,Ce=W._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Ae=W._tileDebugTextSegments||l.debugSegments;X.draw(l,D.TRIANGLES,K,Y,Oi.alphaBlended,di.disabled,jf(N,o.bA.transparent,ge),re,Te,Ce,Ae,null,null,null,[W._globeTileDebugTextBuffer])}function Ve(l,t,n,c){Rl(l,0,t+n/2,l.transform.width,n,c)}function Su(l,t,n,c){Rl(l,t-n/2,0,n,l.transform.height,c)}function Rl(l,t,n,c,f,_){const y=l.context,M=y.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*o.q.devicePixelRatio,n*o.q.devicePixelRatio,c*o.q.devicePixelRatio,f*o.q.devicePixelRatio),y.clear({color:_}),M.disable(M.SCISSOR_TEST)}const Dl=o.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Eu}=Dl;function Aa(l,t,n,c){l.emplaceBack(t,n,c)}class Kf{constructor(t){this.vertexArray=new o.d9,this.indices=new o.aP,Aa(this.vertexArray,-1,-1,1),Aa(this.vertexArray,1,-1,1),Aa(this.vertexArray,-1,1,1),Aa(this.vertexArray,1,1,1),Aa(this.vertexArray,-1,-1,-1),Aa(this.vertexArray,1,-1,-1),Aa(this.vertexArray,-1,1,-1),Aa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Eu),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.b2.simpleSegment(0,0,36,12)}}function Mo(l,t,n,c,f,_){const y=l.context.gl,M=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),R=((F,N,G,X,W)=>({u_matrix_3f:F,u_sun_direction:N,u_sun_intensity:G,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(o.a6.mat3.fromMat4(o.a6.mat3.create(),c),f,D,M,P);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),n.draw(l,y.TRIANGLES,oi.disabled,vi.disabled,Oi.unblended,di.frontCW,R,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const dm=o.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class pm{constructor(t){const n=new o.da;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const c=new o.aP;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,dm.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=o.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ih=o.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Au{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Oi([1,Go,1,Go],o.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Oi([1,0,1,0],o.bA.transparent,[!1,!1,!1,!0]),this.params=new Au,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new pm(n);const c=this.params.sizeRange,f=this.params.intensityRange,_=function(R){const F=o.dd(30),N=[];for(let G=0;G<R;++G){const X=2*Math.PI*F(),W=Math.acos(1-2*F())-.5*Math.PI;N.push(o.a6.vec3.fromValues(Math.cos(W)*Math.cos(X),Math.cos(W)*Math.sin(X),Math.sin(W)))}return N}(this.params.starsCount),y=o.dd(300),M=new o.db,P=new o.aP;let D=0;for(let R=0;R<_.length;++R){const F=o.a6.vec3.scale([],_[R],200),N=Math.max(0,1+.01*c*(1*y()-.5)),G=Math.max(0,1+.01*f*(1*y()-.5));M.emplaceBack(F[0],F[1],F[2],-1,-1,N,G),M.emplaceBack(F[0],F[1],F[2],1,-1,N,G),M.emplaceBack(F[0],F[1],F[2],1,1,N,G),M.emplaceBack(F[0],F[1],F[2],-1,1,N,G),P.emplaceBack(D+0,D+1,D+2),P.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=n.createVertexBuffer(M,Ih.members),this.starsIdx=n.createIndexBuffer(P),this.starsSegments=o.b2.simpleSegment(0,0,M.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const c=t.context,f=c.gl,_=t.transform,y=new oi(f.LEQUAL,oi.ReadOnly,[0,1]),M=o.a9(_.zoom),P=t.style.getLut(n.scope),D=n.properties.get("color").toRenderColor(P).toArray01(),R=n.properties.get("high-color").toRenderColor(P).toArray01(),F=n.properties.get("space-color").toRenderColor(P).toArray01PremultipliedAlpha(),N=5e-4,G=o.dc(n.properties.get("horizon-blend"),0,1,N,.25),X=o.cx(t,c,_)&&G===N?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,W=t.frameCounter/1e3%1,K=o.a6.vec3.length(_.globeCenterInViewSpace),Y=Math.sqrt(Math.pow(K,2)-Math.pow(X,2)),te=Math.acos(Y/K),re=le=>{const fe=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];le&&fe.push("ALPHA_PASS");const me=t.getOrCreateProgram("globeAtmosphere",{defines:fe}),de=((Te,Ce,Ae,Ee,Ge,Ye,at,_t,bt,ke,rt,$e)=>({u_frustum_tl:Te,u_frustum_tr:Ce,u_frustum_br:Ae,u_frustum_bl:Ee,u_horizon:Ge,u_transition:Ye,u_fadeout_range:at,u_color:_t,u_high_color:bt,u_space_color:ke,u_temporal_offset:rt,u_horizon_angle:$e}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,M,G,D,R,F,W,te);t.uploadCommonUniforms(c,me);const ge=this.atmosphereBuffer;ge&&me.draw(t,f.TRIANGLES,y,vi.disabled,le?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,di.backCW,de,le?"atmosphere_glow_alpha":"atmosphere_glow",ge.vertexBuffer,ge.indexBuffer,ge.segments)};re(!1),re(!0)}drawStars(t,n){const c=o.ap(n.properties.get("star-intensity"),0,1);if(c===0)return;const f=t.context,_=f.gl,y=t.transform,M=t.getOrCreateProgram("stars"),P=o.a6.quat.identity([]);o.a6.quat.rotateX(P,P,-y._pitch),o.a6.quat.rotateZ(P,P,-y.angle),o.a6.quat.rotateX(P,P,o.bC(y._center.lat)),o.a6.quat.rotateY(P,P,-o.bC(y._center.lng));const D=o.a6.mat4.fromQuat(new Float32Array(16),P),R=o.a6.mat4.multiply([],y.starsProjMatrix,D),F=o.a6.mat3.fromMat4([],D),N=o.a6.mat3.invert([],F),G=[0,1,0];o.a6.vec3.transformMat3(G,G,N),o.a6.vec3.scale(G,G,this.params.sizeMultiplier);const X=[1,0,0];o.a6.vec3.transformMat3(X,X,N),o.a6.vec3.scale(X,X,this.params.sizeMultiplier);const W=(K=G,Y=X,te=c,{u_matrix:Float32Array.from(R),u_up:K,u_right:Y,u_intensity_multiplier:te});var K,Y,te;t.uploadCommonUniforms(f,M),this.starsVx&&this.starsIdx&&M.draw(t,_.TRIANGLES,oi.disabled,vi.disabled,this.colorModeAlphaBlendedWriteRGB,di.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Qf(l,t){const n=[...l],c=t.cameraWorldSizeForFog/t.worldSize,f=o.a6.mat4.identity([]);return o.a6.mat4.scale(f,f,[c,c,1]),o.a6.mat4.multiply(n,f,n),o.a6.mat4.multiply(n,t.worldToFogMatrix,n),n}function Ch(l,t,n,c,f){const _=n.material,y=c.context,{baseColorTexture:M,metallicRoughnessTexture:P}=_.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:R,emissionTexture:F}=_;function N(X,W,K){if(X&&(l.push(W),y.activeTexture.set(y.gl.TEXTURE0+K),X.gfxTexture)){const{minFilter:Y,magFilter:te,wrapS:re,wrapT:le}=X.sampler;X.gfxTexture.bindExtraParam(Y,te,re,le)}}N(M,"HAS_TEXTURE_u_baseColorTexture",Or.BaseColor),N(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Or.MetallicRoughness),N(D,"HAS_TEXTURE_u_normalTexture",Or.Normal),N(R,"HAS_TEXTURE_u_occlusionTexture",Or.Occlusion),N(F,"HAS_TEXTURE_u_emissionTexture",Or.Emission),f&&(f.texture||(f.texture=new o.df(c.context,f.image,[f.image.height,f.image.height,f.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+Or.LUT),f.texture&&f.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(l.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||l.push("DIFFUSE_SHADED"),l.push("USE_STANDARD_DERIVATIVES");const G=c.shadowRenderer;G&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&l.push("NORMAL_OFFSET"))}function Ya(l,t,n,c,f,_){const y=n.paint.get("model-opacity"),M=t.context,P=new oi(t.context.gl.LEQUAL,oi.ReadWrite,t.depthRangeFor3D),D=t.transform,R=l.mesh,F=R.material,N=F.pbrMetallicRoughness,G=t.style.fog;let X;X=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:o.a6.mat4.multiply([],c.zScaleMatrix,l.nodeModelMatrix),o.a6.mat4.multiply(X,c.negCameraPosMatrix,X);const W=o.a6.mat4.invert([],X);o.a6.mat4.transpose(W,W);const K=n.paint.get("model-emissive-strength").constantOr(0),Y=wh(new Float32Array(l.worldViewProjection),new Float32Array(X),new Float32Array(W),null,t,y,N.baseColorFactor.toRenderColor(null),F.emissiveFactor,N.metallicFactor,N.roughnessFactor,F,K,n),te={defines:[]},re=[],le=t.shadowRenderer;le&&(le.useNormalOffset=!1),Ch(te.defines,re,R,t,n.lut);let fe=null;if(G){const ge=Qf(l.nodeModelMatrix,t.transform);if(fe=new Float32Array(ge),D.projection.name!=="globe"){const Te=R.aabb.min,Ce=R.aabb.max,[Ae,Ee]=G.getOpacityForBounds(ge,Te[0],Te[1],Ce[0],Ce[1]);te.overrideFog=Ae>=gt||Ee>=gt}}const me=va(t,n.paint.get("model-cutoff-fade-range"));me.shouldRenderCutoff&&te.defines.push("RENDER_CUTOFF");const de=t.getOrCreateProgram("model",te);t.uploadCommonUniforms(M,de,null,fe,me),t.renderPass!=="shadow"&&le&&le.setupShadowsFromMatrix(l.nodeModelMatrix,de),de.draw(t,M.gl.TRIANGLES,P,f,_,R.material.doubleSided?di.disabled:di.backCCW,Y,n.id,R.vertexBuffer,R.indexBuffer,R.segments,n.paint,t.transform.zoom,void 0,re)}function Ll(l,t,n,c,f,_,y){let M;M=l.projection.name==="globe"?o.dg(n,l):[...n],o.a6.mat4.multiply(M,M,t.matrix);const P=o.a6.mat4.multiply([],c,M);if(t.meshes)for(const D of t.meshes){if(D.material.alphaMode!=="BLEND"){y.push({mesh:D,depth:0,modelIndex:f,worldViewProjection:P,nodeModelMatrix:M});continue}const R=o.a6.vec3.transformMat4([],D.centroid,P);R[2]>0&&_.push({mesh:D,depth:R[2],modelIndex:f,worldViewProjection:P,nodeModelMatrix:M})}if(t.children)for(const D of t.children)Ll(l,D,n,c,f,_,y)}function Ph(l,t,n,c){const f=n.shadowRenderer;if(!f)return;const _=f.getShadowPassDepthMode(),y=f.getShadowPassColorMode(),M=f.calculateShadowPassMatrixFromMatrix(t),P=Hf(M);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,_,vi.disabled,y,di.backCCW,P,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,n.transform.zoom,void 0,void 0)}function Rh(l,t,n){const c=t.updateZoomBasedPaintProperties(),f=function(_,y,M){let P,D,R,F=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&F>0){const N=_.terrain,G=N.findDEMTileFor(M);G&&G.dem?P=o.di.create(N,M,G):F=0}if(F===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),F===y.validForExaggeration&&(F===0||P&&P._demTile&&P._demTile.tileID===y.validForDEMTile.id&&P._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const N in y.instancesPerModel){const G=y.instancesPerModel[N];for(let X=0;X<G.instancedDataArray.length;++X){const W=(P?F*P.getElevationAt(0|G.instancedDataArray.float32[16*X],0|G.instancedDataArray.float32[16*X+1],!0,!0):0)+G.instancesEvaluatedElevation[X];G.instancedDataArray.float32[16*X+6]=W,D=D?Math.min(y.terrainElevationMin,W):W,R=R?Math.max(y.terrainElevationMax,W):W}}return y.terrainElevationMin=D||0,y.terrainElevationMax=R||0,y.validForExaggeration=F,y.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,n);(c||f)&&(t.uploaded=!1,t.upload(l.context))}const zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.ca([0,0,0],[o.ab,o.ab,0])};function _o(l,t){const n=1<<l.canonical.z,c=t.getFreeCameraOptions().position,f=t.elevation,_=l.canonical.x/n,y=(l.canonical.x+1)/n,M=l.canonical.y/n,P=(l.canonical.y+1)/n;let D=t._centerAltitude;if(f){const G=f.getMinMaxForTile(l);G&&G.max>D&&(D=G.max)}const R=o.ap(c.x,_,y)-c.x,F=o.ap(c.y,M,P)-c.y,N=o.bE(D,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(R*R+F*F+N*N))}function ed(l,t,n,c,f,_,y){const M=l.context,P=l.renderPass==="shadow",D=l.shadowRenderer,R=P&&D?D.getShadowPassDepthMode():new oi(M.gl.LEQUAL,oi.ReadWrite,l.depthRangeFor3D),F=l.isTileAffectedByFog(_);if(n.meshes)for(const N of n.meshes){const G=["MODEL_POSITION_ON_GPU"],X=[];let W,K,Y;c.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const te=va(l,t.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),P&&D)W=l.getOrCreateProgram("modelDepth",{defines:G}),K=Hf(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(n.matrix)),Y=D.getShadowPassColorMode();else{Ch(G,X,N,l,t.lut),W=l.getOrCreateProgram("model",{defines:G,overrideFog:F});const le=N.material,fe=le.pbrMetallicRoughness,me=t.paint.get("model-opacity"),de=t.paint.get("model-emissive-strength").constantOr(0);K=wh(_.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,l,me,fe.baseColorFactor.toRenderColor(null),le.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,le,de,t,f),D&&(y.shadowUniformsInitialized?W.setShadowUniformValues(M,D.getShadowUniformValues()):(D.setupShadows(_.toUnwrapped(),W,"model-tile",_.overscaledZ),y.shadowUniformsInitialized=!0)),Y=te.shouldRenderCutoff||me<1||le.alphaMode!=="OPAQUE"?Oi.alphaBlended:Oi.unblended}l.uploadCommonUniforms(M,W,_.toUnwrapped(),null,te);const re=N.material.doubleSided?di.disabled:di.backCCW;if(c.instancedDataArray.length>20)X.push(c.instancedDataBuffer),W.draw(l,M.gl.TRIANGLES,R,vi.disabled,Y,re,K,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,X,c.instancedDataArray.length);else{const le=P?"u_instance":"u_normal_matrix";for(let fe=0;fe<c.instancedDataArray.length;++fe)K[le]=new Float32Array(c.instancedDataArray.arrayBuffer,64*fe,16),W.draw(l,M.gl.TRIANGLES,R,vi.disabled,Y,re,K,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,X)}}if(n.children)for(const N of n.children)ed(l,t,N,c,f,_,y)}const Ka=[1,-1,1];function Nn(l,t,n,c){if(!n.modelManager)return!0;const f=n.modelManager;if(!n.shadowRenderer)return!0;const _=n.shadowRenderer,y=t.aabb;let M=!0,P=l.maxHeight;if(P===0){let R=0;for(const F in l.instancesPerModel){const N=f.getModel(F,c);N?R=Math.max(R,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):M=!1}P=l.maxScale*R*1.41+l.maxVerticalOffset,M&&(l.maxHeight=P)}y.max[2]=P,y.min[2]+=l.terrainElevationMin,y.max[2]+=l.terrainElevationMax,o.a6.vec3.transformMat4(y.min,y.min,t.tileMatrix),o.a6.vec3.transformMat4(y.max,y.max,t.tileMatrix);const D=y.intersects(_.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=D===2),D===0}function on(l,t){const n=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],_=l.uniformValues.u_cutoff_params[3];return c===n||_===f?1:o.ap(((t-n)/(c-n)-f)/(_-f),0,1)}function td(l,t,n,c){if(t.pitch<20)return 1;const f=t.getWorldToCameraMatrix();o.a6.mat4.multiply(f,f,l);const _=o.a6.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let y=o.a6.vec4.transformMat4(o.a6.vec4.create(),_,f),M=y,P=y;_[1]=n.max[1],y=o.a6.vec4.transformMat4(o.a6.vec4.create(),_,f),M=y[1]<M[1]?y:M,P=y[1]>P[1]?y:P,_[0]=n.max[0],y=o.a6.vec4.transformMat4(o.a6.vec4.create(),_,f),M=y[1]<M[1]?y:M,P=y[1]>P[1]?y:P,_[1]=n.min[1],y=o.a6.vec4.transformMat4(o.a6.vec4.create(),_,f),M=y[1]<M[1]?y:M,P=y[1]>P[1]?y:P;const D=o.ap(c[0],0,1),R=100*t.pixelsPerMeter*o.ap(c[1],0,1),F=o.ap(c[2],0,1),N=o.a6.vec4.lerp(o.a6.vec4.create(),M,P,D),G=Math.tan(.5*t.fovX),X=-N[2]*G;if(R===0)return N[1]<-Math.abs(X)?F:1;const W=(-Math.abs(X)-N[1])/R,K=(te,re,le)=>(1-le)*te+le*re,Y=o.ap(K(1,F,W),F,1);return K(1,Y,o.ap((t.pitch-20)/20,0,1))}class Ja{}class Mu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,c){{const F=this._storage.get(n.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const f=c.gl,_=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),y=new ArrayBuffer(_),M=new Int16Array(y);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const P=new o.dk;for(let F=0;F<_/2;F+=3){const N=M[F],G=M[F+1],X=M[F+2];P.emplaceBack(N,G),P.emplaceBack(G,X),P.emplaceBack(X,N)}const D=c.bindVertexArrayOES.current,R=new Ja;return R.buf=new Ao(c,P),R.lastUsedFrameIdx=t,this._storage.set(n.id,R),c.bindVertexArrayOES.set(D),R.buf}update(t){for(const[n,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class gc{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Iu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const yc={symbol:function(l,t,n,c,f){if(l.renderPass!=="translucent")return;const _=vi.disabled,y=l.colorModeForRenderPass(),M=n.layout.get("text-variable-anchor"),P=n.layout.get("text-size-scale-range"),D=o.ap(l.scaleFactor,P[0],P[1]);M&&function(N,G,X,W,K,Y,te,re){const le=G.transform,fe=K==="map",me=Y==="map";for(const de of N){const ge=W.getTile(de),Te=ge.getBucket(X);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const Ce=o.bk(Te.textSizeData,le.zoom,re),Ae=Ks(de,Te.getProjection(),le),Ee=le.calculatePixelsToTileUnitsMatrix(ge),Ge=Wi(Ae,ge.tileID.canonical,me,fe,le,Te.getProjection(),Ee),Ye=Te.hasIconTextFit()&&Te.hasIconData();if(Ce){const at=Math.pow(2,le.zoom-ge.tileID.overscaledZ);bu(Te,fe,me,te,o.cS,le,Ge,de,at,Ce,Ye)}}}(c,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),f,D);const R=n.paint.get("icon-opacity").constantOr(1)!==0,F=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||F)?Ds(l,t,n,c,_,y):(R&&Ds(l,t,n,c,_,y,{onlyIcons:!0}),F&&Ds(l,t,n,c,_,y,{onlyText:!0})),t.map.showCollisionBoxes&&(Zf(l,t,n,c,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Zf(l,t,n,c,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,c){if(l.renderPass!=="translucent")return;const f=n.paint.get("circle-opacity"),_=n.paint.get("circle-stroke-width"),y=n.paint.get("circle-stroke-opacity"),M=n.layout.get("circle-sort-key").constantOr(1)!==void 0,P=n.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(_.constantOr(1)===0||y.constantOr(1)===0))return;const D=l.context,R=D.gl,F=l.transform,N=l.depthModeForSublayer(0,oi.ReadOnly),G=vi.disabled,X=l.colorModeForDrapableLayerRenderPass(P),W=F.projection.name==="globe",K=[o.am(F.center.lng),o.at(F.center.lat)],Y=[];for(let re=0;re<c.length;re++){const le=c[re],fe=t.getTile(le),me=fe.getBucket(n);if(!me||me.projection.name!==F.projection.name)continue;const de=me.programConfigurations.get(n.id),ge=o.cT(n),Te=l.isTileAffectedByFog(le);W&&ge.push("PROJECTION_GLOBE_VIEW"),ge.push("DEPTH_D24"),l.terrain&&F.depthOcclusionForSymbolsAndCircles&&ge.push("DEPTH_OCCLUSION");const Ce=l.getOrCreateProgram("circle",{config:de,defines:ge,overrideFog:Te}),Ae=me.layoutVertexBuffer,Ee=me.globeExtVertexBuffer,Ge=me.indexBuffer,Ye=F.projection.createInversionMatrix(F,le.canonical),at={programConfiguration:de,program:Ce,layoutVertexBuffer:Ae,globeExtVertexBuffer:Ee,indexBuffer:Ge,uniformValues:o.cU(l,le,fe,Ye,K,n),tile:fe};if(M){const _t=me.segments.get();for(const bt of _t)Y.push({segments:new o.b2([bt]),sortKey:bt.sortKey,state:at})}else Y.push({segments:me.segments,sortKey:0,state:at})}M&&Y.sort((re,le)=>re.sortKey-le.sortKey);const te={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const re of Y){const{programConfiguration:le,program:fe,layoutVertexBuffer:me,globeExtVertexBuffer:de,indexBuffer:ge,uniformValues:Te,tile:Ce}=re.state,Ae=re.segments;l.terrain&&l.terrain.setupElevationDraw(Ce,fe,te),l.uploadCommonUniforms(D,fe,Ce.tileID.toUnwrapped()),fe.draw(l,R.TRIANGLES,N,G,X,di.disabled,Te,n.id,me,ge,Ae,n.paint,F.zoom,le,[de])}},heatmap:function(l,t,n,c){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const f=l.context,_=f.gl,y=vi.disabled,M=new Oi([_.ONE,_.ONE,_.ONE,_.ONE],o.bA.transparent,[!0,!0,!0,!0]);(function(G,X,W,K){const Y=G.gl,te=X.width*K,re=X.height*K;G.activeTexture.set(Y.TEXTURE1),G.viewport.set([0,0,te,re]);let le=W.heatmapFbo;if(!le||le&&(le.width!==te||le.height!==re)){le&&le.destroy();const fe=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,fe),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),le=W.heatmapFbo=G.createFramebuffer(te,re,!0,null),function(me,de,ge,Te,Ce,Ae){const Ee=me.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,me.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Ce,Ae,0,Ee.RGBA,me.extRenderToTextureHalfFloat?Ee.HALF_FLOAT:Ee.UNSIGNED_BYTE,null),Te.colorAttachment.set(ge)}(G,0,fe,le,te,re)}else Y.bindTexture(Y.TEXTURE_2D,le.colorAttachment.get()),G.bindFramebuffer.set(le.framebuffer)})(f,l,n,l.transform.projection.name==="globe"?.5:.25),f.clear({color:o.bA.transparent});const P=l.transform,D=P.projection.name==="globe",R=D?["PROJECTION_GLOBE_VIEW"]:[],F=D?di.frontCCW:di.disabled,N=[o.am(P.center.lng),o.at(P.center.lat)];for(let G=0;G<c.length;G++){const X=c[G];if(t.hasRenderableParent(X))continue;const W=t.getTile(X),K=W.getBucket(n);if(!K||K.projection.name!==P.projection.name)continue;const Y=l.isTileAffectedByFog(X),te=K.programConfigurations.get(n.id),re=l.getOrCreateProgram("heatmap",{config:te,defines:R,overrideFog:Y}),{zoom:le}=l.transform;l.terrain&&l.terrain.setupElevationDraw(W,re),l.uploadCommonUniforms(f,re,X.toUnwrapped());const fe=P.projection.createInversionMatrix(P,X.canonical);re.draw(l,_.TRIANGLES,oi.disabled,y,M,F,Gf(l,X,W,fe,N,le,n.paint.get("heatmap-intensity")),n.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,n.paint,l.transform.zoom,te,D?[K.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(f,_){const y=f.context,M=y.gl,P=_.heatmapFbo;if(!P)return;y.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),y.activeTexture.set(M.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new o.T(y,_.colorRamp,M.RGBA8)),D.bind(M.LINEAR,M.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,M.TRIANGLES,oi.disabled,vi.disabled,f.colorModeForRenderPass(),di.disabled,((R,F,N,G)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,_),_.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,_.paint,f.transform.zoom)}(l,n))},line:function(l,t,n,c){if(l.renderPass!=="translucent")return;const f=n.paint.get("line-opacity"),_=n.paint.get("line-width");if(f.constantOr(1)===0||_.constantOr(1)===0)return;const y=n.paint.get("line-emissive-strength"),M=n.paint.get("line-occlusion-opacity"),P=n.layout.get("line-elevation-reference")==="sea",D=l.context,R=D.gl,F=!n.isDraped();if(F&&l.transform.projection.name==="globe")return;const N=n.layout.get("line-cross-slope"),G=N!==void 0,X=N<1,W=F?new oi(l.depthOcclusion?R.GREATER:R.LEQUAL,oi.ReadOnly,l.depthRangeFor3D):l.depthModeForSublayer(0,oi.ReadOnly),K=l.colorModeForDrapableLayerRenderPass(y),Y=l.terrain&&l.terrain.renderingToTexture,te=Y?1:o.q.devicePixelRatio,re=n.paint.get("line-dasharray"),le=re.constantOr(1),fe=n.layout.get("line-cap"),me=re.constantOr(null),de=fe.constantOr(null),ge=n.paint.get("line-pattern"),Te=ge.constantOr(1),Ce=ge.constantOr(null),Ae=n.paint.get("line-opacity").constantOr(1);let Ee=!Te&&Ae!==1||l.depthOcclusion&&M>0&&M<1;const Ge=n.paint.get("line-gradient"),Ye=Te?"linePattern":"line",at=o.cV(n);let _t;if(Y&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Ee=!1),M!==0&&l.depthOcclusion){const ke=n.paint._values["line-opacity"];ke&&ke.value&&ke.value.kind==="constant"?_t=ke.value:o.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(l.forceTerrainMode=!0),!F&&M!==0&&l.terrain&&!Y)return void o.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`);const bt=Ee&&F?l.stencilModeFor3D():vi.disabled;F&&(at.push("ELEVATED"),G&&at.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&at.push("ELEVATION_REFERENCE_SEA"));for(const ke of c){const rt=t.getTile(ke);if(Te&&!rt.patternsLoaded())continue;const $e=rt.getBucket(n);if(!$e)continue;l.prepareDrawTile();const nt=$e.programConfigurations.get(n.id),lt=l.isTileAffectedByFog(ke),ot=l.getOrCreateProgram(Ye,{config:nt,defines:at,overrideFog:lt,overrideRtt:!F&&void 0});if(Ce&&rt.imageAtlas){const zt=rt.imageAtlas.patternPositions[Ce.toString()];zt&&nt.setConstantPatternPositions(zt)}if(!Te&&me&&de&&rt.lineAtlas){const zt=rt.lineAtlas.getDash(me,de);zt&&nt.setConstantPatternPositions(zt)}let[St,Wt]=n.paint.get("line-trim-offset");(de==="round"||de==="square")&&St!==Wt&&(St===0&&(St-=1),Wt===1&&(Wt+=1));const ti=Y?ke.projMatrix:null,kt=Te?o.cW(l,rt,n,ti,te,[St,Wt]):o.cX(l,rt,n,ti,$e.lineClipsArray.length,te,[St,Wt]);if(Ge){const zt=$e.gradients[n.id];let ai=zt.texture;if(n.gradientVersion!==zt.version){let Si=256;if(n.stepInterpolant){const Ui=t.getSource().maxzoom,Mn=ke.canonical.z===Ui?Math.ceil(1<<l.transform.maxZoom-ke.canonical.z):1;Si=o.ap(o.cY($e.maxLineLength/o.ab*1024*Mn),256,D.maxTextureSize)}zt.gradient=o.cZ({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:zt.gradient||void 0,clips:$e.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new o.T(D,zt.gradient,R.RGBA8),zt.version=n.gradientVersion,ai=zt.texture}D.activeTexture.set(R.TEXTURE1),ai.bind(n.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}le&&(D.activeTexture.set(R.TEXTURE0),rt.lineAtlasTexture&&rt.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),nt.updatePaintBuffers()),Te&&(D.activeTexture.set(R.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),nt.updatePaintBuffers()),F&&!P&&l.terrain.setupElevationDraw(rt,ot),l.uploadCommonUniforms(D,ot,ke.toUnwrapped());const Kt=zt=>{_t!=null&&(_t.value=Ae*M),ot.draw(l,R.TRIANGLES,W,zt,K,di.disabled,kt,n.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,n.paint,l.transform.zoom,nt,[$e.layoutVertexBuffer2,$e.patternVertexBuffer,$e.zOffsetVertexBuffer]),_t!=null&&(_t.value=Ae)};if(Ee&&!F){const zt=l.stencilModeForClipping(ke).ref;zt===0&&Y&&D.clear({stencil:0});const ai={func:R.EQUAL,mask:255};kt.u_alpha_discard_threshold=.8,Kt(new vi(ai,zt,255,R.KEEP,R.KEEP,R.INVERT)),kt.u_alpha_discard_threshold=0,Kt(new vi(ai,zt,255,R.KEEP,R.KEEP,R.KEEP))}else Ee&&F&&(kt.u_alpha_discard_threshold=.001),Kt(F?bt:l.stencilModeForClipping(ke))}F&&(l.forceTerrainMode=!1),Ee&&(l.resetStencilClippingMasks(),Y&&D.clear({stencil:0})),M===0||l.depthOcclusion||Y||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,n,c){const f=n.paint.get("fill-color"),_=n.paint.get("fill-opacity"),y=n.is3D(),M=new oi(l.context.gl.LEQUAL,oi.ReadWrite,l.depthRangeFor3D);if(_.constantOr(1)===0)return;const P=n.paint.get("fill-emissive-strength"),D=l.colorModeForDrapableLayerRenderPass(P),R=n.paint.get("fill-pattern"),F=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&f.constantOr(o.bA.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===F){const N=y?M:l.depthModeForSublayer(1,l.renderPass==="opaque"?oi.ReadWrite:oi.ReadOnly);Sh(l,t,n,c,N,D,!1)}if(!y&&l.renderPass==="translucent"&&n.paint.get("fill-antialias")){const N=y?M:l.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,oi.ReadOnly);Sh(l,t,n,c,N,D,!0)}},"fill-extrusion":function(l,t,n,c){const f=n.paint.get("fill-extrusion-opacity"),_=l.context,y=_.gl,M=l.terrain,P=M&&M.renderingToTexture;if(f===0)return;const D=l.conflationActive&&l.style.isLayerClipped(n,t.getSource()),R=l.style.order.indexOf(n.fqid);if(D&&function(F,N,G,X,W){for(const K of X){const Y=N.getTile(K).getBucket(G);Y&&(Y.updateReplacement(K,F.replacementSource,W),Y.uploadCentroid(F.context))}}(l,t,n,c,R),M||D)for(const F of c){const N=t.getTile(F).getBucket(n);N&&mc(l.context,t,F,N,n,M,D)}if(l.renderPass==="shadow"&&l.shadowRenderer){const F=l.shadowRenderer;if(M&&f<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.a4)return;const N=F.getShadowPassDepthMode(),G=F.getShadowPassColorMode();ao(l,t,n,c,N,vi.disabled,G,D)}else if(l.renderPass==="translucent"){const F=!n.paint.get("fill-extrusion-pattern").constantOr(1),N=n.paint.get("fill-extrusion-color").constantOr(o.bA.white);if(!P&&N.a!==0){const G=new oi(l.context.gl.LEQUAL,oi.ReadWrite,l.depthRangeFor3D);f===1&&F?ao(l,t,n,c,G,vi.disabled,Oi.unblended,D):(ao(l,t,n,c,G,vi.disabled,Oi.disabled,D),ao(l,t,n,c,G,l.stencilModeFor3D(),l.colorModeForRenderPass(),D),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&F&&(!M&&l.transform.projection.name!=="globe"||P)){const G=n.paint.get("fill-extrusion-opacity"),X=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=n.paint.get("fill-extrusion-flood-light-intensity"),Y=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(n.lut).toArray01().slice(0,3),te=X>0&&W>0,re=K>0,le=(me,de,ge)=>(1-ge)*me+ge*de,fe=me=>{const de=l.depthModeForSublayer(1,oi.ReadOnly,y.LEQUAL,!0),ge=n.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Te=le(.1,3,ge),Ce=l._showOverdrawInspector;if(!Ce){const Ae=new vi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),Ee=new Oi([y.ONE,y.ONE,y.ONE,y.ONE],o.bA.transparent,[!1,!1,!1,!0],y.MIN);zo(l,t,n,c,de,Ae,Ee,di.disabled,me,"sdf",G,X,W,K,Y,Te,D,!1)}{const Ae=Ce?vi.disabled:new vi({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),Ee=Ce?l.colorModeForRenderPass():new Oi([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],o.bA.transparent,[!0,!0,!0,!0]);zo(l,t,n,c,de,Ae,Ee,di.disabled,me,"color",G,X,W,K,Y,Te,D,!1)}};if(P){const me=(de,ge,Te)=>{const Ce=l.depthModeForSublayer(1,oi.ReadOnly,y.LEQUAL,!1),Ae=n.paint.get(de?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=le(.1,3,Ae);{const Ge=new Oi([y.ONE,y.ONE,y.ONE,y.ONE],o.bA.transparent,[!1,!1,!1,!0]);zo(l,t,n,c,Ce,vi.disabled,Ge,di.disabled,de,"clear",G,X,W,K,Y,Ee,D,ge)}{const Ge=new vi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),Ye=new Oi([y.ONE,y.ONE,y.ONE,y.ONE],o.bA.transparent,[!1,!1,!1,!0],y.MIN);zo(l,t,n,c,Ce,Ge,Ye,di.disabled,de,"sdf",G,X,W,K,Y,Ee,D,ge)}{const Ge=de?y.ZERO:y.ONE_MINUS_DST_ALPHA,Ye=new vi({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),at=new Oi([Ge,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],o.bA.transparent,[!0,!0,!0,!0]);zo(l,t,n,c,Ce,Ye,at,di.disabled,de,"color",G,X,W,K,Y,Ee,D,ge)}{const Ge=new Oi([y.ONE,y.ONE,y.ONE,de?y.ZERO:y.ONE],o.bA.transparent,[!1,!1,!1,!0],de?y.FUNC_ADD:y.MAX);zo(l,t,n,c,Ce,vi.disabled,Ge,di.disabled,de,"clear",G,X,W,K,Y,Ee,D,ge,Te)}};if(te||re){let de;if(l.prepareDrawTile(),M){const ge=M.drapeBufferSize[0],Te=M.drapeBufferSize[1];de=M.framebufferCopyTexture,de&&(!de||de.size[0]===ge&&de.size[1]===Te)||(de&&de.destroy(),de=M.framebufferCopyTexture=new o.T(_,new o.r({width:ge,height:Te}),y.RGBA8)),de.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexSubImage2D(y.TEXTURE_2D,0,0,0,0,0,ge,Te)}te&&me(!0,!1,de),re&&me(!1,!0,de)}}else te&&fe(!0),re&&fe(!1),(te||re)&&l.resetStencilClippingMasks()}}},hillshade:function(l,t,n,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const f=l.context,_=l.terrain&&l.terrain.renderingToTexture,[y,M]=l.renderPass!=="translucent"||_?[{},c]:l.stencilConfigForOverlap(c);for(const P of M){const D=t.getTile(P);if(D.needsHillshadePrepare&&l.renderPass==="offscreen")xl(l,D,n);else if(l.renderPass==="translucent"){const R=l.depthModeForSublayer(0,oi.ReadOnly),F=n.paint.get("hillshade-emissive-strength"),N=l.colorModeForDrapableLayerRenderPass(F),G=_&&l.terrain?l.terrain.stencilModeForRTTOverlap(P):y[P.overscaledZ];Gn(l,P,D,n,R,G,N)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,n,c,f,_){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const y=l.transform.projection.name==="globe",M=n.paint.get("raster-elevation")!==0,P=M&&y;if(l.renderElevatedRasterBackface&&!P)return;const D=l.context,R=D.gl,F=t.getSource(),N=function(me,de,ge,Te){const Ce=de.paint.get("raster-color"),Ae=me.type==="raster-array",Ee=[],Ge=de.paint.get("raster-resampling"),Ye=de.paint.get("raster-color-mix");let at=de.paint.get("raster-color-range");const _t=[Ye[0],Ye[1],Ye[2],0],bt=Ye[3];let ke=Ge==="nearest"?Te.NEAREST:Te.LINEAR;if(Ae&&(Ee.push("RASTER_ARRAY"),Ce||Ee.push("RASTER_COLOR"),Ge==="linear"&&Ee.push("RASTER_ARRAY_LINEAR"),ke=Te.NEAREST,!at&&me.rasterLayers)){const rt=me.rasterLayers.find(({id:$e})=>$e===de.sourceLayer);rt&&rt.fields&&rt.fields.range&&(at=rt.fields.range)}if(at=at||[0,1],Ce){Ee.push("RASTER_COLOR"),ge.activeTexture.set(Te.TEXTURE2),de.updateColorRamp(at);let rt=de.colorRampTexture;rt||(rt=de.colorRampTexture=new o.T(ge,de.colorRamp,Te.RGBA8)),rt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:_t,range:at,offset:bt,defines:Ee,resampling:ke}}(F,n,D,R);if(F instanceof o.aD&&!c.length&&!y)return;const G=n.paint.get("raster-emissive-strength"),X=l.colorModeForDrapableLayerRenderPass(G),W=l.terrain&&l.terrain.renderingToTexture,K=!l.options.moving,Y=n.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(F instanceof o.aD&&!c.length&&(F.onNorthPole||F.onSouthPole)){const me=M?l.stencilModeFor3D():vi.disabled;return void Kn(!!F.onNorthPole,null,l,t,n,G,N,di.disabled,me)}if(!c.length)return;const[te,re]=F instanceof o.aD||W?[{},c]:l.stencilConfigForOverlap(c),le=re[re.length-1].overscaledZ;P&&N.defines.push("PROJECTION_GLOBE_VIEW"),M&&N.defines.push("RENDER_CUTOFF");const fe=(me,de,ge)=>{for(const Te of me){const Ce=Te.toUnwrapped(),Ae=t.getTile(Te);if(W&&(!Ae||!Ae.hasData()))continue;D.activeTexture.set(R.TEXTURE0);const Ee=Tu(Ae,F,n,N);if(!Ee||!Ee.texture)continue;const{texture:Ge,mix:Ye,offset:at,tileSize:_t,buffer:bt}=Ee;let ke,rt;W?(ke=oi.disabled,rt=Te.projMatrix):M?(ke=new oi(R.LEQUAL,oi.ReadWrite,l.depthRangeFor3D),rt=y?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(Ce,K)):(ke=l.depthModeForSublayer(Te.overscaledZ-le,n.paint.get("raster-opacity")===1?oi.ReadWrite:oi.ReadOnly,R.LESS),rt=l.transform.calculateProjMatrix(Ce,K));const $e=l.terrain&&W?l.terrain.stencilModeForRTTOverlap(Te):te[Te.overscaledZ],nt=_?0:n.paint.get("raster-fade-duration");Ae.registerFadeDuration(nt);const lt=t.findLoadedParent(Te,0),ot=Al(Ae,lt,t,l.transform,nt);let St,Wt;l.terrain&&l.terrain.prepareDrawTile(),D.activeTexture.set(R.TEXTURE0),Ge.bind(Y,R.CLAMP_TO_EDGE),D.activeTexture.set(R.TEXTURE1),lt?(lt.texture&&lt.texture.bind(Y,R.CLAMP_TO_EDGE),St=Math.pow(2,lt.tileID.overscaledZ-Ae.tileID.overscaledZ),Wt=[Ae.tileID.canonical.x*St%1,Ae.tileID.canonical.y*St%1]):Ge.bind(Y,R.CLAMP_TO_EDGE),Ge.useMipmap&&D.extTextureFilterAnisotropic&&l.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const ti=l.transform;let kt;const Kt=M?qr(ti):[0,0,0,0];let zt,ai,Si,Ui,Mn,en=0;if(P&&F instanceof o.aD&&F.coordinates.length>3)zt=Float32Array.from(o.b6(o.cC(new o.bQ(0,0,0)))),ai=Float32Array.from(ti.globeMatrix),Si=Float32Array.from(o.cy(ti)),Ui=[o.am(ti.center.lng),o.at(ti.center.lat)],kt=F.elevatedGlobePerspectiveTransform,Mn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const Fi=o.cz(Te.canonical);en=o.cA(Fi.getCenter().lat),zt=Float32Array.from(o.b6(o.cC(Te.canonical))),ai=Float32Array.from(ti.globeMatrix),Si=Float32Array.from(o.cy(ti)),Ui=[o.am(ti.center.lng),o.at(ti.center.lat)],kt=[0,0],Mn=Float32Array.from(o.cB(Te.canonical,Fi,en,ti.worldSize/ti._pixelsPerMercatorPixel))}else kt=F instanceof o.aD?F.perspectiveTransform:[0,0],zt=new Float32Array(16),ai=new Float32Array(9),Si=new Float32Array(16),Ui=[0,0],Mn=new Float32Array(9);const kn=vh(rt,zt,ai,Si,Mn,Wt||[0,0],o.a9(l.transform.zoom),Ui,Kt,St||1,ot,n,kt,M?n.paint.get("raster-elevation"):0,2,Ye,at,N.range,_t,bt,G),ln=l.isTileAffectedByFog(Te),In=l.getOrCreateProgram("raster",{defines:N.defines,overrideFog:ln});if(l.uploadCommonUniforms(D,In,Ce),F instanceof o.aD){const Fi=F.elevatedGlobeVertexBuffer,An=F.elevatedGlobeIndexBuffer;if(W||!y)F.boundsBuffer&&F.boundsSegments&&In.draw(l,R.TRIANGLES,ke,vi.disabled,X,di.disabled,kn,n.id,F.boundsBuffer,l.quadTriangleIndexBuffer,F.boundsSegments);else if(Fi&&An){const bn=ti.zoom<=o.c3?F.elevatedGlobeSegments:F.getSegmentsForLongitude(ti.center.lng);bn&&In.draw(l,R.TRIANGLES,ke,vi.disabled,X,de,kn,n.id,Fi,An,bn)}}else if(P){ke=new oi(R.LEQUAL,oi.ReadOnly,l.depthRangeFor3D);const Fi=l.globeSharedBuffers;if(Fi){const[An,bn,hn]=Fi.getGridBuffers(en,!1);In.draw(l,R.TRIANGLES,ke,ge||$e,l.colorModeForRenderPass(),de,kn,n.id,An,bn,hn)}}else{const{tileBoundsBuffer:Fi,tileBoundsIndexBuffer:An,tileBoundsSegments:bn}=l.getTileBoundsBuffers(Ae);In.draw(l,R.TRIANGLES,ke,$e,X,di.disabled,kn,n.id,Fi,An,bn)}}if(!(F instanceof o.aD)&&P)for(const Te of me){const Ce=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&Kn(!0,Te,l,t,n,G,N,de,ge||vi.disabled),Ce&&Kn(!1,Te,l,t,n,G,N,de===di.frontCW?di.backCW:di.frontCW,ge||vi.disabled)}};P?fe(re,l.renderElevatedRasterBackface?di.backCW:di.frontCW,l.stencilModeFor3D()):fe(re,di.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,n,c,f,_){l.renderPass==="offscreen"&&function(y,M,P,D){if(!D.length)return;const R=y.context,F=R.gl,N=M.getSource();if(!(N instanceof Ts))return;const G=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let X=P.particlePositionRGBAImage;if(!X||X.width!==G){const re=function(le){const fe=le*le,me=new Uint8Array(4*fe),de=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let Te=0;Te<fe;Te++){const Ce=ge*(de(2*Te+0)+Il),Ae=ge*(de(2*Te+1)+Il),Ee=255*Ce%1,Ge=255*Ae%1,Ye=Ee,at=Ae-Ge/255,_t=Ge;me[4*Te+0]=255*(Ce-Ee/255),me[4*Te+1]=255*Ye,me[4*Te+2]=255*at,me[4*Te+3]=255*_t}return me}(G);X=P.particlePositionRGBAImage=new o.r({width:G,height:G},re)}let W=P.particleFramebuffer;W?W.width!==G&&(W.destroy(),W=P.particleFramebuffer=R.createFramebuffer(G,G,!0,null)):W=P.particleFramebuffer=R.createFramebuffer(G,G,!0,null);const K=[];for(const re of D){const le=M.getTile(re);if(!(le instanceof ec))continue;const fe=Ah(le,N,P);if(!fe)continue;const me=[le.tileSize,le.tileSize];let de=P.tileFramebuffer;de||(de=P.tileFramebuffer=R.createFramebuffer(me[0],me[1],!0,null));let ge=le.rasterParticleState;ge||(ge=le.rasterParticleState=new Ls(R,re,me,X));const Te=ge.update(P.lastInvalidatedAt);ge.particleTextureDimension!==G&&ge.updateParticleTexture(re,X);const Ce=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=Ce;const Ae=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Ae,K.push([re,fe,ge,Te])}if(K.length===0)return;const Y=o.q.now(),te=P.previousDrawTimestamp?.001*(Y-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=Y,P.hasColorMap()){R.activeTexture.set(F.TEXTURE0+2);let re=P.colorRampTexture;re||(re=P.colorRampTexture=new o.T(R,P.colorRamp,F.RGBA8)),re.bind(F.LINEAR,F.CLAMP_TO_EDGE)}R.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(re,le,fe){const me=re.context,de=me.gl,ge=le.tileFramebuffer;me.activeTexture.set(de.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Ae=le.paint.get("raster-particle-fade-opacity-factor"))/(Ae+.05)},Ce=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ae;for(const Ee of fe){const[,,Ge,Ye]=Ee;ge.colorAttachment.set(Ge.targetColorTexture.texture),me.viewport.set([0,0,ge.width,ge.height]),me.clear({color:o.bA.transparent}),Ye&&(Ge.backgroundColorTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE),Ce.draw(re,de.TRIANGLES,oi.disabled,vi.disabled,Oi.alphaBlended,di.disabled,Te,le.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(y,P,K),function(re,le,fe,me){const de=re.context,ge=de.gl,Te=fe.tileFramebuffer,Ce=re.transform.projection.name==="globe",Ae=fe.paint.get("raster-particle-max-speed");for(const Ee of me){const[Ge,Ye,at]=Ee;de.activeTexture.set(ge.TEXTURE0+0),Ye.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Te.colorAttachment.set(at.targetColorTexture.texture);const _t=re.getOrCreateProgram("rasterParticleDraw",{defines:Ye.defines,overrideFog:!1});de.activeTexture.set(ge.TEXTURE0+1);const bt=Ye.scalarData?[]:[0,1,2,3].map($e=>o.c$[$e](Ge));bt.push(Ge);const ke=Ge.canonical.x,rt=Ge.canonical.y;for(const $e of bt){const nt=le.getTile(Ce?$e.wrapped():$e);if(!nt)continue;const lt=nt.rasterParticleState;if(!lt)continue;const ot=$e.canonical.x+(1<<$e.canonical.z)*($e.wrap-Ge.wrap),St=$e.canonical.y;lt.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const Wt=ea(1,lt.particleTexture0.size[0],[ot-ke,St-rt],0,Ye.texture.size,2,Ae,Ye.textureOffset,Ye.scale,Ye.offset);_t.draw(re,ge.POINTS,oi.disabled,vi.disabled,Oi.alphaBlended,di.disabled,Wt,fe.id,lt.particleIndexBuffer,void 0,lt.particleSegment)}}}(y,M,P,K),R.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(re,le,fe,me){const de=re.context,ge=de.gl,Te=le.paint.get("raster-particle-max-speed"),Ce=me*le.paint.get("raster-particle-speed-factor")*.15,Ae=function(Ge){return Math.pow(Ge,6)}(.01+1*le.paint.get("raster-particle-reset-rate-factor")),Ee=le.particleFramebuffer;de.viewport.set([0,0,Ee.width,Ee.height]);for(const Ge of fe){const[,Ye,at]=Ge;de.activeTexture.set(ge.TEXTURE0+0),Ye.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),de.activeTexture.set(ge.TEXTURE0+1);const _t=at.particleTexture0;_t.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const bt=qf(1,_t.size[0],0,Ye.texture.size,Te,Ce,Ae,Ye.textureOffset,Ye.scale,Ye.offset);Ee.colorAttachment.set(at.particleTexture1.texture),de.clear({color:o.bA.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Ye.defines}).draw(re,ge.TRIANGLES,oi.disabled,vi.disabled,Oi.unblended,di.disabled,bt,le.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(y,P,K,te)}(l,t,n,c),l.renderPass==="translucent"&&(function(y,M,P,D,R){const F=y.context,N=F.gl,G=M.getSource().tileSize,X=5*(1-o.a7(o.bV,o.bV+1,y.transform.zoom))*G+P.paint.get("raster-particle-elevation"),W=!y.options.moving,K=y.transform.projection.name==="globe";if(!D.length)return;const[Y,te]=y.stencilConfigForOverlap(D),re=[];K&&re.push("PROJECTION_GLOBE_VIEW");const le=y.stencilModeFor3D();for(const fe of te){const me=fe.toUnwrapped(),de=M.getTile(fe);if(!de.rasterParticleState)continue;const ge=de.rasterParticleState,Te=100;de.registerFadeDuration(Te);const Ce=M.findLoadedParent(fe,0),Ae=Al(de,Ce,M,y.transform,Te);let Ee,Ge;y.terrain&&y.terrain.prepareDrawTile(),F.activeTexture.set(N.TEXTURE0),ge.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),F.activeTexture.set(N.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ee=Math.pow(2,Ce.tileID.overscaledZ-de.tileID.overscaledZ),Ge=[de.tileID.canonical.x*Ee%1,de.tileID.canonical.y*Ee%1]):ge.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ye=K?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(me,W),at=y.transform,_t=Mh(at),bt=o.cz(fe.canonical),ke=o.cA(bt.getCenter().lat);let rt,$e,nt,lt,ot;K?(rt=Float32Array.from(o.b6(o.cC(fe.canonical))),$e=Float32Array.from(at.globeMatrix),nt=Float32Array.from(o.cy(at)),lt=[o.am(at.center.lng),o.at(at.center.lat)],ot=Float32Array.from(o.cB(fe.canonical,bt,ke,at.worldSize/at._pixelsPerMercatorPixel))):(rt=new Float32Array(16),$e=new Float32Array(9),nt=new Float32Array(16),lt=[0,0],ot=new Float32Array(9));const St=bh(Ye,rt,$e,nt,ot,Ge||[0,0],o.a9(y.transform.zoom),lt,_t,Ee||1,Ae,X),Wt=y.isTileAffectedByFog(fe),ti=y.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:Wt});if(y.uploadCommonUniforms(F,ti,me),K){const kt=new oi(N.LEQUAL,oi.ReadOnly,y.depthRangeFor3D),Kt=0,zt=y.globeSharedBuffers;if(zt){const[ai,Si,Ui]=zt.getGridBuffers(ke,Kt!==0);ti.draw(y,N.TRIANGLES,kt,le,Oi.alphaBlended,y.renderElevatedRasterBackface?di.frontCCW:di.backCCW,St,P.id,ai,Si,Ui)}}else{const kt=y.depthModeForSublayer(0,oi.ReadOnly),Kt=Y[fe.overscaledZ],{tileBoundsBuffer:zt,tileBoundsIndexBuffer:ai,tileBoundsSegments:Si}=y.getTileBoundsBuffers(de);ti.draw(y,N.TRIANGLES,kt,Kt,Oi.alphaBlended,di.disabled,St,P.id,zt,ai,Si)}}y.resetStencilClippingMasks()}(l,t,n,c),l.style.map.triggerRepaint())},background:function(l,t,n,c){const f=n.paint.get("background-color"),_=n.paint.get("background-opacity"),y=n.paint.get("background-emissive-strength"),M=n.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const P=l.context,D=P.gl,R=l.transform,F=R.tileSize,N=n.paint.get("background-pattern");let G;if(N!==void 0&&(N===null||(G=l.imageManager.getPattern(N.toString(),n.scope,l.style.getLut(n.scope)),!G)))return;const X=!N&&f.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==X)return;const W=vi.disabled,K=l.depthModeForSublayer(0,X==="opaque"?oi.ReadWrite:oi.ReadOnly),Y=l.colorModeForDrapableLayerRenderPass(y),te=N?"backgroundPattern":"background";let re,le=c;if(le||(re=l.getBackgroundTiles(),le=Object.values(re).map(fe=>fe.tileID)),N&&(P.activeTexture.set(D.TEXTURE0),l.imageManager.bind(l.context,n.scope)),M){const fe=l.getOrCreateProgram(te,{overrideFog:!1,overrideRtt:!0}),me=new Float32Array(o.a6.mat4.identity([])),de=new o.aA(0,0,0,0,0),ge=N?xu(me,y,_,l,0,n.scope,G,M,{tileID:de,tileSize:F}):Cl(me,y,_,f.toRenderColor(n.lut));fe.draw(l,D.TRIANGLES,K,W,Y,di.disabled,ge,n.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const fe of le){const me=l.isTileAffectedByFog(fe),de=l.getOrCreateProgram(te,{overrideFog:me}),ge=fe.toUnwrapped(),Te=c?fe.projMatrix:l.transform.calculateProjMatrix(ge);l.prepareDrawTile();const Ce=t?t.getTile(fe):re?re[fe.key]:new Es(fe,F,R.zoom,l),Ae=N?xu(Te,y,_,l,0,n.scope,G,M,{tileID:fe,tileSize:F}):Cl(Te,y,_,f.toRenderColor(n.lut));l.uploadCommonUniforms(P,de,ge);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Ge,tileBoundsSegments:Ye}=l.getTileBoundsBuffers(Ce);de.draw(l,D.TRIANGLES,K,W,Y,di.disabled,Ae,n.id,Ee,Ge,Ye)}},sky:function(l,t,n){const c=l._atmosphere?o.a9(l.transform.zoom):1,f=n.paint.get("sky-opacity")*c;if(f===0)return;const _=l.context,y=n.paint.get("sky-type"),M=new oi(_.gl.LEQUAL,oi.ReadOnly,[0,1]),P=l.frameCounter/1e3%1;y==="atmosphere"?l.renderPass==="offscreen"?n.needsSkyboxCapture(l)&&(function(D,R,F,N){const G=D.context,X=G.gl;let W=R.skyboxFbo;if(!W){W=R.skyboxFbo=G.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new Kf(G),R.skyboxTexture=G.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,R.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let re=0;re<6;++re)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(W.framebuffer),G.viewport.set([0,0,32,32]);const K=R.getCenter(D,!0),Y=D.getOrCreateProgram("skyboxCapture"),te=new Float64Array(16);o.a6.mat4.identity(te),o.a6.mat4.rotateY(te,te,.5*-Math.PI),Mo(D,R,Y,te,K,0),o.a6.mat4.identity(te),o.a6.mat4.rotateY(te,te,.5*Math.PI),Mo(D,R,Y,te,K,1),o.a6.mat4.identity(te),o.a6.mat4.rotateX(te,te,.5*-Math.PI),Mo(D,R,Y,te,K,2),o.a6.mat4.identity(te),o.a6.mat4.rotateX(te,te,.5*Math.PI),Mo(D,R,Y,te,K,3),o.a6.mat4.identity(te),Mo(D,R,Y,te,K,4),o.a6.mat4.identity(te),o.a6.mat4.rotateY(te,te,Math.PI),Mo(D,R,Y,te,K,5),G.viewport.set([0,0,D.width,D.height])}(l,n),n.markSkyboxValid(l)):l.renderPass==="sky"&&function(D,R,F,N,G){const X=D.context,W=X.gl,K=D.transform,Y=D.getOrCreateProgram("skybox");X.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture);const te=((re,le,fe,me,de)=>({u_matrix:re,u_sun_direction:le,u_cubemap:0,u_opacity:me,u_temporal_offset:de}))(K.skyboxMatrix,R.getCenter(D,!1),0,N,G);D.uploadCommonUniforms(X,Y),Y.draw(D,W.TRIANGLES,F,vi.disabled,D.colorModeForRenderPass(),di.backCW,te,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,n,M,f,P):y==="gradient"&&l.renderPass==="sky"&&function(D,R,F,N,G){const X=D.context,W=X.gl,K=D.transform,Y=D.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Kf(X)),X.activeTexture.set(W.TEXTURE0);let te=R.colorRampTexture;te||(te=R.colorRampTexture=new o.T(X,R.colorRamp,W.RGBA8)),te.bind(W.LINEAR,W.CLAMP_TO_EDGE);const re=((le,fe,me,de,ge)=>({u_matrix:le,u_color_ramp:0,u_center_direction:fe,u_radius:o.bC(me),u_opacity:de,u_temporal_offset:ge}))(K.skyboxMatrix,R.getCenter(D,!1),R.paint.get("sky-gradient-radius"),N,G);D.uploadCommonUniforms(X,Y),Y.draw(D,W.TRIANGLES,F,vi.disabled,D.colorModeForRenderPass(),di.backCW,re,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,n,M,f,P)},debug:function(l,t,n,c,f,_){for(let y=0;y<n.length;y++)if(f){const D=new o.bA(c.r*.8,c.g*.8,c.b*.8,1);Bn(l,t,n[y],c,-1,-1,_),Bn(l,t,n[y],c,-1,1,_),Bn(l,t,n[y],c,1,1,_),Bn(l,t,n[y],c,1,-1,_),Bn(l,t,n[y],D,0,0,_)}else Bn(l,t,n[y],c,0,0,_)},custom:function(l,t,n,c){const f=l.context,_=n.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&n.isDraped(t)){if(l.renderPass==="offscreen"){const y=_.prerender;if(y){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const M=l.transform.pointMerc;y.call(_,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.a9(l.transform.zoom),[M.x,M.y],l.transform.pixelsPerMeterRatio)}else y.call(_,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const M=_.renderToTile;if(M){const P=c[0].canonical,D=new o.a5(P.x+c[0].wrap*(1<<P.z),P.y,P.z);f.setDepthMode(oi.disabled),f.setStencilMode(vi.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),M.call(_,f.gl,D),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(vi.disabled);const y=_.renderingMode==="3d"?new oi(l.context.gl.LEQUAL,oi.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,oi.ReadOnly);if(f.setDepthMode(y),l.transform.projection.name==="globe"){const M=l.transform.pointMerc;_.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.a9(l.transform.zoom),[M.x,M.y],l.transform.pixelsPerMeterRatio)}else _.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,n,c){if(l.renderPass==="opaque")return;const f=n.paint.get("model-opacity");if(f===0)return;const _=n.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!_||l.terrain&&f<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof o.a4))return;const y=l.shadowRenderer,M=n.paint.get("model-receive-shadows");y&&(y.useNormalOffset=!0,M||(y.enabled=!1));const P=()=>{y&&(y.useNormalOffset=!0,M||(y.enabled=!0))},D=t.getSource();if(l.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(Y,te,re,le,fe){const me=Y.transform;if(me.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${me.projection.name} projection is not yet implemented`);const de=me.getFreeCameraOptions().position;if(!Y.modelManager)return;const ge=Y.modelManager;re.modelManager=ge;const Te=Y.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ce=re._unevaluatedLayout._values["model-id"],Ae={...re.layout.get("model-id").parameters},Ee=Y.style.order.indexOf(re.fqid);for(const Ge of le){const Ye=te.getTile(Ge).getBucket(re);if(!Ye||Ye.projection.name!==me.projection.name)continue;const at=Ye.getModelUris();at&&!Ye.modelsRequested&&(ge.addModelsFromBucket(at,fe),Ye.modelsRequested=!0);const _t=_o(Ge,me);Ae.zoom=_t;const bt=Ce.possiblyEvaluate(Ae);if(Rh(Y,Ye,Ge),zs.shadowUniformsInitialized=!1,zs.useSingleShadowCascade=!!Te&&Te.getMaxCascadeForTile(Ge.toUnwrapped())===0,Y.renderPass==="shadow"&&Te){if(Y.currentShadowCascade===1&&Ye.isInsideFirstShadowMapFrustum)continue;const $e=me.calculatePosMatrix(Ge.toUnwrapped(),me.worldSize);if(zs.tileMatrix.set($e),zs.shadowTileMatrix=Float32Array.from(Te.calculateShadowPassMatrixFromMatrix($e)),zs.aabb.min.fill(0),zs.aabb.max[0]=zs.aabb.max[1]=o.ab,zs.aabb.max[2]=0,Nn(Ye,zs,Y,re.scope))continue}const ke=1<<Ge.canonical.z,rt=[((de.x-Ge.wrap)*ke-Ge.canonical.x)*o.ab,(de.y*ke-Ge.canonical.y)*o.ab,de.z*ke*o.ab];Y.conflationActive&&Object.keys(Ye.instancesPerModel).length>0&&Y.style.isLayerClipped(re,te.getSource())&&Ye.updateReplacement(Ge,Y.replacementSource,Ee,fe)&&(Ye.uploaded=!1,Ye.upload(Y.context));for(let $e in Ye.instancesPerModel){const nt=Ye.instancesPerModel[$e];nt.features.length>0&&($e=bt.evaluate(nt.features[0].feature,{}));const lt=ge.getModel($e,fe);if(lt&&lt.uploaded)for(const ot of lt.nodes)ed(Y,re,ot,nt,rt,Ge,zs)}}}(l,t,n,c,D.type==="vector"?n.scope:""),void P();if(!D.loaded())return;if(D.type==="batched-model")return function(Y,te,re,le){re.resetLayerRenderingStats(Y);const fe=Y.context,me=Y.transform,de=Y.style.fog,ge=Y.shadowRenderer;if(me.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${me.projection.name} projection is not yet implemented`);const Te=Y.transform.getFreeCameraOptions().position,Ce=o.a6.vec3.scale([],[Te.x,Te.y,Te.z],Y.transform.worldSize),Ae=o.a6.vec3.negate([],Ce),Ee=o.a6.mat4.identity([]),Ge=o.de(me.center.lat,me.zoom),Ye=o.a6.mat4.fromScaling([],[1,1,1/Ge]);o.a6.mat4.translate(Ee,Ee,Ae);const at=re.paint.get("model-opacity"),_t=new oi(fe.gl.LEQUAL,oi.ReadWrite,Y.depthRangeFor3D),bt=new oi(fe.gl.LEQUAL,oi.ReadOnly,Y.depthRangeFor3D),ke=new o.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),rt=Y.renderPass==="shadow",$e=rt&&ge?ge.getCurrentCascadeFrustum():me.getFrustum(me.scaleZoom(me.worldSize)),nt=re.paint.get("model-front-cutoff"),lt=nt[2]<1,ot=va(Y,re.paint.get("model-cutoff-fade-range")),St=re.getLayerRenderingStats();(function(Wt,ti,kt,Kt){const zt=Wt.terrain?Wt.terrain.exaggeration():0,ai=Wt.transform.zoom;for(const Si of Kt){const Ui=ti.getTile(Si).getBucket(kt);Ui&&(Wt.conflationActive&&Ui.updateReplacement(Si,Wt.replacementSource),Ui.evaluateScale(Wt,kt),Wt.terrain&&zt>0&&Ui.elevationUpdate(Wt.terrain,zt,Si,kt.source),Ui.needsReEvaluation(Wt,ai,kt)&&Ui.evaluate(kt))}})(Y,te,re,le),function(){let Wt,ti,kt;lt?(Wt=le.length-1,ti=-1,kt=-1):(Wt=0,ti=le.length,kt=1);const Kt=new Float64Array(16),zt=o.a6.vec3.create(),ai=new o.P(0,0);for(let Si=Wt;Si!==ti;Si+=kt){const Ui=le[Si],Mn=te.getTile(Ui).getBucket(re);if(!Mn||!Mn.uploaded)continue;let en=!1;ge&&(en=ge.getMaxCascadeForTile(Ui.toUnwrapped())===0);const kn=me.calculatePosMatrix(Ui.toUnwrapped(),me.worldSize),ln=Mn.modelTraits;!rt&&lt&&(o.a6.mat4.invert(Kt,kn),o.a6.vec3.transformMat4(zt,Ce,Kt),ai.x=zt[0],ai.y=zt[1]);const In=[];for(const Fi of Mn.getNodesInfo()){if(Fi.hiddenByReplacement||!Fi.node.meshes)continue;const An=Fi.node;let bn=0;Y.terrain&&An.elevation&&(bn=An.elevation*Y.terrain.exaggeration());const hn=(()=>{const or=Fi.aabb;return ke.min=[...or.min],ke.max=[...or.max],ke.min[2]+=bn,ke.max[2]+=bn,o.a6.vec3.transformMat4(ke.min,ke.min,kn),o.a6.vec3.transformMat4(ke.max,ke.max,kn),ke})(),Un=Fi.evaluatedScale;if(Un[0]<=1&&Un[1]<=1&&Un[2]<=1&&hn.intersects($e)===0)continue;if(!rt&&lt){const or=.16666666666666666;Fi.cameraCollisionOpacity=Ce[0]>hn.min[0]&&Ce[0]<hn.max[0]&&Ce[1]>hn.min[1]&&Ce[1]<hn.max[1]&&Ce[2]*Ge<hn.max[2]&&An.footprint&&o.bv(ai,An.footprint)?Math.max(Fi.cameraCollisionOpacity-or,0):Math.min(1,Fi.cameraCollisionOpacity+or)}const gr=[...kn],ko=An.anchor?An.anchor[0]:0,us=An.anchor?An.anchor[1]:0;o.a6.mat4.translate(gr,gr,[ko*(Un[0]-1),us*(Un[1]-1),bn]),o.a6.vec3.exactEquals(Un,o.dh)||o.a6.mat4.scale(gr,gr,Un);const kr=o.a6.mat4.multiply([],gr,An.matrix),Xi=o.a6.mat4.multiply([],me.expandedFarZProjMatrix,kr),Vi=o.a6.mat4.multiply([],me.expandedFarZProjMatrix,gr),cn=o.a6.vec4.transformMat4([],[ko,us,bn,1],Xi)[2];An.hidden=!1;let Rn=at;rt||(lt&&(Rn*=Fi.cameraCollisionOpacity,Rn*=td(gr,me,Fi.aabb,nt)),Rn*=on(ot,cn)),Rn!==0?In.push({nodeInfo:Fi,depth:cn,opacity:Rn,wvpForNode:Xi,wvpForTile:Vi,nodeModelMatrix:kr,tileModelMatrix:gr}):An.hidden=!0}rt||In.sort((Fi,An)=>!lt||Fi.opacity===1&&An.opacity===1?Fi.depth<An.depth?-1:1:Fi.opacity===1?-1:An.opacity===1?1:Fi.depth>An.depth?-1:1);for(const Fi of In){const An=Fi.nodeInfo,bn=An.node;let hn=o.a6.mat4.multiply([],Ye,Fi.tileModelMatrix);o.a6.mat4.multiply(hn,Ee,hn);const Un=o.a6.mat4.invert([],hn);o.a6.mat4.transpose(Un,Un),o.a6.mat4.scale(Un,Un,Ka),hn=o.a6.mat4.multiply(hn,hn,bn.matrix);const gr=Y.renderPass==="light-beam",ko=ln&o.dj.HasMapboxMeshFeatures,us=ko?0:An.evaluatedRMEA[0][2];for(let kr=0;kr<bn.meshes.length;++kr){const Xi=bn.meshes[kr],Vi=kr===bn.lightMeshIndex;let cn=Fi.wvpForNode;if(Vi){if(!gr&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}cn=Fi.wvpForTile}else if(gr)continue;const Rn={defines:[]},or=[];if(!rt&&ge&&(ge.useNormalOffset=!!Xi.normalBuffer),Ch(Rn.defines,or,Xi,Y,re.lut),ko||Rn.defines.push("DIFFUSE_SHADED"),en&&Rn.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(rt?St.numRenderedVerticesInShadowPass+=Xi.vertexArray.length:St.numRenderedVerticesInTransparentPass+=Xi.vertexArray.length),rt){Ph(Xi,Fi.nodeModelMatrix,Y,re);continue}let $n=null;if(de){const Ns=Qf(Fi.nodeModelMatrix,Y.transform);if($n=new Float32Array(Ns),me.projection.name!=="globe"){const Co=Xi.aabb.min,Ra=Xi.aabb.max,[fs,gn]=de.getOpacityForBounds(Ns,Co[0],Co[1],Ra[0],Ra[1]);Rn.overrideFog=fs>=gt||gn>=gt}}const $r=Xi.material;let aa;$r.occlusionTexture&&$r.occlusionTexture.offsetScale&&(aa=$r.occlusionTexture.offsetScale,Rn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const dr=Y.getOrCreateProgram("model",Rn);!rt&&ge&&ge.setupShadowsFromMatrix(Fi.tileModelMatrix,dr,ge.useNormalOffset),Y.uploadCommonUniforms(fe,dr,null,$n);const Fo=$r.pbrMetallicRoughness;Fo.metallicFactor=.9,Fo.roughnessFactor=.5;const hs=wh(new Float32Array(cn),new Float32Array(hn),new Float32Array(Un),new Float32Array(bn.matrix),Y,Fi.opacity,Fo.baseColorFactor.toRenderColor(null),$r.emissiveFactor,Fo.metallicFactor,Fo.roughnessFactor,$r,us,re,[0,0,0],aa);!Vi&&(An.hasTranslucentParts||Fi.opacity<1)&&dr.draw(Y,fe.gl.TRIANGLES,_t,vi.disabled,Oi.disabled,di.backCCW,hs,re.id,Xi.vertexBuffer,Xi.indexBuffer,Xi.segments,re.paint,Y.transform.zoom,void 0,or),dr.draw(Y,fe.gl.TRIANGLES,Vi?bt:_t,vi.disabled,Vi||Fi.opacity<1||An.hasTranslucentParts?Oi.alphaBlended:Oi.unblended,di.backCCW,hs,re.id,Xi.vertexBuffer,Xi.indexBuffer,Xi.segments,re.paint,Y.transform.zoom,void 0,or)}}}}()}(l,t,n,c),void P();if(D.type!=="model")return;const R=D.getModels(),F=[],N=l.transform.getFreeCameraOptions().position,G=o.a6.vec3.scale([],[N.x,N.y,N.z],l.transform.worldSize);o.a6.vec3.negate(G,G);const X=[],W=[];let K=0;for(const Y of R){const te=n.paint.get("model-rotation").constantOr(null),re=n.paint.get("model-scale").constantOr(null),le=n.paint.get("model-translation").constantOr(null);Y.computeModelMatrix(l,te,re,le,!0,!0,!1);const fe=o.a6.mat4.identity([]),me=o.de(Y.position.lat,l.transform.zoom),de=o.a6.mat4.fromScaling([],[1,1,1/me]);o.a6.mat4.translate(fe,fe,G),F.push({zScaleMatrix:de,negCameraPosMatrix:fe});for(const ge of Y.nodes)Ll(l.transform,ge,Y.matrix,l.transform.expandedFarZProjMatrix,K,X,W);K++}if(X.sort((Y,te)=>te.depth-Y.depth),l.renderPass!=="shadow"){if(f===1)for(const Y of W)Ya(Y,l,n,F[Y.modelIndex],vi.disabled,l.colorModeForRenderPass());else{for(const Y of W)Ya(Y,l,n,F[Y.modelIndex],vi.disabled,Oi.disabled);for(const Y of W)Ya(Y,l,n,F[Y.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const Y of X)Ya(Y,l,n,F[Y.modelIndex],vi.disabled,l.colorModeForRenderPass());P()}else{for(const Y of W)Ph(Y.mesh,Y.nodeModelMatrix,l,n);for(const Y of X)Ph(Y.mesh,Y.nodeModelMatrix,l,n);P()}}},Os={model:function(l,t,n){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,c.type==="vector"?l.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const f=c.getModels();for(const _ of f)_.upload(n.context)},raster:function(l,t,n){const c=t.getSource();if(!(c instanceof Ts&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const _=l.paint.get("raster-array-band")||c.getInitialBand(f);if(_==null)return;const y=t.getIds().map(M=>t.getTileByID(M));for(const M of y)M.updateNeeded(f,_)&&c.prepareTile(M,f,_)},"raster-particle":function(l,t,n){const c=t.getSource();if(!(c instanceof Ts&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const _=l.paint.get("raster-particle-array-band")||c.getInitialBand(f);if(_==null)return;const y=t.getIds().map(M=>t.getTileByID(M));for(const M of y)M.updateNeeded(f,_)&&c.prepareTile(M,f,_)}};class Qa{constructor(t,n,c,f,_){this.context=new vu(t,n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const y=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of y)this._debugParams.enabledLayers[P]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of y)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new gc(_),this.setup(),this.numSublayers=ho.maxUnderzooming+ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Kd(this),this._wireframeDebugCache=new Mu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,M,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=f}updateTerrain(t,n){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wa(this,t));const f=this._terrain;this.transform.elevation=c?f:null,f.update(t,this.transform,n),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,f]=n.getFovAdjustedRange(this.transform._fov);if(c>f)return void(this.transform.fogCullDistSq=null);const _=c+.78*(f-c);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Wa(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*o.q.devicePixelRatio,this.height=n*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,n=new o.a$;n.emplaceBack(0,0),n.emplaceBack(o.ab,0),n.emplaceBack(0,o.ab),n.emplaceBack(o.ab,o.ab),this.tileExtentBuffer=t.createVertexBuffer(n,o.b1.members),this.tileExtentSegments=o.b2.simpleSegment(0,0,4,2);const c=new o.a$;c.emplaceBack(0,0),c.emplaceBack(o.ab,0),c.emplaceBack(0,o.ab),c.emplaceBack(o.ab,o.ab),this.debugBuffer=t.createVertexBuffer(c,o.b1.members),this.debugSegments=o.b2.simpleSegment(0,0,4,5);const f=new o.a$;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,o.b1.members),this.viewportSegments=o.b2.simpleSegment(0,0,4,2);const _=new o.aO;_.emplaceBack(0,0,0,0),_.emplaceBack(o.ab,0,o.ab,0),_.emplaceBack(0,o.ab,0,o.ab),_.emplaceBack(o.ab,o.ab,o.ab,o.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(_,o.b4.members),this.mercatorBoundsSegments=o.b2.simpleSegment(0,0,4,2);const y=new o.aP;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const M=new o.b0;for(const D of[0,1,3,2,0])M.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new o.T(t,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.a6.mat4.create();const P=this.context.gl;this.stencilClearMode=new vi({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,oi.disabled,this.stencilClearMode,Oi.disabled,di.disabled,gu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,c){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const P of c)if(this._tileClippingMaskIDs[P.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=n.id;const f=this.context,_=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(Oi.disabled),f.setDepthMode(oi.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of c){const P=n.getTile(M),D=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:F,tileBoundsSegments:N}=this.getTileBoundsBuffers(P);y.draw(this,_.TRIANGLES,oi.disabled,new vi({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),Oi.disabled,di.disabled,gu(M.projMatrix),"$clipping",R,F,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new vi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new vi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,c=t.sort((y,M)=>M.overscaledZ-y.overscaledZ),f=c[c.length-1].overscaledZ,_=c[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const y={};for(let M=0;M<_;M++)y[M+f]=new vi({func:n.GEQUAL,mask:255},M+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=_,[y,c]}return[{[f]:vi.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Oi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oi.unblended:Oi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Oi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new o.bA(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,c,f=!1){if(this.depthOcclusion)return new oi(this.context.gl.GREATER,oi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return oi.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new oi(c||this.context.gl.LEQUAL,n,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),c=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&c!==0&&(this.depthFBO=new Th(this.context,n,c,!1,"texture"),this.depthTexture=new o.T(this.context,{width:n,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,c,0,0,n,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const c=o.q.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const f=this.style._mergedLayers,_=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Ae=>{const Ee=f[Ae];return!(Ee.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ee.type]});let y=!1,M=!1;for(const Ae of _){const Ee=f[Ae];Ee.type==="circle"&&(y=!0),Ee.type==="symbol"&&(Ee.hasInitialOcclusionOpacityProperties?M=!0:y=!0)}const P=_.map(Ae=>f[Ae]),D=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let R=0,F=!1;for(const Ae in D){const Ee=D[Ae];Ee.used&&(Ee.prepare(this.context),Ee.getSource().usedInConflation&&++R)}let N=!1;for(const Ae of P)Ae.isHidden(this.transform.zoom)||(Ae.type==="clip"&&(N=!0),this.prepareLayer(Ae));const G={},X={},W={},K={},Y={};for(const Ae in D){const Ee=D[Ae];G[Ae]=Ee.getVisibleCoordinates(),X[Ae]=G[Ae].slice().reverse(),W[Ae]=Ee.getVisibleCoordinates(!0).reverse(),K[Ae]=Ee.getShadowCasterCoordinates(),Y[Ae]=Ee.sortCoordinatesByDistance(G[Ae])}const te=Ae=>{const Ee=this.style.getLayerSourceCache(Ae);return Ee&&Ee.used?Ee.getSource():null};if(R||N||this._clippingActiveLastFrame){const Ae=[],Ee=[];let Ge=0;for(const Ye of P)this.isSourceForClippingOrConflation(Ye,te(Ye))&&(Ae.push(Ye),Ee.push(Ge)),Ge++;if(Ae&&(N||Ae.length>1)||this._clippingActiveLastFrame){N=!1;const Ye=[];for(let at=0;at<Ae.length;at++){const _t=Ae[at],bt=Ee[at],ke=this.style.getLayerSourceCache(_t);if(!ke||!ke.used||!ke.getSource().usedInConflation&&_t.type!=="clip")continue;let rt=o.dn,$e=o.bt.None;const nt=[];let lt=!0;if(_t.type==="clip"){rt=bt;for(const ot of _t.layout.get("clip-layer-types"))$e|=ot==="model"?o.bt.Model:ot==="symbol"?o.bt.Symbol:o.bt.FillExtrusion;for(const ot of _t.layout.get("clip-layer-scope"))nt.push(ot);_t.isHidden(this.transform.zoom)?lt=!1:N=!0}lt&&Ye.push({layer:_t.fqid,cache:ke,order:rt,clipMask:$e,clipScope:nt})}this.replacementSource.setSources(Ye),F=!0}}this._clippingActiveLastFrame=N,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ae=0;Ae<P.length;Ae++){const Ee=P[Ae],Ge=Ee.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){const Ye=te(Ee);Ye&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom)),Ee.minzoom&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom))}Ee.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ae),this._lastOcclusionLayer=Ae)}const re=this.style&&this.style.fog;re?(this._fogVisible=re.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=re.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(W),this.opaquePassCutoff=0);const le=this._shadowRenderer;if(le){le.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ae in D)for(const Ee of G[Ae]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(Ee)||Ge),le.addShadowReceiver(Ee.toUnwrapped(),Ge.min,Ge.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!sn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ae of P){const Ee=t.getLayerSourceCache(Ae);if(!Ae.hasOffscreenPass()||Ae.isHidden(this.transform.zoom))continue;const Ge=Ee?X[Ee.id]:void 0;(Ae.type==="custom"||Ae.type==="raster"||Ae.type==="raster-particle"||Ae.isSky()||Ge&&Ge.length)&&this.renderLayer(this,Ee,Ae,Ge)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,K)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const fe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),me=(()=>{if(n.showOverdrawInspector)return o.bA.black;const Ae=this.style.fog;if(Ae&&this.transform.projection.supportsFog){const Ee=this.style.getLut(Ae.scope);if(!fe){const Ge=Ae.properties.get("color").toRenderColor(Ee).toArray01();return new o.bA(...Ge)}if(fe){const Ge=Ae.properties.get("space-color").toRenderColor(Ee).toArray01();return new o.bA(...Ge)}}return o.bA.transparent})();if(this.context.clear({color:me,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&fe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const Ae=P[this.currentLayer],Ee=t.getLayerSourceCache(Ae);if(Ae.isSky())continue;const Ge=Ee?(Ae.is3D()?Y:X)[Ee.id]:void 0;this._renderTileClippingMasks(Ae,Ee,Ge),this.renderLayer(this,Ee,Ae,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&fe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const Ae=P[this.currentLayer],Ee=t.getLayerSourceCache(Ae);Ae.isSky()&&this.renderLayer(this,Ee,Ae,Ee?X[Ee.id]:void 0)}function de(Ae,Ee){let Ge;return Ee&&(Ge=(Ae.type==="symbol"?W:Ae.is3D()?Y:X)[Ee.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){const Ae=P[this.currentLayer];if(Ae.type==="raster"||Ae.type==="raster-particle"){const Ee=t.getLayerSourceCache(Ae);this.renderLayer(this,Ee,Ae,de(Ae,Ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ge=0;le&&(ge=le.getShadowCastingLayerCount());let Te=!1,Ce=-1;for(let Ae=0;Ae<_.length;++Ae){const Ee=P[Ae];Ee.isHidden(this.transform.zoom)||Ee.is3D()&&(Ce=Ae)}for(M&&Ce===-1&&(y=!0);this.currentLayer<_.length;){const Ae=P[this.currentLayer],Ee=t.getLayerSourceCache(Ae);if(Ae.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ae)){if(Ae.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(y&&!Te&&this.terrain&&!this.transform.isOrthographic&&(Te=!0,this.blitDepth()),M&&Ce!==-1&&this.currentLayer===Ce+1&&!this.transform.isOrthographic&&this.blitDepth(),Ae.is3D()||this.terrain||this._renderTileClippingMasks(Ae,Ee,Ee?G[Ee.id]:void 0),this.renderLayer(this,Ee,Ae,de(Ae,Ee)),!this.terrain&&le&&ge>0&&Ae.hasShadowPass()&&--ge==0&&(le.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){const Ye=P[this.currentLayer];if(!Ye.hasLightBeamPass())continue;const at=t.getLayerSourceCache(Ye);this.renderLayer(this,at,Ye,at?X[at.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ge=this.currentLayer;this.depthOcclusion=!0;for(const Ye of this.layersWithOcclusionOpacity){this.currentLayer=Ye;const at=P[this.currentLayer],_t=t.getLayerSourceCache(at),bt=_t?X[_t.id]:void 0;at.is3D()||this.terrain||this._renderTileClippingMasks(at,_t,_t?G[_t.id]:void 0),this.renderLayer(this,_t,at,bt)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ae=null;P.forEach(Ee=>{const Ge=t.getLayerSourceCache(Ee);Ge&&!Ee.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!Ae||Ae.getSource().maxzoom<Ge.getSource().maxzoom)&&(Ae=Ge)}),Ae&&this.options.showTileBoundaries&&yc.debug(this,Ae,Ae.getVisibleCoordinates(),o.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&yc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ae){const Ee=Ae.transform.padding;Ve(Ae,Ae.transform.height-(Ee.top||0),3,cs),Ve(Ae,Ee.bottom||0,3,Pl),Su(Ae,Ee.left||0,3,ht),Su(Ae,Ae.transform.width-(Ee.right||0),3,ei);const Ge=Ae.transform.centerPoint;(function(Ye,at,_t,bt){Rl(Ye,at-1,_t-10,2,20,bt),Rl(Ye,at-10,_t-1,20,2,bt)})(Ae,Ge.x,Ae.transform.height-Ge.y,_c)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,c=!n||!n.includes(t.type);if(Os[t.type]&&(c||this.terrain&&t.type==="custom")){const f=this.style.getLayerSourceCache(t);Os[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,n,c,f){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||f&&f.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||yc[c.type](t,n,c,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,c=this.context.gl;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),f.calls++,c.beginQuery(n.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,c=n.createQuery();this.deferredRenderGpuTimeQueries.push(c),n.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const c in t){const f=t[c],_=this.context.extTimerQuery,y=_.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(f.query),n[c]=y}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let c=0;for(const f of t)c+=n.getQueryParameter(f,n.QUERY_RESULT)/1e6,n.deleteQuery(f);return c}translatePosMatrix(t,n,c,f,_){if(!c[0]&&!c[1])return t;const y=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(y){const D=Math.sin(y),R=Math.cos(y);c=[c[0]*R-c[1]*D,c[0]*D+c[1]*R]}const M=[_?c[0]:o.ak(n,c[0],this.transform.zoom),_?c[1]:o.ak(n,c[1],this.transform.zoom),0],P=new Float32Array(16);return o.a6.mat4.translate(P,t,M),P}saveTileTexture(t){const n=t.size[0],c=this._tileTextures[n];c?c.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,c){const f=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||f||n!==void 0&&!n||_.push("FOG","FOG_DITHERING"),f&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,n){this.cache=this.cache||{};const c=n&&n.defines||[],f=n&&n.config,_=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(c),y=Ta.cacheKey(Rs[t],t,_,f);return this.cache[y]||(this.cache[y]=new Ta(this.context,t,Rs[t],f,Xa[t],_)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const c=this.style.directionalLight,f=this.style.ambientLight;if(c&&f){const _=((y,M,P)=>{const D=y.properties.get("direction"),R=y.properties.get("color").toRenderColor(P.getLut(y.scope)).toArray01(),F=y.properties.get("intensity"),N=M.properties.get("color").toRenderColor(P.getLut(M.scope)).toArray01(),G=M.properties.get("intensity"),X=[D.x,D.y,D.z],W=o.cH(N,G),K=o.cH(R,F);return{u_lighting_ambient_color:W,u_lighting_directional_dir:X,u_lighting_directional_color:K,u_ground_radiance:fc(X,K,W)}})(c,f,this.style);n.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,n,c,f,_){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const M=y.getOpacity(this.transform.pitch),P=((D,R,F,N,G,X,W,K,Y,te,re,le)=>{const fe=D.transform,me=R.properties.get("color").toRenderColor(D.style.getLut(R.scope)).toArray01();me[3]=N;const de=D.frameCounter/1e3%1,[ge,Te]=R.properties.get("vertical-range");return{u_fog_matrix:F?fe.calculateFogTileMatrix(F):le||D.identityMat,u_fog_range:R.getFovAdjustedRange(fe._fov),u_fog_color:me,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,Te),Te],u_fog_temporal_offset:de,u_frustum_tl:G,u_frustum_tr:X,u_frustum_br:W,u_frustum_bl:K,u_globe_pos:Y,u_globe_radius:te,u_viewport:re,u_globe_transition:o.a9(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,y,c,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],f);n.setFogUniformValues(t,P)}_&&n.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const f of c)n[f.key]=t[f.key]||new Es(f,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=gt||n[1]>=gt}setupDepthForOcclusion(t,n,c){const f=this.context,_=f.gl,y=!!c;var M;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),f.activeTexture.set(_.TEXTURE0),y||n.setTerrainUniformValues(f,c)}}function ks(l,t){let n=!1,c=null;const f=()=>{c=null,n&&(l(),c=setTimeout(f,t),n=!1)};return()=>(n=!0,c||f(),c)}class an{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ks(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Cu(t);if(this._hashName){const c=this._hashName;let f=!1;const _=location.hash.slice(1).split("&").map(y=>{const M=y.split("=")[0];return M===c?(f=!0,`${M}=${n}`):y}).filter(y=>y);return f||_.push(`${c}=${n}`),`#${_.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(n=c)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Cu(l,t){const n=l.getCenter(),c=Math.round(100*l.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),y=Math.round(n.lng*_)/_,M=Math.round(n.lat*_)/_,P=l.getBearing(),D=l.getPitch();let R=t?`/${y}/${M}/${c}`:`${c}/${M}/${y}`;return(P||D)&&(R+="/"+Math.round(10*P)/10),D&&(R+=`/${Math.round(D)}`),R}const xc={linearity:.3,easing:o.dp(0,0,.3,1)},zl=o.l({deceleration:2500,maxSpeed:1400},xc),Dh=o.l({deceleration:20,maxSpeed:1400},xc),el=o.l({deceleration:1e3,maxSpeed:360},xc),id=o.l({deceleration:1e3,maxSpeed:90},xc);class Io{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=o.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)n.zoom+=_.zoomDelta||0,n.bearing+=_.bearingDelta||0,n.pitch+=_.pitchDelta||0,_.panDelta&&n.pan._add(_.panDelta),_.around&&(n.around=_.around),_.pinchAround&&(n.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(n.pan.mag()){const _=Ma(n.pan.mag(),c,o.l({},zl,t||{}));f.offset=n.pan.mult(_.amount/n.pan.mag()),f.center=this._map.transform.center,vc(f,_)}if(n.zoom){const _=Ma(n.zoom,c,Dh);f.zoom=this._map.transform.zoom+_.amount,vc(f,_)}if(n.bearing){const _=Ma(n.bearing,c,el);f.bearing=this._map.transform.bearing+o.ap(_.amount,-179,179),vc(f,_)}if(n.pitch){const _=Ma(n.pitch,c,id);f.pitch=this._map.transform.pitch+_.amount,vc(f,_)}if(f.zoom||f.bearing){const _=n.pinchAround===void 0?n.around:n.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function vc(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ma(l,t,n){const{maxSpeed:c,linearity:f,deceleration:_}=n,y=o.ap(l*f/(t/1e3),-c,c),M=Math.abs(y)/(_*f);return{easing:n.easing,duration:1e3*M,amount:y*(M/2)}}class qn extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c,f={}){const _=cr(n.getCanvasContainer(),c),y=n.unproject(_);super(t,o.l({point:_,lngLat:y,originalEvent:c},f)),this._defaultPrevented=!1,this.target=n}}class Ol extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c){const f=t==="touchend"?c.changedTouches:c.touches,_=Xr(n.getCanvasContainer(),f),y=_.map(P=>n.unproject(P)),M=_.reduce((P,D,R,F)=>P.add(D.div(F.length)),new o.P(0,0));super(t,{points:_,point:M,lngLats:y,lngLat:n.unproject(M),originalEvent:c}),this._defaultPrevented=!1}}class Lh extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class lo{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Lh(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new qn(t.type,this._map,t))}mouseup(t){this._map.fire(new qn(t.type,this._map,t))}preclick(t){const n=o.l({},t);n.type="preclick",this._map.fire(new qn(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new qn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new qn(t.type,this._map,t))}mouseover(t){this._map.fire(new qn(t.type,this._map,t))}mouseout(t){this._map.fire(new qn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ol(t.type,this._map,t))}touchmove(t){this._map.fire(new Ol(t.type,this._map,t))}touchend(t){this._map.fire(new Ol(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ol(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new qn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new qn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(At(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const c=n,f=this._startPos,_=this._lastPos;if(!f||!_||_.equals(c)||!this._box&&c.dist(f)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=It("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(f.x,c.x),M=Math.max(f.x,c.x),P=Math.min(f.y,c.y),D=Math.max(f.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${P}px)`,this._box.style.width=M-y+"px",this._box.style.height=D-P+"px")})}mouseupWindow(t,n){if(!this._active)return;const c=this._startPos,f=n;if(c&&t.button===0){if(this.reset(),Ut(),c.x!==f.x||c.y!==f.y)return this._map.fire(new o.x("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ri(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new o.x(t,{originalEvent:n}))}}function Ru(l,t){const n={};for(let c=0;c<l.length;c++)n[l[c].identifier]=t[c];return n}class Du{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(f){const _=new o.P(0,0);for(const y of f)_._add(y);return _.div(f.length)}(n),this.touches=Ru(c,n)))}touchmove(t,n,c){if(this.aborted||!this.centroid)return;const f=Ru(c,n);for(const _ in this.touches){const y=f[_];(!y||y.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,n,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class bc{constructor(t){this.singleTap=new Du(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,c){this.singleTap.touchstart(t,n,c)}touchmove(t,n,c){this.singleTap.touchmove(t,n,c)}touchend(t,n,c){const f=this.singleTap.touchend(t,n,c);if(f){const _=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(f)<30;if(_&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Lu{constructor(){this._zoomIn=new bc({numTouches:1,numTaps:2}),this._zoomOut=new bc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,c){this._zoomIn.touchstart(t,n,c),this._zoomOut.touchstart(t,n,c)}touchmove(t,n,c){this._zoomIn.touchmove(t,n,c),this._zoomOut.touchmove(t,n,c)}touchend(t,n,c){const f=this._zoomIn.touchend(t,n,c),_=this._zoomOut.touchend(t,n,c);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(f)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wc={0:1,2:2};class kl{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const c=li(t);this._correctButton(t,c)&&(this._lastPoint=n,this._eventButton=c)}mousemoveWindow(t,n){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(f,_){const y=wc[_];return f.buttons===void 0||(f.buttons&y)!==y}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(c,n)}}mouseupWindow(t){this._lastPoint&&li(t)===this._eventButton&&(this._moved&&Ut(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tc extends kl{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Fs extends kl{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const c=.8*(n.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class zh extends kl{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const c=-.5*(n.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class Ia{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),o.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,n,c){return this._calculateTransform(t,n,c)}touchmove(t,n,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!o.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,c)}}touchend(t,n,c){this._calculateTransform(t,n,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,c){c.length>0&&(this._active=!0);const f=Ru(c,n),_=new o.P(0,0),y=new o.P(0,0);let M=0;for(const D in f){const R=f[D],F=this._touches[D];F&&(_._add(R),y._add(R.sub(F)),M++,f[D]=R)}if(this._touches=f,M<this._minTouches||!y.mag())return;const P=y.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(M),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=It("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class zu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,c){return{}}touchstart(t,n,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,c){const f=this._firstTwoTouches;if(!f)return;t.preventDefault();const[_,y]=f,M=Sc(c,n,_),P=Sc(c,n,y);if(!M||!P)return;const D=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],D,t)}touchend(t,n,c){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,y=Sc(c,n,f),M=Sc(c,n,_);y&&M||(this._active&&Ut(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sc(l,t,n){for(let c=0;c<l.length;c++)if(l[c].identifier===n)return t[c]}function Ou(l,t){return Math.log(l/t)/Math.LN2}class sp extends zu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,c),pinchAround:n}}}function nd(l,t){return 180*l.angleWith(t)/Math.PI}class ap extends zu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:nd(this._vector,c),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const f=nd(t,c);return Math.abs(f)<n}}function ku(l){return Math.abs(l.y)>Math.abs(l.x)}class rd extends zu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ku(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,c){const f=this._lastPoints;if(!f)return;const _=t[0].sub(f[0]),y=t[1].sub(f[1]);return this._map._cooperativeGestures&&!o.dq()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(_,y,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+y.y)/2*-.5})}gestureBeginsVertically(t,n,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,_=n.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const y=t.y>0==n.y>0;return ku(t)&&ku(n)&&y}}const lp={panStep:100,bearingStep:15,pitchStep:10};class od{constructor(){const t=lp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,c=0,f=0,_=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:sd,zoom:n?Math.round(P)+n*(t.shiftKey?2:1):P,bearing:M.getBearing()+c*this._bearingStep,pitch:M.getPitch()+f*this._pitchStep,offset:[-_*this._panStep,-y*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sd(l){return l*(2-l)}const go=4.000244140625,ia=1/450;class mm{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ia,o.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=o.q.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,n!==0&&n%go==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=cr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>go?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&R!==0&&(R=1/R);const F=n(),N=Math.pow(2,F),G=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(G*R))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:n(),f=this._startZoom,_=this._easing;let y,M=!1;if(this._type==="wheel"&&f&&_){const D=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),R=_(D);y=o.aa(f,c,R),D<1?this._frameId||(this._frameId=!0):M=!0}else y=c,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=y-n();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=o.dr;if(this._prevEase){const c=this._prevEase,f=(o.q.now()-c.start)/c.duration,_=c.easing(f+.01)-c.easing(f),y=.27/Math.sqrt(_*_+1e-4)*.01,M=Math.sqrt(.0729-y*y);n=o.dp(y,M,.25,1)}return this._prevEase={start:o.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=It("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rr{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ec{constructor(){this._tap=new bc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=n[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,n,c))}touchmove(t,n,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=n[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,n,c)}touchend(t,n,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,n,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cp{constructor(t,n,c){this._el=t,this._mousePan=n,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ac{constructor(t,n,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class up{constructor(t,n,c,f){this._el=t,this._touchZoom=n,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fl=l=>l.zoom||l.drag||l.pitch||l.rotate;class Ca extends o.x{}class Xo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const c=o.a6.vec3.sub([],n,t);this.radius=o.a6.vec3.length(c[2]<0?o.a6.vec3.div([],c,this.constants):[c[0],c[1],0])}projectRay(t){o.a6.vec3.div(t,t,this.constants),o.a6.vec3.normalize(t,t),o.a6.vec3.mul(t,t,this.constants);const n=o.a6.vec3.scale([],t,this.radius);if(n[2]>0){const c=o.a6.vec3.scale([],[0,0,1],o.a6.vec3.dot(n,[0,0,1])),f=o.a6.vec3.scale([],o.a6.vec3.normalize([],[n[0],n[1],0]),this.radius),_=o.a6.vec3.add([],n,o.a6.vec3.scale([],o.a6.vec3.sub([],o.a6.vec3.add([],f,c),n),2));n[0]=_[0],n[1]=_[1]}return n}}function Bl(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Er{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Io(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),o.aJ(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,y]of this._listeners){const M=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(_,M,y)}}destroy(){for(const[t,n,c]of this._listeners){const f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,f,c)}}_addDefaultHandlers(t){const n=this._map,c=n.getCanvasContainer();this._add("mapEvent",new lo(n,t));const f=n.boxZoom=new Pu(n,t);this._add("boxZoom",f);const _=new Lu,y=new Fu;n.doubleClickZoom=new rr(y,_),this._add("tapZoom",_),this._add("clickZoom",y);const M=new Ec;this._add("tapDragZoom",M);const P=n.touchPitch=new rd(n);this._add("touchPitch",P);const D=new Fs(t),R=new zh(t);n.dragRotate=new Ac(t,D,R),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const F=new Tc(t),N=new Ia(n,t);n.dragPan=new cp(c,F,N),this._add("mousePan",F),this._add("touchPan",N,["touchZoom","touchRotate"]);const G=new ap,X=new sp;n.touchZoomRotate=new up(c,X,G,M),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oo(n));const W=n.scrollZoom=new mm(n,this);this._add("scrollZoom",W,["mousePan"]);const K=n.keyboard=new od;this._add("keyboard",K);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&n[Y].enable(t[Y])}_add(t,n,c){this._handlers.push({handlerName:t,handler:n,allowed:c}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,c){for(const f in t)if(f!==c&&(!n||n.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const c of t)this._el.contains(c.target)&&n.push(c);return n}handleEvent(t,n){this._updatingCamera=!0;const c=t.type==="renderFrame",f=c?void 0:t,_={needsRenderFrame:!1},y={},M={},P=t.touches?this._getMapTouches(t.touches):void 0,D=P?Xr(this._el,P):c?void 0:cr(this._el,t);for(const{handlerName:N,handler:G,allowed:X}of this._handlers){if(!G.isEnabled())continue;let W;this._blockedByActive(M,X,N)?G.reset():G[n||t.type]&&(W=G[n||t.type](t,D,P),this.mergeHandlerResult(_,y,W,N,f),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||G.isActive())&&(M[N]=G)}const R={};for(const N in this._previousActiveHandlers)M[N]||(R[N]=f);this._previousActiveHandlers=M,(Object.keys(R).length||Bl(_))&&(this._changes.push([_,y,R]),this._triggerRenderFrame()),(Object.keys(M).length||Bl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=_;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,n,c,f,_){if(!c)return;o.l(t,c);const y={handlerName:f,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(n.zoom=y),c.panDelta!==void 0&&(n.drag=y),c.pitchDelta!==void 0&&(n.pitch=y),c.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const t={},n={},c={};for(const[f,_,y]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),o.l(n,_),o.l(c,y);this._updateMapTransform(t,n,c),this._changes=[]}_updateMapTransform(t,n,c){const f=this._map,_=f.transform,y=te=>[te.x,te.y,te.z];if((te=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Bl(t)){const te=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),te!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&f._stop(!0),!Bl(t))return void this._fireEvents(n,c,!0);let{panDelta:M,zoomDelta:P,bearingDelta:D,pitchDelta:R,around:F,aroundCoord:N,pinchAround:G}=t;_._isCameraConstrained&&(P>0&&(P=0),_._isCameraConstrained=!1),G!==void 0&&(F=G),(P||(te=>n[te]&&!this._eventsInProgress[te])("drag"))&&F&&(this._dragOrigin=y(_.pointCoordinate3D(F)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",f._stop(!0),F=F||f.transform.centerPoint,D&&(_.bearing+=D),R&&(_.pitch+=R),_._updateCameraState();const X=[0,0,0];if(M)if(_.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F).dir),re=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F.sub(M)).dir);X[0]=re[0]-te[0],X[1]=re[1]-te[1]}else{const te=_.pointCoordinate(F);if(_.projection.name==="globe"){M=M.rotate(-_.angle);const re=_._pixelsPerMercatorPixel/_.worldSize;X[0]=-M.x*o.ds(o.aN(te.y))*re,X[1]=-M.y*o.ds(_.center.lat)*re}else{const re=_.pointCoordinate(F.sub(M));te&&re&&(X[0]=re.x-te.x,X[1]=re.y-te.y)}}const W=_.zoom,K=[0,0,0];if(P){const te=y(N||_.pointCoordinate3D(F)),re={dir:o.a6.vec3.normalize([],o.a6.vec3.sub([],te,_._camera.position))};if(re.dir[2]<0){const le=_.zoomDeltaToMovement(te,P);o.a6.vec3.scale(K,re.dir,le)}}const Y=o.a6.vec3.add(X,X,K);_._translateCameraConstrained(Y),P&&Math.abs(_.zoom-W)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,c,!0)}_fireEvents(t,n,c){const f=Fl(this._eventsInProgress),_=Fl(t),y={};for(const R in t){const{originalEvent:F}=t[R];this._eventsInProgress[R]||(y[`${R}start`]=F),this._eventsInProgress[R]=t[R]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in y)this._fireEvent(R,y[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:F}=t[R];this._fireEvent(R,F)}const M={};let P;for(const R in this._eventsInProgress){const{handlerName:F,originalEvent:N}=this._eventsInProgress[R];this._handlersById[F].isActive()||(delete this._eventsInProgress[R],P=n[F]||N,M[`${R}end`]=P)}for(const R in M)this._fireEvent(R,M[R]);const D=Fl(this._eventsInProgress);if(c&&(f||_)&&!D){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;R?(F(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:P})):(this._map.fire(new o.x("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new o.x(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Ca("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mc extends o.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,o.aJ(["_renderFrameCallback"],this)}getCenter(){return new o.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,c){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.l({offset:t},n),c)}panTo(t,n,c){return this.easeTo(o.l({center:t},n),c)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,c){return this.easeTo(o.l({zoom:t},n),c)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,c){return this.easeTo(o.l({bearing:t},n),c)}resetNorth(t,n){return this.rotateTo(0,o.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=o.as.convert(t);const c=n&&n.bearing||0,f=n&&n.pitch||0,_=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,_,y,c,f,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?o.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:o.l({},n,t)}_extendCameraOptions(t){return(t=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const c=n.max[0]-n.min[0],f=n.max[1]-n.min[1];return c/f>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,c,f,_,y){const M=t.clone(),P=this._extendCameraOptions(y);M.bearing=f,M.pitch=_;const D=o.bL.convert(n),R=o.bL.convert(c),F=.5*(D.lat+R.lat),N=.5*(D.lng+R.lng),G=o.dt(F,N),X=o.a6.vec3.normalize([],G),W=o.a6.vec3.normalize([],o.a6.vec3.cross([],X,[0,1,0])),K=o.a6.vec3.cross([],W,X),Y=[W[0],W[1],W[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],te=[G,o.dt(D.lat,D.lng),o.dt(R.lat,D.lng),o.dt(R.lat,R.lng),o.dt(D.lat,R.lng),o.dt(F,D.lng),o.dt(F,R.lng),o.dt(D.lat,N),o.dt(R.lat,N)];let re=o.ca.fromPoints(te.map($e=>[o.a6.vec3.dot(W,$e),o.a6.vec3.dot(K,$e),o.a6.vec3.dot(X,$e)]));const le=o.a6.vec3.transformMat4([],re.center,Y);o.a6.vec3.squaredLength(le)===0&&o.a6.vec3.set(le,0,0,1),o.a6.vec3.normalize(le,le),o.a6.vec3.scale(le,le,o.aq),M.center=o.du(le);const fe=M.getWorldToCameraMatrix(),me=o.a6.mat4.invert(new Float64Array(16),fe);re=o.ca.applyTransform(re,o.a6.mat4.multiply([],fe,Y));const de=this._extendAABB(re,M,P,f);if(!de)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=de,o.a6.vec3.transformMat4(le,le,fe);const ge=.5*(re.max[2]-re.min[2]),Te=this._minimumAABBFrustumDistance(M,re),Ce=o.a6.vec3.scale([],[0,0,1],ge),Ae=o.a6.vec3.add(Ce,le,Ce),Ee=Te+(M.pitch===0?0:o.a6.vec3.distance(le,Ae)),Ge=M.globeCenterInViewSpace,Ye=o.a6.vec3.sub([],le,[Ge[0],Ge[1],Ge[2]]);o.a6.vec3.normalize(Ye,Ye),o.a6.vec3.scale(Ye,Ye,Ee);const at=o.a6.vec3.add([],le,Ye);o.a6.vec3.transformMat4(at,at,me);const _t=o.dw/o.aq,bt=o.a6.vec3.length(at),ke=o.bE(Math.max(bt*_t-o.dw,Number.EPSILON),0),rt=Math.min(M.zoomFromMercatorZAdjusted(ke),P.maxZoom);return rt>.5*(o.c3+o.bV)?(M.setProjection({name:"mercator"}),M.zoom=rt,this._cameraForBounds(M,n,c,f,_,y)):{center:M.center,zoom:rt,bearing:f,pitch:_}}_extendAABB(t,n,c,f){const _=.5*((c.padding.left||0)+(c.padding.right||0)),y=.5*((c.padding.top||0)+(c.padding.bottom||0)),M=y,P=_,D=_,R=y,F=n.width-(P+D),N=n.height-(M+R),G=o.a6.vec3.sub([],t.max,t.min),X=Math.min(F/G[0],N/G[1]),W=Math.min(n.scaleZoom(n.scale*X),c.maxZoom);if(isNaN(W))return null;const K=n.scale/n.zoomScale(W),Y=new o.ca([t.min[0]-P*K,t.min[1]-R*K,t.min[2]],[t.max[0]+D*K,t.max[1]+M*K,t.max[2]]),te=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new o.P(c.offset.x,c.offset.y):o.P.convert(c.offset)).rotate(-o.bC(f));return Y.center[0]-=te.x*K,Y.center[1]+=te.y*K,Y}queryTerrainElevation(t,n){const c=this.transform.elevation;return c?(n=o.l({},{exaggerated:!0},n),c.getAtPoint(o.a5.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,c,f,_,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,c,f,_,y);const M=t.clone(),P=this._extendCameraOptions(y);M.bearing=f,M.pitch=_;const D=o.bL.convert(n),R=o.bL.convert(c),F=new o.bL(D.lng,R.lat),N=new o.bL(R.lng,D.lat),G=M.project(D),X=M.project(R),W=this.queryTerrainElevation(D),K=this.queryTerrainElevation(R),Y=this.queryTerrainElevation(F),te=this.queryTerrainElevation(N),re=[[G.x,G.y,Math.min(W||0,K||0,Y||0,te||0)],[X.x,X.y,Math.max(W||0,K||0,Y||0,te||0)]];let le=o.ca.fromPoints(re);const fe=M.getWorldToCameraMatrix(),me=o.a6.mat4.invert(new Float64Array(16),fe);le=o.ca.applyTransform(le,fe);const de=this._extendAABB(le,M,P,f);if(!de)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");le=de;const ge=.5*o.a6.vec3.sub([],le.max,le.min)[2],Te=this._minimumAABBFrustumDistance(M,le),Ce=[0,0,1,0];o.a6.vec4.transformMat4(Ce,Ce,fe),o.a6.vec4.normalize(Ce,Ce);const Ae=o.a6.vec3.scale([],Ce,Te+ge),Ee=o.a6.vec3.add([],le.center,Ae);o.a6.vec3.transformMat4(le.center,le.center,me),o.a6.vec3.transformMat4(Ee,Ee,me);const Ge=M.unproject(new o.P(le.center[0],le.center[1])),Ye=o.dv(M.projection,Ge),at=Math.pow(2,Ye),_t=Math.min(M._zoomFromMercatorZ(Ee[2]*M.pixelsPerMeter*at/M.worldSize),P.maxZoom);return M.mercatorFromTransition&&_t<.5*(o.c3+o.bV)?(M.setProjection({name:"globe"}),M.zoom=_t,this._cameraForBounds(M,n,c,f,_,y)):{center:Ge,zoom:_t,bearing:f,pitch:_}}fitBounds(t,n,c){const f=this.cameraForBounds(t,n);return this._fitInternal(f,n,c)}fitScreenCoordinates(t,n,c,f,_){const y=o.P.convert(t),M=o.P.convert(n),P=new o.P(Math.min(y.x,M.x),Math.min(y.y,M.y)),D=new o.P(Math.max(y.x,M.x),Math.max(y.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,M))return this;const R=this.transform.pointLocation3D(P),F=this.transform.pointLocation3D(D),N=this.transform.pointLocation3D(new o.P(P.x,D.y)),G=this.transform.pointLocation3D(new o.P(D.x,P.y)),X=[Math.min(R.lng,F.lng,N.lng,G.lng),Math.min(R.lat,F.lat,N.lat,G.lat)],W=[Math.max(R.lng,F.lng,N.lng,G.lng),Math.max(R.lat,F.lat,N.lat,G.lat)],K=f&&f.pitch?f.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,X,W,c,K,f);return this._fitInternal(Y,f,_)}_fitInternal(t,n,c){return t?(n=o.l(t,n)).linear?this.easeTo(n,c):this.flyTo(n,c):this}jumpTo(t,n){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let f=!1,_=!1,y=!1;"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=o.bL.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(_=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(y=!0,c.pitch=+t.pitch);const M=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(M))if(t.retainPadding===!1){const P=c.clone();P.padding=M,c.setLocationAtPoint(c.center,P.centerPoint)}else c.padding=M;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new o.x("movestart",n)).fire(new o.x("move",n)),f&&this.fire(new o.x("zoomstart",n)).fire(new o.x("zoom",n)).fire(new o.x("zoomend",n)),_&&this.fire(new o.x("rotatestart",n)).fire(new o.x("rotate",n)).fire(new o.x("rotateend",n)),y&&this.fire(new o.x("pitchstart",n)).fire(new o.x("pitch",n)).fire(new o.x("pitchend",n)),this.fire(new o.x("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Bs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const c=this.transform;if(!c.projection.supportsFreeCamera)return o.w(Bs),this;this.stop();const f=c.zoom,_=c.pitch,y=c.bearing;c.setFreeCameraOptions(t);const M=f!==c.zoom,P=_!==c.pitch,D=y!==c.bearing;return this.fire(new o.x("movestart",n)).fire(new o.x("move",n)),M&&this.fire(new o.x("zoomstart",n)).fire(new o.x("zoom",n)).fire(new o.x("zoomend",n)),D&&this.fire(new o.x("rotatestart",n)).fire(new o.x("rotate",n)).fire(new o.x("rotateend",n)),P&&this.fire(new o.x("pitchstart",n)).fire(new o.x("pitch",n)).fire(new o.x("pitchend",n)),this.fire(new o.x("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=o.l({offset:[0,0],duration:500,easing:o.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,f=this.getZoom(),_=this.getBearing(),y=this.getPitch(),M=this.getPadding(),P="zoom"in t?+t.zoom:f,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,R="pitch"in t?+t.pitch:y,F=this._extendPadding(t.padding),N=o.P.convert(t.offset);let G,X,W;if(c.projection.name==="globe"){const Ce=o.a5.fromLngLat(c.center),Ae=N.rotate(-c.angle);Ce.x+=Ae.x/c.worldSize,Ce.y+=Ae.y/c.worldSize;const Ee=Ce.toLngLat(),Ge=o.bL.convert(t.center||Ee);this._normalizeCenter(Ge),G=c.centerPoint.add(Ae),X=new o.P(Ce.x,Ce.y).mult(c.worldSize),W=new o.P(o.am(Ge.lng),o.at(Ge.lat)).mult(c.worldSize).sub(X)}else{G=c.centerPoint.add(N);const Ce=c.pointLocation(G),Ae=o.bL.convert(t.center||Ce);this._normalizeCenter(Ae),X=c.project(Ce),W=c.project(Ae).sub(X)}const K=c.zoomScale(P-f);let Y,te;t.around&&(Y=o.bL.convert(t.around),te=c.locationPoint(Y));const re=this._zooming||P!==f,le=this._rotating||_!==D,fe=this._pitching||R!==y,me=!c.isPaddingEqual(F),de=t.retainPadding===!1?c.clone():c,ge=Ce=>Ae=>{if(re&&(Ce.zoom=o.aa(f,P,Ae)),le&&(Ce.bearing=o.aa(_,D,Ae)),fe&&(Ce.pitch=o.aa(y,R,Ae)),me&&(de.interpolatePadding(M,F,Ae),G=de.centerPoint.add(N)),Y)Ce.setLocationAtPoint(Y,te);else{const Ee=Ce.zoomScale(Ce.zoom-f),Ge=P>f?Math.min(2,K):Math.max(.5,K),Ye=Math.pow(Ge,1-Ae),at=Ce.unproject(X.add(W.mult(Ae*Ye)).mult(Ee));Ce.setLocationAtPoint(Ce.renderWorldCopies?at.wrap():at,G)}return t.preloadOnly||this._fireMoveEvents(n),Ce};if(t.preloadOnly){const Ce=this._emulate(ge,t.duration,c);return this._preloadTiles(Ce),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=le,this._pitching=fe,this._padding=me,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,Te),this._ease(ge(c),Ce=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(n,Ce)},t),this}_prepareEase(t,n,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||c.moving||this.fire(new o.x("movestart",t)),this._zooming&&!c.zooming&&this.fire(new o.x("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new o.x("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new o.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.x("move",t)),this._zooming&&this.fire(new o.x("zoom",t)),this._rotating&&this.fire(new o.x("rotate",t)),this._pitching&&this.fire(new o.x("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new o.x("zoomend",t)),f&&this.fire(new o.x("rotateend",t)),_&&this.fire(new o.x("pitchend",t)),this.fire(new o.x("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const $e=o.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo($e,n)}this.stop(),t=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.dr},t);const c=this.transform,f=this.getZoom(),_=this.getBearing(),y=this.getPitch(),M=this.getPadding(),P="zoom"in t?o.ap(+t.zoom,c.minZoom,c.maxZoom):f,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,R="pitch"in t?+t.pitch:y,F=this._extendPadding(t.padding),N=c.zoomScale(P-f),G=o.P.convert(t.offset);let X=c.centerPoint.add(G);const W=c.pointLocation(X),K=o.bL.convert(t.center||W);this._normalizeCenter(K);const Y=c.project(W),te=c.project(K).sub(Y);let re=t.curve;const le=Math.max(c.width,c.height),fe=le/N,me=te.mag();if("minZoom"in t){const $e=o.ap(Math.min(t.minZoom,f,P),c.minZoom,c.maxZoom),nt=le/c.zoomScale($e-f);re=Math.sqrt(nt/me*2)}const de=re*re;function ge($e){const nt=(fe*fe-le*le+($e?-1:1)*de*de*me*me)/(2*($e?fe:le)*de*me);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Te($e){return(Math.exp($e)-Math.exp(-$e))/2}function Ce($e){return(Math.exp($e)+Math.exp(-$e))/2}const Ae=ge(0);let Ee=function($e){return Ce(Ae)/Ce(Ae+re*$e)},Ge=function($e){return le*((Ce(Ae)*(Te(nt=Ae+re*$e)/Ce(nt))-Te(Ae))/de)/me;var nt},Ye=(ge(1)-Ae)/re;if(Math.abs(me)<1e-6||!isFinite(Ye)){if(Math.abs(le-fe)<1e-6)return this.easeTo(t,n);const $e=fe<le?-1:1;Ye=Math.abs(Math.log(fe/le))/re,Ge=function(){return 0},Ee=function(nt){return Math.exp($e*re*nt)}}t.duration="duration"in t?+t.duration:1e3*Ye/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const at=_!==D,_t=R!==y,bt=!c.isPaddingEqual(F),ke=t.retainPadding===!1?c.clone():c,rt=$e=>nt=>{const lt=nt*Ye,ot=1/Ee(lt);$e.zoom=nt===1?P:f+$e.scaleZoom(ot),at&&($e.bearing=o.aa(_,D,nt)),_t&&($e.pitch=o.aa(y,R,nt)),bt&&(ke.interpolatePadding(M,F,nt),X=ke.centerPoint.add(G));const St=nt===1?K:$e.unproject(Y.add(te.mult(Ge(lt))).mult(ot));return $e.setLocationAtPoint($e.renderWorldCopies?St.wrap():St,X),$e._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),$e};if(t.preloadOnly){const $e=this._emulate(rt,t.duration,c);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=at,this._pitching=_t,this._padding=bt,this._prepareEase(n,!1),this._ease(rt(c),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,n)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,n,c){c.animate===!1||c.duration===0?(t(1),n()):(this._easeStart=o.q.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=o.bB(t,-180,180);const c=Math.abs(t-n);return Math.abs(t-360-n)<c&&(t-=360),Math.abs(t+360-n)<c&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const c=t.lng-n.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,c){const f=Math.ceil(15*n/1e3),_=[],y=t(c.clone());for(let M=0;M<=f;M++){const P=y(M/f);_.push(P.clone())}return _}_preloadTiles(t,n){}}class Bu{constructor(t={}){this.options=t,o.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=It("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const f=It("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",c),this._innerContainer=It("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const c=n.reduce((f,_,y)=>(_.value&&(f+=`${_.key}=${_.value}${y<n.length-1?"&":""}`),f),"?");t.href=`${o.e.FEEDBACK_URL}/${c}#${Cu(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const n=this._map.style._mergedSourceCaches;for(const f in n){const _=n[f];if(_.used){const y=_.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort((f,_)=>f.length-_.length),t=t.filter((f,_)=>{for(let y=_+1;y<t.length;y++)if(t[y].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ic{constructor(){o.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=It("div","mapboxgl-ctrl");const n=It("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const c=t[n].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class Oh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,c=n?this._queue.concat(n):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const c of n)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class tl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=o.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,c){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+c}}const _m={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ad=["mouseenter","mouseover","mouseleave","mouseout"];class Nl extends o.x{constructor(t,n,c,f){const{point:_,lngLat:y,originalEvent:M,target:P}=t;super(t.type,{point:_,lngLat:y,originalEvent:M,target:P}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=c,this.feature=f}}class kh{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const{type:c,filter:f}=n;if(f){const y=o.M(f,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(y.result==="error")throw new Error(y.value.map(M=>`${M.key}: ${M.message}`).join(", "));this.filters.set(t,y.value)}const _=this.interactionsByType.get(c)||new Map;_.size===0&&(ad.includes(c)?this.map.on(c,n.featureset,this.handleType):this.map.on(c,this.handleType),this.interactionsByType.set(c,_)),_.set(t,n),this.typeById.set(t,c)}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(n);c&&(c.delete(t),c.size===0&&this.map.off(n,this.handleType))}handleType(t){const n=this.interactionsByType.get(t.type),c=Array.from(n).reverse(),f=[];for(const[,M]of c)M.featureset&&f.push({featureset:M.featureset,filter:M.filter,radius:M.radius});let _=this.map.style.queryRenderedFeaturesForInteractions(t.point,f,this.map.transform);!_.length&&ad.includes(t.type)&&(_=[null]);let y=!1;for(const M of _){for(const[P,D]of c){const{handler:R,featureset:F}=D;if(F&&(M==null||o.bi(M.featureset,F))&&R(new Nl(t,P,D,M))!==!1){y=!0;break}}if(y)break}if(!y)for(const[M,P]of c){const{handler:D,featureset:R}=P;if(!R&&D(new Nl(t,M,P,null))!==!1)break}}}function Ul(l,t){if(Array.isArray(l)&&Array.isArray(t)){const n=new Set(l),c=new Set(t);return n.size===c.size&&l.every(f=>c.has(f))}return o.bi(l,t)}const Cc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},na={showCompass:!0,showZoom:!0,visualizePitch:!1};class eo{constructor(t,n,c=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Fs({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new zh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),At()}move(t,n){const c=this.map,f=this.mouseRotate.mousemoveWindow(t,n),_=f&&f.bearingDelta;if(_&&c.setBearing(c.getBearing()+_),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,n),M=y&&y.pitchDelta;M&&c.setPitch(c.getPitch()+M)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ri(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),cr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,cr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Xr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ra(l,t,n){if(l=new o.bL(l.lng,l.lat),t){const c=new o.bL(l.lng-360,l.lat),f=new o.bL(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-n.center.lng)/360),y=n.locationPoint(l).distSqr(t),M=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(c).distSqr(t)<y&&(M||Math.abs(c.lng-n.center.lng)<_)?l=c:n.locationPoint(f).distSqr(t)<y&&(M||Math.abs(f.lng-n.center.lng)<_)&&(l=f)}for(;Math.abs(l.lng-n.center.lng)>180;){const c=n.locationPoint(l);if(c.x>=0&&c.y>=0&&c.x<=n.width&&c.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sa extends o.E{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=o.l({element:t},n)),o.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=It("div");const _=41,y=27,M=ri("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),P=ri("radialGradient",{id:"shadowGradient"},ri("defs",{},M));ri("stop",{offset:"10%","stop-opacity":.4},P),ri("stop",{offset:"100%","stop-opacity":.05},P),ri("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),ri("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),ri("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),ri("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=o.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const c=this._element.classList;for(const _ in oa)c.remove(`mapboxgl-marker-anchor-${_}`);c.add(`mapboxgl-marker-anchor-${this._anchor}`);const f=t&&t.className?t.className.trim().split(/\s+/):[];c.add(...f),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.bL.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,c=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,c=this._element;this._popup&&(n===c||c.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const c=t.unproject(n),f=t.getFreeCameraOptions();if(!f.position)return!1;const _=f.position.toLngLat();return _.distanceTo(c)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(n);let f;t._showingGlobe()&&o.dz(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${oa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,c=this.getPitchAlignment();if(!n||!t||c!=="map")return"";if(!n._showingGlobe()){const P=n.getPitch();return P?`rotateX(${P}deg)`:""}const f=o.c1(o.dA(n.transform,this._lngLat)),_=t.sub(o.dB(n.transform)),y=Math.abs(_.x)+Math.abs(_.y);if(y===0)return"";const M=f/y;return`rotateX(${-_.y*M}deg) rotateY(${_.x*M}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let c=0;const f=this.getRotationAlignment();if(f==="map")if(n._showingGlobe()){const _=n.project(new o.bL(this._lngLat.lng,this._lngLat.lat+.001)),y=n.project(new o.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);c=o.c1(Math.atan2(y.y,y.x))-90}else c=-n.getBearing();else if(f==="horizon"){const _=o.a7(4,6,n.getZoom()),y=o.dB(n.transform);y.y+=_*n.transform.height;const M=t.sub(y),P=o.c1(Math.atan2(M.y,M.x));c=(P>90?P-270:P+90)*(1-_)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=ra(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const c=this._pointerdownPos,f=this._positionDelta;if(c&&f){if(!this._isDragging){const _=this._clickTolerance||n._clickTolerance;if(t.point.dist(c)<_)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.x("dragstart"))),this.fire(new o.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.x("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,c=this._pos;n&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},gm={maxWidth:100,unit:"metric"},ym={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Pa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function to(l=new o.P(0,0),t="bottom"){if(typeof l=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new o.P(0,l);case"top-left":return new o.P(n,n);case"top-right":return new o.P(-n,n);case"bottom":return new o.P(0,-l);case"bottom-left":return new o.P(n,-n);case"bottom-right":return new o.P(-n,-n);case"left":return new o.P(l,0);case"right":return new o.P(-l,0)}return new o.P(0,0)}return l instanceof o.P||Array.isArray(l)?o.P.convert(l):o.P.convert(l[t]||[0,0])}return{version:ue,supported:Rt.supported,setRTLTextPlugin:o.dC,getRTLTextPluginStatus:o.dD,Map:class extends Mc{constructor(l){xe.mark(Re.create);const t=l;if((l=o.l({},Cc,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.dx(window)&&(l.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ph(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Oh,this._domRenderTaskQueue=new Oh,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aQ(),this._locale=o.l({},_m,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new bs(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?{...l.contextCreateOptions}:{},typeof l.container=="string"){const n=document.getElementById(l.container);if(!n)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=n}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Iu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Er(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||o.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new an(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const n=l.bounds;n&&(this.resize(),this.fitBounds(n,o.l({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new Bu({customAttribution:l.customAttribution})),this._logoControl=new Ic,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.x(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.x(`${n.dataType}dataloading`,n))}),this._interactions=new kh(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(n,c.firstChild):c.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.x("movestart",l)).fire(new o.x("move",l)),this.fire(new o.x("resize",l)),t&&this.fire(new o.x("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.as.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let n;t==="globe"&&l.zoom>=o.bV?(l.setMercatorFromTransition(),n=!0):t==="mercator"&&l.zoom<o.bV&&(l.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=o.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l){return this.transform.locationPoint3D(o.bL.convert(l))}unproject(l){return this.transform.pointLocation3D(o.P.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,n){const c=f=>{let _=[];if(Array.isArray(t)){const y=t.filter(M=>this.getLayer(M));_=y.length?this.queryRenderedFeatures(f,{layers:y}):[]}else _=this.queryRenderedFeatures(f,{featureset:t});return _};if(l==="mouseenter"||l==="mouseover"){let f=!1;return{listener:n,targets:t,delegates:{mousemove:y=>{const M=c(y.point);M.length?f||(f=!0,n.call(this,new qn(l,this,y.originalEvent,{features:M}))):f=!1},mouseout:()=>{f=!1}}}}if(l==="mouseleave"||l==="mouseout"){let f=!1;return{listener:n,targets:t,delegates:{mousemove:M=>{c(M.point).length?f=!0:f&&(f=!1,n.call(this,new qn(l,this,M.originalEvent)))},mouseout:M=>{f&&(f=!1,n.call(this,new qn(l,this,M.originalEvent)))}}}}{const f=_=>{const y=c(_.point);y.length&&(_.features=y,n.call(this,_),delete _.features)};return{listener:n,targets:t,delegates:{[l]:f}}}}on(l,t,n){if(typeof t=="function"||n===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const f in c.delegates)this.on(f,c.delegates[f]);return this}once(l,t,n){if(typeof t=="function"||n===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,n);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(l,t,n){if(typeof t=="function"||n===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(f=>{for(let _=0;_<f.length;_++){const y=f[_];if(y.listener===n&&Ul(y.targets,t)){for(const M in y.delegates)this.off(M,y.delegates[M]);return f.splice(_,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(t!==void 0||l===void 0||l instanceof o.P||Array.isArray(l)||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(t=t||{}))return this._isFeaturesetDescriptorValid(t.featureset)?this.style.queryRenderedFeaturesForInteractions(l,[t],this.transform):[];if(t.layers&&Array.isArray(t.layers)){for(const n of t.layers)if(!this._isValidId(n))return[]}return this.style.queryRenderedFeatures(l,t,this.transform)}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}setStyle(l,t){return t=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(n,c)=>{n?(o.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(l,t)):c&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const n=o.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new $o(this,n).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new $o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new o.t(new Error("IDs can't be empty."))),!1):!o.aK(l)||(this.fire(new o.t(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isFeaturesetDescriptorValid(l){return"featuresetId"in l?this._isValidId(l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isFeaturesetDescriptorValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:n=1,sdf:c=!1,stretchX:f,stretchY:_,content:y}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:M,height:P,data:D}=o.q.getImageData(t);this.style.addImage(l,{data:new o.r({width:M,height:P},D),pixelRatio:n,stretchX:f,stretchY:_,content:y,sdf:c,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new o.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:P}=t,D=t;this.style.addImage(l,{data:new o.r({width:M,height:P},new Uint8Array(D.data)),pixelRatio:n,stretchX:f,stretchY:_,content:y,sdf:c,version:0,userImage:D}),D.onAdd&&D.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const n=this.style.getImage(l);if(!n)return void this.fire(new o.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.q.getImageData(t):t,{width:f,height:_,data:y}=c;if(f===void 0||_===void 0)return void this.fire(new o.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==n.data.width||_!==n.data.height)return void this.fire(new o.t(new Error(`The width and height of the updated image (${f}, ${_})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const M=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);n.data.replace(y,M),this.style.updateImage(l,n)}hasImage(l){return l?!!this.style&&!!this.style.getImage(l):(this.fire(new o.t(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){o.o(this._requestManager.transformRequest(l,o.R.Image),(n,c)=>{t(n,c instanceof HTMLImageElement?o.q.getImageData(c):c)})}listImages(){return this.style.listImages()}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new o.t(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,n){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,n),this._update(!0)):this}setFilter(l,t,n={}){return this._isValidId(l)?(this.style.setFilter(l,t,n),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,n,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,n,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,n,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,n,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,n){return this.style.setConfigProperty(l,t,n),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bL.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,c,f,_=this._container;for(;_&&(!c||!f);){const y=window.getComputedStyle(_).transform;y&&y!=="none"&&(n=y.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(c=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(f=n[3])),_=_.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=It("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=It("div","mapboxgl-canvas-container",l);this._canvas=It("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=It("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(f=>{c[f]=It("div",`mapboxgl-ctrl-${f}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const n=o.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(l),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=o.l({},Rt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Cn(t,!0),this.painter=new Qa(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(t)):this.fire(new o.t(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.x("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.x("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new o.x("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,c=o.q.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,R=this.transform.pitch,F=o.q.now(),N=new o.a3(D,{now:F,fadeDuration:_,pitch:R,transition:this.style.transition});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(c),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(c);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,xe.mark(Re.load),this.fire(new o.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=o.q.now()-c;f.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const R=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new o.x("gpu-timing-frame",{cpuTime:D,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(D);this.fire(new o.x("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(D);this.fire(new o.x("gpu-timing-deferred-render",{gpuTime:R}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(P||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(y=this._updateAverageElevation(c,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new o.x("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,xe.mark(Re.fullLoad),this._performanceMetricsCollection&&si(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const n=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const f=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=l;const y=Math.abs(f-_);if(y>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(_),n(_);this._averageElevation.easeTo(_,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(_),n(_)}return!!this._averageElevation.isEasing(l)&&n(this._averageElevation.getValue(l))}_authenticate(){ye(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===Yr||l.status===401)){const t=this.painter.context.gl;Cn(t,!1),this._logoControl instanceof Ic&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ts(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Qn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,c=n.createFramebuffer();function f(_){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,_,0);const y=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,y),y}return n.bindFramebuffer(n.FRAMEBUFFER,c),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,n){let c=n[1]-n[0];const f=l.length/4;for(let _=0;_<t.length;_++){const y=t[_];let M=0;for(let P=0;P<y.length;P+=4)y[P]===l[P]&&y[P+1]===l[P+1]&&y[P+2]===l[P+2]&&y[P+3]===l[P+3]&&(M+=1);c+=(n[_+2]-n[_+1])*(1-M/f)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),sn.delete(this.painter.context.gl),ii.remove(),gi.remove(),this._removed=!0,this.fire(new o.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return o.bg(t,(n,c)=>n._preloadTiles(l,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){o.dy(l,t)}get version(){return ue}},NavigationControl:class{constructor(l={}){this.options=o.l({},na,l),this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),It("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),It("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=It("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),n=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new eo(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const n=It("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",n),l.firstElementChild&&l.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends o.E{constructor(l={}){super();const t=navigator.geolocation;this.options=o.l({geolocation:t},hp,l),o.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ks(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,l(n)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.x("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("geolocate",l)),this._finish()}}_updateCamera(l){const t=new o.bL(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,c=this._map.getBearing(),f=o.l({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),f,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new o.bL(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=o.bE(1,l._center.lat)*l.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=It("button","mapboxgl-ctrl-geolocate",this._container),It("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=It("div","mapboxgl-user-location"),this._dotElement.appendChild(It("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(It("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=It("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.x("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bu,ScaleControl:class{constructor(l={}){this.options=o.l({},gm,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,c=t._containerWidth/2-l/2,f=t.unproject([c,n]),_=t.unproject([c+l,n]),y=f.distanceTo(_);if(this.options.unit==="imperial"){const M=3.2808*y;M>5280?this._setScale(l,M/5280,"mile"):this._setScale(l,M,"foot")}else this.options.unit==="nautical"?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,t,n){this._map._requestDomTask(()=>{const c=function(_){const y=Math.pow(10,`${Math.floor(_)}`.length-1);let M=_/y;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(P){const D=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*D)/D}(M),y*M}(t),f=c/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(c):`${c}&nbsp;${ym[n]}`,this._container.style.width=l*f+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:o.w("Full screen control 'container' must be a DOM element.")),o.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=It("button","mapboxgl-ctrl-fullscreen",this._controlContainer);It("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(l){super(),this.options=o.l(Object.create(Pa),l),o.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.x("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.bL.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let c;for(n.innerHTML=l;c=n.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=It("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const n=this._closeButton=It("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,c=this._pos;if(!t||!n||!c)return"bottom";const f=n.offsetWidth,_=n.offsetHeight,y=c.x<f/2,M=c.x>t.transform.width-f/2;if(c.y+l<_)return y?"top-left":M?"top-right":"top";if(c.y>t.transform.height-_){if(y)return"bottom-left";if(M)return"bottom-right"}return y?"left":M?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let c=this._container;if(c||(c=this._container=It("div","mapboxgl-popup",t.getContainer()),this._tip=It("div","mapboxgl-popup-tip",c),c.appendChild(n)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ra(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const f=this._pos=this._trackPointer&&l instanceof o.P?l:t.project(this._lngLat),_=to(this.options.offset),y=this._anchor=this._getAnchor(_.y),M=to(this.options.offset,y),P=f.add(M).round();t._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${oa[y]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const f=o.dz(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Fh);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:sa,Style:$o,LngLat:o.bL,LngLatBounds:o.as,Point:o.P,MercatorCoordinate:o.a5,FreeCameraOptions:Gr,Evented:o.E,config:o.e,prewarm:o.dE,clearPrewarmedResources:o.dF,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(l){o.e.ACCESS_TOKEN=l},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(l){o.e.API_URL=l},get workerCount(){return o.dG.workerCount},set workerCount(l){o.dG.workerCount=l},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.dH(l)},get workerUrl(){return o.dI.workerUrl},set workerUrl(l){o.dI.workerUrl=l},get workerClass(){return o.dI.workerClass},set workerClass(l){o.dI.workerClass=l},get workerParams(){return o.dI.workerParams},set workerParams(l){o.dI.workerParams=l},get dracoUrl(){return o.dJ()},set dracoUrl(l){o.dK(l)},get meshoptUrl(){return o.dL()},set meshoptUrl(l){o.dM(l)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var ee=U;return ee})}(By)),By.exports}var bC=vC();const mv=mC(bC),t2="pk.eyJ1IjoidmFtc2k5OTgiLCJhIjoiY20zempoaHQ5MHN2cTJpcTE0cmNid2dsNCJ9.CS9V6B7-IAtmzFUuqv4aIw",wC={name:"MapBox",props:{sourceCordinates:{type:Array,default:()=>[]},destinationCordinates:{type:Array,default:()=>[]},placeCurrentLocation:{type:Boolean,default:!1},placeDestinationLocation:{type:Boolean,default:!1}},data(){return{map:null,directionsServiceUrl:"https://api.mapbox.com/directions/v5/mapbox/driving",mapInitialized:!1,routeGeojson:null}},watch:{placeCurrentLocation:{handler(d){d&&this.pickCurrentLocation()}},placeDestinationLocation:{handler(d){d&&this.getRoute()}}},mounted(){mv.accessToken=t2,this.map=new mv.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.sourceCoord,zoom:6,attributionControl:!1}),this.map.on("load",()=>{this.mapInitialized=!0})},methods:{async getRoute(){if(this.mapInitialized)try{const O=(await(await fetch(`${this.directionsServiceUrl}/${this.sourceCordinates[0]},${this.sourceCordinates[1]};${this.destinationCordinates[0]},${this.destinationCordinates[1]}?steps=true&geometries=geojson&access_token=${t2}`,{method:"GET"})).json()).routes[0].geometry.coordinates,U={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:O}};this.addRouteToMap(U);const $=new mv.LngLatBounds;O.forEach(ee=>$.extend(ee)),this.map.fitBounds($,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:14})}catch(d){console.error("Error getting directions:",d)}},addRouteToMap(d){this.map.getSource("route")&&(this.map.removeLayer("route"),this.map.removeSource("route")),this.map.addSource("route",{type:"geojson",data:d}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":8}})},pickCurrentLocation(){this.mapInitialized&&(console.log(this.sourceCordinates,"SOURCE_CORDINATES"),this.map.flyTo({center:[this.sourceCordinates[0],this.sourceCordinates[1]],zoom:14,speed:2,curve:1}))}}},TC={id:"map",style:{width:"100%",height:"350px"}};function SC(d,v,I,O,U,$){return Fa(),Vc("div",TC)}const EC=c0(wC,[["render",SC],["__scopeId","data-v-7c6727d8"]]),AC="pk.eyJ1IjoidmFtc2k5OTgiLCJhIjoiY20zempoaHQ5MHN2cTJpcTE0cmNid2dsNCJ9.CS9V6B7-IAtmzFUuqv4aIw",MC={name:"SourceDestinationPicker",components:{MapBox:EC},data(){return{source:"",destination:"",placeCurrentLocation:!1,placeDestinationLocation:!1,sourcePlaces:[],destinationPlaces:[],sourceCordinates:[],destinationCordinates:[],debouncedSearchLocation:yC.debounce(this.searchLocation,500)}},methods:{async searchLocation(d){if(console.log(d),this.source.length<3){d==="source"?this.sourcePlaces=[]:this.destinationPlaces=[];return}try{const v=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(d==="source"?this.source:this.destination)}.json?access_token=${AC}&limit=5`,O=await(await fetch(v)).json();d==="source"?this.sourcePlaces=O.features||[]:this.destinationPlaces=O.features||[],console.log(this.sourcePlaces,O.features)}catch(v){console.error("Error searching for location:",v)}},selectPlace(d,v){d==="source"?(this.sourceCordinates=(v==null?void 0:v.center)||"",this.source=(v==null?void 0:v.place_name)||"",this.placeCurrentLocation=!0,setTimeout(()=>{this.placeCurrentLocation=!1},2e3),this.sourcePlaces=[]):(this.destinationCordinates=(v==null?void 0:v.center)||"",this.destination=(v==null?void 0:v.place_name)||"",this.destinationPlaces=[],this.placeDestinationLocation=!0,setTimeout(()=>{this.placeDestinationLocation=!1},2e3))},selectCurrentLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(d=>{const v=d.coords.latitude,I=d.coords.longitude;this.sourceCordinates=[I,v],console.log(this.sourceCordinates),this.placeCurrentLocation=!0,this.source="Current Location",setTimeout(()=>{this.placeCurrentLocation=!1},2e3)})}}},IC={class:"row source-destination-container"},CC={class:"col-xs-12 map-container"},PC={class:"col-xs-12 form-group"},RC={key:0,class:"place-list-container"},DC=["onClick"],LC={class:"col-xs-12 form-group"},zC={key:0,class:"place-list-container"},OC=["onClick"];function kC(d,v,I,O,U,$){var ue,Re;const ee=$y("map-box"),o=$y("font-awesome-icon");return Fa(),Vc("div",IC,[jc("div",CC,[yo(ee,{"source-cordinates":U.sourceCordinates,"destination-cordinates":U.destinationCordinates,"place-current-location":U.placeCurrentLocation,"place-destination-location":U.placeDestinationLocation},null,8,["source-cordinates","destination-cordinates","place-current-location","place-destination-location"]),yo(o,{icon:"location",class:"location-icon",title:"Current Location",onClick:$.selectCurrentLocation},null,8,["onClick"])]),jc("div",PC,[yo(o,{icon:"search",class:"search-icon"}),sw(jc("input",{"onUpdate:modelValue":v[0]||(v[0]=xe=>U.source=xe),class:"form-control",type:"text",placeholder:"Search Source Location",onChange:v[1]||(v[1]=xe=>U.debouncedSearchLocation("source"))},null,544),[[zw,U.source]]),(ue=this.sourcePlaces)!=null&&ue.length?(Fa(),Vc("ul",RC,[(Fa(!0),Vc(da,null,lw(this.sourcePlaces,xe=>(Fa(),Vc("li",{key:xe==null?void 0:xe.id,onClick:Oe=>$.selectPlace("source",xe)},Tv(xe==null?void 0:xe.place_name),9,DC))),128))])):gw("",!0)]),jc("div",LC,[yo(o,{icon:"search",class:"search-icon"}),sw(jc("input",{"onUpdate:modelValue":v[2]||(v[2]=xe=>U.destination=xe),class:"form-control",type:"text",placeholder:"Search Destination",onChange:v[3]||(v[3]=xe=>U.debouncedSearchLocation("destination"))},null,544),[[zw,U.destination]]),(Re=this.destinationPlaces)!=null&&Re.length?(Fa(),Vc("ul",zC,[(Fa(!0),Vc(da,null,lw(this.destinationPlaces,xe=>(Fa(),Vc("li",{key:xe==null?void 0:xe.id,onClick:Oe=>$.selectPlace("destination",xe)},Tv(xe==null?void 0:xe.place_name),9,OC))),128))])):gw("",!0)]),v[4]||(v[4]=jc("div",{class:"col-xs-12 form-group"},[jc("input",{class:"form-control",type:"number",placeholder:"Enter Mobile Number"})],-1))])}const FC=c0(MC,[["render",kC]]),BC=[{path:"/",name:"SourceDestinationPicker",component:FC}],NC=dC({history:jI("/"),routes:BC});/*!
 * Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2024 Fonticons, Inc.
 */function UC(d,v,I){return(v=jC(v))in d?Object.defineProperty(d,v,{value:I,enumerable:!0,configurable:!0,writable:!0}):d[v]=I,d}function i2(d,v){var I=Object.keys(d);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(d);v&&(O=O.filter(function(U){return Object.getOwnPropertyDescriptor(d,U).enumerable})),I.push.apply(I,O)}return I}function Jt(d){for(var v=1;v<arguments.length;v++){var I=arguments[v]!=null?arguments[v]:{};v%2?i2(Object(I),!0).forEach(function(O){UC(d,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(I)):i2(Object(I)).forEach(function(O){Object.defineProperty(d,O,Object.getOwnPropertyDescriptor(I,O))})}return d}function VC(d,v){if(typeof d!="object"||!d)return d;var I=d[Symbol.toPrimitive];if(I!==void 0){var O=I.call(d,v||"default");if(typeof O!="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(d)}function jC(d){var v=VC(d,"string");return typeof v=="symbol"?v:v+""}const n2=()=>{};let S1={},KT={},JT=null,QT={mark:n2,measure:n2};try{typeof window<"u"&&(S1=window),typeof document<"u"&&(KT=document),typeof MutationObserver<"u"&&(JT=MutationObserver),typeof performance<"u"&&(QT=performance)}catch{}const{userAgent:r2=""}=S1.navigator||{},cf=S1,Vr=KT,o2=JT,Dy=QT;cf.document;const eh=!!Vr.documentElement&&!!Vr.head&&typeof Vr.addEventListener=="function"&&typeof Vr.createElement=="function",eS=~r2.indexOf("MSIE")||~r2.indexOf("Trident/");var GC=/fa(s|r|l|t|d|dr|dl|dt|b|k|kd|ss|sr|sl|st|sds|sdr|sdl|sdt)?[\-\ ]/,qC=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,tS={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fab:"brands","fa-brands":"brands"},duotone:{fa:"solid",fad:"solid","fa-solid":"solid","fa-duotone":"solid",fadr:"regular","fa-regular":"regular",fadl:"light","fa-light":"light",fadt:"thin","fa-thin":"thin"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid",fasdr:"regular","fa-regular":"regular",fasdl:"light","fa-light":"light",fasdt:"thin","fa-thin":"thin"}},$C={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},iS=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone"],vs="classic",h0="duotone",HC="sharp",WC="sharp-duotone",nS=[vs,h0,HC,WC],ZC={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},duotone:{900:"fad",400:"fadr",300:"fadl",100:"fadt"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds",400:"fasdr",300:"fasdl",100:"fasdt"}},XC={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad",400:"fadr",normal:"fadr",300:"fadl",100:"fadt"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds",400:"fasdr",normal:"fasdr",300:"fasdl",100:"fasdt"}},YC=new Map([["classic",{defaultShortPrefixId:"fas",defaultStyleId:"solid",styleIds:["solid","regular","light","thin","brands"],futureStyleIds:[],defaultFontWeight:900}],["sharp",{defaultShortPrefixId:"fass",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["duotone",{defaultShortPrefixId:"fad",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp-duotone",{defaultShortPrefixId:"fasds",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}]]),KC={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",brands:"fab"},duotone:{solid:"fad",regular:"fadr",light:"fadl",thin:"fadt"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds",regular:"fasdr",light:"fasdl",thin:"fasdt"}},JC=["fak","fa-kit","fakd","fa-kit-duotone"],s2={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},QC=["kit"],eP={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},tP=["fak","fakd"],iP={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},a2={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}},Ly={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},nP=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone"],rP=["fak","fa-kit","fakd","fa-kit-duotone"],oP={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},sP={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},duotone:{"fa-regular":"fadr","fa-light":"fadl","fa-thin":"fadt"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds","fa-regular":"fasdr","fa-light":"fasdl","fa-thin":"fasdt"}},aP={classic:["fas","far","fal","fat","fad"],duotone:["fadr","fadl","fadt"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds","fasdr","fasdl","fasdt"]},Nv={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},duotone:{fadr:"fa-regular",fadl:"fa-light",fadt:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid",fasdr:"fa-regular",fasdl:"fa-light",fasdt:"fa-thin"}},lP=["fa-solid","fa-regular","fa-light","fa-thin","fa-duotone","fa-brands"],Uv=["fa","fas","far","fal","fat","fad","fadr","fadl","fadt","fab","fass","fasr","fasl","fast","fasds","fasdr","fasdl","fasdt",...nP,...lP],cP=["solid","regular","light","thin","duotone","brands"],rS=[1,2,3,4,5,6,7,8,9,10],uP=rS.concat([11,12,13,14,15,16,17,18,19,20]),hP=[...Object.keys(aP),...cP,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",Ly.GROUP,Ly.SWAP_OPACITY,Ly.PRIMARY,Ly.SECONDARY].concat(rS.map(d=>"".concat(d,"x"))).concat(uP.map(d=>"w-".concat(d))),fP={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}};const Yu="___FONT_AWESOME___",Vv=16,oS="fa",sS="svg-inline--fa",qd="data-fa-i2svg",jv="data-fa-pseudo-element",dP="data-fa-pseudo-element-pending",E1="data-prefix",A1="data-icon",l2="fontawesome-i2svg",pP="async",mP=["HTML","HEAD","STYLE","SCRIPT"],aS=(()=>{try{return!0}catch{return!1}})();function j_(d){return new Proxy(d,{get(v,I){return I in v?v[I]:v[vs]}})}const lS=Jt({},tS);lS[vs]=Jt(Jt(Jt(Jt({},{"fa-duotone":"duotone"}),tS[vs]),s2.kit),s2["kit-duotone"]);const _P=j_(lS),Gv=Jt({},KC);Gv[vs]=Jt(Jt(Jt(Jt({},{duotone:"fad"}),Gv[vs]),a2.kit),a2["kit-duotone"]);const c2=j_(Gv),qv=Jt({},Nv);qv[vs]=Jt(Jt({},qv[vs]),iP.kit);const M1=j_(qv),$v=Jt({},sP);$v[vs]=Jt(Jt({},$v[vs]),eP.kit);j_($v);const gP=GC,cS="fa-layers-text",yP=qC,xP=Jt({},ZC);j_(xP);const vP=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],_v=$C,bP=[...QC,...hP],I_=cf.FontAwesomeConfig||{};function wP(d){var v=Vr.querySelector("script["+d+"]");if(v)return v.getAttribute(d)}function TP(d){return d===""?!0:d==="false"?!1:d==="true"?!0:d}Vr&&typeof Vr.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(v=>{let[I,O]=v;const U=TP(wP(I));U!=null&&(I_[O]=U)});const uS={styleDefault:"solid",familyDefault:vs,cssPrefix:oS,replacementClass:sS,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};I_.familyPrefix&&(I_.cssPrefix=I_.familyPrefix);const sm=Jt(Jt({},uS),I_);sm.autoReplaceSvg||(sm.observeMutations=!1);const zi={};Object.keys(uS).forEach(d=>{Object.defineProperty(zi,d,{enumerable:!0,set:function(v){sm[d]=v,C_.forEach(I=>I(zi))},get:function(){return sm[d]}})});Object.defineProperty(zi,"familyPrefix",{enumerable:!0,set:function(d){sm.cssPrefix=d,C_.forEach(v=>v(zi))},get:function(){return sm.cssPrefix}});cf.FontAwesomeConfig=zi;const C_=[];function SP(d){return C_.push(d),()=>{C_.splice(C_.indexOf(d),1)}}const nf=Vv,qc={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function EP(d){if(!d||!eh)return;const v=Vr.createElement("style");v.setAttribute("type","text/css"),v.innerHTML=d;const I=Vr.head.childNodes;let O=null;for(let U=I.length-1;U>-1;U--){const $=I[U],ee=($.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(ee)>-1&&(O=$)}return Vr.head.insertBefore(v,O),d}const AP="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function B_(){let d=12,v="";for(;d-- >0;)v+=AP[Math.random()*62|0];return v}function am(d){const v=[];for(let I=(d||[]).length>>>0;I--;)v[I]=d[I];return v}function I1(d){return d.classList?am(d.classList):(d.getAttribute("class")||"").split(" ").filter(v=>v)}function hS(d){return"".concat(d).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function MP(d){return Object.keys(d||{}).reduce((v,I)=>v+"".concat(I,'="').concat(hS(d[I]),'" '),"").trim()}function f0(d){return Object.keys(d||{}).reduce((v,I)=>v+"".concat(I,": ").concat(d[I].trim(),";"),"")}function C1(d){return d.size!==qc.size||d.x!==qc.x||d.y!==qc.y||d.rotate!==qc.rotate||d.flipX||d.flipY}function IP(d){let{transform:v,containerWidth:I,iconWidth:O}=d;const U={transform:"translate(".concat(I/2," 256)")},$="translate(".concat(v.x*32,", ").concat(v.y*32,") "),ee="scale(".concat(v.size/16*(v.flipX?-1:1),", ").concat(v.size/16*(v.flipY?-1:1),") "),o="rotate(".concat(v.rotate," 0 0)"),ue={transform:"".concat($," ").concat(ee," ").concat(o)},Re={transform:"translate(".concat(O/2*-1," -256)")};return{outer:U,inner:ue,path:Re}}function CP(d){let{transform:v,width:I=Vv,height:O=Vv,startCentered:U=!1}=d,$="";return U&&eS?$+="translate(".concat(v.x/nf-I/2,"em, ").concat(v.y/nf-O/2,"em) "):U?$+="translate(calc(-50% + ".concat(v.x/nf,"em), calc(-50% + ").concat(v.y/nf,"em)) "):$+="translate(".concat(v.x/nf,"em, ").concat(v.y/nf,"em) "),$+="scale(".concat(v.size/nf*(v.flipX?-1:1),", ").concat(v.size/nf*(v.flipY?-1:1),") "),$+="rotate(".concat(v.rotate,"deg) "),$}var PP=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-regular: normal 400 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-light: normal 300 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-thin: normal 100 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-regular: normal 400 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-light: normal 300 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-thin: normal 100 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}`;function fS(){const d=oS,v=sS,I=zi.cssPrefix,O=zi.replacementClass;let U=PP;if(I!==d||O!==v){const $=new RegExp("\\.".concat(d,"\\-"),"g"),ee=new RegExp("\\--".concat(d,"\\-"),"g"),o=new RegExp("\\.".concat(v),"g");U=U.replace($,".".concat(I,"-")).replace(ee,"--".concat(I,"-")).replace(o,".".concat(O))}return U}let u2=!1;function gv(){zi.autoAddCss&&!u2&&(EP(fS()),u2=!0)}var RP={mixout(){return{dom:{css:fS,insertCss:gv}}},hooks(){return{beforeDOMElementCreation(){gv()},beforeI2svg(){gv()}}}};const Ku=cf||{};Ku[Yu]||(Ku[Yu]={});Ku[Yu].styles||(Ku[Yu].styles={});Ku[Yu].hooks||(Ku[Yu].hooks={});Ku[Yu].shims||(Ku[Yu].shims=[]);var $c=Ku[Yu];const dS=[],pS=function(){Vr.removeEventListener("DOMContentLoaded",pS),Zy=1,dS.map(d=>d())};let Zy=!1;eh&&(Zy=(Vr.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Vr.readyState),Zy||Vr.addEventListener("DOMContentLoaded",pS));function DP(d){eh&&(Zy?setTimeout(d,0):dS.push(d))}function G_(d){const{tag:v,attributes:I={},children:O=[]}=d;return typeof d=="string"?hS(d):"<".concat(v," ").concat(MP(I),">").concat(O.map(G_).join(""),"</").concat(v,">")}function h2(d,v,I){if(d&&d[v]&&d[v][I])return{prefix:v,iconName:I,icon:d[v][I]}}var yv=function(v,I,O,U){var $=Object.keys(v),ee=$.length,o=I,ue,Re,xe;for(O===void 0?(ue=1,xe=v[$[0]]):(ue=0,xe=O);ue<ee;ue++)Re=$[ue],xe=o(xe,v[Re],Re,v);return xe};function LP(d){const v=[];let I=0;const O=d.length;for(;I<O;){const U=d.charCodeAt(I++);if(U>=55296&&U<=56319&&I<O){const $=d.charCodeAt(I++);($&64512)==56320?v.push(((U&1023)<<10)+($&1023)+65536):(v.push(U),I--)}else v.push(U)}return v}function Hv(d){const v=LP(d);return v.length===1?v[0].toString(16):null}function zP(d,v){const I=d.length;let O=d.charCodeAt(v),U;return O>=55296&&O<=56319&&I>v+1&&(U=d.charCodeAt(v+1),U>=56320&&U<=57343)?(O-55296)*1024+U-56320+65536:O}function f2(d){return Object.keys(d).reduce((v,I)=>{const O=d[I];return!!O.icon?v[O.iconName]=O.icon:v[I]=O,v},{})}function Wv(d,v){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:O=!1}=I,U=f2(v);typeof $c.hooks.addPack=="function"&&!O?$c.hooks.addPack(d,f2(v)):$c.styles[d]=Jt(Jt({},$c.styles[d]||{}),U),d==="fas"&&Wv("fa",v)}const{styles:N_,shims:OP}=$c,mS=Object.keys(M1),kP=mS.reduce((d,v)=>(d[v]=Object.keys(M1[v]),d),{});let P1=null,_S={},gS={},yS={},xS={},vS={};function FP(d){return~bP.indexOf(d)}function BP(d,v){const I=v.split("-"),O=I[0],U=I.slice(1).join("-");return O===d&&U!==""&&!FP(U)?U:null}const bS=()=>{const d=O=>yv(N_,(U,$,ee)=>(U[ee]=yv($,O,{}),U),{});_S=d((O,U,$)=>(U[3]&&(O[U[3]]=$),U[2]&&U[2].filter(o=>typeof o=="number").forEach(o=>{O[o.toString(16)]=$}),O)),gS=d((O,U,$)=>(O[$]=$,U[2]&&U[2].filter(o=>typeof o=="string").forEach(o=>{O[o]=$}),O)),vS=d((O,U,$)=>{const ee=U[2];return O[$]=$,ee.forEach(o=>{O[o]=$}),O});const v="far"in N_||zi.autoFetchSvg,I=yv(OP,(O,U)=>{const $=U[0];let ee=U[1];const o=U[2];return ee==="far"&&!v&&(ee="fas"),typeof $=="string"&&(O.names[$]={prefix:ee,iconName:o}),typeof $=="number"&&(O.unicodes[$.toString(16)]={prefix:ee,iconName:o}),O},{names:{},unicodes:{}});yS=I.names,xS=I.unicodes,P1=d0(zi.styleDefault,{family:zi.familyDefault})};SP(d=>{P1=d0(d.styleDefault,{family:zi.familyDefault})});bS();function R1(d,v){return(_S[d]||{})[v]}function NP(d,v){return(gS[d]||{})[v]}function Vd(d,v){return(vS[d]||{})[v]}function wS(d){return yS[d]||{prefix:null,iconName:null}}function UP(d){const v=xS[d],I=R1("fas",d);return v||(I?{prefix:"fas",iconName:I}:null)||{prefix:null,iconName:null}}function uf(){return P1}const TS=()=>({prefix:null,iconName:null,rest:[]});function VP(d){let v=vs;const I=mS.reduce((O,U)=>(O[U]="".concat(zi.cssPrefix,"-").concat(U),O),{});return nS.forEach(O=>{(d.includes(I[O])||d.some(U=>kP[O].includes(U)))&&(v=O)}),v}function d0(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:I=vs}=v,O=_P[I][d];if(I===h0&&!d)return"fad";const U=c2[I][d]||c2[I][O],$=d in $c.styles?d:null;return U||$||null}function jP(d){let v=[],I=null;return d.forEach(O=>{const U=BP(zi.cssPrefix,O);U?I=U:O&&v.push(O)}),{iconName:I,rest:v}}function d2(d){return d.sort().filter((v,I,O)=>O.indexOf(v)===I)}function p0(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:I=!1}=v;let O=null;const U=Uv.concat(rP),$=d2(d.filter(Oe=>U.includes(Oe))),ee=d2(d.filter(Oe=>!Uv.includes(Oe))),o=$.filter(Oe=>(O=Oe,!iS.includes(Oe))),[ue=null]=o,Re=VP($),xe=Jt(Jt({},jP(ee)),{},{prefix:d0(ue,{family:Re})});return Jt(Jt(Jt({},xe),HP({values:d,family:Re,styles:N_,config:zi,canonical:xe,givenPrefix:O})),GP(I,O,xe))}function GP(d,v,I){let{prefix:O,iconName:U}=I;if(d||!O||!U)return{prefix:O,iconName:U};const $=v==="fa"?wS(U):{},ee=Vd(O,U);return U=$.iconName||ee||U,O=$.prefix||O,O==="far"&&!N_.far&&N_.fas&&!zi.autoFetchSvg&&(O="fas"),{prefix:O,iconName:U}}const qP=nS.filter(d=>d!==vs||d!==h0),$P=Object.keys(Nv).filter(d=>d!==vs).map(d=>Object.keys(Nv[d])).flat();function HP(d){const{values:v,family:I,canonical:O,givenPrefix:U="",styles:$={},config:ee={}}=d,o=I===h0,ue=v.includes("fa-duotone")||v.includes("fad"),Re=ee.familyDefault==="duotone",xe=O.prefix==="fad"||O.prefix==="fa-duotone";if(!o&&(ue||Re||xe)&&(O.prefix="fad"),(v.includes("fa-brands")||v.includes("fab"))&&(O.prefix="fab"),!O.prefix&&qP.includes(I)&&(Object.keys($).find(Ke=>$P.includes(Ke))||ee.autoFetchSvg)){const Ke=YC.get(I).defaultShortPrefixId;O.prefix=Ke,O.iconName=Vd(O.prefix,O.iconName)||O.iconName}return(O.prefix==="fa"||U==="fa")&&(O.prefix=uf()||"fas"),O}class WP{constructor(){this.definitions={}}add(){for(var v=arguments.length,I=new Array(v),O=0;O<v;O++)I[O]=arguments[O];const U=I.reduce(this._pullDefinitions,{});Object.keys(U).forEach($=>{this.definitions[$]=Jt(Jt({},this.definitions[$]||{}),U[$]),Wv($,U[$]);const ee=M1[vs][$];ee&&Wv(ee,U[$]),bS()})}reset(){this.definitions={}}_pullDefinitions(v,I){const O=I.prefix&&I.iconName&&I.icon?{0:I}:I;return Object.keys(O).map(U=>{const{prefix:$,iconName:ee,icon:o}=O[U],ue=o[2];v[$]||(v[$]={}),ue.length>0&&ue.forEach(Re=>{typeof Re=="string"&&(v[$][Re]=o)}),v[$][ee]=o}),v}}let p2=[],Zp={};const im={},ZP=Object.keys(im);function XP(d,v){let{mixoutsTo:I}=v;return p2=d,Zp={},Object.keys(im).forEach(O=>{ZP.indexOf(O)===-1&&delete im[O]}),p2.forEach(O=>{const U=O.mixout?O.mixout():{};if(Object.keys(U).forEach($=>{typeof U[$]=="function"&&(I[$]=U[$]),typeof U[$]=="object"&&Object.keys(U[$]).forEach(ee=>{I[$]||(I[$]={}),I[$][ee]=U[$][ee]})}),O.hooks){const $=O.hooks();Object.keys($).forEach(ee=>{Zp[ee]||(Zp[ee]=[]),Zp[ee].push($[ee])})}O.provides&&O.provides(im)}),I}function Zv(d,v){for(var I=arguments.length,O=new Array(I>2?I-2:0),U=2;U<I;U++)O[U-2]=arguments[U];return(Zp[d]||[]).forEach(ee=>{v=ee.apply(null,[v,...O])}),v}function $d(d){for(var v=arguments.length,I=new Array(v>1?v-1:0),O=1;O<v;O++)I[O-1]=arguments[O];(Zp[d]||[]).forEach($=>{$.apply(null,I)})}function hf(){const d=arguments[0],v=Array.prototype.slice.call(arguments,1);return im[d]?im[d].apply(null,v):void 0}function Xv(d){d.prefix==="fa"&&(d.prefix="fas");let{iconName:v}=d;const I=d.prefix||uf();if(v)return v=Vd(I,v)||v,h2(SS.definitions,I,v)||h2($c.styles,I,v)}const SS=new WP,YP=()=>{zi.autoReplaceSvg=!1,zi.observeMutations=!1,$d("noAuto")},KP={i2svg:function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return eh?($d("beforeI2svg",d),hf("pseudoElements2svg",d),hf("i2svg",d)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:v}=d;zi.autoReplaceSvg===!1&&(zi.autoReplaceSvg=!0),zi.observeMutations=!0,DP(()=>{QP({autoReplaceSvgRoot:v}),$d("watch",d)})}},JP={icon:d=>{if(d===null)return null;if(typeof d=="object"&&d.prefix&&d.iconName)return{prefix:d.prefix,iconName:Vd(d.prefix,d.iconName)||d.iconName};if(Array.isArray(d)&&d.length===2){const v=d[1].indexOf("fa-")===0?d[1].slice(3):d[1],I=d0(d[0]);return{prefix:I,iconName:Vd(I,v)||v}}if(typeof d=="string"&&(d.indexOf("".concat(zi.cssPrefix,"-"))>-1||d.match(gP))){const v=p0(d.split(" "),{skipLookups:!0});return{prefix:v.prefix||uf(),iconName:Vd(v.prefix,v.iconName)||v.iconName}}if(typeof d=="string"){const v=uf();return{prefix:v,iconName:Vd(v,d)||d}}}},Na={noAuto:YP,config:zi,dom:KP,parse:JP,library:SS,findIconDefinition:Xv,toHtml:G_},QP=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:v=Vr}=d;(Object.keys($c.styles).length>0||zi.autoFetchSvg)&&eh&&zi.autoReplaceSvg&&Na.dom.i2svg({node:v})};function m0(d,v){return Object.defineProperty(d,"abstract",{get:v}),Object.defineProperty(d,"html",{get:function(){return d.abstract.map(I=>G_(I))}}),Object.defineProperty(d,"node",{get:function(){if(!eh)return;const I=Vr.createElement("div");return I.innerHTML=d.html,I.children}}),d}function e3(d){let{children:v,main:I,mask:O,attributes:U,styles:$,transform:ee}=d;if(C1(ee)&&I.found&&!O.found){const{width:o,height:ue}=I,Re={x:o/ue/2,y:.5};U.style=f0(Jt(Jt({},$),{},{"transform-origin":"".concat(Re.x+ee.x/16,"em ").concat(Re.y+ee.y/16,"em")}))}return[{tag:"svg",attributes:U,children:v}]}function t3(d){let{prefix:v,iconName:I,children:O,attributes:U,symbol:$}=d;const ee=$===!0?"".concat(v,"-").concat(zi.cssPrefix,"-").concat(I):$;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Jt(Jt({},U),{},{id:ee}),children:O}]}]}function D1(d){const{icons:{main:v,mask:I},prefix:O,iconName:U,transform:$,symbol:ee,title:o,maskId:ue,titleId:Re,extra:xe,watchable:Oe=!1}=d,{width:Ke,height:st}=I.found?I:v,Rt=tP.includes(O),It=[zi.replacementClass,U?"".concat(zi.cssPrefix,"-").concat(U):""].filter(Ri=>xe.classes.indexOf(Ri)===-1).filter(Ri=>Ri!==""||!!Ri).concat(xe.classes).join(" ");let ri={children:[],attributes:Jt(Jt({},xe.attributes),{},{"data-prefix":O,"data-icon":U,class:It,role:xe.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(Ke," ").concat(st)})};const ft=Rt&&!~xe.classes.indexOf("fa-fw")?{width:"".concat(Ke/st*16*.0625,"em")}:{};Oe&&(ri.attributes[qd]=""),o&&(ri.children.push({tag:"title",attributes:{id:ri.attributes["aria-labelledby"]||"title-".concat(Re||B_())},children:[o]}),delete ri.attributes.title);const Dt=Jt(Jt({},ri),{},{prefix:O,iconName:U,main:v,mask:I,maskId:ue,transform:$,symbol:ee,styles:Jt(Jt({},ft),xe.styles)}),{children:Yt,attributes:At}=I.found&&v.found?hf("generateAbstractMask",Dt)||{children:[],attributes:{}}:hf("generateAbstractIcon",Dt)||{children:[],attributes:{}};return Dt.children=Yt,Dt.attributes=At,ee?t3(Dt):e3(Dt)}function m2(d){const{content:v,width:I,height:O,transform:U,title:$,extra:ee,watchable:o=!1}=d,ue=Jt(Jt(Jt({},ee.attributes),$?{title:$}:{}),{},{class:ee.classes.join(" ")});o&&(ue[qd]="");const Re=Jt({},ee.styles);C1(U)&&(Re.transform=CP({transform:U,startCentered:!0,width:I,height:O}),Re["-webkit-transform"]=Re.transform);const xe=f0(Re);xe.length>0&&(ue.style=xe);const Oe=[];return Oe.push({tag:"span",attributes:ue,children:[v]}),$&&Oe.push({tag:"span",attributes:{class:"sr-only"},children:[$]}),Oe}function i3(d){const{content:v,title:I,extra:O}=d,U=Jt(Jt(Jt({},O.attributes),I?{title:I}:{}),{},{class:O.classes.join(" ")}),$=f0(O.styles);$.length>0&&(U.style=$);const ee=[];return ee.push({tag:"span",attributes:U,children:[v]}),I&&ee.push({tag:"span",attributes:{class:"sr-only"},children:[I]}),ee}const{styles:xv}=$c;function Yv(d){const v=d[0],I=d[1],[O]=d.slice(4);let U=null;return Array.isArray(O)?U={tag:"g",attributes:{class:"".concat(zi.cssPrefix,"-").concat(_v.GROUP)},children:[{tag:"path",attributes:{class:"".concat(zi.cssPrefix,"-").concat(_v.SECONDARY),fill:"currentColor",d:O[0]}},{tag:"path",attributes:{class:"".concat(zi.cssPrefix,"-").concat(_v.PRIMARY),fill:"currentColor",d:O[1]}}]}:U={tag:"path",attributes:{fill:"currentColor",d:O}},{found:!0,width:v,height:I,icon:U}}const n3={found:!1,width:512,height:512};function r3(d,v){!aS&&!zi.showMissingIcons&&d&&console.error('Icon with name "'.concat(d,'" and prefix "').concat(v,'" is missing.'))}function Kv(d,v){let I=v;return v==="fa"&&zi.styleDefault!==null&&(v=uf()),new Promise((O,U)=>{if(I==="fa"){const $=wS(d)||{};d=$.iconName||d,v=$.prefix||v}if(d&&v&&xv[v]&&xv[v][d]){const $=xv[v][d];return O(Yv($))}r3(d,v),O(Jt(Jt({},n3),{},{icon:zi.showMissingIcons&&d?hf("missingIconAbstract")||{}:{}}))})}const _2=()=>{},Jv=zi.measurePerformance&&Dy&&Dy.mark&&Dy.measure?Dy:{mark:_2,measure:_2},x_='FA "6.7.1"',o3=d=>(Jv.mark("".concat(x_," ").concat(d," begins")),()=>ES(d)),ES=d=>{Jv.mark("".concat(x_," ").concat(d," ends")),Jv.measure("".concat(x_," ").concat(d),"".concat(x_," ").concat(d," begins"),"".concat(x_," ").concat(d," ends"))};var L1={begin:o3,end:ES};const Ny=()=>{};function g2(d){return typeof(d.getAttribute?d.getAttribute(qd):null)=="string"}function s3(d){const v=d.getAttribute?d.getAttribute(E1):null,I=d.getAttribute?d.getAttribute(A1):null;return v&&I}function a3(d){return d&&d.classList&&d.classList.contains&&d.classList.contains(zi.replacementClass)}function l3(){return zi.autoReplaceSvg===!0?Uy.replace:Uy[zi.autoReplaceSvg]||Uy.replace}function c3(d){return Vr.createElementNS("http://www.w3.org/2000/svg",d)}function u3(d){return Vr.createElement(d)}function AS(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:I=d.tag==="svg"?c3:u3}=v;if(typeof d=="string")return Vr.createTextNode(d);const O=I(d.tag);return Object.keys(d.attributes||[]).forEach(function($){O.setAttribute($,d.attributes[$])}),(d.children||[]).forEach(function($){O.appendChild(AS($,{ceFn:I}))}),O}function h3(d){let v=" ".concat(d.outerHTML," ");return v="".concat(v,"Font Awesome fontawesome.com "),v}const Uy={replace:function(d){const v=d[0];if(v.parentNode)if(d[1].forEach(I=>{v.parentNode.insertBefore(AS(I),v)}),v.getAttribute(qd)===null&&zi.keepOriginalSource){let I=Vr.createComment(h3(v));v.parentNode.replaceChild(I,v)}else v.remove()},nest:function(d){const v=d[0],I=d[1];if(~I1(v).indexOf(zi.replacementClass))return Uy.replace(d);const O=new RegExp("".concat(zi.cssPrefix,"-.*"));if(delete I[0].attributes.id,I[0].attributes.class){const $=I[0].attributes.class.split(" ").reduce((ee,o)=>(o===zi.replacementClass||o.match(O)?ee.toSvg.push(o):ee.toNode.push(o),ee),{toNode:[],toSvg:[]});I[0].attributes.class=$.toSvg.join(" "),$.toNode.length===0?v.removeAttribute("class"):v.setAttribute("class",$.toNode.join(" "))}const U=I.map($=>G_($)).join(`
`);v.setAttribute(qd,""),v.innerHTML=U}};function y2(d){d()}function MS(d,v){const I=typeof v=="function"?v:Ny;if(d.length===0)I();else{let O=y2;zi.mutateApproach===pP&&(O=cf.requestAnimationFrame||y2),O(()=>{const U=l3(),$=L1.begin("mutate");d.map(U),$(),I()})}}let z1=!1;function IS(){z1=!0}function Qv(){z1=!1}let Xy=null;function x2(d){if(!o2||!zi.observeMutations)return;const{treeCallback:v=Ny,nodeCallback:I=Ny,pseudoElementsCallback:O=Ny,observeMutationsRoot:U=Vr}=d;Xy=new o2($=>{if(z1)return;const ee=uf();am($).forEach(o=>{if(o.type==="childList"&&o.addedNodes.length>0&&!g2(o.addedNodes[0])&&(zi.searchPseudoElements&&O(o.target),v(o.target)),o.type==="attributes"&&o.target.parentNode&&zi.searchPseudoElements&&O(o.target.parentNode),o.type==="attributes"&&g2(o.target)&&~vP.indexOf(o.attributeName))if(o.attributeName==="class"&&s3(o.target)){const{prefix:ue,iconName:Re}=p0(I1(o.target));o.target.setAttribute(E1,ue||ee),Re&&o.target.setAttribute(A1,Re)}else a3(o.target)&&I(o.target)})}),eh&&Xy.observe(U,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function f3(){Xy&&Xy.disconnect()}function d3(d){const v=d.getAttribute("style");let I=[];return v&&(I=v.split(";").reduce((O,U)=>{const $=U.split(":"),ee=$[0],o=$.slice(1);return ee&&o.length>0&&(O[ee]=o.join(":").trim()),O},{})),I}function p3(d){const v=d.getAttribute("data-prefix"),I=d.getAttribute("data-icon"),O=d.innerText!==void 0?d.innerText.trim():"";let U=p0(I1(d));return U.prefix||(U.prefix=uf()),v&&I&&(U.prefix=v,U.iconName=I),U.iconName&&U.prefix||(U.prefix&&O.length>0&&(U.iconName=NP(U.prefix,d.innerText)||R1(U.prefix,Hv(d.innerText))),!U.iconName&&zi.autoFetchSvg&&d.firstChild&&d.firstChild.nodeType===Node.TEXT_NODE&&(U.iconName=d.firstChild.data)),U}function m3(d){const v=am(d.attributes).reduce((U,$)=>(U.name!=="class"&&U.name!=="style"&&(U[$.name]=$.value),U),{}),I=d.getAttribute("title"),O=d.getAttribute("data-fa-title-id");return zi.autoA11y&&(I?v["aria-labelledby"]="".concat(zi.replacementClass,"-title-").concat(O||B_()):(v["aria-hidden"]="true",v.focusable="false")),v}function _3(){return{iconName:null,title:null,titleId:null,prefix:null,transform:qc,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function v2(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:I,prefix:O,rest:U}=p3(d),$=m3(d),ee=Zv("parseNodeAttributes",{},d);let o=v.styleParser?d3(d):[];return Jt({iconName:I,title:d.getAttribute("title"),titleId:d.getAttribute("data-fa-title-id"),prefix:O,transform:qc,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:U,styles:o,attributes:$}},ee)}const{styles:g3}=$c;function CS(d){const v=zi.autoReplaceSvg==="nest"?v2(d,{styleParser:!1}):v2(d);return~v.extra.classes.indexOf(cS)?hf("generateLayersText",d,v):hf("generateSvgReplacementMutation",d,v)}function y3(){return[...JC,...Uv]}function b2(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!eh)return Promise.resolve();const I=Vr.documentElement.classList,O=xe=>I.add("".concat(l2,"-").concat(xe)),U=xe=>I.remove("".concat(l2,"-").concat(xe)),$=zi.autoFetchSvg?y3():iS.concat(Object.keys(g3));$.includes("fa")||$.push("fa");const ee=[".".concat(cS,":not([").concat(qd,"])")].concat($.map(xe=>".".concat(xe,":not([").concat(qd,"])"))).join(", ");if(ee.length===0)return Promise.resolve();let o=[];try{o=am(d.querySelectorAll(ee))}catch{}if(o.length>0)O("pending"),U("complete");else return Promise.resolve();const ue=L1.begin("onTree"),Re=o.reduce((xe,Oe)=>{try{const Ke=CS(Oe);Ke&&xe.push(Ke)}catch(Ke){aS||Ke.name==="MissingIcon"&&console.error(Ke)}return xe},[]);return new Promise((xe,Oe)=>{Promise.all(Re).then(Ke=>{MS(Ke,()=>{O("active"),O("complete"),U("pending"),typeof v=="function"&&v(),ue(),xe()})}).catch(Ke=>{ue(),Oe(Ke)})})}function x3(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;CS(d).then(I=>{I&&MS([I],v)})}function v3(d){return function(v){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const O=(v||{}).icon?v:Xv(v||{});let{mask:U}=I;return U&&(U=(U||{}).icon?U:Xv(U||{})),d(O,Jt(Jt({},I),{},{mask:U}))}}const b3=function(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:I=qc,symbol:O=!1,mask:U=null,maskId:$=null,title:ee=null,titleId:o=null,classes:ue=[],attributes:Re={},styles:xe={}}=v;if(!d)return;const{prefix:Oe,iconName:Ke,icon:st}=d;return m0(Jt({type:"icon"},d),()=>($d("beforeDOMElementCreation",{iconDefinition:d,params:v}),zi.autoA11y&&(ee?Re["aria-labelledby"]="".concat(zi.replacementClass,"-title-").concat(o||B_()):(Re["aria-hidden"]="true",Re.focusable="false")),D1({icons:{main:Yv(st),mask:U?Yv(U.icon):{found:!1,width:null,height:null,icon:{}}},prefix:Oe,iconName:Ke,transform:Jt(Jt({},qc),I),symbol:O,title:ee,maskId:$,titleId:o,extra:{attributes:Re,styles:xe,classes:ue}})))};var w3={mixout(){return{icon:v3(b3)}},hooks(){return{mutationObserverCallbacks(d){return d.treeCallback=b2,d.nodeCallback=x3,d}}},provides(d){d.i2svg=function(v){const{node:I=Vr,callback:O=()=>{}}=v;return b2(I,O)},d.generateSvgReplacementMutation=function(v,I){const{iconName:O,title:U,titleId:$,prefix:ee,transform:o,symbol:ue,mask:Re,maskId:xe,extra:Oe}=I;return new Promise((Ke,st)=>{Promise.all([Kv(O,ee),Re.iconName?Kv(Re.iconName,Re.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(Rt=>{let[It,ri]=Rt;Ke([v,D1({icons:{main:It,mask:ri},prefix:ee,iconName:O,transform:o,symbol:ue,maskId:xe,title:U,titleId:$,extra:Oe,watchable:!0})])}).catch(st)})},d.generateAbstractIcon=function(v){let{children:I,attributes:O,main:U,transform:$,styles:ee}=v;const o=f0(ee);o.length>0&&(O.style=o);let ue;return C1($)&&(ue=hf("generateAbstractTransformGrouping",{main:U,transform:$,containerWidth:U.width,iconWidth:U.width})),I.push(ue||U.icon),{children:I,attributes:O}}}},T3={mixout(){return{layer(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:I=[]}=v;return m0({type:"layer"},()=>{$d("beforeDOMElementCreation",{assembler:d,params:v});let O=[];return d(U=>{Array.isArray(U)?U.map($=>{O=O.concat($.abstract)}):O=O.concat(U.abstract)}),[{tag:"span",attributes:{class:["".concat(zi.cssPrefix,"-layers"),...I].join(" ")},children:O}]})}}}},S3={mixout(){return{counter(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:I=null,classes:O=[],attributes:U={},styles:$={}}=v;return m0({type:"counter",content:d},()=>($d("beforeDOMElementCreation",{content:d,params:v}),i3({content:d.toString(),title:I,extra:{attributes:U,styles:$,classes:["".concat(zi.cssPrefix,"-layers-counter"),...O]}})))}}}},E3={mixout(){return{text(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:I=qc,title:O=null,classes:U=[],attributes:$={},styles:ee={}}=v;return m0({type:"text",content:d},()=>($d("beforeDOMElementCreation",{content:d,params:v}),m2({content:d,transform:Jt(Jt({},qc),I),title:O,extra:{attributes:$,styles:ee,classes:["".concat(zi.cssPrefix,"-layers-text"),...U]}})))}}},provides(d){d.generateLayersText=function(v,I){const{title:O,transform:U,extra:$}=I;let ee=null,o=null;if(eS){const ue=parseInt(getComputedStyle(v).fontSize,10),Re=v.getBoundingClientRect();ee=Re.width/ue,o=Re.height/ue}return zi.autoA11y&&!O&&($.attributes["aria-hidden"]="true"),Promise.resolve([v,m2({content:v.innerHTML,width:ee,height:o,transform:U,title:O,extra:$,watchable:!0})])}}};const A3=new RegExp('"',"ug"),w2=[1105920,1112319],T2=Jt(Jt(Jt(Jt({},{FontAwesome:{normal:"fas",400:"fas"}}),XC),fP),oP),e1=Object.keys(T2).reduce((d,v)=>(d[v.toLowerCase()]=T2[v],d),{}),M3=Object.keys(e1).reduce((d,v)=>{const I=e1[v];return d[v]=I[900]||[...Object.entries(I)][0][1],d},{});function I3(d){const v=d.replace(A3,""),I=zP(v,0),O=I>=w2[0]&&I<=w2[1],U=v.length===2?v[0]===v[1]:!1;return{value:Hv(U?v[0]:v),isSecondary:O||U}}function C3(d,v){const I=d.replace(/^['"]|['"]$/g,"").toLowerCase(),O=parseInt(v),U=isNaN(O)?"normal":O;return(e1[I]||{})[U]||M3[I]}function S2(d,v){const I="".concat(dP).concat(v.replace(":","-"));return new Promise((O,U)=>{if(d.getAttribute(I)!==null)return O();const ee=am(d.children).filter(Ke=>Ke.getAttribute(jv)===v)[0],o=cf.getComputedStyle(d,v),ue=o.getPropertyValue("font-family"),Re=ue.match(yP),xe=o.getPropertyValue("font-weight"),Oe=o.getPropertyValue("content");if(ee&&!Re)return d.removeChild(ee),O();if(Re&&Oe!=="none"&&Oe!==""){const Ke=o.getPropertyValue("content");let st=C3(ue,xe);const{value:Rt,isSecondary:It}=I3(Ke),ri=Re[0].startsWith("FontAwesome");let ft=R1(st,Rt),Dt=ft;if(ri){const Yt=UP(Rt);Yt.iconName&&Yt.prefix&&(ft=Yt.iconName,st=Yt.prefix)}if(ft&&!It&&(!ee||ee.getAttribute(E1)!==st||ee.getAttribute(A1)!==Dt)){d.setAttribute(I,Dt),ee&&d.removeChild(ee);const Yt=_3(),{extra:At}=Yt;At.attributes[jv]=v,Kv(ft,st).then(Ri=>{const Sn=D1(Jt(Jt({},Yt),{},{icons:{main:Ri,mask:TS()},prefix:st,iconName:Dt,extra:At,watchable:!0})),Ut=Vr.createElementNS("http://www.w3.org/2000/svg","svg");v==="::before"?d.insertBefore(Ut,d.firstChild):d.appendChild(Ut),Ut.outerHTML=Sn.map(cr=>G_(cr)).join(`
`),d.removeAttribute(I),O()}).catch(U)}else O()}else O()})}function P3(d){return Promise.all([S2(d,"::before"),S2(d,"::after")])}function R3(d){return d.parentNode!==document.head&&!~mP.indexOf(d.tagName.toUpperCase())&&!d.getAttribute(jv)&&(!d.parentNode||d.parentNode.tagName!=="svg")}function E2(d){if(eh)return new Promise((v,I)=>{const O=am(d.querySelectorAll("*")).filter(R3).map(P3),U=L1.begin("searchPseudoElements");IS(),Promise.all(O).then(()=>{U(),Qv(),v()}).catch(()=>{U(),Qv(),I()})})}var D3={hooks(){return{mutationObserverCallbacks(d){return d.pseudoElementsCallback=E2,d}}},provides(d){d.pseudoElements2svg=function(v){const{node:I=Vr}=v;zi.searchPseudoElements&&E2(I)}}};let A2=!1;var L3={mixout(){return{dom:{unwatch(){IS(),A2=!0}}}},hooks(){return{bootstrap(){x2(Zv("mutationObserverCallbacks",{}))},noAuto(){f3()},watch(d){const{observeMutationsRoot:v}=d;A2?Qv():x2(Zv("mutationObserverCallbacks",{observeMutationsRoot:v}))}}}};const M2=d=>{let v={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return d.toLowerCase().split(" ").reduce((I,O)=>{const U=O.toLowerCase().split("-"),$=U[0];let ee=U.slice(1).join("-");if($&&ee==="h")return I.flipX=!0,I;if($&&ee==="v")return I.flipY=!0,I;if(ee=parseFloat(ee),isNaN(ee))return I;switch($){case"grow":I.size=I.size+ee;break;case"shrink":I.size=I.size-ee;break;case"left":I.x=I.x-ee;break;case"right":I.x=I.x+ee;break;case"up":I.y=I.y-ee;break;case"down":I.y=I.y+ee;break;case"rotate":I.rotate=I.rotate+ee;break}return I},v)};var z3={mixout(){return{parse:{transform:d=>M2(d)}}},hooks(){return{parseNodeAttributes(d,v){const I=v.getAttribute("data-fa-transform");return I&&(d.transform=M2(I)),d}}},provides(d){d.generateAbstractTransformGrouping=function(v){let{main:I,transform:O,containerWidth:U,iconWidth:$}=v;const ee={transform:"translate(".concat(U/2," 256)")},o="translate(".concat(O.x*32,", ").concat(O.y*32,") "),ue="scale(".concat(O.size/16*(O.flipX?-1:1),", ").concat(O.size/16*(O.flipY?-1:1),") "),Re="rotate(".concat(O.rotate," 0 0)"),xe={transform:"".concat(o," ").concat(ue," ").concat(Re)},Oe={transform:"translate(".concat($/2*-1," -256)")},Ke={outer:ee,inner:xe,path:Oe};return{tag:"g",attributes:Jt({},Ke.outer),children:[{tag:"g",attributes:Jt({},Ke.inner),children:[{tag:I.icon.tag,children:I.icon.children,attributes:Jt(Jt({},I.icon.attributes),Ke.path)}]}]}}}};const vv={x:0,y:0,width:"100%",height:"100%"};function I2(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return d.attributes&&(d.attributes.fill||v)&&(d.attributes.fill="black"),d}function O3(d){return d.tag==="g"?d.children:[d]}var k3={hooks(){return{parseNodeAttributes(d,v){const I=v.getAttribute("data-fa-mask"),O=I?p0(I.split(" ").map(U=>U.trim())):TS();return O.prefix||(O.prefix=uf()),d.mask=O,d.maskId=v.getAttribute("data-fa-mask-id"),d}}},provides(d){d.generateAbstractMask=function(v){let{children:I,attributes:O,main:U,mask:$,maskId:ee,transform:o}=v;const{width:ue,icon:Re}=U,{width:xe,icon:Oe}=$,Ke=IP({transform:o,containerWidth:xe,iconWidth:ue}),st={tag:"rect",attributes:Jt(Jt({},vv),{},{fill:"white"})},Rt=Re.children?{children:Re.children.map(I2)}:{},It={tag:"g",attributes:Jt({},Ke.inner),children:[I2(Jt({tag:Re.tag,attributes:Jt(Jt({},Re.attributes),Ke.path)},Rt))]},ri={tag:"g",attributes:Jt({},Ke.outer),children:[It]},ft="mask-".concat(ee||B_()),Dt="clip-".concat(ee||B_()),Yt={tag:"mask",attributes:Jt(Jt({},vv),{},{id:ft,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[st,ri]},At={tag:"defs",children:[{tag:"clipPath",attributes:{id:Dt},children:O3(Oe)},Yt]};return I.push(At,{tag:"rect",attributes:Jt({fill:"currentColor","clip-path":"url(#".concat(Dt,")"),mask:"url(#".concat(ft,")")},vv)}),{children:I,attributes:O}}}},F3={provides(d){let v=!1;cf.matchMedia&&(v=cf.matchMedia("(prefers-reduced-motion: reduce)").matches),d.missingIconAbstract=function(){const I=[],O={fill:"currentColor"},U={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};I.push({tag:"path",attributes:Jt(Jt({},O),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});const $=Jt(Jt({},U),{},{attributeName:"opacity"}),ee={tag:"circle",attributes:Jt(Jt({},O),{},{cx:"256",cy:"364",r:"28"}),children:[]};return v||ee.children.push({tag:"animate",attributes:Jt(Jt({},U),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:Jt(Jt({},$),{},{values:"1;0;1;1;0;1;"})}),I.push(ee),I.push({tag:"path",attributes:Jt(Jt({},O),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:v?[]:[{tag:"animate",attributes:Jt(Jt({},$),{},{values:"1;0;0;0;0;1;"})}]}),v||I.push({tag:"path",attributes:Jt(Jt({},O),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:Jt(Jt({},$),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:I}}}},B3={hooks(){return{parseNodeAttributes(d,v){const I=v.getAttribute("data-fa-symbol"),O=I===null?!1:I===""?!0:I;return d.symbol=O,d}}}},N3=[RP,w3,T3,S3,E3,D3,L3,z3,k3,F3,B3];XP(N3,{mixoutsTo:Na});Na.noAuto;Na.config;const U3=Na.library;Na.dom;const t1=Na.parse;Na.findIconDefinition;Na.toHtml;const V3=Na.icon;Na.layer;Na.text;Na.counter;function C2(d,v){var I=Object.keys(d);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(d);v&&(O=O.filter(function(U){return Object.getOwnPropertyDescriptor(d,U).enumerable})),I.push.apply(I,O)}return I}function Zu(d){for(var v=1;v<arguments.length;v++){var I=arguments[v]!=null?arguments[v]:{};v%2?C2(Object(I),!0).forEach(function(O){fa(d,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(I)):C2(Object(I)).forEach(function(O){Object.defineProperty(d,O,Object.getOwnPropertyDescriptor(I,O))})}return d}function j3(d,v){if(typeof d!="object"||!d)return d;var I=d[Symbol.toPrimitive];if(I!==void 0){var O=I.call(d,v||"default");if(typeof O!="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(d)}function G3(d){var v=j3(d,"string");return typeof v=="symbol"?v:v+""}function Yy(d){"@babel/helpers - typeof";return Yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},Yy(d)}function fa(d,v,I){return v=G3(v),v in d?Object.defineProperty(d,v,{value:I,enumerable:!0,configurable:!0,writable:!0}):d[v]=I,d}function q3(d,v){if(d==null)return{};var I={};for(var O in d)if(Object.prototype.hasOwnProperty.call(d,O)){if(v.indexOf(O)>=0)continue;I[O]=d[O]}return I}function $3(d,v){if(d==null)return{};var I=q3(d,v),O,U;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(d);for(U=0;U<$.length;U++)O=$[U],!(v.indexOf(O)>=0)&&Object.prototype.propertyIsEnumerable.call(d,O)&&(I[O]=d[O])}return I}var H3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},PS={exports:{}};(function(d){(function(v){var I=function(ft,Dt,Yt){if(!Re(Dt)||Oe(Dt)||Ke(Dt)||st(Dt)||ue(Dt))return Dt;var At,Ri=0,Sn=0;if(xe(Dt))for(At=[],Sn=Dt.length;Ri<Sn;Ri++)At.push(I(ft,Dt[Ri],Yt));else{At={};for(var Ut in Dt)Object.prototype.hasOwnProperty.call(Dt,Ut)&&(At[ft(Ut,Yt)]=I(ft,Dt[Ut],Yt))}return At},O=function(ft,Dt){Dt=Dt||{};var Yt=Dt.separator||"_",At=Dt.split||/(?=[A-Z])/;return ft.split(At).join(Yt)},U=function(ft){return Rt(ft)?ft:(ft=ft.replace(/[\-_\s]+(.)?/g,function(Dt,Yt){return Yt?Yt.toUpperCase():""}),ft.substr(0,1).toLowerCase()+ft.substr(1))},$=function(ft){var Dt=U(ft);return Dt.substr(0,1).toUpperCase()+Dt.substr(1)},ee=function(ft,Dt){return O(ft,Dt).toLowerCase()},o=Object.prototype.toString,ue=function(ft){return typeof ft=="function"},Re=function(ft){return ft===Object(ft)},xe=function(ft){return o.call(ft)=="[object Array]"},Oe=function(ft){return o.call(ft)=="[object Date]"},Ke=function(ft){return o.call(ft)=="[object RegExp]"},st=function(ft){return o.call(ft)=="[object Boolean]"},Rt=function(ft){return ft=ft-0,ft===ft},It=function(ft,Dt){var Yt=Dt&&"process"in Dt?Dt.process:Dt;return typeof Yt!="function"?ft:function(At,Ri){return Yt(At,ft,Ri)}},ri={camelize:U,decamelize:ee,pascalize:$,depascalize:ee,camelizeKeys:function(ft,Dt){return I(It(U,Dt),ft)},decamelizeKeys:function(ft,Dt){return I(It(ee,Dt),ft,Dt)},pascalizeKeys:function(ft,Dt){return I(It($,Dt),ft)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};d.exports?d.exports=ri:v.humps=ri})(H3)})(PS);var W3=PS.exports,Z3=["class","style"];function X3(d){return d.split(";").map(function(v){return v.trim()}).filter(function(v){return v}).reduce(function(v,I){var O=I.indexOf(":"),U=W3.camelize(I.slice(0,O)),$=I.slice(O+1).trim();return v[U]=$,v},{})}function Y3(d){return d.split(/\s+/).reduce(function(v,I){return v[I]=!0,v},{})}function RS(d){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof d=="string")return d;var O=(d.children||[]).map(function(ue){return RS(ue)}),U=Object.keys(d.attributes||{}).reduce(function(ue,Re){var xe=d.attributes[Re];switch(Re){case"class":ue.class=Y3(xe);break;case"style":ue.style=X3(xe);break;default:ue.attrs[Re]=xe}return ue},{attrs:{},class:{},style:{}});I.class;var $=I.style,ee=$===void 0?{}:$,o=$3(I,Z3);return b1(d.tag,Zu(Zu(Zu({},v),{},{class:U.class,style:Zu(Zu({},U.style),ee)},U.attrs),o),O)}var DS=!1;try{DS=!0}catch{}function K3(){if(!DS&&console&&typeof console.error=="function"){var d;(d=console).error.apply(d,arguments)}}function bv(d,v){return Array.isArray(v)&&v.length>0||!Array.isArray(v)&&v?fa({},d,v):{}}function J3(d){var v,I=(v={"fa-spin":d.spin,"fa-pulse":d.pulse,"fa-fw":d.fixedWidth,"fa-border":d.border,"fa-li":d.listItem,"fa-inverse":d.inverse,"fa-flip":d.flip===!0,"fa-flip-horizontal":d.flip==="horizontal"||d.flip==="both","fa-flip-vertical":d.flip==="vertical"||d.flip==="both"},fa(fa(fa(fa(fa(fa(fa(fa(fa(fa(v,"fa-".concat(d.size),d.size!==null),"fa-rotate-".concat(d.rotation),d.rotation!==null),"fa-pull-".concat(d.pull),d.pull!==null),"fa-swap-opacity",d.swapOpacity),"fa-bounce",d.bounce),"fa-shake",d.shake),"fa-beat",d.beat),"fa-fade",d.fade),"fa-beat-fade",d.beatFade),"fa-flash",d.flash),fa(fa(v,"fa-spin-pulse",d.spinPulse),"fa-spin-reverse",d.spinReverse));return Object.keys(I).map(function(O){return I[O]?O:null}).filter(function(O){return O})}function P2(d){if(d&&Yy(d)==="object"&&d.prefix&&d.iconName&&d.icon)return d;if(t1.icon)return t1.icon(d);if(d===null)return null;if(Yy(d)==="object"&&d.prefix&&d.iconName)return d;if(Array.isArray(d)&&d.length===2)return{prefix:d[0],iconName:d[1]};if(typeof d=="string")return{prefix:"fas",iconName:d}}var Q3=g1({name:"FontAwesomeIcon",props:{border:{type:Boolean,default:!1},fixedWidth:{type:Boolean,default:!1},flip:{type:[Boolean,String],default:!1,validator:function(v){return[!0,!1,"horizontal","vertical","both"].indexOf(v)>-1}},icon:{type:[Object,Array,String],required:!0},mask:{type:[Object,Array,String],default:null},maskId:{type:String,default:null},listItem:{type:Boolean,default:!1},pull:{type:String,default:null,validator:function(v){return["right","left"].indexOf(v)>-1}},pulse:{type:Boolean,default:!1},rotation:{type:[String,Number],default:null,validator:function(v){return[90,180,270].indexOf(Number.parseInt(v,10))>-1}},swapOpacity:{type:Boolean,default:!1},size:{type:String,default:null,validator:function(v){return["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"].indexOf(v)>-1}},spin:{type:Boolean,default:!1},transform:{type:[String,Object],default:null},symbol:{type:[Boolean,String],default:!1},title:{type:String,default:null},titleId:{type:String,default:null},inverse:{type:Boolean,default:!1},bounce:{type:Boolean,default:!1},shake:{type:Boolean,default:!1},beat:{type:Boolean,default:!1},fade:{type:Boolean,default:!1},beatFade:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},spinPulse:{type:Boolean,default:!1},spinReverse:{type:Boolean,default:!1}},setup:function(v,I){var O=I.attrs,U=Qo(function(){return P2(v.icon)}),$=Qo(function(){return bv("classes",J3(v))}),ee=Qo(function(){return bv("transform",typeof v.transform=="string"?t1.transform(v.transform):v.transform)}),o=Qo(function(){return bv("mask",P2(v.mask))}),ue=Qo(function(){return V3(U.value,Zu(Zu(Zu(Zu({},$.value),ee.value),o.value),{},{symbol:v.symbol,title:v.title,titleId:v.titleId,maskId:v.maskId}))});S_(ue,function(xe){if(!xe)return K3("Could not find one or more icon(s)",U.value,o.value)},{immediate:!0});var Re=Qo(function(){return ue.value?RS(ue.value.abstract[0],{},O):null});return function(){return Re.value}}});/*!
 * Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2024 Fonticons, Inc.
 */const eR={prefix:"fas",iconName:"location-crosshairs",icon:[512,512,["location"],"f601","M256 0c17.7 0 32 14.3 32 32l0 34.7C368.4 80.1 431.9 143.6 445.3 224l34.7 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-34.7 0C431.9 368.4 368.4 431.9 288 445.3l0 34.7c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-34.7C143.6 431.9 80.1 368.4 66.7 288L32 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l34.7 0C80.1 143.6 143.6 80.1 224 66.7L224 32c0-17.7 14.3-32 32-32zM128 256a128 128 0 1 0 256 0 128 128 0 1 0 -256 0zm128-80a80 80 0 1 1 0 160 80 80 0 1 1 0-160z"]},tR=eR,iR={prefix:"fas",iconName:"magnifying-glass",icon:[512,512,[128269,"search"],"f002","M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"]},nR=iR;U3.add(nR,tR);const O1=eI(hI);O1.use(NC);O1.component("font-awesome-icon",Q3);O1.mount("#app");
